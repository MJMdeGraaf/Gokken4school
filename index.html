<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Goksite PWS ‚Äî Multiplayer Blackjack</title>
  <style>
    /* ============================
   LEADERBOARD TAB STYLE
   ============================ */
#lb-tab{
    position: fixed;
    right: 20px;
    bottom: 20px;
    background: gold;
    padding: 12px 20px;
    border-radius: 16px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 0 10px rgba(0,0,0,0.4);
    z-index: 9999;
}

/* ============================
   POPUP WINDOW
   ============================ */
#lb-popup{
    position: fixed;
    bottom: 0;
    right: 0;
    width: 350px;
    height: 450px;
    background: rgba(0,0,0,0.80);
    border-radius: 20px 0 0 0;
    display: none;
    z-index: 99999;
    color: white;
}

#lb-popup-inner{
    padding: 20px;
    height: 100%;
    position: relative;
}

/* ============================
   ARROWS
   ============================ */
.lb-arrow{
    position: absolute;
    top: 15px;
    font-size: 26px;
    cursor: pointer;
    user-select: none;
}
#lb-left{ left: 10px; }
#lb-right{ right: 10px; }

/* ============================
   CONTENT AREA
   ============================ */
#lb-content{
    margin-top: 60px;
    height: 330px;
    overflow-y: auto;
    font-size: 18px;
}

#lb-close{
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 8px 20px;
    border-radius: 10px;
    cursor: pointer;
}

    body { margin:0; font-family: system-ui, sans-serif; }
    /* Dashboard Hoofdmenu */
    #login, #dashboard, #blackjackSection { display: none; padding: 20px; text-align:center; }
    #login { background: #f0f0f0; height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; }
    #dashboard { background: linear-gradient(to bottom, #ffffff, #e0e0e0); height:100vh; }
    #dashboard h2, #login h2 { margin-bottom:10px; }
    button { padding: 10px 18px; margin: 10px; border-radius: 8px; border:none; cursor:pointer; }

    /* Muziekknop */
    #musicMenu{
  position: fixed;
  right: 20px;
  bottom: 70px;
  width: 300px;
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 15px;
  border-radius: 12px;
  display: none;
  z-index: 99999;
}

#musicMenuInner{
  text-align: center;
}

#musicMenu input[type=range]{
  width: 80%;
}

    /* Blackjack sectie */
    #blackjackSection { background: #2f1e0f; height:100vh; color:white; }
    .table-container { position:relative; width: 90%; max-width: 900px; margin: 50px auto; height:600px; }
    .table { background: #8b5a2b; border-radius: 50%; width:100%; height:100%; position:relative; }
    .player-area { position:absolute; text-align:center; }
    .cards { display:flex; justify-content:center; gap:5px; margin-top:8px; }
    .card-bj { width:80px; height:120px; background:white; color:black; border-radius:6px; display:flex; justify-content:center; align-items:center; font-weight:bold; }
    .chair { width:40px; height:40px; background:#333; border-radius:50%; position:absolute; }
    #controls { margin-top:20px; }
  </style>
</head>
<body>

  <!-- Login / Account aanmaken -->
  <section id="login">
    <h2>Welkom! Maak een account of log in</h2>
    <input type="text" id="usernameInput" placeholder="Gebruikersnaam">
    <button id="loginBtn">Login / Maak account</button>
  </section>

  <!-- Dashboard -->
  <section id="dashboard">
    <h2>Welkom, <span id="displayName"></span></h2>
    <p>Credits: <span id="credits"></span></p>
    <button id="claimDailyBtn">Claim dagelijkse bonus</button><br>
    <button id="playBlackjackBtn">Speel Blackjack</button>
    <button id="logoutBtn">Uitloggen</button>
    <audio id="bgMusic" loop>
  <source src="https://cdn.pixabay.com/audio/2023/03/07/audio_2ea36d1deb.mp3" type="audio/mpeg"> <!-- Funky upbeat -->
  <source src="https://cdn.pixabay.com/audio/2023/03/15/audio_e3bbcbfce7.mp3" type="audio/mpeg"> <!-- Electronic chill -->
  <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_8f17fc4b42.mp3" type="audio/mpeg"> <!-- Chill lounge -->
</audio>
<button id="musicControl">üéµ Muziek</button>

  </section>

  <!-- Blackjack -->
  <section id="blackjackSection">
    <h2>Blackjack</h2>
    <div>
      <label>Kies aantal bots:</label>
      <select id="botCount">
        <option value="0">0 bots</option>
        <option value="1">1 bot</option>
        <option value="2">2 bots</option>
        <option value="3">3 bots</option>
      </select>
      <button id="startGame">Start spel</button>
      <button id="backToMenu">Terug naar menu</button>
    </div>
    <div class="table-container">
      <div class="table" id="table">
        <!-- Stoelen + spelergebieden komen hier dynamisch -->
      </div>
    </div>
    <div id="controls">
      <button id="hitBtn">Hit</button>
      <button id="standBtn">Stand</button>
      <button id="nextRoundBtn" style="display:none">Volgende ronde</button>
    </div>
  </section>

  <script>
    // ===== Accountsysteem =====
    let users = JSON.parse(localStorage.getItem('users') || '{}');
    let currentUser = null;

    const loginSection = document.getElementById('login');
    const dashboard = document.getElementById('dashboard');
    const blackjackSection = document.getElementById('blackjackSection');

    const usernameInput = document.getElementById('usernameInput');
    const loginBtn = document.getElementById('loginBtn');
    const displayName = document.getElementById('displayName');
    const creditsEl = document.getElementById('credits');
    const claimDailyBtn = document.getElementById('claimDailyBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const playBlackjackBtn = document.getElementById('playBlackjackBtn');
    const bgMusic = document.getElementById('bgMusic');
    const musicControl = document.getElementById('musicControl');

    function renderDashboard(){
      displayName.textContent = currentUser.name;
      creditsEl.textContent = currentUser.credits;
    }

    loginBtn.onclick = ()=>{
      const name = usernameInput.value.trim();
      if(!name) return alert('Vul een gebruikersnaam in.');
      if(!users[name]) users[name]={credits:500,lastDaily:null,name:name};
      currentUser = users[name];
      localStorage.setItem('users', JSON.stringify(users));
      loginSection.style.display='none';
      dashboard.style.display='block';
      renderDashboard();
      bgMusic.play().catch(()=>{});
    };

    logoutBtn.onclick = ()=>{
      currentUser=null;
      dashboard.style.display='none';
      loginSection.style.display='flex';
      bgMusic.pause();
    };

    claimDailyBtn.onclick = ()=>{
      const today = new Date().toDateString();
      if(currentUser.lastDaily !== today){
        currentUser.credits += 100;
        currentUser.lastDaily = today;
        users[currentUser.name]=currentUser;
        localStorage.setItem('users', JSON.stringify(users));
        renderDashboard();
        alert('Dagelijkse bonus van 100 credits geclaimd!');
      } else { alert('Je hebt vandaag al je bonus geclaimd.'); }
    };

    musicControl.onclick = ()=>{ bgMusic.paused?bgMusic.play():bgMusic.pause(); };

    // ===== Navigatie naar Blackjack =====
    playBlackjackBtn.onclick = ()=>{
      dashboard.style.display='none';
      blackjackSection.style.display='block';
    };

    const backToMenu = document.getElementById('backToMenu');
    backToMenu.onclick = ()=>{
      blackjackSection.style.display='none';
      dashboard.style.display='block';
    };

    // ===== Blackjack logica =====
    const suits=['‚ô†','‚ô•','‚ô¶','‚ô£'];
    const values=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    let deck=[];

    function createDeck(){ deck=[]; for(let s of suits){for(let v of values){deck.push({suit:s,value:v});}} for(let i=deck.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; } }
    function cardValue(card){ if(['J','Q','K'].includes(card.value)) return 10; if(card.value==='A') return 11; return parseInt(card.value); }
    function handValue(hand){ let total=0, aces=0; for(let c of hand){ total+=cardValue(c); if(c.value==='A') aces++; } while(total>21 && aces>0){ total-=10; aces--; } return total; }

    const startGameBtn = document.getElementById('startGame');
    const botSelect = document.getElementById('botCount');
    const table = document.getElementById('table');
    const hitBtn = document.getElementById('hitBtn');
    const standBtn = document.getElementById('standBtn');
    const nextRoundBtn = document.getElementById('nextRoundBtn');

    let players=[];
    let dealer={hand:[]};
    let currentPlayerIndex=0;

    function drawCard(){ return deck.pop(); }

function placePlayers(){
  table.innerHTML = '';
  const centerX = table.clientWidth / 2;
  const centerY = table.clientHeight / 2;
  const kaartOffset = 60;
  const kaartWidth = 80;
  const kaartHeight = 120;
// Pas radius aan zodat cirkel perfect binnen de tafel past
const radius = Math.min(table.clientWidth, table.clientHeight) / 2 - kaartOffset;

  // Hoeken
  const dealerAngle = 6*Math.PI/4;       // Dealer boven
  const playerAngle = 2*Math.PI/4; // Speler onder
  const botAngles = [
      0,// 0¬∞
      Math.PI/4,   // 45¬∞
      3*Math.PI/4, // 135¬∞
      4*Math.PI/4, // 180¬∞
      5*Math.PI/4, // 225¬∞
      7*Math.PI/4  // 315¬∞  
  ];

  function getCirclePosition(angleRad, radius, centerX, centerY){
      const x = centerX + radius * Math.cos(angleRad);
      const y = centerY + radius * Math.sin(angleRad);
      return {x, y};
  }

  // Dealer positie
  const dealerPos = getCirclePosition(dealerAngle, radius, centerX, centerY);
  const dealerDiv = document.createElement('div');
  dealerDiv.className = 'player-area';
  dealerDiv.style.left = (dealerPos.x - 40) + 'px';
  dealerDiv.style.top = (dealerPos.y - 60) + 'px';
  dealerDiv.innerHTML = `<h3>Dealer</h3><div class='cards'>${dealer.hand.map(c=>`<div class='card-bj'>${c.value}${c.suit}</div>`).join('')}</div>`;

  // Dealer stoel
  const dealerChair = document.createElement('div');
  dealerChair.className = 'chair';
  dealerChair.style.left = (dealerPos.x) + 'px';
  dealerChair.style.top = (dealerPos.y + 80) + 'px';

  table.appendChild(dealerChair);
  table.appendChild(dealerDiv);

  // Speler positie
  const playerPos = getCirclePosition(playerAngle, radius, centerX, centerY);
  const playerDiv = document.createElement('div');
  playerDiv.className = 'player-area';
  playerDiv.style.left = (playerPos.x - 40) + 'px';
  playerDiv.style.top = (playerPos.y - 60) + 'px';
  playerDiv.innerHTML = `<h3>${players[0].name} ${currentPlayerIndex===0?'‚Üê':''}</h3><div class='cards'>${players[0].hand.map(c=>`<div class='card-bj'>${c.value}${c.suit}</div>`).join('')}</div>`;

  const playerChair = document.createElement('div');
  playerChair.className = 'chair';
  playerChair.style.left = (playerPos.x) + 'px';
  playerChair.style.top = (playerPos.y + 80) + 'px';

  table.appendChild(playerChair);
  table.appendChild(playerDiv);

  // Bots
  const botCount = players.length - 1; // exclude user
  const bots = botAngles.slice(0, botCount);
  for(let i=1; i<players.length; i++){
      const pos = getCirclePosition(bots[i-1], radius, centerX, centerY);
      const botDiv = document.createElement('div');
      botDiv.className = 'player-area';
      botDiv.style.left = (pos.x - 40) + 'px';
      botDiv.style.top = (pos.y - 60) + 'px';
      botDiv.innerHTML = `<h3>${players[i].name}</h3><div class='cards'>${players[i].hand.map(c=>`<div class='card-bj'>${c.value}${c.suit}</div>`).join('')}</div>`;

      const botChair = document.createElement('div');
      botChair.className = 'chair';
      botChair.style.left = (pos.x) + 'px';
      botChair.style.top = (pos.y + 80) + 'px';

      table.appendChild(botChair);
      table.appendChild(botDiv);
  }
}


    function renderGame(){ placePlayers(); }

    function nextPlayer(){
      currentPlayerIndex++;
      if(currentPlayerIndex>=players.length){ dealerTurn(); } else if(players[currentPlayerIndex].bot){ botTurn(players[currentPlayerIndex]); }
      renderGame();
    }

    function botTurn(bot){ let hv = handValue(bot.hand); while(hv<16){ bot.hand.push(drawCard()); hv=handValue(bot.hand); } nextPlayer(); }

    function dealerTurn(){ let hv = handValue(dealer.hand); while(hv<17){ dealer.hand.push(drawCard()); hv=handValue(dealer.hand); } checkWinners(); }

    function checkWinners(){
      const dealerScore = handValue(dealer.hand);
      let resultMsg = `Dealer heeft ${dealerScore}.\n`;
      players.forEach(p=>{
        const ps = handValue(p.hand);
        if(ps>21) resultMsg+=`${p.name} verliest (bust).\n`;
        else if(dealerScore>21 || ps>dealerScore) resultMsg+=`${p.name} wint!\n`;
        else if(ps===dealerScore) resultMsg+=`${p.name} gelijkspel.\n`;
        else resultMsg+=`${p.name} verliest.\n`;
      });
      alert(resultMsg);
      nextRoundBtn.style.display='inline';
      hitBtn.style.display='none';
      standBtn.style.display='none';
    }

    function startRound(){
      createDeck();
      dealer.hand=[drawCard(),drawCard()];
      players.forEach(p=>{ p.hand=[drawCard(),drawCard()]; });
      currentPlayerIndex=0;
      renderGame();
      if(players[0].bot) botTurn(players[0]);
      hitBtn.style.display='inline';
      standBtn.style.display='inline';
    }

    startGameBtn.onclick = ()=>{
      const botCount=parseInt(botSelect.value);
      players=[{name:'Jij', bot:false, hand:[]}];
      for(let i=1;i<=botCount;i++){ players.push({name:`Bot ${i}`, bot:true, hand:[]}); }
      startRound();
    };

    hitBtn.onclick = ()=>{ const p=players[currentPlayerIndex]; p.hand.push(drawCard()); if(handValue(p.hand)>21){ nextPlayer(); } renderGame(); };
    standBtn.onclick = ()=>{ nextPlayer(); };
    nextRoundBtn.onclick = ()=>{ nextRoundBtn.style.display='none'; startRound(); };

    // Toon login scherm bij laden
    loginSection.style.display='flex';
    /* ===============================================
   POPUP LEADERBOARD (TOP 10 + EIGEN POSITIE)
   =============================================== */

let lbIndex = 0; 
const lbTypes = ["earnings", "winrate"];

document.getElementById("lb-tab").onclick = () => {
    lbIndex = 0; 
    openLeaderboard();
};

document.getElementById("lb-close").onclick = () => {
    document.getElementById("lb-popup").style.display = "none";
};

document.getElementById("lb-left").onclick = () => {
    lbIndex = (lbIndex - 1 + lbTypes.length) % lbTypes.length;
    openLeaderboard();
};

document.getElementById("lb-right").onclick = () => {
    lbIndex = (lbIndex + 1) % lbTypes.length;
    openLeaderboard();
};

function openLeaderboard(){
    const popup = document.getElementById("lb-popup");
    popup.style.display = "block";

    const type = lbTypes[lbIndex];
    const title = document.getElementById("lb-title");
    const content = document.getElementById("lb-content");

    const stats = loadStats();
    const entries = Object.entries(stats);

    // Earnings sortering
    if(type === "earnings"){
        title.innerText = "All-Time Earnings";
        entries.sort((a,b)=>b[1].earnings - a[1].earnings);
    }
    // Winrate sortering
    else {
        title.innerText = "Win Percentage";
        entries.sort((a,b)=>{
            const wa = a[1].wins / Math.max(1,(a[1].wins+a[1].losses));
            const wb = b[1].wins / Math.max(1,(b[1].wins+b[1].losses));
            return wb - wa;
        });
    }

    const username = currentUser;
    let rank = entries.findIndex(([u]) => u === username) + 1;

    let html = "";

    // Top 10 tonen
    entries.slice(0,10).forEach(([user,data],i)=>{
        let extra = user === username ? " <strong>(jij)</strong>" : "";
        html += `<div>#${i+1} ‚Äî <strong>${user}</strong>${extra}</div>`;
    });

    // Als speler buiten top 10 valt
    if(rank > 10){
        const [u,data] = entries[rank-1];
        html += `
            <hr>
            <div>#${rank} ‚Äî <strong>${u}</strong> (jij)</div>
        `;
    }

    content.innerHTML = html;
}
// MUSIC MENU
const musicMenu = document.getElementById("musicMenu");
const musicControl = document.getElementById("musicControl");
const musicVolume = document.getElementById("musicVolume");
const musicTrackSelect = document.getElementById("musicTrackSelect");
const closeMusicMenu = document.getElementById("closeMusicMenu");
const muteBtn = document.getElementById("muteBtn");
const bgMusic = document.getElementById("bgMusic");

// Open menu
musicControl.onclick = () => {
    musicMenu.style.display = musicMenu.style.display === "block" ? "none" : "block";
};

// Volume slider
musicVolume.oninput = () => {
    bgMusic.volume = musicVolume.value;
};

// Track wisselen
musicTrackSelect.onchange = () => {
    const index = parseInt(musicTrackSelect.value);
    bgMusic.src = bgMusic.children[index].src;
    bgMusic.play();
};

// Mute
muteBtn.onclick = () => {
    bgMusic.muted = !bgMusic.muted;
};

// Sluiten
closeMusicMenu.onclick = () => {
    musicMenu.style.display = "none";
};

// Standaard volume
musicVolume.value = 0.4;
bgMusic.volume = 0.4;

  </script>
  <!-- ============================
     LEADERBOARD FLOATING TAB
     ============================ -->
<div id="lb-tab">üèÜ Leaderboard</div>

<!-- ============================
     LEADERBOARD POPUP
     ============================ -->
<div id="lb-popup">
    <div id="lb-popup-inner">
        <div id="lb-left" class="lb-arrow">‚Üê</div>

        <h2 id="lb-title">All-Time Earnings</h2>

        <div id="lb-content"></div>

        <div id="lb-right" class="lb-arrow">‚Üí</div>

        <button id="lb-close">Sluiten</button>
    </div>
</div>
<!-- MUSIC MENU -->
<div id="musicMenu">
  <div id="musicMenuInner">
      <h3>Muziekinstellingen</h3>

      <label>Volume:</label><br>
      <input type="range" id="musicVolume" min="0" max="1" step="0.01">

      <br><br>

      <label>Muziek selecteren:</label>
      <select id="musicTrackSelect">
          <option value="0">Funky Upbeat</option>
          <option value="1">Electronic Chill</option>
          <option value="2">Lounge Vibes</option>
      </select>

      <br><br>

      <button id="muteBtn">Mute / Unmute</button>
      <br><br>

      <button id="closeMusicMenu">Sluiten</button>
  </div>
</div>
</body>
</html>
