<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Goksite PWS â€” Multiplayer Blackjack & Poker</title>
  <style>
    /* ============================ LEADERBOARD TAB STYLE ============================ */
    #lb-tab{
        background: var(--theme-leaderboard-tab-bg);
        color: #f8fbff;
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: 0 12px 24px rgba(6, 18, 40, 0.45);
        letter-spacing: 0.3px;
        text-transform: uppercase;
    }

    /* ============================ POPUP WINDOW ============================ */
    #lb-popup{
        position: fixed;
        bottom: 0;
        right: 0;
        width: 360px;
        height: 460px;
        background: var(--theme-leaderboard-popup-bg);
        border-radius: 20px 0 0 0;
        display: none;
        z-index: 99999;
        color: white;
        border: 1px solid rgba(114, 179, 255, 0.25);
        box-shadow: 0 24px 40px rgba(0,0,0,0.55);
    }

    #lb-popup-inner{
        padding: 18px;
        height: 100%;
        position: relative;
    }

    /* ============================ ARROWS ============================ */
    .lb-arrow{
        position: absolute;
        top: 12px;
        font-size: 26px;
        cursor: pointer;
        user-select: none;
        color: #8fc5ff;
        transition: transform 0.2s ease, color 0.2s ease;
    }
    .lb-arrow:hover{
        transform: scale(1.05);
        color: #ffe8a6;
    }
    #lb-left{ left: 10px; }
    #lb-right{ right: 10px; }

    #lb-title{
        text-align: center;
        margin: 6px 0 0;
        font-size: 18px;
        letter-spacing: 0.4px;
        color: #f6fbff;
    }

    /* ============================ CONTENT AREA ============================ */
    #lb-content{
        margin-top: 52px;
        height: 330px;
        overflow-y: auto;
        font-size: 16px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .lb-entry{
        display: grid;
        grid-template-columns: 28px 1fr auto;
        align-items: center;
        gap: 10px;
        padding: 8px 12px;
        background: var(--theme-leaderboard-entry-bg);
        border-radius: 12px;
        border: 1px solid var(--theme-leaderboard-border);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.03);
    }

    .lb-entry.you{
        background: var(--theme-leaderboard-entry-you-bg);
        border-color: var(--theme-leaderboard-border-you);
    }

    .lb-rank{
        font-weight: 700;
        color: #ffe8a6;
    }

    .lb-name{
        font-weight: 600;
        color: #f2f7ff;
    }

    .lb-extra{
        font-size: 14px;
        color: #b9d8ff;
    }

    #lb-close{
        position: absolute;
        bottom: 14px;
        left: 50%;
        transform: translateX(-50%);
        padding: 8px 20px;
        border-radius: 10px;
        cursor: pointer;
        background: linear-gradient(135deg, #ffd986, #c9971d);
        color: #2b1a00;
        border: 1px solid rgba(255, 221, 128, 0.8);
        box-shadow: 0 8px 16px rgba(0,0,0,0.4);
    }

    /* ============================ GAME HELP PANEL ============================ */
    .help-fab{
      position: fixed;
      right: 24px;
      bottom: 24px;
      width: 48px;
      height: 48px;
      border-radius: 14px;
      border: 1px solid rgba(255, 221, 128, 0.8);
      background: linear-gradient(135deg, #ffe08a, #c9961e);
      color: #2b1a00;
      font-size: 22px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 14px 26px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
      z-index: 9999;
    }

    .help-fab.is-visible{
      opacity: 1;
      pointer-events: auto;
    }

    .help-fab:hover{
      transform: translateY(-2px);
      box-shadow: 0 18px 30px rgba(0,0,0,0.5);
    }

    .help-panel{
      position: fixed;
      right: 24px;
      bottom: 86px;
      width: min(360px, 92vw);
      background: linear-gradient(160deg, rgba(10, 26, 48, 0.98), rgba(6, 14, 30, 0.98));
      border-radius: 18px;
      border: 1px solid rgba(114, 179, 255, 0.3);
      box-shadow: 0 22px 40px rgba(0,0,0,0.55);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      opacity: 0;
      pointer-events: none;
      transform: translateY(12px) scale(0.98);
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 10000;
    }

    .help-panel.is-open{
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0) scale(1);
    }

    .help-panel-header{
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }

    .help-panel-title{
      font-size: 18px;
      font-weight: 800;
      letter-spacing: 0.3px;
    }

    .help-panel-subtitle{
      font-size: 13px;
      color: rgba(214, 229, 255, 0.8);
      margin-top: 4px;
      line-height: 1.4;
    }

    .help-close{
      border: none;
      background: rgba(255, 255, 255, 0.08);
      color: #f6e9c4;
      width: 32px;
      height: 32px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .help-steps{
      display: grid;
      gap: 10px;
    }

    .help-step{
      display: grid;
      grid-template-columns: 38px 1fr;
      gap: 10px;
      align-items: center;
      background: rgba(15, 40, 86, 0.55);
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid rgba(140, 200, 255, 0.2);
    }

    .help-icon{
      width: 34px;
      height: 34px;
      border-radius: 10px;
      background: rgba(255, 215, 128, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
    }

    .help-step-title{
      font-size: 14px;
      font-weight: 700;
      color: #f6fbff;
    }

    .help-step-text{
      font-size: 12.5px;
      color: rgba(214, 229, 255, 0.8);
      line-height: 1.4;
      margin-top: 2px;
    }

    @media (max-width: 720px){
      .help-panel{
        right: 14px;
        bottom: 76px;
      }
      .help-fab{
        right: 14px;
        bottom: 18px;
      }
    }

    /* ============================ GAME RESULT OVERLAY ============================ */
    .game-result-overlay{
      position: fixed;
      inset: 0;
      background: rgba(3, 8, 18, 0.78);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
      z-index: 100000;
    }

    .game-result-overlay.is-visible{
      opacity: 1;
      pointer-events: auto;
    }

    .game-result-card{
      position: relative;
      width: min(420px, 90vw);
      padding: 26px 28px 22px;
      border-radius: 18px;
      background: linear-gradient(160deg, rgba(15, 35, 75, 0.96), rgba(8, 16, 36, 0.96));
      color: #f5f8ff;
      text-align: center;
      border: 2px solid rgba(140, 200, 255, 0.2);
      box-shadow: 0 20px 45px rgba(0,0,0,0.45);
      animation: resultPop 0.35s ease;
      overflow: hidden;
    }

    .game-result-card::before{
      content: "";
      position: absolute;
      inset: -3px;
      border-radius: 20px;
      border: 2px solid transparent;
      background: conic-gradient(from 180deg, rgba(255,255,255,0.05), rgba(255,215,128,0.65), rgba(114,179,255,0.65), rgba(255,255,255,0.05)) border-box;
      mask: linear-gradient(#000 0 0) padding-box, linear-gradient(#000 0 0);
      mask-composite: exclude;
      animation: resultGlow 2s linear infinite;
      opacity: 0.85;
      pointer-events: none;
    }

    .game-result-card.win{
      border-color: rgba(255, 221, 128, 0.7);
      box-shadow: 0 25px 50px rgba(255, 221, 128, 0.25);
    }

    .game-result-card.lose{
      border-color: rgba(255, 120, 120, 0.6);
      box-shadow: 0 25px 50px rgba(255, 120, 120, 0.22);
    }

    .game-result-card.push{
      border-color: rgba(160, 200, 255, 0.6);
    }

    .game-result-title{
      font-size: 26px;
      letter-spacing: 0.6px;
      margin-bottom: 8px;
      font-weight: 800;
    }

    .game-result-message{
      font-size: 16px;
      color: #dfe9ff;
      margin-bottom: 18px;
      line-height: 1.5;
    }

    .game-result-actions{
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .game-result-actions button{
      padding: 10px 18px;
      border-radius: 12px;
      border: 1px solid rgba(255, 221, 128, 0.7);
      background: linear-gradient(135deg, #ffd986, #c9971d);
      color: #2b1a00;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }

    .game-result-actions button.secondary{
      background: rgba(255, 215, 128, 0.12);
      border-color: rgba(255, 221, 128, 0.4);
      color: #f6e9c4;
    }

    .game-result-actions button:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(0,0,0,0.35);
    }

    @keyframes resultPop{
      from{ transform: scale(0.92); opacity: 0; }
      to{ transform: scale(1); opacity: 1; }
    }

    @keyframes resultGlow{
      0%{ filter: hue-rotate(0deg); }
      100%{ filter: hue-rotate(360deg); }
    }

    /* ============================ SITE MESSAGE ============================ */
    .site-message{
      position: fixed;
      inset: 0;
      background: rgba(3, 8, 18, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 99998;
    }

    .site-message.is-visible{
      opacity: 1;
      pointer-events: auto;
    }

    .site-message-card{
      width: min(420px, 92vw);
      padding: 22px 24px 18px;
      border-radius: 18px;
      background: linear-gradient(160deg, rgba(15, 35, 75, 0.97), rgba(8, 16, 36, 0.97));
      border: 2px solid rgba(140, 200, 255, 0.2);
      color: #f5f8ff;
      text-align: center;
      box-shadow: 0 20px 45px rgba(0,0,0,0.45);
      position: relative;
    }

    .site-message[data-type="success"] .site-message-card{
      border-color: rgba(120, 220, 160, 0.6);
      box-shadow: 0 25px 50px rgba(120, 220, 160, 0.2);
    }

    .site-message[data-type="error"] .site-message-card{
      border-color: rgba(255, 120, 120, 0.6);
      box-shadow: 0 25px 50px rgba(255, 120, 120, 0.22);
    }

    .site-message[data-type="warning"] .site-message-card{
      border-color: rgba(255, 210, 120, 0.6);
      box-shadow: 0 25px 50px rgba(255, 210, 120, 0.22);
    }

    .site-message-title{
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 0.4px;
      margin-bottom: 8px;
    }

    .site-message-text{
      font-size: 15px;
      line-height: 1.5;
      color: #dfe9ff;
      margin-bottom: 14px;
    }

    .site-message-close{
      padding: 8px 18px;
      border-radius: 12px;
      border: 1px solid rgba(255, 221, 128, 0.7);
      background: linear-gradient(135deg, #ffd986, #c9971d);
      color: #2b1a00;
      font-weight: 700;
      cursor: pointer;
    }

    /* ============================ Loot box styles ============================ */
    #lootBoxMenuSection{
      position: relative;
      background: radial-gradient(circle at 20% 10%, rgba(255, 214, 140, 0.18), transparent 45%),
        radial-gradient(circle at 80% 20%, rgba(130, 220, 255, 0.16), transparent 45%),
        linear-gradient(145deg, #2b0f35 0, #0b0515 55%, #020108 100%);
      min-height: 100vh;
      text-align: center;
      padding: 24px;
      overflow: hidden;
    }

    #lootBoxMenuSection::before{
      content: "";
      position: absolute;
      inset: -40% -10% auto;
      height: 60%;
      background: conic-gradient(from 120deg, rgba(255, 214, 140, 0.12), rgba(109, 206, 255, 0.12), transparent 45%);
      opacity: 0.65;
      filter: blur(10px);
      pointer-events: none;
    }

    #lootBoxMenuSection h2{
      font-size: 28px;
      letter-spacing: 0.8px;
      margin-bottom: 6px;
      text-transform: uppercase;
      color: #f6e9c4;
    }

    #lootBoxMenuSection p{
      color: rgba(235, 226, 197, 0.75);
      margin-top: 0;
    }

    .lootbox-menu-grid{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 22px;
      margin: 28px auto 10px;
      max-width: 860px;
    }

    .lootbox-option{
      padding: 18px;
      border-radius: 24px;
      background: linear-gradient(155deg, rgba(30, 8, 48, 0.9), rgba(6, 5, 16, 0.95));
      border: 1px solid rgba(255, 221, 140, 0.2);
      box-shadow: 0 18px 40px rgba(0,0,0,0.55), inset 0 0 30px rgba(80, 30, 110, 0.35);
      position: relative;
      overflow: hidden;
    }

    .lootbox-option::after{
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 10%, rgba(255, 222, 138, 0.18), transparent 55%);
      opacity: 0.8;
      pointer-events: none;
    }

    .lootbox-star-row{
      display: flex;
      justify-content: center;
      gap: 6px;
      font-size: 20px;
      color: #ffe48a;
      margin-bottom: 6px;
      text-shadow: 0 0 6px rgba(0,0,0,0.6);
    }

    #lootBoxSection{
      position: relative;
      background: radial-gradient(circle at 30% 10%, rgba(255, 232, 168, 0.15), transparent 48%),
        radial-gradient(circle at 70% 20%, rgba(120, 160, 255, 0.16), transparent 48%),
        linear-gradient(150deg, #190d2b 0, #05040f 60%, #020107 100%);
      min-height: 100vh;
      text-align: center;
      padding: 24px;
      overflow: hidden;
    }

    #lootBoxSection::after{
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 0, rgba(255, 255, 255, 0.08), transparent 45%),
        radial-gradient(circle at 20% 80%, rgba(120, 220, 255, 0.08), transparent 45%);
      opacity: 0.7;
      pointer-events: none;
    }

    .lootbox-stage{
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      margin-top: 20px;
    }

    .lootbox-card{
      width: 220px;
      height: 220px;
      border-radius: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 22px;
      font-weight: 700;
      color: #041014;
      box-shadow: 0 18px 35px rgba(0,0,0,0.6);
      cursor: pointer;
      position: relative;
      transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
      overflow: hidden;
    }

    .lootbox-card:hover{
      transform: translateY(-4px);
      box-shadow: 0 24px 40px rgba(0,0,0,0.7);
      filter: brightness(1.08);
    }

    .lootbox-card.disabled{
      cursor: default;
      opacity: 0.8;
    }

    .lootbox-card::before{
      content: "";
      position: absolute;
      inset: -3px;
      border-radius: 26px;
      border: 2px solid transparent;
      background: conic-gradient(from 140deg, rgba(255,255,255,0.05), rgba(255,215,128,0.75), rgba(120,190,255,0.75), rgba(255,255,255,0.05)) border-box;
      mask: linear-gradient(#000 0 0) padding-box, linear-gradient(#000 0 0);
      mask-composite: exclude;
      opacity: 0.6;
      pointer-events: none;
    }

    .lootbox-card::after{
      content: "";
      position: absolute;
      inset: 12px;
      border-radius: 18px;
      background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.45), transparent 40%);
      opacity: 0.5;
      pointer-events: none;
    }

    .lootbox-icon{
      font-size: 54px;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,0.35));
    }

    .lootbox-chances{
      display: flex;
      gap: 10px;
    }

    .chance-dot{
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffe48a;
      font-size: 16px;
      background: rgba(0,0,0,0.3);
      transition: opacity 0.2s ease, filter 0.2s ease;
    }

    .chance-dot.used{
      opacity: 0.3;
      filter: grayscale(1);
    }

    .lootbox-level-1{ background: linear-gradient(140deg, #55f0ff, #1aa7c9); }
    .lootbox-level-2{ background: linear-gradient(140deg, #63e28a, #2e9c58); }
    .lootbox-level-3{ background: linear-gradient(140deg, #c3844b, #8b4d20); }
    .lootbox-level-4{ background: linear-gradient(140deg, #d8dbe2, #8b8f9c); }
    .lootbox-level-5{ background: linear-gradient(140deg, #ffe48a, #c79a1b); }

    .lootbox-card.is-tapped{
      animation: lootboxTap 0.35s ease;
    }

    .lootbox-card.is-leveling{
      animation: lootboxLevelUp 0.75s ease;
    }

    .lootbox-card.is-leveling::before{
      opacity: 0.9;
      animation: lootboxGlow 1.6s linear infinite;
    }

    .lootbox-card.is-leveling .lootbox-icon{
      animation: lootboxSparkle 0.9s ease;
    }

    @keyframes lootboxTap{
      0%{ transform: scale(1); }
      35%{ transform: scale(0.96) rotate(-1deg); }
      70%{ transform: scale(1.04) rotate(1deg); }
      100%{ transform: scale(1); }
    }

    @keyframes lootboxLevelUp{
      0%{ transform: scale(1); box-shadow: 0 18px 35px rgba(0,0,0,0.6); }
      35%{ transform: scale(1.08); box-shadow: 0 30px 50px rgba(255,215,128,0.45); }
      70%{ transform: scale(0.98); box-shadow: 0 26px 46px rgba(120,190,255,0.35); }
      100%{ transform: scale(1); box-shadow: 0 22px 40px rgba(0,0,0,0.6); }
    }

    @keyframes lootboxGlow{
      0%{ filter: hue-rotate(0deg); }
      100%{ filter: hue-rotate(360deg); }
    }

    @keyframes lootboxSparkle{
      0%{ transform: scale(1); filter: drop-shadow(0 0 0 rgba(255,255,255,0)); }
      40%{ transform: scale(1.18); filter: drop-shadow(0 0 16px rgba(255,255,255,0.85)); }
      100%{ transform: scale(1); filter: drop-shadow(0 0 0 rgba(255,255,255,0)); }
    }

    /* ============================ Rest of page ============================ */
    :root{
      --maria-blue: #0b4f7b;
      --maria-blue-bright: #0f6fb2;
      --maria-blue-deep: #062339;
      --casino-gold: #d4af37;
      --casino-cream: #f6e9c4;
      --theme-game-bg: linear-gradient(150deg, rgba(11, 79, 123, 0.88) 0%, rgba(6, 35, 57, 0.95) 55%, rgba(3, 16, 28, 0.98) 100%);
      --theme-game-bg-glow: radial-gradient(circle at 15% 15%, rgba(140, 200, 255, 0.2), transparent 55%);
      --theme-game-panel: linear-gradient(160deg, rgba(12, 36, 68, 0.96), rgba(6, 14, 28, 0.98));
      --theme-game-panel-soft: rgba(10, 28, 52, 0.78);
      --theme-game-border: rgba(140, 200, 255, 0.25);
      --theme-game-accent: rgba(255, 221, 128, 0.85);
      --theme-game-accent-soft: rgba(255, 221, 128, 0.25);
      --menu-surface: rgba(10, 22, 36, 0.88);
      --menu-surface-light: rgba(18, 44, 70, 0.82);
      --theme-menu-surface: linear-gradient(140deg, rgba(11, 79, 123, 0.65), rgba(15, 111, 178, 0.55));
      --theme-menu-surface-light: linear-gradient(140deg, rgba(11, 79, 123, 0.55), rgba(15, 111, 178, 0.45));
      --theme-login-shell-bg: linear-gradient(130deg, rgba(11, 79, 123, 0.7), rgba(6, 35, 57, 0.9));
      --theme-login-card-bg: linear-gradient(160deg, rgba(11, 79, 123, 0.6), rgba(7, 24, 42, 0.9));
      --theme-login-pill-bg: linear-gradient(140deg, rgba(11, 79, 123, 0.4), rgba(15, 111, 178, 0.3));
      --theme-login-pill-border: rgba(140, 200, 255, 0.35);
      --theme-login-input-bg: rgba(11, 79, 123, 0.35);
      --theme-login-input-border: rgba(140, 200, 255, 0.25);
      --theme-login-logo-bg: linear-gradient(140deg, var(--maria-blue), var(--maria-blue-bright));
      --theme-login-logo-color: var(--casino-cream);
      --theme-login-logo-shadow: 0 0 18px rgba(15,111,178,0.45);
      --theme-claim-daily-bg: linear-gradient(120deg, var(--maria-blue), var(--maria-blue-bright));
      --theme-claim-daily-border: 1px solid rgba(140, 200, 255, 0.35);
      --theme-claim-daily-color: #f8fbff;
      --theme-claim-daily-shadow: 0 8px 18px rgba(10,90,140,0.35);
      --theme-leaderboard-tab-bg: linear-gradient(120deg, rgba(11, 79, 123, 0.95), rgba(15, 111, 178, 0.95));
      --theme-leaderboard-popup-bg: linear-gradient(160deg, rgba(7, 20, 45, 0.98), rgba(4, 10, 22, 0.98));
      --theme-leaderboard-entry-bg: rgba(15, 40, 86, 0.6);
      --theme-leaderboard-entry-you-bg: rgba(25, 79, 164, 0.75);
      --theme-leaderboard-border: rgba(140, 200, 255, 0.2);
      --theme-leaderboard-border-you: rgba(255, 221, 128, 0.6);
    }

    body {
      margin:0;
      font-family: "Segoe UI", system-ui, sans-serif;
      background:#050515;
      color:#fff;
      user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      -moz-user-select: none;
      -webkit-touch-callout: none;
    }
    *,
    *::before,
    *::after{
      user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      -moz-user-select: none;
      -webkit-touch-callout: none;
    }
    #login, #dashboard, #blackjackSection, #pokerSection, #lootBoxMenuSection, #lootBoxSection, #slotsSection, #skinsSection, #shopSection { display: none; padding: 20px; text-align:center; }
    #login {
      position: relative;
      background:
        radial-gradient(circle at top, rgba(15,111,178,0.28), transparent 52%),
        radial-gradient(circle at 15% 30%, rgba(212,175,55,0.2), transparent 45%),
        linear-gradient(150deg, #02070f 0, #040f1e 45%, #020408 100%);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding: 48px 20px;
      overflow: hidden;
    }

    #login::before{
      content:"";
      position:absolute;
      inset: 0;
      background:
        radial-gradient(circle at 85% 20%, rgba(114,179,255,0.18), transparent 40%),
        radial-gradient(circle at 10% 90%, rgba(212,175,55,0.14), transparent 35%);
      pointer-events: none;
    }

    .login-shell{
      position: relative;
      z-index: 1;
      max-width: 980px;
      width: 100%;
      display: grid;
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.85fr);
      gap: 32px;
      padding: 34px;
      border-radius: 26px;
      background: var(--theme-login-shell-bg);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 30px 60px rgba(0,0,0,0.45);
    }

    .login-branding{
      display: flex;
      flex-direction: column;
      gap: 18px;
      text-align: left;
      padding: 10px 6px;
    }

    .login-logo{
      width: 58px;
      height: 58px;
      border-radius: 16px;
      background: var(--theme-login-logo-bg);
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--theme-login-logo-color);
      font-size: 26px;
      box-shadow: var(--theme-login-logo-shadow);
    }

    .login-branding h2{
      margin: 0;
      font-size: 28px;
      letter-spacing: 0.4px;
    }

    .login-branding p{
      margin: 0;
      color: rgba(246,233,196,0.8);
      line-height: 1.5;
      max-width: 340px;
    }

    .login-highlights{
      display: grid;
      gap: 10px;
    }

    .login-pill{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      background: var(--theme-login-pill-bg);
      border: 1px solid var(--theme-login-pill-border);
      color: #eaf3ff;
      font-size: 14px;
      letter-spacing: 0.2px;
    }

    .login-pill span{
      color: var(--casino-gold);
      font-weight: 700;
    }

    .login-card{
      background: var(--theme-login-card-bg);
      border-radius: 22px;
      padding: 26px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02), 0 22px 35px rgba(0,0,0,0.45);
      display: flex;
      flex-direction: column;
      gap: 16px;
      text-align: left;
    }

    .login-card h3{
      margin: 0;
      font-size: 22px;
    }

    .login-card p{
      margin: 0;
      color: rgba(185,216,255,0.75);
      font-size: 14px;
    }

    .login-field{
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 13px;
      color: rgba(246,233,196,0.85);
    }

    .login-field input{
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--theme-login-input-border);
      background: var(--theme-login-input-bg);
      color: #fff;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
    }

    .login-field input:focus{
      outline: none;
      border-color: rgba(255,221,128,0.6);
      box-shadow: 0 0 0 2px rgba(255,221,128,0.15);
    }

    .login-actions{
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .login-actions button{
      width: 100%;
    }

    .login-note{
      font-size: 12px;
      color: rgba(185,216,255,0.7);
    }

    @media (max-width: 860px){
      .login-shell{
        grid-template-columns: 1fr;
        padding: 26px;
      }
    }
    #dashboard {
      background:
        radial-gradient(circle at top, rgba(15,111,178,0.25), transparent 40%),
        radial-gradient(circle at 20% 20%, rgba(212,175,55,0.18), transparent 55%),
        linear-gradient(140deg, #030b14 0, #051729 35%, #071f33 60%, #030b14 100%);
      min-height:100vh;
      text-align:left;
    }
    #dashboard h2, #login h2 { margin-bottom:10px; }
    button {
      padding: 10px 14px;
      margin: 6px;
      border-radius: 10px;
      border: 1px solid rgba(255, 221, 128, 0.75);
      cursor: pointer;
      background: linear-gradient(135deg, #ffd986, #c9971d);
      color: #2b1a00;
      font-weight: 700;
      letter-spacing: 0.2px;
      box-shadow: 0 10px 18px rgba(10, 8, 2, 0.35);
      transition: transform 0.15s ease, box-shadow 0.2s ease, filter 0.2s ease;
    }
    button:hover{
      transform: translateY(-1px);
      filter: brightness(1.06);
      box-shadow: 0 14px 22px rgba(10, 8, 2, 0.45);
    }
    input { padding:8px 10px; border-radius:8px; border:1px solid #2b4055; background:#111a23; color:#fff; }

    /* ============================ Dashboard menu overhaul ============================ */
    .menu-wrapper{
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px 10px 50px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .menu-header{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap:16px;
      padding: 16px 22px;
      border-radius: 18px;
      background: linear-gradient(120deg, rgba(7,30,49,0.95), rgba(8,40,60,0.8));
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
      position: relative;
    }

    .menu-brand{
      display:flex;
      align-items:center;
      gap:12px;
      margin-left: 54px;
    }

    .menu-logo{
      width:48px;
      height:48px;
      border-radius:14px;
      background: linear-gradient(140deg, var(--maria-blue), var(--maria-blue-bright));
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--casino-cream);
      font-size:22px;
      box-shadow: 0 0 16px rgba(15,111,178,0.5);
    }

    .menu-brand h2{
      margin:0;
      font-size: 20px;
      font-weight: 700;
    }

    .menu-brand small{
      color: rgba(246,233,196,0.75);
    }

    .menu-stats{
      display:flex;
      gap: 14px;
      flex-wrap: wrap;
    }

    .menu-stat{
      background: rgba(8, 26, 40, 0.75);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 10px 14px;
      border-radius: 12px;
      min-width: 140px;
    }

    .menu-stat span{
      display:block;
      font-size:12px;
      color: rgba(255,255,255,0.65);
    }

    .menu-stat strong{
      font-size:16px;
      color: var(--casino-cream);
    }

    .menu-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .menu-action-btn{
      background: linear-gradient(135deg, #f6d37a, #b88311);
      border: 1px solid rgba(255, 221, 128, 0.8);
      color: #2b1a00;
      padding: 8px 14px;
      box-shadow: 0 10px 18px rgba(10, 8, 2, 0.35);
    }

    .menu-action-btn.primary{
      background: linear-gradient(135deg, #ffd986, #c9971d);
      border: 1px solid rgba(255, 221, 128, 0.85);
      box-shadow: 0 12px 20px rgba(10, 8, 2, 0.4);
      color: #2b1a00;
    }

    #claimDailyBtn{
      background: var(--theme-claim-daily-bg);
      border: var(--theme-claim-daily-border);
      color: var(--theme-claim-daily-color);
      box-shadow: var(--theme-claim-daily-shadow);
    }

    #logoutBtn{
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff;
      box-shadow: none;
    }

    .lucky-drop-btn{
      position: relative;
      border: 1px solid rgba(255, 221, 128, 0.6);
      background: linear-gradient(140deg, rgba(255, 215, 128, 0.85), rgba(168, 118, 18, 0.85));
      box-shadow: 0 10px 18px rgba(0,0,0,0.35);
      padding: 0;
      margin: 0;
    }

    .lucky-drop-btn:hover{
      transform: translateY(-1px);
      filter: brightness(1.08);
    }

    .lucky-drop-icon{
      font-size: 20px;
    }

    .lucky-drop-badge{
      position: absolute;
      top: -6px;
      right: -6px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: linear-gradient(140deg, #ffd769, #b78608);
      color: #3b2600;
      font-size: 12px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transform: scale(0.6);
      transition: opacity 0.2s ease, transform 0.2s ease;
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    }

    .lucky-drop-btn.has-available .lucky-drop-badge{
      opacity: 1;
      transform: scale(1);
    }

    .lucky-drop-btn.shake{
      animation: luckyDropShake 0.6s ease-in-out;
    }

    @keyframes luckyDropShake{
      0%{ transform: translateX(0); }
      20%{ transform: translateX(-2px); }
      40%{ transform: translateX(2px); }
      60%{ transform: translateX(-1px); }
      80%{ transform: translateX(1px); }
      100%{ transform: translateX(0); }
    }

    .menu-hero{
      padding: 24px;
      border-radius: 20px;
      background: var(--theme-menu-surface);
      border: 1px solid rgba(255,255,255,0.08);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 20px;
      box-shadow: inset 0 0 40px rgba(0,0,0,0.35);
    }

    .menu-hero-text h3{
      margin:0 0 6px 0;
      font-size: 26px;
    }

    .menu-hero-text p{
      margin:0;
      color: rgba(255,255,255,0.7);
    }

    .menu-hero-highlight{
      background: linear-gradient(130deg, rgba(212,175,55,0.12), rgba(15,111,178,0.2));
      border: 1px solid rgba(212,175,55,0.3);
      padding: 14px 18px;
      border-radius: 16px;
      text-align:center;
      min-width: 180px;
    }

    .menu-hero-highlight strong{
      font-size: 22px;
      color: var(--casino-cream);
    }

    .menu-hero-actions{
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .menu-hero-quick{
      width: 46px;
      height: 46px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
    }

    .menu-hero-quick:hover{
      transform: translateY(-2px);
      box-shadow: 0 16px 28px rgba(6, 18, 40, 0.55);
      filter: brightness(1.08);
    }

    .menu-hero-shop{
      width: 52px;
      height: 52px;
      border-radius: 16px;
      border: 1px solid rgba(255, 221, 128, 0.9);
      background: linear-gradient(145deg, #ffe7a4, #c9971d);
      color: #2b1a00;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 14px 26px rgba(0,0,0,0.35), 0 0 18px rgba(255, 221, 128, 0.5);
      transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
    }

    .menu-hero-shop:hover{
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 18px 32px rgba(0,0,0,0.45), 0 0 22px rgba(255, 221, 128, 0.65);
      filter: brightness(1.08);
    }

    .menu-hero-skins{
      border-color: rgba(114, 179, 255, 0.8);
      background: linear-gradient(145deg, #9ed0ff, #2f78b4);
      color: #061427;
      box-shadow: 0 14px 26px rgba(0,0,0,0.35), 0 0 18px rgba(114, 179, 255, 0.45);
    }

    .menu-hero-skins:hover{
      box-shadow: 0 18px 32px rgba(0,0,0,0.45), 0 0 22px rgba(114, 179, 255, 0.6);
    }

    .menu-hero-leaderboard{
      background: var(--theme-leaderboard-tab-bg);
      color: #f8fbff;
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 12px 24px rgba(6, 18, 40, 0.45);
    }

    /* ============================ Skins menu ============================ */
    #skinsSection{
      min-height: 100vh;
      background: radial-gradient(circle at 15% 10%, rgba(255, 200, 214, 0.35), transparent 45%),
        radial-gradient(circle at 85% 20%, rgba(150, 220, 255, 0.3), transparent 50%),
        linear-gradient(160deg, #0d1226 0, #1a0f2f 45%, #03040d 100%);
      color: #f6fbff;
      padding: 28px 18px 40px;
    }

    .skins-shell{
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .skins-header{
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
      background: linear-gradient(120deg, rgba(26, 20, 46, 0.92), rgba(10, 20, 40, 0.85));
      border: 1px solid rgba(255, 200, 214, 0.25);
      padding: 18px 20px;
      border-radius: 22px;
      box-shadow: 0 18px 32px rgba(0,0,0,0.45), 0 0 20px rgba(255, 200, 214, 0.18);
      text-align: left;
    }

    .skins-header h2{
      margin: 0;
      font-size: 24px;
      letter-spacing: 0.4px;
    }

    .skins-header p{
      margin: 6px 0 0;
      color: rgba(214, 229, 255, 0.75);
      font-size: 14px;
    }

    .skins-controls{
      display: flex;
      flex-direction: column;
      gap: 14px;
      padding: 16px 18px;
      border-radius: 18px;
      background: rgba(16, 20, 40, 0.8);
      border: 1px solid rgba(255, 200, 214, 0.18);
      box-shadow: inset 0 0 30px rgba(120, 80, 160, 0.25);
    }

    .skins-tabs{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .skins-tab{
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(8, 20, 38, 0.65);
      color: rgba(236, 244, 255, 0.85);
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    }

    .skins-tab.is-active{
      border-color: rgba(255, 221, 128, 0.7);
      color: #fff2cc;
      box-shadow: 0 12px 20px rgba(0,0,0,0.35);
      transform: translateY(-1px);
    }

    .skins-panels{
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .skins-panel{
      display: none;
      flex-direction: column;
      gap: 14px;
      padding: 16px 18px;
      border-radius: 20px;
      background: rgba(12, 12, 28, 0.72);
      border: 1px solid rgba(150, 220, 255, 0.16);
      box-shadow: inset 0 0 26px rgba(80, 60, 140, 0.25);
    }

    .skins-panel.is-active{
      display: flex;
    }

    .skins-panel-title{
      font-size: 14px;
      color: rgba(214, 229, 255, 0.8);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin: 0;
    }

    .skins-controls label{
      font-size: 13px;
      color: rgba(214, 229, 255, 0.8);
      text-transform: uppercase;
      letter-spacing: 0.6px;
    }

    .skins-controls select{
      max-width: 260px;
    }

    .skin-game-tabs{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .skin-game-tab{
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(8, 20, 38, 0.65);
      color: rgba(236, 244, 255, 0.85);
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    }

    .skin-game-tab.is-active{
      border-color: rgba(255, 221, 128, 0.7);
      color: #fff2cc;
      box-shadow: 0 12px 20px rgba(0,0,0,0.35);
      transform: translateY(-1px);
    }

    .skins-grid{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }

    /* ============================ SHOP ============================ */
    #shopSection{
      background: radial-gradient(circle at 15% 15%, rgba(255, 214, 140, 0.2), transparent 48%),
        radial-gradient(circle at 80% 10%, rgba(120, 200, 255, 0.15), transparent 45%),
        linear-gradient(150deg, #1d1208 0, #0b0c12 45%, #040406 100%);
      min-height: 100vh;
    }

    .shop-shell{
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
      text-align: left;
    }

    .shop-header{
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      padding: 18px 22px;
      border-radius: 20px;
      background: linear-gradient(120deg, rgba(44, 22, 10, 0.95), rgba(14, 22, 32, 0.9));
      border: 1px solid rgba(255, 214, 140, 0.2);
      box-shadow: 0 18px 40px rgba(0,0,0,0.45), 0 0 18px rgba(255, 200, 140, 0.18);
    }

    .shop-header h2{
      margin: 0 0 6px;
      font-size: 24px;
      letter-spacing: 0.4px;
    }

    .shop-header p{
      margin: 0;
      color: rgba(214, 229, 255, 0.8);
      font-size: 14px;
      line-height: 1.5;
    }

    .shop-tabs{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 8px 4px 4px;
    }

    .shop-tab{
      border-radius: 999px;
      padding: 8px 16px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(10, 26, 48, 0.75);
      color: rgba(238, 245, 255, 0.85);
      font-weight: 600;
      cursor: pointer;
      letter-spacing: 0.2px;
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }

    .shop-tab.is-active{
      background: linear-gradient(135deg, rgba(255, 226, 146, 0.95), rgba(196, 150, 38, 0.95));
      color: #2b1a00;
      box-shadow: 0 12px 20px rgba(0,0,0,0.35), 0 0 14px rgba(255, 214, 140, 0.4);
      transform: translateY(-1px);
    }

    .shop-game-tabs{
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }

    .shop-game-tab{
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      padding: 6px 12px;
      background: rgba(6, 20, 36, 0.8);
      color: rgba(230, 240, 255, 0.8);
      cursor: pointer;
      font-size: 13px;
      letter-spacing: 0.2px;
    }

    .shop-game-tab.is-active{
      background: rgba(255, 221, 128, 0.18);
      color: #ffe08a;
      border-color: rgba(255, 221, 128, 0.45);
    }

    .shop-grid{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      padding-bottom: 40px;
    }

    .shop-card{
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 16px;
      border-radius: 20px;
      background: linear-gradient(160deg, rgba(30, 18, 12, 0.92), rgba(10, 16, 24, 0.9));
      border: 1px solid rgba(255, 214, 140, 0.18);
      box-shadow: 0 18px 32px rgba(0,0,0,0.45);
      position: relative;
      overflow: hidden;
    }

    .shop-card.is-owned{
      border-color: rgba(120, 220, 160, 0.6);
    }

    .shop-card.is-selected{
      border-color: rgba(255, 221, 128, 0.7);
      box-shadow: 0 18px 34px rgba(255, 221, 128, 0.25);
    }

    .shop-item-image{
      height: 120px;
      border-radius: 16px;
      background: linear-gradient(140deg, #6b3b18, #1b1c2d);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      color: rgba(255,255,255,0.9);
      border: 1px solid rgba(255,214,140,0.18);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08);
      position: relative;
      overflow: hidden;
    }

    .shop-preview{
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .shop-preview-group{
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .shop-preview-icon{
      position: absolute;
      right: 8px;
      bottom: 8px;
      font-size: 18px;
      background: rgba(0,0,0,0.35);
      color: #fff;
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
      z-index: 2;
    }

    .shop-preview-card{
      width: 58px;
      height: 86px;
      border-radius: 12px;
      background: var(--preview-card-bg);
      border: 1px solid var(--preview-card-border);
      box-shadow: 0 8px 16px rgba(0,0,0,0.35);
    }

    .shop-preview-die{
      width: 52px;
      height: 52px;
      border-radius: 14px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      place-items: center;
      background: var(--preview-dice-bg);
      color: var(--preview-dice-color);
      border: 1px solid rgba(255,255,255,0.45);
      box-shadow: 0 8px 16px rgba(0,0,0,0.35);
      text-shadow: 0 2px 4px rgba(0,0,0,0.45);
    }

    .shop-preview-die .craps-pip{
      width: 12px;
      height: 12px;
      font-size: 10px;
      filter: none;
      text-shadow: 0 1px 2px rgba(0,0,0,0.45);
    }

    .shop-preview-ball{
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: var(--preview-ball-bg);
      border: 1px solid rgba(255,255,255,0.45);
      box-shadow: inset 0 0 8px rgba(255,255,255,0.3), 0 8px 16px rgba(0,0,0,0.35);
    }

    .shop-preview-screen{
      width: 92px;
      height: 70px;
      border-radius: 14px;
      background: var(--preview-screen-bg);
      border: 1px solid rgba(255,255,255,0.4);
      position: relative;
      overflow: hidden;
      box-shadow: 0 10px 18px rgba(0,0,0,0.35);
    }

    .shop-preview-screen::before{
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 18px;
      background: rgba(0,0,0,0.25);
    }

    .shop-preview-screen::after{
      content: "";
      position: absolute;
      left: 10px;
      right: 10px;
      bottom: 12px;
      height: 8px;
      border-radius: 999px;
      background: var(--preview-screen-accent);
    }

    .shop-card h4{
      margin: 0;
      font-size: 16px;
    }

    .shop-card p{
      margin: 0;
      font-size: 13px;
      color: rgba(214, 229, 255, 0.78);
      line-height: 1.4;
    }

    .shop-card-footer{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: auto;
    }

    .price-tag{
      font-weight: 700;
      color: #ffe8a6;
      font-size: 14px;
    }

    .shop-action{
      padding: 8px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.85);
      font-weight: 600;
      cursor: pointer;
      font-size: 13px;
    }

    .shop-action.buy{
      background: linear-gradient(135deg, #ffd986, #c9971d);
      border-color: rgba(255, 221, 128, 0.8);
      color: #2b1a00;
    }

    .shop-action.selected{
      background: rgba(120, 220, 160, 0.15);
      border-color: rgba(120, 220, 160, 0.5);
      color: rgba(190, 255, 220, 0.9);
      cursor: default;
    }

    .shop-subtitle{
      font-size: 13px;
      color: rgba(214, 229, 255, 0.75);
      margin-top: -8px;
      margin-bottom: 6px;
    }


    .skin-card{
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(8, 18, 34, 0.78);
      cursor: pointer;
      text-align: left;
      color: inherit;
      box-shadow: 0 16px 28px rgba(0,0,0,0.4);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .skin-card:hover{
      transform: translateY(-2px);
      box-shadow: 0 20px 34px rgba(0,0,0,0.5);
    }

    .skin-card.is-selected{
      border-color: rgba(255, 221, 128, 0.7);
      box-shadow: 0 18px 34px rgba(255, 221, 128, 0.22);
    }

    .skin-card-preview{
      height: 86px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: inset 0 0 18px rgba(0,0,0,0.45);
    }

    .skin-card-title{
      font-size: 16px;
      font-weight: 700;
    }

    .skin-card-desc{
      font-size: 12.5px;
      color: rgba(214, 229, 255, 0.78);
      line-height: 1.4;
    }

    .skin-card-tag{
      align-self: flex-start;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.4px;
      background: rgba(255, 221, 128, 0.2);
      color: #ffe6a6;
      border: 1px solid rgba(255, 221, 128, 0.4);
      text-transform: uppercase;
    }

    .menu-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap:18px;
      perspective: 1200px;
    }

    .menu-card{
      background: var(--theme-menu-surface-light);
      border-radius: 18px;
      padding: 18px 18px 64px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 14px 28px rgba(0,0,0,0.4);
      text-align:left;
      display:flex;
      flex-direction:column;
      gap:12px;
      position: relative;
      overflow: hidden;
      transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
    }

    .menu-card::after{
      content:'';
      position:absolute;
      inset:0;
      background: radial-gradient(circle at top right, rgba(15,111,178,0.35), transparent 55%);
      opacity:0.8;
      pointer-events:none;
      z-index: 0;
    }

    .menu-card > *{
      position: relative;
      z-index: 1;
    }

    .menu-card:hover{
      transform: translateY(-6px);
      box-shadow: 0 20px 32px rgba(0,0,0,0.45);
      filter: brightness(1.03);
    }

    .menu-card-art{
      position: absolute;
      right: 14px;
      bottom: 12px;
      width: 64px;
      height: 64px;
      opacity: 0.9;
      z-index: 0;
      transform: rotate(calc(-8deg + var(--card-tilt, 0deg)));
      filter: drop-shadow(0 10px 18px rgba(0,0,0,0.45));
      pointer-events: none;
    }

    .menu-card-emoji{
      position: absolute;
      right: 14px;
      bottom: 12px;
      width: 64px;
      height: 64px;
      opacity: 0.9;
      z-index: 0;
      transform: rotate(-8deg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 46px;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,0.45));
      pointer-events: none;
    }

    .menu-card h4{
      margin:0;
      font-size:18px;
    }

    .menu-card p{
      margin:0;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
    }

    .menu-card .cta-button{
      margin:0;
      align-self: flex-start;
      background: linear-gradient(130deg, var(--casino-gold), #f0c96a);
      color:#1b1b1b;
      font-weight: 700;
    }

    .menu-card .cta-button.alt{
      background: linear-gradient(130deg, #f6d37a, #b88311);
      color:#2b1a00;
    }

    .menu-highlight{
      border:1px solid rgba(212,175,55,0.45);
      box-shadow: 0 14px 30px rgba(212,175,55,0.22);
    }

    .menu-cta-row{
      display:flex;
      gap:12px;
      flex-wrap: wrap;
    }

    .menu-cta-row button{
      margin:0;
    }

    @media (max-width: 840px){
      .menu-header{
        flex-direction: column;
        align-items: flex-start;
        padding-top: 64px;
      }
      .menu-brand{
        margin-left: 0;
      }
      .lucky-drop-btn{
        top: 12px;
        left: 12px;
      }
      .menu-actions{
        width:100%;
        justify-content:flex-start;
      }
      .menu-hero{
        flex-direction: column;
        align-items: flex-start;
      }
      .menu-card{
        transform: none;
      }
    }

    /* Blackjack sectie */
    #blackjackSection {
      position: relative;
      min-height: 100vh;
      color: #f7fbff;
      background:
        var(--theme-game-bg-glow),
        radial-gradient(circle at 85% 100%, rgba(255, 221, 128, 0.12), transparent 55%),
        var(--layout-bg, var(--theme-game-bg));
      padding-bottom: 40px;
      overflow: hidden;
    }

    #blackjackSection::after{
      content: "";
      position: absolute;
      inset: -40% -10% auto;
      height: 55%;
      background: repeating-linear-gradient(135deg, rgba(255, 255, 255, 0.04) 0 12px, transparent 12px 26px);
      opacity: 0.3;
      pointer-events: none;
    }

    #blackjackSection.skin-aurora{
      background:
        radial-gradient(circle at 10% 10%, rgba(120, 190, 255, 0.25), transparent 55%),
        radial-gradient(circle at 90% 80%, rgba(174, 120, 255, 0.2), transparent 60%),
        linear-gradient(140deg, #041728 0%, #0b3a5a 45%, #03101f 100%);
    }

    #blackjackSection.skin-velvet{
      background:
        radial-gradient(circle at 15% 15%, rgba(255, 221, 128, 0.2), transparent 55%),
        radial-gradient(circle at 90% 85%, rgba(160, 60, 90, 0.25), transparent 60%),
        linear-gradient(140deg, #3b0c20 0%, #651c3a 45%, #17050d 100%);
    }

    .bj-shell{
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .bj-header{
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      background: var(--theme-game-panel);
      border: 1px solid var(--theme-game-border);
      border-radius: 18px;
      padding: 16px 18px;
      box-shadow: 0 16px 30px rgba(0,0,0,0.4), 0 0 18px rgba(140, 200, 255, 0.2);
    }

    .bj-header h2{
      margin: 0;
      font-size: 22px;
      letter-spacing: 0.4px;
    }

    .bj-setup{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .bj-setup label{
      font-size: 13px;
      color: rgba(255,255,255,0.7);
      margin-right: 6px;
    }

    .bj-setup select,
    .bj-setup input{
      min-width: 110px;
    }

    .bj-table{
      position: relative;
      background:
        radial-gradient(circle at top, rgba(255,255,255,0.12), transparent 55%),
        radial-gradient(circle at 50% 85%, rgba(0,0,0,0.55), transparent 55%),
        var(--theme-game-panel);
      border-radius: 24px;
      border: 1px solid var(--theme-game-border);
      padding: 26px;
      min-height: 440px;
      box-shadow: inset 0 0 30px rgba(0,0,0,0.6), 0 25px 50px rgba(0,0,0,0.45);
      overflow: hidden;
    }

    .bj-table::before{
      content: '';
      position: absolute;
      inset: 18px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.08);
      pointer-events: none;
    }

    .bj-shoe{
      position: absolute;
      right: 30px;
      top: 26px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      z-index: 4;
    }

    .bj-shoe-stack{
      position: relative;
      width: 76px;
      height: 108px;
    }

    .bj-shoe-card{
      position: absolute;
      inset: 0;
      border-radius: 12px;
      border: 2px solid var(--theme-card-border);
      background: var(--theme-card-back);
      box-shadow:
        0 6px 14px rgba(0,0,0,0.65),
        inset 0 0 0 1px rgba(255,255,255,0.85);
    }

    .bj-shoe-card:nth-child(1){ transform: translate(0,0); }
    .bj-shoe-card:nth-child(2){ transform: translate(4px,-4px); }
    .bj-shoe-card:nth-child(3){ transform: translate(8px,-8px); }

    .bj-shoe-count{
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 999px;
      background: rgba(6, 24, 40, 0.8);
      border: 1px solid rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.8);
    }

    .bj-lane{
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
      text-align: center;
    }

    .bj-lane .bj-hand{
      display: flex;
      gap: 10px;
      min-height: 132px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }

    .bj-lane .bj-score{
      font-size: 14px;
      color: rgba(255,255,255,0.75);
    }

    .bj-table-grid{
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 22px;
      height: 100%;
    }

    .bj-dealer{
      padding-top: 8px;
    }

    .bj-players{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 14px;
      align-items: stretch;
    }

    .bj-seat{
      background: var(--theme-game-panel-soft);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 180px;
      position: relative;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .bj-seat.active{
      transform: translateY(-4px);
      box-shadow: 0 0 18px rgba(255, 221, 128, 0.45);
    }

    .bj-seat h3{
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }

    .bj-seat .bj-score{
      font-size: 13px;
    }

    .bj-seat .bj-hand{
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      min-height: 132px;
    }

    .bj-card{
      width: 76px;
      height: 110px;
      border-radius: 12px;
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
      border: 2px solid #d4af37;
      color: #111;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow:
        0 6px 14px rgba(0,0,0,0.55),
        inset 0 0 0 1px rgba(255,255,255,0.75);
    }

    .bj-card .corner{
      position: absolute;
      top: 8px;
      left: 8px;
      font-size: 12px;
      font-weight: 700;
    }

    .bj-card .center{
      font-size: 22px;
      line-height: 1;
    }

    .bj-card.red{
      color: #b01e2d;
    }

    .bj-card.is-back{
      background: radial-gradient(circle at 30% 20%, #fff3c1 0, #cda23b 40%, #7a5a16 100%);
      color: transparent;
    }

    .bj-card.is-back::after{
      content: 'â™£';
      color: rgba(255,255,255,0.85);
      font-size: 24px;
    }

    .bj-actions{
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      background: var(--theme-game-panel-soft);
      border: 1px solid var(--theme-game-border);
      border-radius: 16px;
      padding: 14px 18px;
      box-shadow: 0 12px 24px rgba(0,0,0,0.35);
    }

    .bj-status{
      font-size: 14px;
      color: rgba(255,255,255,0.8);
      max-width: 520px;
      text-align: left;
    }

    .bj-actions-buttons{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .bj-actions-buttons button{
      min-width: 110px;
      position: relative;
    }

    #hitBtn{
      background: linear-gradient(135deg, #ffe08a, #c9961e);
      border-color: rgba(255, 221, 128, 0.85);
      color: #2b1a00;
    }

    #standBtn{
      background: linear-gradient(135deg, #ff7a6b, #c7362c);
      border: 1px solid rgba(255, 215, 128, 0.85);
      color: #2a0404;
    }

    .bj-actions-buttons button:not(:disabled){
      box-shadow: 0 14px 24px rgba(0,0,0,0.45), 0 0 16px rgba(140, 200, 255, 0.35);
      transform: translateY(-2px);
    }

    .bj-actions-buttons button:not(:disabled):hover{
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 18px 30px rgba(0,0,0,0.5), 0 0 22px rgba(140, 200, 255, 0.45);
    }

    .bj-actions-buttons button:disabled{
      opacity: 0.55;
      box-shadow: 0 6px 12px rgba(0,0,0,0.25);
      transform: none;
      filter: grayscale(0.2);
    }

    .bj-fly-card{
      position: fixed;
      width: 76px;
      height: 110px;
      border-radius: 12px;
      border: 2px solid #d4af37;
      background: radial-gradient(circle at 30% 20%, #fff3c1 0, #cda23b 40%, #7a5a16 100%);
      box-shadow:
        0 8px 18px rgba(0,0,0,0.65),
        inset 0 0 0 1px rgba(255,255,255,0.85);
      z-index: 9999;
      pointer-events: none;
      transition: transform 0.5s ease, opacity 0.4s ease;
    }

    .chair {
      width:50px;
      height:50px;
      background:radial-gradient(circle at 30% 20%, #555, #222);
      border-radius:50%;
      position:absolute;
      box-shadow:
        0 4px 10px rgba(0,0,0,0.6),
        inset 0 -4px 8px rgba(0,0,0,0.8);
      border:2px solid #666;
    }

    #controls { margin-top:20px; }

    /* Poker section */
    #pokerSection {
      position: relative;
      background: var(--theme-game-bg-glow),
        radial-gradient(circle at 80% 20%, rgba(255, 221, 128, 0.12), transparent 50%),
        var(--layout-bg, var(--theme-game-bg));
      min-height: 100vh;
      color: #f4f7ff;
      padding-bottom: 40px;
      overflow: hidden;
    }

    #pokerSection::before{
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 80% 20%, rgba(140, 200, 255, 0.12), transparent 45%),
        radial-gradient(circle at 20% 80%, rgba(255, 221, 128, 0.08), transparent 45%);
      opacity: 0.7;
      pointer-events: none;
    }

    #pokerSection.skin-aurora{
      background: radial-gradient(circle at top, #122a4a 0, #081225 65%, #03070f 100%);
    }

    #pokerSection.skin-velvet{
      background: radial-gradient(circle at top, #402032 0, #1c0e16 65%, #070306 100%);
    }

    .poker-lobby {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 18px;
      margin: 16px auto 10px;
      max-width: 980px;
      text-align: center;
    }

    .poker-lobby-card {
      background: var(--theme-game-panel);
      border-radius: 14px;
      padding: 14px 18px;
      border: 1px solid var(--theme-game-border);
      box-shadow: 0 10px 24px rgba(0,0,0,0.55);
    }

    .poker-table-shell{
      width: 92%;
      max-width: 1100px;
      margin: 20px auto 40px;
      position: relative;
      padding: 34px 8px 46px;
    }

    .poker-table {
      width: 100%;
      margin: 0;
      background: radial-gradient(circle at 50% 20%, rgba(75, 130, 190, 0.88) 0, rgba(14, 32, 58, 0.96) 65%, rgba(6, 14, 26, 0.98) 100%);
      border-radius: 22px;
      padding: 20px 24px;
      box-shadow: 0 18px 42px rgba(0,0,0,0.6);
      border: 1px solid var(--theme-game-border);
      position: relative;
      overflow: hidden;
    }

    .poker-dealer {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
      padding: 10px 14px;
      border-radius: 16px;
      background: var(--theme-game-panel-soft);
      border: 1px solid rgba(255,255,255,0.08);
    }

    .dealer-avatar {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffe8a6 0, #c39a2f 45%, #6b4c0b 100%);
      display: grid;
      place-items: center;
      font-size: 26px;
      color: #2b1b00;
      box-shadow: 0 6px 16px rgba(0,0,0,0.5);
    }

    .dealer-info h3 {
      margin: 0;
      font-size: 16px;
      letter-spacing: 0.4px;
    }

    .dealer-info p {
      margin: 4px 0 0;
      font-size: 12px;
      color: #cfe6ff;
    }

    .poker-board {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 16px;
    }

    .poker-user-spot{
      margin-top: 10px;
      padding: 10px 14px;
      border-radius: 16px;
      background: var(--theme-game-panel-soft);
      border: 1px solid rgba(255,255,255,0.08);
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: center;
      min-height: 96px;
    }

    .poker-user-spot h4{
      margin: 0;
      font-size: 15px;
      letter-spacing: 0.4px;
    }

    .poker-user-spot .hand{
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .poker-user-spot .card-pk{
      width: 82px;
      height: 118px;
      font-size: 16px;
    }

    .poker-community {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 8px 0;
    }

    .card-pk {
      width: 72px;
      height: 102px;
      background: linear-gradient(160deg, #ffffff 0%, #f6f0e7 100%);
      color: #111;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: 700;
      font-family: "Georgia", "Times New Roman", serif;
      position: relative;
      padding: 8px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.7);
      animation: dealCard 0.35s ease;
      border: 1px solid #d6c4a4;
    }

    .card-pk.back {
      background: linear-gradient(135deg, #183b6a, #0a1c31);
      color: transparent;
      border: 2px solid rgba(255,255,255,0.3);
      position: relative;
    }

    .card-pk.back::after {
      content: "â™ ";
      color: rgba(255,255,255,0.6);
      font-size: 28px;
    }

    .card-pk .card-corner{
      position: absolute;
      top: 6px;
      left: 8px;
      font-size: 13px;
      font-weight: 700;
    }

    .card-pk .card-corner.bottom{
      top: auto;
      left: auto;
      right: 8px;
      bottom: 6px;
      transform: rotate(180deg);
    }

    .card-pk .card-center{
      font-size: 26px;
      font-weight: 700;
    }

    .card-pk .card-red{
      color: #c11a2b;
    }

    .poker-seats {
      position: absolute;
      inset: -18px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: repeat(3, min-content);
      align-content: space-between;
      gap: 10px 22px;
      pointer-events: none;
      padding: 10px;
    }

    .poker-player {
      padding: 12px;
      border-radius: 12px;
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.08);
      position: relative;
      pointer-events: auto;
    }

    .poker-player.bot{
      padding: 6px 8px;
      border-radius: 10px;
      background: rgba(6, 16, 32, 0.65);
      transform: scale(0.72);
      transform-origin: center;
      min-width: 130px;
      max-width: 160px;
      font-size: 11px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-self: start;
    }

    .poker-player.bot.bot-slot-1{
      grid-column: 1;
      grid-row: 1;
      justify-self: start;
    }

    .poker-player.bot.bot-slot-2{
      grid-column: 2;
      grid-row: 1;
      justify-self: end;
    }

    .poker-player.bot.bot-slot-3{
      grid-column: 1;
      grid-row: 2;
      justify-self: start;
    }

    .poker-player.bot.bot-slot-4{
      grid-column: 2;
      grid-row: 2;
      justify-self: end;
    }

    .poker-player.bot.bot-slot-5{
      grid-column: 1;
      grid-row: 3;
      justify-self: start;
    }

    .poker-player.bot.bot-slot-6{
      grid-column: 2;
      grid-row: 3;
      justify-self: end;
    }

    .poker-player.bot .card-pk{
      width: 50px;
      height: 70px;
      font-size: 11px;
    }

    .poker-player.bot .hand{
      order: -1;
      margin: -8px 0 6px;
    }

    .poker-player.active {
      box-shadow: 0 0 0 2px rgba(255, 221, 128, 0.7);
    }

    .poker-player h4 {
      margin: 0 0 6px 0;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .poker-badges {
      display: flex;
      gap: 6px;
      font-size: 10px;
    }

    .poker-badges span {
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.16);
      border: 1px solid rgba(255,255,255,0.25);
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }

    .poker-player .hand {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin: 6px 0;
    }

    .poker-info-row {
      margin-top: 6px;
      font-size: 12px;
      color: #d9e4ff;
    }

    .poker-seat-row {
      font-size: 11px;
      color: #b7c3e6;
      margin-top: 4px;
    }

    .poker-actions {
      margin-top: 18px;
      display: grid;
      gap: 10px;
      background: var(--theme-game-panel-soft);
      border-radius: 14px;
      padding: 14px;
      border: 1px solid var(--theme-game-border);
    }

    .poker-action-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    .poker-status {
      font-size: 12px;
      color: #cfe6ff;
      text-align: center;
    }

    .poker-meta {
      display: flex;
      justify-content: center;
      gap: 14px;
      flex-wrap: wrap;
      font-size: 13px;
    }

    .poker-meta span {
      background: rgba(6, 16, 32, 0.65);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    small { font-size:12px; color:#ddd; }

    /* Table games */
    #crapsSection{
      position: relative;
      min-height: 100vh;
      color: white;
      padding: 24px;
      background: var(--theme-game-bg-glow),
        radial-gradient(circle at 80% 15%, rgba(255, 221, 128, 0.12), transparent 55%),
        var(--layout-bg, var(--theme-game-bg));
      text-align: center;
      overflow: hidden;
    }

    #baccaratSection{
      position: relative;
      min-height: 100vh;
      color: white;
      padding: 24px;
      background: var(--theme-game-bg-glow),
        radial-gradient(circle at 80% 15%, rgba(255, 221, 128, 0.12), transparent 48%),
        var(--layout-bg, var(--theme-game-bg));
      text-align: center;
      overflow: hidden;
    }

    #rouletteSection{
      position: relative;
      min-height: 100vh;
      color: white;
      padding: 24px;
      background: var(--theme-game-bg-glow),
        radial-gradient(circle at 50% 0%, rgba(255, 221, 128, 0.14), transparent 45%),
        var(--layout-bg, var(--theme-game-bg));
      text-align: center;
      overflow: hidden;
    }

    #crapsSection.skin-aurora,
    #baccaratSection.skin-aurora,
    #rouletteSection.skin-aurora{
      background: radial-gradient(circle at top, #1b2f5d 0, #0a1224 65%, #04070f 100%);
    }

    #crapsSection.skin-velvet,
    #baccaratSection.skin-velvet,
    #rouletteSection.skin-velvet{
      background: radial-gradient(circle at top, #3a1f32 0, #160b12 65%, #070306 100%);
    }

    .table-game-panel{
      max-width: 860px;
      margin: 20px auto;
      background: var(--theme-game-panel);
      border-radius: 18px;
      padding: 20px;
      border: 1px solid var(--theme-game-border);
      box-shadow: 0 12px 30px rgba(0,0,0,0.55);
    }

    .craps-panel{
      background: var(--theme-game-panel);
      border: 1px solid var(--theme-game-border);
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    }

    .craps-header{
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: center;
      margin-bottom: 16px;
    }

    .craps-header h2{
      margin: 0;
      font-size: 30px;
      letter-spacing: 1px;
      color: #ffe9b0;
      text-transform: uppercase;
    }

    .craps-header p{
      margin: 0;
      font-size: 14px;
      color: #cfe2ff;
    }

    .craps-meta{
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: center;
      font-size: 13px;
      color: #c7d8ff;
      margin-top: 4px;
    }

    .craps-meta span{
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 215, 128, 0.2);
      background: rgba(12, 24, 48, 0.6);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
    }

    .craps-field{
      margin: 16px auto;
      padding: 22px 18px;
      border-radius: 24px;
      background: radial-gradient(circle at top, rgba(35, 86, 140, 0.9) 0%, rgba(14, 48, 82, 0.95) 45%, rgba(7, 24, 42, 0.98) 100%);
      border: 2px solid var(--theme-game-accent-soft);
      box-shadow: inset 0 0 24px rgba(0,0,0,0.4), 0 16px 32px rgba(0,0,0,0.55);
      position: relative;
      overflow: hidden;
    }

    .craps-field::before{
      content: "";
      position: absolute;
      inset: 8px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.08);
      pointer-events: none;
      box-shadow: 0 0 18px rgba(255, 215, 128, 0.15);
    }

    .dice-row{
      display:flex;
      justify-content:center;
      gap:16px;
      margin: 14px 0;
      font-size: 48px;
    }

    .dice-row div:not(.craps-die){
      width: 64px;
      height: 64px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius: 12px;
      background: rgba(255,255,255,0.08);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.12);
    }

    .craps-dice{
      margin: 0;
      position: relative;
      z-index: 2;
    }

    .craps-die{
      width: 78px;
      height: 78px;
      border-radius: 18px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      place-items: center;
      color: #f6d676;
      background: linear-gradient(160deg, #0d1726, #1b2740);
      border: 2px solid var(--theme-game-accent);
      box-shadow: 0 18px 30px rgba(0,0,0,0.55), inset 0 0 0 1px rgba(255,255,255,0.08);
      text-shadow: 0 2px 6px rgba(0,0,0,0.55);
      position: relative;
      overflow: hidden;
    }

    .craps-die::after{
      content: "";
      position: absolute;
      inset: 8px 10px 14px;
      border-radius: 10px;
      background: linear-gradient(140deg, rgba(255,255,255,0.25), rgba(255,255,255,0));
      opacity: 0.5;
      pointer-events: none;
    }

    .craps-pip{
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: currentColor;
      text-shadow: 0 2px 4px rgba(0,0,0,0.6);
      filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.35));
    }

    .craps-pip.pos-0{ grid-area: 1 / 1; }
    .craps-pip.pos-1{ grid-area: 1 / 2; }
    .craps-pip.pos-2{ grid-area: 1 / 3; }
    .craps-pip.pos-3{ grid-area: 2 / 1; }
    .craps-pip.pos-4{ grid-area: 2 / 2; }
    .craps-pip.pos-5{ grid-area: 2 / 3; }
    .craps-pip.pos-6{ grid-area: 3 / 1; }
    .craps-pip.pos-7{ grid-area: 3 / 2; }
    .craps-pip.pos-8{ grid-area: 3 / 3; }

    .dice-roll{
      animation: diceRoll 0.85s cubic-bezier(0.25, 0.75, 0.3, 1.1);
    }

    @keyframes diceRoll{
      0% { transform: translateX(-12px) translateY(6px) rotate(0deg) scale(0.9); filter: blur(0px); }
      25% { transform: translateX(18px) translateY(-8px) rotate(95deg) scale(1.05); filter: blur(0.6px); }
      55% { transform: translateX(-10px) translateY(10px) rotate(190deg) scale(0.95); filter: blur(0.2px); }
      80% { transform: translateX(8px) translateY(-4px) rotate(310deg) scale(1.04); filter: blur(0px); }
      100% { transform: translateX(0) translateY(0) rotate(360deg) scale(1); filter: blur(0px); }
    }

    .craps-status{
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: center;
      margin-top: 12px;
      font-size: 14px;
      color: #dce8ff;
    }

    .craps-point{
      font-weight: 700;
      font-size: 16px;
      color: #ffe9b0;
    }

    .baccarat-row,
    .roulette-row{
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap: wrap;
      margin: 14px 0;
    }

    .baccarat-table{
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding-top: 12px;
      padding-right: 120px;
      min-height: 200px;
      background: var(--theme-game-panel);
      border-radius: 18px;
      border: 1px solid var(--theme-game-border);
      box-shadow: inset 0 0 24px rgba(6, 20, 38, 0.5);
    }

    .baccarat-shoe{
      position: absolute;
      top: 12px;
      right: 12px;
      width: 76px;
      height: 108px;
    }

    .baccarat-shoe-stack{
      position: relative;
      width: 76px;
      height: 108px;
    }

    .baccarat-shoe-card{
      position: absolute;
      inset: 0;
      border-radius: 12px;
      border: 2px solid var(--theme-card-border);
      background: var(--theme-card-back);
      box-shadow: 0 8px 18px rgba(0,0,0,0.6), inset 0 0 0 1px rgba(255,255,255,0.85);
    }

    .baccarat-shoe-card:nth-child(2){ transform: translate(4px,-4px); }
    .baccarat-shoe-card:nth-child(3){ transform: translate(8px,-8px); }

    .baccarat-card{
      width: 70px;
      height: 100px;
      background: #fdfdfd;
      color:#111;
      border-radius: 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      border:2px solid #d4af37;
      box-shadow: 0 6px 16px rgba(0,0,0,0.6);
      animation: dealCard 0.35s ease;
    }

    .baccarat-fly-card{
      position: fixed;
      width: 70px;
      height: 100px;
      border-radius: 12px;
      border: 2px solid #d4af37;
      background: radial-gradient(circle at 30% 20%, #fff3c1 0, #cda23b 40%, #7a5a16 100%);
      box-shadow:
        0 8px 18px rgba(0,0,0,0.65),
        inset 0 0 0 1px rgba(255,255,255,0.85);
      z-index: 9999;
      pointer-events: none;
      transition: transform 0.6s ease, opacity 0.5s ease;
    }

    .baccarat-label{
      width: 100%;
      text-align: center;
      font-weight: 700;
      color: #ffd6dc;
      letter-spacing: 0.4px;
    }

    #rouletteSection{
      background:
        var(--theme-game-bg-glow),
        radial-gradient(circle at 20% 20%, rgba(255, 221, 128, 0.12), transparent 50%),
        var(--layout-bg, var(--theme-game-bg));
    }

    .roulette-panel{
      position: relative;
      overflow: hidden;
      border-radius: 24px;
      background: var(--theme-game-panel);
      border: 1px solid var(--theme-game-border);
      box-shadow: 0 24px 50px rgba(0,0,0,0.6);
    }

    .roulette-panel::before{
      content: "";
      position: absolute;
      inset: 12px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.06);
      pointer-events: none;
      box-shadow: inset 0 0 16px rgba(255, 215, 128, 0.08);
    }

    .roulette-layout{
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(280px, 0.8fr);
      gap: 24px;
      align-items: center;
    }

    .roulette-stage{
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px 0;
      min-height: 360px;
    }

    .roulette-wheel-frame{
      position: relative;
      width: 360px;
      height: 360px;
      border-radius: 50%;
      background:
        radial-gradient(circle at 28% 28%, rgba(255,255,255,0.2), transparent 45%),
        radial-gradient(circle at 70% 70%, rgba(12, 18, 28, 0.85), rgba(6, 8, 14, 0.95)),
        radial-gradient(circle at 50% 50%, rgba(255, 215, 128, 0.08), transparent 65%);
      border: 2px solid rgba(255, 215, 128, 0.45);
      box-shadow: inset 0 0 55px rgba(0,0,0,0.7), 0 28px 60px rgba(0,0,0,0.65);
      display: grid;
      place-items: center;
    }

    .roulette-wheel-frame::after{
      content: "";
      position: absolute;
      inset: 14px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: inset 0 0 26px rgba(255, 215, 128, 0.18);
      pointer-events: none;
    }

    .roulette-wheel{
      width: 290px;
      height: 290px;
      border-radius: 50%;
      background: var(--roulette-wheel-gradient, conic-gradient(
        #1b7d3d 0 9.73deg,
        #c62828 9.73deg 19.46deg,
        #111 19.46deg 29.19deg,
        #c62828 29.19deg 38.92deg,
        #111 38.92deg 48.65deg,
        #c62828 48.65deg 58.38deg,
        #111 58.38deg 68.11deg,
        #c62828 68.11deg 77.84deg,
        #111 77.84deg 87.57deg,
        #c62828 87.57deg 97.3deg,
        #111 97.3deg 107.03deg,
        #c62828 107.03deg 116.76deg,
        #111 116.76deg 126.49deg,
        #c62828 126.49deg 136.22deg,
        #111 136.22deg 145.95deg,
        #c62828 145.95deg 155.68deg,
        #111 155.68deg 165.41deg,
        #c62828 165.41deg 175.14deg,
        #111 175.14deg 184.87deg,
        #c62828 184.87deg 194.6deg,
        #111 194.6deg 204.33deg,
        #c62828 204.33deg 214.06deg,
        #111 214.06deg 223.79deg,
        #c62828 223.79deg 233.52deg,
        #111 233.52deg 243.25deg,
        #c62828 243.25deg 252.98deg,
        #111 252.98deg 262.71deg,
        #c62828 262.71deg 272.44deg,
        #111 272.44deg 282.17deg,
        #c62828 282.17deg 291.9deg,
        #111 291.9deg 301.63deg,
        #c62828 301.63deg 311.36deg,
        #111 311.36deg 321.09deg,
        #c62828 321.09deg 330.82deg,
        #111 330.82deg 340.55deg,
        #c62828 340.55deg 350.28deg,
        #111 350.28deg 360deg
      ));
      border: 7px solid rgba(212, 175, 55, 0.85);
      box-shadow: inset 0 0 26px rgba(0,0,0,0.6);
      position: relative;
    }

    .roulette-pocket-layer,
    .roulette-hatch-layer{
      position: absolute;
      inset: 0;
      border-radius: 50%;
      pointer-events: none;
    }

    .roulette-pocket-layer{
      z-index: 2;
    }

    .roulette-hatch-layer{
      z-index: 3;
    }

    .roulette-number{
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(var(--angle)) translateY(-112px) rotate(calc(-1 * var(--angle)));
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.2px;
      text-shadow: 0 1px 3px rgba(0,0,0,0.6);
    }

    .roulette-number.red{
      color: #ffd6d6;
    }

    .roulette-number.black{
      color: #e3e8f4;
    }

    .roulette-number.green{
      color: #c8ffe2;
    }

    .roulette-hatch{
      position: absolute;
      top: 50%;
      left: 50%;
      width: 1px;
      height: 16px;
      border-radius: 1px;
      background: linear-gradient(180deg, rgba(255, 236, 196, 0.7), rgba(180, 120, 30, 0.35));
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
      transform: translate(-50%, -50%) rotate(var(--angle)) translateY(-94px);
    }

    .roulette-wheel::before{
      content: "";
      position: absolute;
      inset: 14px;
      border-radius: 50%;
      border: 2px dashed rgba(255,255,255,0.18);
      box-shadow: inset 0 0 24px rgba(255, 215, 128, 0.22);
    }

    .roulette-wheel-center{
      position: absolute;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fce9b5, #b38a1c 60%, #6b4a0c 100%);
      border: 4px solid rgba(255, 235, 170, 0.8);
      box-shadow: 0 10px 20px rgba(0,0,0,0.45);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 5;
    }

    .roulette-pocket-ring{
      position: absolute;
      inset: 38px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.1);
      box-shadow: inset 0 0 20px rgba(0,0,0,0.55);
      z-index: 4;
    }

    .roulette-ball-orbit{
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .roulette-ball{
      position: absolute;
      top: 50%;
      left: 50%;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #d9d9d9 65%, #a2a2a2 100%);
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      transform: translate(-50%, -50%) translateY(var(--ball-orbit-radius, -156px));
    }

    .roulette-ball.is-dropping{
      animation: rouletteBallDrop var(--ball-drop-duration, 520ms) cubic-bezier(0.25, 0.8, 0.2, 1) forwards;
    }

    @keyframes rouletteBallDrop{
      0%{ transform: translate(-50%, -50%) translateY(var(--ball-orbit-radius, -156px)) scale(1); }
      60%{ transform: translate(-50%, -50%) translateY(var(--ball-drop-mid, -132px)) scale(0.96); }
      100%{ transform: translate(-50%, -50%) translateY(var(--ball-drop-end, -118px)) scale(0.92); }
    }

    .roulette-pointer{
      position: absolute;
      top: -6px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 18px solid #f6e9c4;
      filter: drop-shadow(0 6px 8px rgba(0,0,0,0.6));
    }

    .roulette-legend{
      display: flex;
      flex-direction: column;
      gap: 12px;
      text-align: left;
      padding: 12px;
    }

    .roulette-legend h3{
      margin: 0;
      font-size: 22px;
      color: #ffe9b0;
    }

    .roulette-legend p{
      margin: 0;
      color: #cfe2ff;
      line-height: 1.5;
      font-size: 14px;
    }

    .roulette-glow{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 12px;
      color: #f9f2d9;
    }

    .roulette-glow span{
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(10,20,35,0.7);
      border: 1px solid rgba(255, 215, 128, 0.2);
    }

    .roulette-result{
      font-size: 20px;
      font-weight: 700;
      margin-top: 12px;
    }

    @media (max-width: 860px){
      .roulette-layout{
        grid-template-columns: 1fr;
      }
      .roulette-stage{
        min-height: 300px;
      }
      .roulette-wheel-frame{
        width: 300px;
        height: 300px;
      }
      .roulette-wheel{
        width: 240px;
        height: 240px;
      }
      .roulette-ball{
        transform: translate(-50%, -50%) translateY(-130px);
      }
      @keyframes rouletteBallDrop{
        0%{ transform: translate(-50%, -50%) translateY(-130px) scale(1); }
        60%{ transform: translate(-50%, -50%) translateY(-104px) scale(0.95); }
        100%{ transform: translate(-50%, -50%) translateY(-92px) scale(0.9); }
      }
    }

    /* Slot machine */
    #slotsSection{
      min-height: 100vh;
      color: #fff;
      padding: 24px;
      background: var(--theme-game-bg-glow),
        radial-gradient(circle at 80% 20%, rgba(255, 221, 128, 0.18), transparent 50%),
        var(--layout-bg, var(--theme-game-bg));
      text-align: center;
    }

    #slotsSection.skin-aurora{
      background: radial-gradient(circle at top, #20365d 0, #0b1427 55%, #04070f 100%);
    }

    #slotsSection.skin-velvet{
      background: radial-gradient(circle at top, #4a1f33 0, #1a0b16 55%, #070309 100%);
    }

    .slots-machine{
      --slot-symbol-size: 72px;
      max-width: 720px;
      margin: 30px auto;
      padding: 30px;
      border-radius: 28px;
      background: var(--theme-game-panel);
      border: 1px solid var(--theme-game-border);
      box-shadow: 0 26px 50px rgba(0,0,0,0.7), 0 0 28px rgba(140, 200, 255, 0.18);
      position: relative;
    }

    .slots-marquee{
      text-transform: uppercase;
      font-weight: 800;
      letter-spacing: 2px;
      font-size: 18px;
      padding: 10px 18px;
      border-radius: 999px;
      background: linear-gradient(120deg, #ffe08a, #a9781c);
      color: #2b1a00;
      box-shadow: inset 0 2px 4px rgba(255,255,255,0.4), 0 12px 20px rgba(0,0,0,0.4);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 18px;
    }

    .slots-body{
      display: flex;
      gap: 26px;
      align-items: stretch;
      justify-content: center;
    }

    .slots-cabinet{
      flex: 1;
      padding: 18px;
      border-radius: 20px;
      background: linear-gradient(160deg, rgba(14, 38, 70, 0.95), rgba(8, 14, 30, 0.95));
      border: 1px solid var(--theme-game-border);
      box-shadow: inset 0 0 18px rgba(0,0,0,0.65), 0 16px 26px rgba(0,0,0,0.35);
      position: relative;
    }

    .slots-header{
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
      margin-bottom: 16px;
    }

    .slots-window{
      padding: 14px;
      border-radius: 18px;
      background: radial-gradient(circle at top, rgba(10, 20, 38, 0.95), rgba(5, 8, 18, 0.9));
      border: 2px solid var(--theme-game-border);
      box-shadow: inset 0 0 18px rgba(0,0,0,0.85);
    }

    .slots-reels{
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
      margin: 20px auto;
      max-width: 420px;
    }

    .slot-reel{
      background: rgba(8,8,14,0.85);
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: inset 0 0 12px rgba(0,0,0,0.8);
      overflow: hidden;
      height: var(--slot-symbol-size);
      position: relative;
    }

    .slot-reel::after{
      content: '';
      position: absolute;
      inset: 0;
      border-top: 1px solid rgba(255,255,255,0.1);
      border-bottom: 1px solid rgba(255,255,255,0.12);
      box-shadow: inset 0 0 18px rgba(255,255,255,0.08);
      pointer-events: none;
    }

    .slot-reel-strip{
      display: flex;
      flex-direction: column;
      align-items: center;
      transform: translateY(0);
      transition: transform 1s cubic-bezier(0.2, 0.6, 0.1, 1);
      will-change: transform;
    }

    .slot-symbol{
      height: var(--slot-symbol-size);
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      text-shadow: 0 8px 14px rgba(0,0,0,0.6);
    }

    .slot-reel.spinning .slot-reel-strip{
      filter: blur(1.2px);
    }

    .slots-controls{
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      align-items: center;
      margin-top: 16px;
    }

    .slots-status{
      margin-top: 14px;
      font-weight: 600;
      min-height: 24px;
    }

    .slots-win{
      color: #ffe28a;
      text-shadow: 0 0 12px rgba(255,215,125,0.45);
    }

    .slots-lever{
      width: 80px;
      min-width: 80px;
      border: none;
      background: transparent;
      cursor: pointer;
      position: relative;
      padding: 0;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    .slots-lever:disabled{
      cursor: not-allowed;
      filter: grayscale(0.2) brightness(0.85);
    }

    .slots-lever-track{
      width: 54px;
      height: 220px;
      background: linear-gradient(180deg, rgba(8, 18, 32, 0.9), rgba(6, 12, 20, 0.95));
      border-radius: 30px;
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
      position: relative;
      overflow: hidden;
    }

    .lever-handle{
      position: absolute;
      top: 26px;
      left: 50%;
      width: 14px;
      height: 140px;
      transform: translateX(-50%);
      background: linear-gradient(180deg, #f8e4a4, #c38b2f);
      border-radius: 20px;
      box-shadow: inset 0 2px 4px rgba(255,255,255,0.5), 0 8px 16px rgba(0,0,0,0.5);
      transform-origin: top center;
    }

    .lever-knob{
      position: absolute;
      top: 4px;
      left: 50%;
      width: 40px;
      height: 40px;
      transform: translateX(-50%);
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ff7a7a, #c41022);
      box-shadow: inset 0 3px 6px rgba(255,255,255,0.4), 0 10px 18px rgba(0,0,0,0.55);
      border: 2px solid rgba(255,255,255,0.25);
    }

    .slots-lever.pulling .lever-handle{
      animation: leverPull 0.6s ease-in-out;
    }

    .slots-lever.pulling .lever-knob{
      animation: leverKnobPull 0.6s ease-in-out;
    }

    @keyframes leverPull{
      0%{ transform: translateX(-50%) translateY(0); }
      40%{ transform: translateX(-50%) translateY(64px); }
      70%{ transform: translateX(-50%) translateY(54px); }
      100%{ transform: translateX(-50%) translateY(0); }
    }

    @keyframes leverKnobPull{
      0%{ transform: translateX(-50%) translateY(0); }
      40%{ transform: translateX(-50%) translateY(86px); }
      70%{ transform: translateX(-50%) translateY(70px); }
      100%{ transform: translateX(-50%) translateY(0); }
    }

    @media (max-width: 720px){
      .slots-body{
        flex-direction: column;
        align-items: center;
      }

      .slots-lever{
        width: 100%;
        align-items: center;
      }
    }

    /* Plinko */
    #plinkoSection{
      min-height: 100vh;
      color: #fff;
      padding: 24px;
      text-align: center;
      background: radial-gradient(circle at 20% 12%, rgba(255, 231, 152, 0.25), transparent 45%),
        radial-gradient(circle at 80% 18%, rgba(120, 200, 255, 0.25), transparent 50%),
        var(--layout-bg, var(--theme-game-bg));
    }

    #plinkoSection.skin-aurora{
      background: radial-gradient(circle at top, #1f3562 0, #0a1326 60%, #03070f 100%);
    }

    #plinkoSection.skin-velvet{
      background: radial-gradient(circle at top, #3d1c31 0, #170a15 60%, #060308 100%);
    }

    .plinko-panel{
      max-width: 1160px;
      margin: 0 auto;
    }

    .plinko-controls{
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      align-items: center;
      margin-top: 12px;
    }

    .plinko-board{
      position: relative;
      width: min(1120px, 98vw);
      height: 740px;
      margin: 26px auto 12px;
      border-radius: 24px;
      background: linear-gradient(160deg, rgba(18, 44, 82, 0.96), rgba(8, 18, 36, 0.96));
      border: 1px solid var(--theme-game-border);
      box-shadow: 0 26px 50px rgba(0,0,0,0.7), 0 0 28px rgba(140, 200, 255, 0.35);
      overflow: hidden;
    }

    .plinko-pegs{
      position: absolute;
      inset: 28px 42px 70px 42px;
    }

    .plinko-peg{
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff4c4, #9bd0ff);
      box-shadow: 0 0 14px rgba(140, 200, 255, 0.75);
      transform: translate(-50%, -50%);
    }

    .plinko-ball{
      position: absolute;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff1b8, #ffb347);
      box-shadow: 0 8px 16px rgba(0,0,0,0.55), 0 0 16px rgba(255,215,125,0.6);
      left: 50%;
      top: 16px;
      transform: translateX(-50%);
      pointer-events: none;
    }

    .plinko-slots{
      position: absolute;
      left: 0;
      right: 0;
      bottom: 44px;
      height: 90px;
      display: grid;
      grid-template-columns: repeat(13, minmax(0, 1fr));
      gap: 6px;
      padding: 0 12px 10px;
      align-items: end;
    }

    .plinko-slot{
      background: linear-gradient(180deg, rgba(64, 156, 255, 0.35), rgba(14, 44, 88, 0.9));
      border: 1px solid rgba(120, 180, 255, 0.45);
      border-radius: 12px;
      padding: 10px 4px 14px;
      font-weight: 700;
      font-size: 13px;
      color: #cfe0ff;
      transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    }

    .plinko-slot.active{
      transform: translateY(-8px);
      background: rgba(255, 199, 122, 0.3);
      box-shadow: 0 0 18px rgba(255,198,120,0.6);
      color: #ffe3b0;
    }

    .plinko-multipliers{
      position: absolute;
      left: 0;
      right: 0;
      bottom: 12px;
      display: grid;
      grid-template-columns: repeat(13, minmax(0, 1fr));
      gap: 6px;
      padding: 0 12px;
      font-size: 12px;
      font-weight: 700;
      color: #f9e7b8;
      letter-spacing: 0.02em;
    }

    .plinko-multiplier{
      padding: 4px 2px;
      border-radius: 8px;
      background: rgba(10, 24, 46, 0.65);
      border: 1px solid rgba(255, 221, 128, 0.25);
      box-shadow: inset 0 0 10px rgba(0,0,0,0.35);
    }

    .plinko-multiplier.active{
      background: rgba(255, 221, 128, 0.22);
      border-color: rgba(255, 221, 128, 0.45);
      color: #fff2c8;
    }

    .plinko-status{
      margin-top: 12px;
      font-weight: 600;
      min-height: 24px;
    }

    .plinko-note{
      font-size: 12px;
      opacity: 0.7;
      letter-spacing: 0.02em;
    }

    /* Global currency display */
    #currencyDisplay{
      position: fixed;
      top: 12px;
      left: 12px;
      right: auto;
      display: none;
      flex-direction: column;
      gap: 12px;
      z-index: 99999;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    .currency-chip{
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(6, 12, 24, 0.75);
      color: #fff;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: 0 8px 22px rgba(0,0,0,0.45);
      min-width: 150px;
    }

    .currency-values{
      display: flex;
      flex-direction: column;
      line-height: 1.1;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      opacity: 0.85;
    }

    .currency-values strong{
      font-size: 18px;
      letter-spacing: 0.02em;
      text-transform: none;
      opacity: 1;
    }

    .currency-sub{
      font-size: 11px;
      text-transform: none;
      letter-spacing: 0.02em;
      opacity: 0.7;
    }

    .coin-icon{
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-weight: 700;
      font-size: 14px;
      box-shadow: inset 0 2px 5px rgba(255,255,255,0.35), inset 0 -2px 6px rgba(0,0,0,0.4);
    }

    .coin-silver{
      background: radial-gradient(circle at 30% 30%, #f4f7fb 0%, #cfd5df 45%, #8b94a1 100%);
      border: 1px solid #d7dde6;
      color: #fdfdfd;
      text-shadow: 0 1px 2px rgba(0,0,0,0.6);
    }

    .coin-gold{
      background: radial-gradient(circle at 30% 30%, #ffe9a6 0%, #d6a93b 52%, #9a6a06 100%);
      border: 1px solid #f1d37a;
      color: #7a5200;
      font-size: 15px;
      text-shadow: 0 1px 1px rgba(255,255,255,0.6);
    }

    /* Developer portal */
    #developerPortal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100000;
    }

    .developer-card{
      background: #0f1624;
      color: #fff;
      padding: 24px;
      border-radius: 16px;
      width: min(420px, 90vw);
      box-shadow: 0 24px 50px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .developer-card h3{
      margin: 0 0 8px;
      font-size: 22px;
    }

    .developer-actions{
      display: grid;
      gap: 10px;
      margin-top: 16px;
    }

    /* Player tracking panel */
    #playerTrackingPanel{
      position: fixed;
      inset: 0;
      background: rgba(2, 8, 18, 0.82);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100001;
    }

    .tracking-card{
      width: min(1080px, 94vw);
      max-height: 90vh;
      overflow: hidden;
      background: linear-gradient(160deg, rgba(12, 24, 46, 0.97), rgba(6, 12, 26, 0.98));
      border-radius: 18px;
      border: 1px solid rgba(140, 200, 255, 0.2);
      box-shadow: 0 28px 60px rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
    }

    .tracking-header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 22px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      gap: 12px;
    }

    .tracking-header h3{
      margin: 0 0 6px;
      font-size: 20px;
    }

    .tracking-header p{
      margin: 0;
      color: rgba(210, 225, 255, 0.78);
      font-size: 13px;
    }

    .tracking-close{
      border: none;
      background: rgba(255,255,255,0.08);
      color: #f6e9c4;
      width: 36px;
      height: 36px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
    }

    .tracking-controls{
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 12px 22px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      background: rgba(8, 18, 34, 0.7);
    }

    .tracking-controls button{
      padding: 6px 12px;
      border-radius: 8px;
      border: 1px solid rgba(255, 221, 128, 0.6);
      background: rgba(255, 215, 128, 0.12);
      color: #f6e9c4;
      cursor: pointer;
      font-weight: 700;
    }

    .tracking-game-label{
      font-weight: 700;
      letter-spacing: 0.4px;
    }

    .tracking-tables{
      padding: 16px 22px 24px;
      overflow: auto;
      display: grid;
      gap: 18px;
    }

    .tracking-table-block h4{
      margin: 0 0 8px;
      font-size: 16px;
    }

    .tracking-table{
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      background: rgba(10, 22, 40, 0.7);
      border-radius: 12px;
      overflow: hidden;
    }

    .tracking-table th,
    .tracking-table td{
      padding: 8px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      text-align: center;
      white-space: nowrap;
    }

    .tracking-table th:first-child,
    .tracking-table td:first-child{
      text-align: left;
      font-weight: 600;
      color: #f6fbff;
    }

    .tracking-table thead th{
      background: rgba(255,255,255,0.06);
      color: rgba(214, 229, 255, 0.9);
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 0.06em;
    }

    .tracking-table tbody tr:last-child td{
      border-bottom: none;
    }

/* ===== Paardenrace Lanes ===== */
#horseRaceSection{
    background: var(--theme-game-bg-glow),
      radial-gradient(circle at 70% 15%, rgba(255, 221, 128, 0.16), transparent 50%),
      var(--layout-bg, var(--theme-game-bg));
    min-height: 100vh;
}

#horseRaceSection.skin-aurora{
    background: radial-gradient(circle at top, rgba(22, 44, 78, 0.95) 0, rgba(8, 14, 26, 0.98) 60%, #04060d 100%);
}

#horseRaceSection.skin-velvet{
    background: radial-gradient(circle at top, rgba(66, 28, 44, 0.95) 0, rgba(22, 10, 16, 0.98) 60%, #050207 100%);
}

.race-shell{
    max-width: 1100px;
    margin: 0 auto;
    padding: 20px 12px 36px;
}

.race-header{
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
}

.race-title{
    text-align: left;
}

.race-title h2{
    margin: 0;
    font-size: 30px;
    letter-spacing: 0.6px;
}

.race-title p{
    margin: 6px 0 0;
    color: rgba(255,255,255,0.7);
}

.race-controls{
    background: var(--theme-game-panel);
    border: 1px solid var(--theme-game-border);
    border-radius: 16px;
    padding: 16px;
    display: grid;
    gap: 10px;
    box-shadow: 0 16px 30px rgba(0,0,0,0.45);
}

.race-controls-row{
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
    justify-content: center;
}

.race-controls label{
    font-weight: 600;
    color: rgba(255,255,255,0.75);
}

.race-controls input,
.race-controls select{
    background: rgba(12, 18, 22, 0.85);
    border: 1px solid rgba(255,255,255,0.18);
    border-radius: 10px;
    color: #f1f6ff;
    padding: 8px 12px;
    font-size: 15px;
}

.race-track{
    position: relative;
    width: min(100%, 980px);
    margin: 28px auto 0;
    padding: 36px 28px 34px;
    border-radius: 22px;
    border: 1px solid rgba(255, 215, 120, 0.4);
    background: linear-gradient(135deg, rgba(22, 60, 30, 0.95), rgba(10, 24, 16, 0.98));
    box-shadow: 0 25px 45px rgba(0,0,0,0.55), inset 0 0 0 1px rgba(255,255,255,0.04);
    overflow: hidden;
    z-index: 1;
}

.race-track::after{
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.08), transparent 45%);
    opacity: 0.6;
    pointer-events: none;
}

.race-track::before{
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at top, rgba(255,255,255,0.08), transparent 55%);
    pointer-events: none;
}

.race-lights{
    position: absolute;
    inset: 16px 26px auto;
    display: flex;
    gap: 6px;
}

.race-light{
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: radial-gradient(circle, #ffeaa3 0, #ffb732 55%, #7d4400 100%);
    box-shadow: 0 0 12px rgba(255, 200, 90, 0.65);
    animation: lightPulse 1.6s ease-in-out infinite;
}

.race-light:nth-child(2){ animation-delay: 0.3s; }
.race-light:nth-child(3){ animation-delay: 0.6s; }
.race-light:nth-child(4){ animation-delay: 0.9s; }
.race-light:nth-child(5){ animation-delay: 1.2s; }

.finish-line{
    position: absolute;
    top: 20px;
    right: 72px;
    bottom: 20px;
    width: 18px;
    border-radius: 10px;
    background:
        repeating-linear-gradient(
            180deg,
            #f8f4e8 0,
            #f8f4e8 12px,
            #1b1b1b 12px,
            #1b1b1b 24px
        );
    box-shadow: 0 0 20px rgba(255, 233, 175, 0.5), inset 0 0 0 2px rgba(255,255,255,0.2);
    z-index: 2;
}

.finish-banner{
    position: absolute;
    top: 8px;
    right: 42px;
    background: linear-gradient(135deg, #2b1605, #7c4a10);
    padding: 6px 14px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 0.4px;
    text-transform: uppercase;
    border: 1px solid rgba(255, 218, 140, 0.8);
    box-shadow: 0 8px 18px rgba(0,0,0,0.45);
    z-index: 2;
}

.raceLane {
    position: relative;
    height: 72px;
    margin: 16px 0;
    border-radius: 16px;
    border: 1px solid rgba(255, 215, 140, 0.45);
    background: linear-gradient(90deg, rgba(21, 69, 30, 0.9), rgba(13, 44, 20, 0.95));
    overflow: hidden;
    z-index: 1;
}

.raceLane::after{
    content: "";
    position: absolute;
    inset: 10px 24px;
    border: 1px dashed rgba(255,255,255,0.1);
    border-radius: 12px;
}

.lane-label{
    position: absolute;
    left: 16px;
    top: 12px;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    color: rgba(255,255,255,0.6);
}

.horse {
    position: absolute;
    left: 0;
    top: 10px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 999px;
    background: rgba(10, 15, 18, 0.85);
    border: 1px solid rgba(255,255,255,0.2);
    font-weight: 600;
    font-size: 16px;
    color: #f8fbff;
    box-shadow: 0 12px 24px rgba(0,0,0,0.4);
    transition: left 0.18s linear;
    animation: gallop 0.45s ease-in-out infinite;
    z-index: 3;
}

.horse.winner{
    background: linear-gradient(135deg, rgba(255, 215, 125, 0.95), rgba(255, 236, 190, 0.85));
    color: #2b1605;
    border-color: rgba(255, 215, 125, 0.9);
    box-shadow: 0 0 18px rgba(255, 220, 140, 0.7);
}

.horse-emoji{
    font-size: 22px;
}

.horse-name{
    font-weight: 700;
    letter-spacing: 0.3px;
}

.horse-tag{
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 999px;
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.25);
    color: rgba(255,255,255,0.85);
    text-transform: uppercase;
    letter-spacing: 0.4px;
}

.horse--sprinter{
    background: linear-gradient(120deg, rgba(255, 220, 120, 0.95), rgba(255, 142, 82, 0.92));
    border-color: rgba(255, 214, 140, 0.9);
    color: #4a2200;
}

.horse--sprinter .horse-tag{
    background: rgba(255, 255, 255, 0.25);
    border-color: rgba(255, 255, 255, 0.45);
    color: #6a2a00;
}

.horse--steady{
    background: linear-gradient(120deg, rgba(124, 170, 255, 0.95), rgba(64, 96, 180, 0.9));
    border-color: rgba(170, 210, 255, 0.75);
}

.horse--steady .horse-tag{
    background: rgba(18, 30, 64, 0.35);
}

.horse--precision{
    background: linear-gradient(120deg, rgba(116, 255, 208, 0.92), rgba(34, 140, 120, 0.9));
    border-color: rgba(154, 255, 225, 0.8);
    color: #053a2f;
}

.horse--precision .horse-tag{
    background: rgba(5, 60, 50, 0.3);
    color: rgba(215, 255, 245, 0.9);
}

.horse--wild{
    background: linear-gradient(120deg, rgba(255, 120, 138, 0.95), rgba(160, 36, 62, 0.92));
    border-color: rgba(255, 160, 190, 0.8);
}

.horse--wild .horse-tag{
    background: rgba(60, 10, 24, 0.35);
    color: rgba(255, 220, 230, 0.9);
}

.race-status{
    margin-top: 12px;
    font-weight: 600;
    color: #ffe8a6;
    text-shadow: 0 0 10px rgba(0,0,0,0.6);
}

.race-results{
    margin-top: 10px;
    padding: 12px 16px;
    border-radius: 14px;
    border: 1px solid rgba(255, 255, 255, 0.18);
    background: rgba(8, 12, 14, 0.72);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03);
    display: none;
}

.race-results.show{
    display: block;
}

.race-results-title{
    font-weight: 700;
    margin-bottom: 6px;
}

.race-results-grid{
    display: grid;
    gap: 6px;
}

.race-result-item{
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    color: rgba(255,255,255,0.85);
}

.photo-finish{
    margin-top: 8px;
    padding: 6px 12px;
    border-radius: 999px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(255, 215, 125, 0.12);
    border: 1px solid rgba(255, 215, 125, 0.6);
    font-size: 13px;
    color: #ffe8a6;
}

@keyframes gallop{
    0%, 100%{ transform: translateY(0); }
    50%{ transform: translateY(-2px); }
}

@keyframes lightPulse{
    0%, 100%{ opacity: 0.5; transform: scale(0.9); }
    50%{ opacity: 1; transform: scale(1.2); }
}

    /* small responsive */
    @media (max-width:600px){
      #lb-popup { width: 100%; right:0; left:0; height: 50vh; border-radius: 12px 12px 0 0;}
      .bj-card{ width:56px; height:84px; }
      .bj-table{ min-height: 360px; }
      .card-pk{ width:56px; height:84px; }
    }
    /* ============================ THEME OVERRIDES ============================ */
    :root{
      --theme-body-bg: #050515;
      --theme-login-bg: radial-gradient(circle at top, rgba(15,111,178,0.28), transparent 52%),
        radial-gradient(circle at 15% 30%, rgba(212,175,55,0.2), transparent 45%),
        linear-gradient(150deg, #02070f 0, #040f1e 45%, #020408 100%);
      --theme-dashboard-bg: radial-gradient(circle at top, rgba(15,111,178,0.25), transparent 40%),
        radial-gradient(circle at 20% 20%, rgba(212,175,55,0.18), transparent 55%),
        linear-gradient(140deg, #030b14 0, #051729 35%, #071f33 60%, #030b14 100%);
      --theme-menu-header-bg: linear-gradient(120deg, rgba(7,30,49,0.95), rgba(8,40,60,0.8));
      --theme-primary: #0b4f7b;
      --theme-secondary: #0f6fb2;
      --theme-accent: #d4af37;
      --theme-cream: #f6e9c4;
      --theme-card-back: radial-gradient(circle at 30% 20%, #fff3c1 0, #cda23b 40%, #7a5a16 100%);
      --theme-card-border: rgba(212, 175, 55, 0.8);
      --theme-dice-bg: linear-gradient(160deg, #f9f5ef, #e8ded0);
      --theme-dice-color: #1b2233;
      --theme-ball-bg: radial-gradient(circle at 30% 30%, #f6f0ff 0, #d2c8ff 40%, #8b7df0 100%);
      --theme-layout-bg: linear-gradient(160deg, rgba(12,66,50,0.95), rgba(6,25,20,0.95));
      --theme-layout-seat: rgba(8, 28, 24, 0.65);
      --theme-layout-panel: rgba(6, 22, 20, 0.7);
      --theme-layout-border: rgba(255,255,255,0.1);
      --theme-login-logo-bg: linear-gradient(140deg, var(--theme-primary), var(--theme-secondary));
      --theme-login-logo-color: var(--theme-cream);
      --theme-login-logo-shadow: 0 0 18px rgba(15,111,178,0.45);
      --theme-claim-daily-bg: linear-gradient(120deg, var(--theme-primary), var(--theme-secondary));
      --theme-claim-daily-border: 1px solid rgba(140, 200, 255, 0.35);
      --theme-claim-daily-color: #f8fbff;
      --theme-claim-daily-shadow: 0 8px 18px rgba(10,90,140,0.35);
    }

    body{
      background: var(--theme-body-bg);
    }

    #login{
      background: var(--theme-login-bg);
    }

    #dashboard{
      background: var(--theme-dashboard-bg);
    }

    .menu-header{
      background: var(--theme-menu-header-bg);
    }

    .menu-logo{
      background: linear-gradient(140deg, var(--theme-primary), var(--theme-secondary));
      color: var(--theme-cream);
    }

    button{
      background: linear-gradient(135deg, #ffd986, var(--theme-accent));
      border-color: rgba(255, 221, 128, 0.75);
    }

    .bj-table{
      background: var(--layout-bg, var(--theme-layout-bg));
      border-color: var(--layout-border, var(--theme-layout-border));
    }

    .bj-seat{
      background: var(--layout-seat, var(--theme-layout-seat));
    }

    .bj-actions{
      background: var(--layout-panel, var(--theme-layout-panel));
      border-color: var(--layout-border, var(--theme-layout-border));
    }

    .poker-table{
      background: var(--layout-bg, var(--theme-layout-bg));
    }

    .craps-field,
    .roulette-layout{
      background: var(--layout-bg, var(--theme-layout-bg));
      border-color: var(--layout-border, var(--theme-layout-border));
    }

    .table-game-panel{
      background: var(--layout-panel, var(--theme-layout-panel));
      border-color: var(--layout-border, var(--theme-layout-border));
    }

    .bj-card.is-back,
    .card-pk.back,
    .bj-fly-card{
      background: var(--theme-card-back);
      border-color: var(--theme-card-border);
    }

    .craps-die{
      background: var(--theme-dice-bg);
      color: var(--theme-dice-color);
      border-color: var(--theme-card-border);
    }

    .roulette-ball,
    .plinko-ball{
      background: var(--theme-ball-bg);
    }

  </style>
</head>
<body>

  <!-- Globale currency overlay -->
  <div id="currencyDisplay">
    <div class="currency-chip">
      <span class="coin-icon coin-silver">C</span>
      <div class="currency-values">
        <span>Credits</span>
        <strong><span id="credits">0</span></strong>
      </div>
    </div>
    <div class="currency-chip">
      <span class="coin-icon coin-gold">L</span>
      <div class="currency-values">
        <span>Lucky Coins</span>
        <strong><span id="luckyCoins">0</span></strong>
        <span class="currency-sub"><span id="luckyCoinProgress">0</span>/500</span>
      </div>
    </div>
  </div>

  <!-- Developer portal -->
  <div id="developerPortal">
    <div class="developer-card">
      <h3>Developer Portal</h3>
      <p>Geef jezelf direct oneindige credits of lucky coins.</p>
      <div class="developer-actions">
        <button id="devCreditsBtn" class="menu-action-btn primary">Geef oneindig credits</button>
        <button id="devLuckyBtn" class="menu-action-btn primary">Geef oneindig lucky coins</button>
        <button id="closeDevPortal" class="menu-action-btn">Sluiten</button>
      </div>
    </div>
  </div>

  <!-- Player tracking panel -->
  <div id="playerTrackingPanel" aria-hidden="true">
    <div class="tracking-card">
      <header class="tracking-header">
        <div>
          <h3>Player Tracking</h3>
          <p>Statistieken per game per dag. Exporteerbaar als tabel.</p>
        </div>
        <button id="closeTrackingPanel" class="tracking-close" aria-label="Sluiten">âœ•</button>
      </header>
      <div class="tracking-controls">
        <button id="trackingPrevGame" type="button">â—€</button>
        <span id="trackingGameLabel" class="tracking-game-label">Blackjack</span>
        <button id="trackingNextGame" type="button">â–¶</button>
      </div>
      <div id="trackingTables" class="tracking-tables"></div>
    </div>
  </div>

  <!-- Login / Account aanmaken -->
  <section id="login">
    <div class="login-shell">
      <div class="login-branding">
        <div class="login-logo">â™ </div>
        <h2>Ignatius Casino</h2>
        <p>Stap binnen in de premium lounge. Snel inloggen, exclusieve bonussen en een luxe casino vibe.</p>
        <div class="login-highlights">
          <div class="login-pill"><span>âœ¦</span> Dagelijkse bonus & vip drops</div>
          <div class="login-pill"><span>âœ¦</span> Multiplayer tafels met live feeling</div>
          <div class="login-pill"><span>âœ¦</span> Veilig account, instant toegang</div>
        </div>
      </div>
      <div class="login-card">
        <h3>Welkom terug</h3>
        <p>Log in met je account of maak direct een nieuwe speler aan.</p>
        <label class="login-field">
          Gebruikersnaam
          <input type="text" id="usernameInput" placeholder="Voer je gebruikersnaam in">
        </label>
        <label class="login-field">
          Wachtwoord
          <input type="password" id="passwordInput" placeholder="Voer je wachtwoord in">
        </label>
        <div class="login-actions">
          <button id="loginBtn">Inloggen</button>
          <button id="createAccountBtn">Account aanmaken</button>
        </div>
        <small class="login-note">Door verder te gaan ga je akkoord met de huisregels van Ignatius Casino.</small>
      </div>
    </div>
  </section>

  <!-- Dashboard -->
  <section id="dashboard">
    <div class="menu-wrapper">
      <header class="menu-header">
        <div class="menu-brand">
          <div class="menu-logo">â™ </div>
          <div>
            <h2>Ignatius Casino</h2>
            <small id="welcomeBack">Welkom terug, <span id="displayName"></span></small>
          </div>
        </div>
        <div class="menu-actions">
          <button id="claimDailyBtn" class="menu-action-btn primary">Claim dagelijkse bonus</button>
          <button id="logoutBtn" class="menu-action-btn">Uitloggen</button>
        </div>
      </header>

      <section class="menu-hero">
        <div class="menu-hero-text">
          <h3>Jouw casinovloer is klaar</h3>
          <p>Pak je voordeel: snelle games, speciale acties en een luxe sfeer om meteen te spelen.</p>
        </div>
        <div class="menu-hero-actions">
          <button id="luckyDropBtn" class="lucky-drop-btn menu-hero-quick" aria-label="Open Lucky Boxes" title="Lucky Boxes">
            <span class="lucky-drop-icon">ðŸ€</span>
            <span class="lucky-drop-badge" aria-hidden="true">!</span>
          </button>
          <button id="lb-tab" class="menu-hero-quick menu-hero-leaderboard" aria-label="Open leaderboard" title="Leaderboard">ðŸ†</button>
          <button class="menu-hero-shop" id="shopBtn" aria-label="Open shop" title="Shop">ðŸ›’</button>
          <button class="menu-hero-shop menu-hero-skins" id="skinsBtn" aria-label="Open skins" title="Skins">ðŸ‘•</button>
          <div class="menu-hero-highlight">
            <div>Dagelijkse boost</div>
            <strong>+250 credits</strong>
            <div style="font-size:12px; color: rgba(255,255,255,0.7);">Mis je bonus niet!</div>
          </div>
        </div>
      </section>

      <div class="menu-grid">
        <div class="menu-card menu-highlight" data-game="blackjack">
          <h4>Blackjack Lounge</h4>
          <p>Casino vibes met live feeling. Strategisch en snel uitbetalen.</p>
          <button id="playBlackjackBtn" class="cta-button">Play Blackjack</button>
        </div>
        <div class="menu-card" data-game="poker">
          <h4>Poker Royale</h4>
          <p>Ga all-in of speel slim. Kies je tafel en domineer.</p>
          <button id="playPokerBtn" class="cta-button alt">Speel Poker</button>
        </div>
        <div class="menu-card" data-game="craps">
          <h4>Craps Arena</h4>
          <p>Gooi de dobbelstenen en bouw je punt op.</p>
          <button id="playCrapsBtn" class="cta-button">Speel Craps</button>
        </div>
        <div class="menu-card" data-game="baccarat">
          <h4>Baccarat Salon</h4>
          <p>Elegante snelle rondes voor high-roller vibes.</p>
          <button id="playBaccaratBtn" class="cta-button alt">Speel Baccarat</button>
        </div>
        <div class="menu-card" data-game="roulette">
          <h4>Roulette Table</h4>
          <p>Voorspel kleur of nummer en laat het wiel draaien.</p>
          <button id="playRouletteBtn" class="cta-button">Speel Roulette</button>
        </div>
        <div class="menu-card" data-game="slots">
          <h4>Slot Machines</h4>
          <p>Drie rollen, dikke payouts. Trek de hendel en voel de spanning.</p>
          <button id="playSlotsBtn" class="cta-button alt">Speel Slots</button>
        </div>
        <div class="menu-card" data-game="horse">
          <h4>Paardenrace Club</h4>
          <p>Stap in de VIP-tribune en kies jouw winnaar.</p>
          <button id="playHorseRaceBtn" class="cta-button alt">Start race</button>
        </div>
        <div class="menu-card" data-game="plinko">
          <h4>Plinko Drop</h4>
          <p>Laat de bal vallen en pak multipliers met een smooth landing.</p>
          <button id="playPlinkoBtn" class="cta-button">Speel Plinko</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Loot Boxes menu -->
  <section id="lootBoxMenuSection" style="display:none;">
    <h2>Lucky Boxes</h2>
    <p>Kies een box om te openen. Je betaalt met Lucky Coins.</p>
    <div class="lootbox-menu-grid">
      <div class="lootbox-option">
        <div class="lootbox-star-row">â˜…</div>
        <div class="lootbox-card lootbox-level-1" data-lootbox="lucky">
          <div class="lootbox-icon">ðŸŽ</div>
          <div>Lucky Box</div>
          <small>1 Lucky Coin</small>
        </div>
      </div>
      <div class="lootbox-option">
        <div class="lootbox-star-row">â˜… â˜…</div>
        <div class="lootbox-card lootbox-level-2" data-lootbox="deluxe">
          <div class="lootbox-icon">ðŸŽ</div>
          <div>Deluxe Lucky Box</div>
          <small>5 Lucky Coins</small>
        </div>
      </div>
      <div class="lootbox-option">
        <div class="lootbox-star-row">â˜… â˜… â˜…</div>
        <div class="lootbox-card lootbox-level-3" data-lootbox="ultra">
          <div class="lootbox-icon">ðŸŽ</div>
          <div>Ultra Deluxe Lucky Box</div>
          <small>10 Lucky Coins</small>
        </div>
      </div>
    </div>
    <button id="backToMenuFromLuckyBoxes">Terug naar menu</button>
  </section>

  <!-- Loot Box opening -->
  <section id="lootBoxSection" style="display:none;">
    <h2 id="lootBoxTitle">Lucky Box</h2>
    <p id="lootBoxSubtitle">Klik op de box om te upgraden. Je hebt 3 kansen.</p>
    <div class="lootbox-stage">
      <div id="lootBoxCard" class="lootbox-card lootbox-level-1">
        <div class="lootbox-icon">ðŸŽ</div>
        <div>Reward level <span id="lootBoxLevel">1</span></div>
      </div>
      <div id="lootBoxChances" class="lootbox-chances">
        <div class="chance-dot">â˜…</div>
        <div class="chance-dot">â˜…</div>
        <div class="chance-dot">â˜…</div>
      </div>
      <div id="lootBoxHint">Klik om te upgraden (12,5% kans per klik).</div>
      <div id="lootBoxReward"></div>
    </div>
    <button id="backToMenuFromLoot">Terug naar menu</button>
  </section>

  <!-- Skins -->
  <section id="skinsSection" style="display:none;">
    <div class="shop-shell skins-shell">
      <header class="shop-header skins-header">
        <div>
          <h2 id="skinsTitle">Skins</h2>
          <p>Bekijk en selecteer de skins die je al in bezit hebt.</p>
        </div>
        <button id="backFromSkinsBtn">Terug naar menu</button>
      </header>

      <div id="skinsTabs" class="shop-tabs" role="tablist" aria-label="Skin categorieÃ«n"></div>
      <div id="skinsGameTabs" class="shop-game-tabs" role="tablist" aria-label="Game selectie" style="display:none;"></div>
      <div id="skinsSubtitle" class="shop-subtitle"></div>
      <div id="skinsGrid" class="shop-grid"></div>
    </div>
  </section>

  <!-- Shop -->
  <section id="shopSection" style="display:none;">
    <div class="shop-shell">
      <header class="shop-header">
        <div>
          <h2>Shop</h2>
          <p>Koop bundles, layouts en accessoires. Elke bundel bevat een thema met bijpassende kaarten, dobbelstenen, ballen en game layouts.</p>
        </div>
        <button id="backFromShopBtn">Terug naar menu</button>
      </header>

      <div id="shopTabs" class="shop-tabs" role="tablist" aria-label="Shop categorieÃ«n"></div>
      <div id="shopGameTabs" class="shop-game-tabs" role="tablist" aria-label="Game layout selectie" style="display:none;"></div>
      <div id="shopSubtitle" class="shop-subtitle"></div>
      <div id="shopGrid" class="shop-grid"></div>
    </div>
  </section>

  <!-- Blackjack -->
  <section id="blackjackSection">
    <div class="bj-shell">
      <div class="bj-header">
        <h2>Blackjack</h2>
        <div class="bj-setup">
          <label for="botCount">Bots:</label>
          <select id="botCount">
            <option value="0">0 bots</option>
            <option value="1">1 bot</option>
            <option value="2">2 bots</option>
            <option value="3">3 bots</option>
            <option value="4">4 bots</option>
            <option value="5">5 bots</option>
            <option value="6">6 bots</option>
          </select>
          <label for="betAmount">Inzet:</label>
          <input type="number" id="betAmount" min="1" value="100">
          <button id="startGame">Start ronde</button>
          <button id="backToMenu">Terug naar menu</button>
        </div>
      </div>

      <div class="bj-table">
        <div class="bj-shoe">
          <div class="bj-shoe-stack" id="bjShoe">
            <div class="bj-shoe-card"></div>
            <div class="bj-shoe-card"></div>
            <div class="bj-shoe-card"></div>
          </div>
          <div class="bj-shoe-count" id="bjShoeCount">Shoe: -- kaarten</div>
        </div>
        <div class="bj-table-grid">
          <div class="bj-lane bj-dealer">
            <div class="bj-label">Dealer</div>
            <div class="bj-hand" id="bjDealerHand"></div>
            <div class="bj-score" id="bjDealerScore">Score: -</div>
          </div>
          <div class="bj-players" id="bjPlayersArea"></div>
        </div>
      </div>

      <div class="bj-actions">
        <div class="bj-status" id="bjStatus">Kies je inzet en start de ronde.</div>
        <div class="bj-actions-buttons">
          <button id="hitBtn">Hit</button>
          <button id="standBtn">Stand</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Poker -->
  <section id="pokerSection">
    <h2>Texas Hold'em Poker</h2>

    <div class="poker-lobby">
      <div class="poker-lobby-card">
        <label>Minimale credits om mee te doen: 500. Kies tafel:</label><br>
        <select id="pokerTableSelect">
          <option value="500">Tafel 500</option>
          <option value="1500">Tafel 1500</option>
          <option value="3500">Tafel 3500</option>
          <option value="5000">Tafel 5000</option>
        </select>
        <div style="margin-top:10px;">
          <label for="pokerBotCount">Bots:</label>
          <select id="pokerBotCount">
            <option value="1">1 bot</option>
            <option value="2">2 bots</option>
            <option value="3" selected>3 bots</option>
            <option value="4">4 bots</option>
            <option value="5">5 bots</option>
          </select>
        </div>
        <div style="margin-top:10px;">
          <button id="joinPokerBtn">Deelnemen</button>
          <button id="leavePokerBtn">Tafel verlaten</button>
          <button id="backFromPokerBtn">Terug naar menu</button>
        </div>
      </div>
      <div class="poker-lobby-card poker-meta">
        <span>Blinds: <strong id="pokerBlinds">â€”</strong></span>
        <span>Fase: <strong id="pokerStage">â€”</strong></span>
        <span>Pot: <strong id="pokerPot">0</strong></span>
      </div>
    </div>

    <div class="poker-table-shell">
      <div class="poker-table">
        <div class="poker-dealer">
          <div class="dealer-avatar">ðŸƒ</div>
          <div class="dealer-info">
            <h3>Dealer Sofia</h3>
            <p id="pokerDealerStatus">Dealer wacht op spelers...</p>
          </div>
        </div>

        <div class="poker-board">
          <div class="poker-community" id="pokerCommunity"></div>
          <div class="poker-user-spot" id="pokerUserSpot"></div>
        </div>

        <div class="poker-actions">
          <div class="poker-action-row">
            <button id="pokerCheckBtn">Check / Call</button>
            <button id="pokerBetBtn">Bet / Raise</button>
            <button id="pokerFoldBtn">Fold</button>
          </div>
          <div class="poker-action-row">
            <label for="pokerBetAmount">Raise naar:</label>
            <input type="number" id="pokerBetAmount" min="0" value="200" style="width:120px;">
          </div>
          <div class="poker-status">
            <strong>Status:</strong> <span id="pokerStatus">Sluit je aan om te spelen.</span>
          </div>
        </div>
      </div>

      <div class="poker-seats" id="pokerPlayers"></div>
    </div>
  </section>

  <!-- Craps -->
  <section id="crapsSection" style="display:none;">
    <div class="table-game-panel craps-panel">
      <div class="craps-header">
        <h2>ðŸŽ² Craps Royale</h2>
        <p>Come-out roll: 7/11 wint, 2/3/12 verliest. Anders zet je een punt.</p>
        <div class="craps-meta">
          <span>Hoge inzet, hoge winst</span>
          <span>Premium felt tafel</span>
        </div>
      </div>
      <label>Inzet (credits):</label>
      <input type="number" id="crapsBet" min="10" value="100">
      <div class="craps-field">
        <div class="dice-row craps-dice">
          <div id="crapsDieOne" class="craps-die" data-value="1"></div>
          <div id="crapsDieTwo" class="craps-die" data-value="1"></div>
        </div>
      </div>
      <div class="craps-status">
        <div id="crapsPoint" class="craps-point">Punt: -</div>
        <div id="crapsStatus">Plaats je inzet en gooi de dobbelstenen.</div>
      </div>
      <div style="margin-top:12px;">
        <button id="rollCrapsBtn">Gooi</button>
        <button id="backFromCrapsBtn">Terug naar menu</button>
      </div>
    </div>
  </section>

  <!-- Baccarat -->
  <section id="baccaratSection" style="display:none;">
    <h2>ðŸ‚¡ Baccarat</h2>
    <p>Kies je inzet op Player, Banker of Tie en laat de kaarten spreken.</p>
    <div class="table-game-panel">
      <label>Inzet (credits):</label>
      <input type="number" id="baccaratBet" min="10" value="200">
      <label style="margin-left:8px;">Inzet op:</label>
      <select id="baccaratBetType">
        <option value="player">Player</option>
        <option value="banker">Banker</option>
        <option value="tie">Tie</option>
      </select>
      <div class="baccarat-table">
        <div class="baccarat-shoe" aria-hidden="true">
          <div class="baccarat-shoe-stack" id="baccaratShoe">
            <div class="baccarat-shoe-card"></div>
            <div class="baccarat-shoe-card"></div>
            <div class="baccarat-shoe-card"></div>
          </div>
        </div>
        <div class="baccarat-row" id="baccaratPlayerRow"></div>
        <div class="baccarat-row" id="baccaratBankerRow"></div>
      </div>
      <div id="baccaratStatus">Plaats je inzet en start een ronde.</div>
      <div style="margin-top:12px;">
        <button id="dealBaccaratBtn">Deel kaarten</button>
        <button id="backFromBaccaratBtn">Terug naar menu</button>
      </div>
    </div>
  </section>

  <!-- Roulette -->
  <section id="rouletteSection" style="display:none;">
    <h2>ðŸŽ¡ Roulette Royale</h2>
    <p>Ervaar een premium wiel met live spin en een vallende bal.</p>
    <div class="table-game-panel roulette-panel">
      <div class="roulette-layout">
        <div>
          <label>Inzet (credits):</label>
          <input type="number" id="rouletteBet" min="10" value="150">
          <label style="margin-left:8px;">Inzettype:</label>
          <select id="rouletteBetType">
            <option value="color">Kleur</option>
            <option value="number">Nummer</option>
          </select>
          <div class="roulette-row">
            <select id="rouletteColor">
              <option value="red">Rood</option>
              <option value="black">Zwart</option>
              <option value="green">Groen (0)</option>
            </select>
            <input type="number" id="rouletteNumber" min="0" max="36" value="7" style="width:90px;">
          </div>
          <div class="roulette-legend">
            <h3>VIP tafel</h3>
            <p>Volg de bal terwijl hij over de baan danst en in de socket valt.</p>
            <div class="roulette-glow">
              <span>Live wheel spin</span>
              <span>Ultra smooth easing</span>
              <span>Premium finish</span>
            </div>
          </div>
        </div>
        <div class="roulette-stage" aria-live="polite">
          <div class="roulette-wheel-frame">
            <div class="roulette-pointer"></div>
            <div class="roulette-wheel" id="rouletteWheel">
              <div class="roulette-pocket-layer" id="roulettePocketLayer"></div>
              <div class="roulette-hatch-layer" id="rouletteHatchLayer"></div>
              <div class="roulette-pocket-ring"></div>
              <div class="roulette-wheel-center"></div>
            </div>
            <div class="roulette-ball-orbit" id="rouletteBallOrbit">
              <div class="roulette-ball" id="rouletteBall"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="roulette-result" id="rouletteResult">Resultaat: -</div>
      <div id="rouletteStatus">Plaats je inzet en draai.</div>
      <div style="margin-top:12px;">
        <button id="spinRouletteBtn">Draaien</button>
        <button id="backFromRouletteBtn">Terug naar menu</button>
      </div>
    </div>
  </section>

  <!-- Slots -->
  <section id="slotsSection" style="display:none;">
    <h2>ðŸŽ° Slot Machines</h2>
    <p>Laat de rollen draaien en pak de jackpot.</p>
    <div class="slots-machine">
      <div class="slots-marquee">Royal Spin</div>
      <div class="slots-body">
        <div class="slots-cabinet">
          <div class="slots-header">
            <div><strong>Uitbetaling</strong>: 3 dezelfde = grote winst, 2 dezelfde = kleine winst.</div>
            <div>Jackpot op 7ï¸âƒ£ of ðŸ’Ž.</div>
          </div>
          <div class="slots-window">
            <div class="slots-reels">
              <div class="slot-reel">
                <div class="slot-reel-strip" id="slotReelOne"></div>
              </div>
              <div class="slot-reel">
                <div class="slot-reel-strip" id="slotReelTwo"></div>
              </div>
              <div class="slot-reel">
                <div class="slot-reel-strip" id="slotReelThree"></div>
              </div>
            </div>
          </div>
        </div>
        <button id="spinSlotsBtn" class="slots-lever" type="button" aria-label="Trek aan de hendel om te draaien">
          <span class="slots-lever-track">
            <span class="lever-knob"></span>
            <span class="lever-handle"></span>
          </span>
        </button>
      </div>
      <div class="slots-controls">
        <label>Inzet (credits):</label>
        <input type="number" id="slotsBet" min="10" value="100">
        <button id="backFromSlotsBtn">Terug naar menu</button>
      </div>
      <div class="slots-status" id="slotsStatus">Plaats je inzet en spin voor de winst.</div>
    </div>
  </section>
  
<!-- ==================== PAARDENRACE SPEL ==================== -->
<section id="horseRaceSection" style="display:none; text-align:center; padding:20px; color:white;">
    <div class="race-shell">
        <div class="race-header">
            <div class="race-title">
                <h2>ðŸ‡ Paardenrace Royale</h2>
                <p>VIP-tribune, cinematic lights en een officiÃ«le foto-finish.</p>
            </div>
        </div>

        <div class="race-controls">
            <div class="race-controls-row">
                <label for="horseBet">Inzet (credits):</label>
                <input type="number" id="horseBet" min="10" value="100">
                <label for="horseSelect">Kies een paard:</label>
                <select id="horseSelect">
                    <option value="1">Paard 1 â€“ âš¡ Sprinter</option>
                    <option value="2">Paard 2 â€“ ðŸ›¡ Steady Boy</option>
                    <option value="3">Paard 3 â€“ ðŸŽ¯ Precision</option>
                    <option value="4">Paard 4 â€“ ðŸ”¥ Wild Power</option>
                </select>
            </div>
            <div class="race-controls-row">
                <button id="startRaceBtn">Start race</button>
                <button id="backToMenuRace">Terug naar menu</button>
            </div>
        </div>

        <div id="raceStatus" class="race-status">Kies je paard en zet je credits in.</div>
        <div id="raceResults" class="race-results" aria-live="polite"></div>

        <!-- Race Track -->
        <div id="raceTrack" class="race-track">
            <div class="race-lights">
                <div class="race-light"></div>
                <div class="race-light"></div>
                <div class="race-light"></div>
                <div class="race-light"></div>
                <div class="race-light"></div>
            </div>
            <div class="finish-line" id="finishLine"></div>
            <div class="finish-banner">Finish</div>

            <div class="raceLane" id="lane1">
                <div class="lane-label">Lane 1</div>
                <div class="horse horse--sprinter" id="horse1" data-horse-name="Sprinter">
                    <span class="horse-emoji">âš¡</span>
                    <span class="horse-name">Sprinter</span>
                    <span class="horse-tag">Bliksemsnel</span>
                </div>
            </div>
            <div class="raceLane" id="lane2">
                <div class="lane-label">Lane 2</div>
                <div class="horse horse--steady" id="horse2" data-horse-name="Steady Boy">
                    <span class="horse-emoji">ðŸ›¡ï¸</span>
                    <span class="horse-name">Steady Boy</span>
                    <span class="horse-tag">Staalvast</span>
                </div>
            </div>
            <div class="raceLane" id="lane3">
                <div class="lane-label">Lane 3</div>
                <div class="horse horse--precision" id="horse3" data-horse-name="Precision">
                    <span class="horse-emoji">ðŸŽ¯</span>
                    <span class="horse-name">Precision</span>
                    <span class="horse-tag">Haarscherp</span>
                </div>
            </div>
            <div class="raceLane" id="lane4">
                <div class="lane-label">Lane 4</div>
                <div class="horse horse--wild" id="horse4" data-horse-name="Wild Power">
                    <span class="horse-emoji">ðŸ”¥</span>
                    <span class="horse-name">Wild Power</span>
                    <span class="horse-tag">Ongetemd</span>
                </div>
            </div>

        </div>
    </div>
</section>

  <!-- Plinko -->
  <section id="plinkoSection" style="display:none;">
    <h2>ðŸŸ£ Plinko Drop</h2>
    <p>Drop de bal en mik op de hoogste multiplier. Smooth animaties, snelle payouts.</p>
    <div class="plinko-panel">
      <div class="plinko-controls">
        <label for="plinkoBet">Inzet:</label>
        <input type="number" id="plinkoBet" min="10" value="150">
        <label for="plinkoBallCount">Ballen:</label>
        <input type="number" id="plinkoBallCount" min="1" max="10" value="10">
        <span class="plinko-note" id="plinkoPerBall">Per bal: 150 credits</span>
        <button id="dropPlinkoBtn">Drop bal</button>
        <button id="backFromPlinkoBtn">Terug naar menu</button>
      </div>
      <div class="plinko-board" id="plinkoBoard">
        <div class="plinko-pegs" id="plinkoPegs"></div>
        <div class="plinko-slots" id="plinkoSlots"></div>
        <div class="plinko-multipliers" id="plinkoMultipliers"></div>
      </div>
      <div class="plinko-status" id="plinkoStatus">Plaats je inzet en drop een bal.</div>
    </div>
  </section>

  <!-- Game rules help -->
  <button id="helpFab" class="help-fab" aria-label="Spelregels openen" title="Spelregels">?</button>
  <div id="helpPanel" class="help-panel" aria-hidden="true">
    <div class="help-panel-header">
      <div>
        <div class="help-panel-title" id="helpTitle"></div>
        <div class="help-panel-subtitle" id="helpSubtitle"></div>
      </div>
      <button id="helpClose" class="help-close" aria-label="Sluiten">âœ•</button>
    </div>
    <div id="helpSteps" class="help-steps"></div>
  </div>
  
  <!-- Leaderboard popup -->
  <div id="lb-popup">
      <div id="lb-popup-inner">
          <div id="lb-left" class="lb-arrow">â†</div>
          <h2 id="lb-title">All-Time Earnings</h2>
          <div id="lb-content"></div>
          <div id="lb-right" class="lb-arrow">â†’</div>
          <button id="lb-close">Sluiten</button>
      </div>
  </div>

  <!-- Game result overlay -->
  <div id="gameResultOverlay" class="game-result-overlay" aria-hidden="true">
    <div class="game-result-card" id="gameResultCard">
      <div class="game-result-title" id="gameResultTitle">Resultaat</div>
      <div class="game-result-message" id="gameResultMessage"></div>
      <div class="game-result-actions" id="gameResultActions">
        <button id="gameResultPlayAgain">Speel opnieuw</button>
        <button id="gameResultMainMenu" class="secondary">Hoofdmenu</button>
      </div>
    </div>
  </div>

  <!-- Site message overlay -->
  <div id="siteMessage" class="site-message" aria-live="polite" aria-hidden="true" data-type="info">
    <div class="site-message-card">
      <div class="site-message-title" id="siteMessageTitle">Melding</div>
      <div class="site-message-text" id="siteMessageText"></div>
      <button class="site-message-close" id="siteMessageClose">Sluiten</button>
    </div>
  </div>

  <!-- Firebase v8 (online accounts & leaderboards) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyARtIFfUXzlkJppkcUSx5ril2FerJltwNs",
      authDomain: "gokken4school.firebaseapp.com",
      databaseURL: "https://gokken4school-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gokken4school",
      storageBucket: "gokken4school.firebasestorage.app",
      messagingSenderId: "210902717668",
      appId: "1:210902717668:web:16ebea58067718ffce48f1",
      measurementId: "G-G9SVYLDMWC"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <script>
    /* ---------------------------
       Data & helpers
       --------------------------- */
    let users = {};
    let currentUser = null;

    function keyForName(name){ return name.trim().toLowerCase(); }

    async function loadUser(key){
      const snap = await db.ref('users/'+key).once('value');
      return snap.val() || null;
    }
    async function saveCurrentUser(){
      if(!currentUser || !currentUser.key) return;
      await db.ref('users/'+currentUser.key).set(currentUser);
    }

    /* ---------------------------
       UI refs
       --------------------------- */
    const loginSection = document.getElementById('login');
    const dashboard = document.getElementById('dashboard');
    const blackjackSection = document.getElementById('blackjackSection');
    const pokerSection = document.getElementById('pokerSection');
    const crapsSection = document.getElementById('crapsSection');
    const baccaratSection = document.getElementById('baccaratSection');
    const rouletteSection = document.getElementById('rouletteSection');
    const slotsSection = document.getElementById('slotsSection');
    const plinkoSection = document.getElementById('plinkoSection');
    const horseRaceSection = document.getElementById('horseRaceSection');
    const lootBoxMenuSection = document.getElementById('lootBoxMenuSection');
    const lootBoxSection = document.getElementById('lootBoxSection');
    const skinsSection = document.getElementById('skinsSection');
    const shopSection = document.getElementById('shopSection');
    const shopTabs = document.getElementById('shopTabs');
    const shopGrid = document.getElementById('shopGrid');
    const shopGameTabs = document.getElementById('shopGameTabs');
    const shopSubtitle = document.getElementById('shopSubtitle');
    const backFromShopBtn = document.getElementById('backFromShopBtn');
    const backFromPokerBtn = document.getElementById('backFromPokerBtn');

    const usernameInput = document.getElementById('usernameInput');
    const passwordInput = document.getElementById('passwordInput');
    const loginBtn = document.getElementById('loginBtn');
    const createAccountBtn = document.getElementById('createAccountBtn');
    const displayName = document.getElementById('displayName');
    const creditsEl = document.getElementById('credits');
    const currencyDisplay = document.getElementById('currencyDisplay');
    const welcomeBack = document.getElementById('welcomeBack');
    const developerPortal = document.getElementById('developerPortal');
    const devCreditsBtn = document.getElementById('devCreditsBtn');
    const devLuckyBtn = document.getElementById('devLuckyBtn');
    const closeDevPortal = document.getElementById('closeDevPortal');
    const playerTrackingPanel = document.getElementById('playerTrackingPanel');
    const closeTrackingPanel = document.getElementById('closeTrackingPanel');
    const trackingPrevGame = document.getElementById('trackingPrevGame');
    const trackingNextGame = document.getElementById('trackingNextGame');
    const trackingGameLabel = document.getElementById('trackingGameLabel');
    const trackingTables = document.getElementById('trackingTables');
    const claimDailyBtn = document.getElementById('claimDailyBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const playBlackjackBtn = document.getElementById('playBlackjackBtn');
    const playPokerBtn = document.getElementById('playPokerBtn');
    const playCrapsBtn = document.getElementById('playCrapsBtn');
    const playBaccaratBtn = document.getElementById('playBaccaratBtn');
    const playRouletteBtn = document.getElementById('playRouletteBtn');
    const playSlotsBtn = document.getElementById('playSlotsBtn');
    const playPlinkoBtn = document.getElementById('playPlinkoBtn');
    const luckyDropBtn = document.getElementById('luckyDropBtn');
    const openLeaderboardsBtn = document.getElementById('openLeaderboardsBtn');
    const skinsBtn = document.getElementById('skinsBtn');
    const shopBtn = document.getElementById('shopBtn');
    const backFromSkinsBtn = document.getElementById('backFromSkinsBtn');
    const skinsTitle = document.getElementById('skinsTitle');
    const skinsTabs = document.getElementById('skinsTabs');
    const skinsGameTabs = document.getElementById('skinsGameTabs');
    const skinsSubtitle = document.getElementById('skinsSubtitle');
    const skinsGrid = document.getElementById('skinsGrid');
    const luckyCoinsEl = document.getElementById('luckyCoins');
    const luckyCoinProgressEl = document.getElementById('luckyCoinProgress');

    const menuCardArtMap = {
      blackjack: {
        src: 'https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f0a1.png',
        alt: 'Aas van schoppen kaart',
        fallback: 'ðŸ‚¡'
      },
      poker: {
        src: 'https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f0cf.png',
        alt: 'Joker speelkaart',
        fallback: 'ðŸƒ'
      },
      craps: {
        src: 'https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f3b2.png',
        alt: 'Dobbelsteen',
        fallback: 'ðŸŽ²'
      },
      baccarat: {
        src: 'https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f0b1.png',
        alt: 'Aas van harten kaart',
        fallback: 'ðŸ‚±'
      },
      roulette: {
        src: 'https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f3af.png',
        alt: 'Roulette doelwit',
        fallback: 'ðŸŽ¯'
      },
      slots: {
        src: 'https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f3b0.png',
        alt: 'Fruitautomaat',
        fallback: 'ðŸŽ°'
      },
      horse: {
        src: 'https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f3c7.png',
        alt: 'Paardenrace',
        fallback: 'ðŸ‡'
      },
      plinko: {
        src: 'https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f3d0.png',
        alt: 'Plinko bal',
        fallback: 'ðŸ'
      }
    };

    function setupMenuCardArt(){
      const menuCards = document.querySelectorAll('.menu-card[data-game]');
      menuCards.forEach((card, index)=>{
        if(card.querySelector('.menu-card-art')) return;
        const art = menuCardArtMap[card.dataset.game];
        if(!art) return;
        const img = document.createElement('img');
        img.className = 'menu-card-art';
        img.src = art.src;
        img.alt = art.alt;
        img.loading = 'lazy';
        img.onerror = () => {
          const fallback = document.createElement('span');
          fallback.className = 'menu-card-emoji';
          fallback.textContent = art.fallback || 'ðŸŽ²';
          fallback.setAttribute('aria-label', art.alt);
          img.replaceWith(fallback);
        };
        card.appendChild(img);
        const tilt = Number.parseFloat(card.dataset.tilt) || (index % 2 === 0 ? -1.6 : 1.6);
        card.style.setProperty('--card-tilt', `${tilt}deg`);
      });
    }

    const lootBoxTitle = document.getElementById('lootBoxTitle');
    const lootBoxSubtitle = document.getElementById('lootBoxSubtitle');
    const lootBoxCard = document.getElementById('lootBoxCard');
    const lootBoxLevel = document.getElementById('lootBoxLevel');
    const lootBoxChances = document.getElementById('lootBoxChances');
    const lootBoxHint = document.getElementById('lootBoxHint');
    const lootBoxReward = document.getElementById('lootBoxReward');
    const backToMenuFromLoot = document.getElementById('backToMenuFromLoot');
    const backToMenuFromLuckyBoxes = document.getElementById('backToMenuFromLuckyBoxes');

    setupMenuCardArt();

    const gameLabels = {
      blackjack: 'Blackjack',
      poker: 'Poker',
      craps: 'Craps',
      baccarat: 'Baccarat',
      roulette: 'Roulette',
      slots: 'Slots',
      horse: 'Paardenrace',
      plinko: 'Plinko'
    };

    const themeCatalog = [
      {
        id: 'classic',
        name: 'Classic',
        description: 'Standaard casino sfeer.',
        preview: 'linear-gradient(135deg, #0b4f7b, #0f6fb2)',
        primary: '#0b4f7b',
        secondary: '#0f6fb2',
        accent: '#d4af37',
        cream: '#f6e9c4',
        bodyBg: '#050515',
        loginBg: 'radial-gradient(circle at top, rgba(15,111,178,0.28), transparent 52%), radial-gradient(circle at 15% 30%, rgba(212,175,55,0.2), transparent 45%), linear-gradient(150deg, #02070f 0, #040f1e 45%, #020408 100%)',
        dashboardBg: 'radial-gradient(circle at top, rgba(15,111,178,0.25), transparent 40%), radial-gradient(circle at 20% 20%, rgba(212,175,55,0.18), transparent 55%), linear-gradient(140deg, #030b14 0, #051729 35%, #071f33 60%, #030b14 100%)',
        menuHeaderBg: 'linear-gradient(120deg, rgba(7,30,49,0.95), rgba(8,40,60,0.8))',
        layoutBg: 'linear-gradient(160deg, rgba(15, 120, 90, 0.98), rgba(8, 28, 48, 0.98))',
        layoutSeat: 'rgba(10, 40, 48, 0.7)',
        layoutPanel: 'rgba(7, 30, 40, 0.75)',
        layoutBorder: 'rgba(212, 175, 55, 0.5)',
        cardBack: 'radial-gradient(circle at 30% 20%, #fff3c1 0, #cda23b 40%, #7a5a16 100%)',
        cardBorder: 'rgba(212, 175, 55, 0.8)',
        diceBg: 'linear-gradient(160deg, #f9f5ef, #e8ded0)',
        diceColor: '#1b2233',
        ballBg: 'radial-gradient(circle at 30% 30%, #f6f0ff 0, #d2c8ff 40%, #8b7df0 100%)'
      },
      {
        id: 'aurora',
        name: 'Aurora',
        description: 'Koele neon gloed voor late-night sessions.',
        preview: 'linear-gradient(135deg, #1e5aa4, #3dd6ff)',
        primary: '#1e5aa4',
        secondary: '#3dd6ff',
        accent: '#7de3ff',
        cream: '#dff6ff',
        bodyBg: '#050916',
        loginBg: 'radial-gradient(circle at top, rgba(61,214,255,0.22), transparent 55%), radial-gradient(circle at 15% 35%, rgba(30,90,164,0.25), transparent 45%), linear-gradient(150deg, #030813 0, #07162b 45%, #02060f 100%)',
        dashboardBg: 'radial-gradient(circle at top, rgba(61,214,255,0.25), transparent 45%), radial-gradient(circle at 18% 22%, rgba(126,215,255,0.2), transparent 55%), linear-gradient(140deg, #051126 0, #071b33 40%, #040912 100%)',
        menuHeaderBg: 'linear-gradient(120deg, rgba(10,30,60,0.95), rgba(12,45,80,0.85))',
        layoutBg: 'linear-gradient(160deg, rgba(18, 80, 140, 0.98), rgba(4, 20, 50, 0.98))',
        layoutSeat: 'rgba(8, 40, 70, 0.75)',
        layoutPanel: 'rgba(6, 30, 60, 0.75)',
        layoutBorder: 'rgba(125, 227, 255, 0.6)',
        cardBack: 'radial-gradient(circle at 30% 20%, #c8f1ff 0, #6bb8ff 40%, #1d4e99 100%)',
        cardBorder: 'rgba(125, 227, 255, 0.8)',
        diceBg: 'linear-gradient(160deg, #e6fbff, #b7e7ff)',
        diceColor: '#0f1d33',
        ballBg: 'radial-gradient(circle at 30% 30%, #f0feff 0, #7edcff 45%, #2c6ac4 100%)'
      },
      {
        id: 'velvet',
        name: 'Velvet',
        description: 'Bordeaux & goud, luxe lounge vibes.',
        preview: 'linear-gradient(135deg, #6b2039, #c0396b)',
        primary: '#6b2039',
        secondary: '#c0396b',
        accent: '#d2a75f',
        cream: '#f7e3c6',
        bodyBg: '#0b0510',
        loginBg: 'radial-gradient(circle at top, rgba(192,57,107,0.22), transparent 55%), radial-gradient(circle at 15% 35%, rgba(107,32,57,0.28), transparent 45%), linear-gradient(150deg, #13040a 0, #2a0f1d 45%, #090206 100%)',
        dashboardBg: 'radial-gradient(circle at top, rgba(192,57,107,0.25), transparent 45%), radial-gradient(circle at 18% 22%, rgba(210,167,95,0.18), transparent 55%), linear-gradient(140deg, #14060f 0, #2c1221 40%, #0a0307 100%)',
        menuHeaderBg: 'linear-gradient(120deg, rgba(40,12,24,0.95), rgba(60,18,32,0.85))',
        layoutBg: 'linear-gradient(160deg, rgba(120, 32, 72, 0.98), rgba(40, 10, 28, 0.98))',
        layoutSeat: 'rgba(66, 20, 40, 0.75)',
        layoutPanel: 'rgba(50, 14, 30, 0.75)',
        layoutBorder: 'rgba(210, 167, 95, 0.6)',
        cardBack: 'radial-gradient(circle at 30% 20%, #f1d4ad 0, #c08c49 40%, #5e2b12 100%)',
        cardBorder: 'rgba(210, 167, 95, 0.8)',
        diceBg: 'linear-gradient(160deg, #f2e6dd, #d9bfa6)',
        diceColor: '#361a26',
        ballBg: 'radial-gradient(circle at 30% 30%, #f8e4f0 0, #d77fb3 45%, #6b2039 100%)'
      },
      {
        id: 'ember',
        name: 'Ember',
        description: 'Warme vlamkleur met koperaccenten.',
        preview: 'linear-gradient(135deg, #7a2b16, #f05a28)',
        primary: '#7a2b16',
        secondary: '#f05a28',
        accent: '#f6c05c',
        cream: '#fff0d6',
        bodyBg: '#100706',
        loginBg: 'radial-gradient(circle at top, rgba(240,90,40,0.28), transparent 52%), radial-gradient(circle at 15% 30%, rgba(246,192,92,0.22), transparent 45%), linear-gradient(150deg, #120606 0, #2b120b 45%, #0a0302 100%)',
        dashboardBg: 'radial-gradient(circle at top, rgba(240,90,40,0.25), transparent 40%), radial-gradient(circle at 20% 20%, rgba(246,192,92,0.2), transparent 55%), linear-gradient(140deg, #140807 0, #2b130c 35%, #0f0403 100%)',
        menuHeaderBg: 'linear-gradient(120deg, rgba(50,18,12,0.95), rgba(82,28,14,0.85))',
        layoutBg: 'linear-gradient(160deg, rgba(130, 50, 20, 0.98), rgba(40, 12, 6, 0.98))',
        layoutSeat: 'rgba(78, 28, 12, 0.75)',
        layoutPanel: 'rgba(64, 20, 10, 0.75)',
        layoutBorder: 'rgba(246, 192, 92, 0.65)',
        cardBack: 'radial-gradient(circle at 30% 20%, #ffe0b0 0, #f29b52 40%, #7a2b16 100%)',
        cardBorder: 'rgba(246, 192, 92, 0.8)',
        diceBg: 'linear-gradient(160deg, #fff0de, #f1c8a2)',
        diceColor: '#4a2315',
        ballBg: 'radial-gradient(circle at 30% 30%, #fff1db 0, #f7a35a 45%, #7a2b16 100%)'
      },
      {
        id: 'lagoon',
        name: 'Lagoon',
        description: 'Koele oceaantinten met frisse highlights.',
        preview: 'linear-gradient(135deg, #0f6c5f, #20c5b5)',
        primary: '#0f6c5f',
        secondary: '#20c5b5',
        accent: '#9df6e7',
        cream: '#e9fff8',
        bodyBg: '#030b0f',
        loginBg: 'radial-gradient(circle at top, rgba(32,197,181,0.25), transparent 55%), radial-gradient(circle at 15% 35%, rgba(15,108,95,0.25), transparent 45%), linear-gradient(150deg, #041015 0, #0a2226 45%, #02080b 100%)',
        dashboardBg: 'radial-gradient(circle at top, rgba(32,197,181,0.25), transparent 45%), radial-gradient(circle at 18% 22%, rgba(157,246,231,0.2), transparent 55%), linear-gradient(140deg, #041216 0, #0a2629 40%, #020809 100%)',
        menuHeaderBg: 'linear-gradient(120deg, rgba(8,35,36,0.95), rgba(10,52,54,0.85))',
        layoutBg: 'linear-gradient(160deg, rgba(12, 120, 110, 0.98), rgba(4, 40, 45, 0.98))',
        layoutSeat: 'rgba(10, 60, 55, 0.75)',
        layoutPanel: 'rgba(10, 50, 48, 0.75)',
        layoutBorder: 'rgba(157, 246, 231, 0.7)',
        cardBack: 'radial-gradient(circle at 30% 20%, #d9fff6 0, #6edccf 40%, #1c6a60 100%)',
        cardBorder: 'rgba(157, 246, 231, 0.85)',
        diceBg: 'linear-gradient(160deg, #f2fffb, #b7efe3)',
        diceColor: '#0b2b29',
        ballBg: 'radial-gradient(circle at 30% 30%, #e8fff9 0, #6edccf 45%, #0f6c5f 100%)'
      },
      {
        id: 'neon',
        name: 'Neon',
        description: 'Harde clublichten met paars en pink.',
        preview: 'linear-gradient(135deg, #40209f, #7f4bff)',
        primary: '#40209f',
        secondary: '#7f4bff',
        accent: '#ff4bd8',
        cream: '#fbe9ff',
        bodyBg: '#080510',
        loginBg: 'radial-gradient(circle at top, rgba(127,75,255,0.28), transparent 55%), radial-gradient(circle at 18% 30%, rgba(255,75,216,0.2), transparent 45%), linear-gradient(150deg, #0a0614 0, #1a1030 45%, #05020b 100%)',
        dashboardBg: 'radial-gradient(circle at top, rgba(127,75,255,0.28), transparent 45%), radial-gradient(circle at 18% 22%, rgba(255,75,216,0.2), transparent 55%), linear-gradient(140deg, #0b0716 0, #1d1136 40%, #05020c 100%)',
        menuHeaderBg: 'linear-gradient(120deg, rgba(24,12,54,0.95), rgba(36,16,72,0.85))',
        layoutBg: 'linear-gradient(160deg, rgba(70, 30, 150, 0.98), rgba(20, 8, 60, 0.98))',
        layoutSeat: 'rgba(40, 18, 80, 0.75)',
        layoutPanel: 'rgba(34, 14, 70, 0.75)',
        layoutBorder: 'rgba(255, 75, 216, 0.7)',
        cardBack: 'radial-gradient(circle at 30% 20%, #ffd7f3 0, #b87bff 40%, #40209f 100%)',
        cardBorder: 'rgba(255, 75, 216, 0.8)',
        diceBg: 'linear-gradient(160deg, #f7ecff, #d1b6ff)',
        diceColor: '#2a174d',
        ballBg: 'radial-gradient(circle at 30% 30%, #ffe6fa 0, #b87bff 45%, #40209f 100%)'
      },
      {
        id: 'rose',
        name: 'Rose',
        description: 'Zachte rosÃ© tinten met warme glans.',
        preview: 'linear-gradient(135deg, #8b2f5b, #ff7bb3)',
        primary: '#8b2f5b',
        secondary: '#ff7bb3',
        accent: '#ffd1e8',
        cream: '#fff0f7',
        bodyBg: '#12070e',
        loginBg: 'radial-gradient(circle at top, rgba(255,123,179,0.25), transparent 55%), radial-gradient(circle at 18% 30%, rgba(139,47,91,0.25), transparent 45%), linear-gradient(150deg, #14070d 0, #2d1420 45%, #0a0306 100%)',
        dashboardBg: 'radial-gradient(circle at top, rgba(255,123,179,0.25), transparent 45%), radial-gradient(circle at 18% 22%, rgba(255,209,232,0.22), transparent 55%), linear-gradient(140deg, #14070f 0, #2f1522 40%, #0a0407 100%)',
        menuHeaderBg: 'linear-gradient(120deg, rgba(45,16,28,0.95), rgba(64,20,38,0.85))',
        layoutBg: 'linear-gradient(160deg, rgba(140, 40, 90, 0.98), rgba(40, 12, 30, 0.98))',
        layoutSeat: 'rgba(70, 22, 50, 0.75)',
        layoutPanel: 'rgba(60, 18, 44, 0.75)',
        layoutBorder: 'rgba(255, 209, 232, 0.7)',
        cardBack: 'radial-gradient(circle at 30% 20%, #ffe4f2 0, #ffa0c9 40%, #8b2f5b 100%)',
        cardBorder: 'rgba(255, 209, 232, 0.8)',
        diceBg: 'linear-gradient(160deg, #fff0f7, #f3bfd9)',
        diceColor: '#4a1f35',
        ballBg: 'radial-gradient(circle at 30% 30%, #ffeaf4 0, #ffa0c9 45%, #8b2f5b 100%)'
      },
      {
        id: 'jade',
        name: 'Jade',
        description: 'Diep groen met frisse jade accenten.',
        preview: 'linear-gradient(135deg, #1b5e3f, #33b17a)',
        primary: '#1b5e3f',
        secondary: '#33b17a',
        accent: '#b7ffcc',
        cream: '#effff5',
        bodyBg: '#040b08',
        loginBg: 'radial-gradient(circle at top, rgba(51,177,122,0.25), transparent 55%), radial-gradient(circle at 18% 30%, rgba(27,94,63,0.25), transparent 45%), linear-gradient(150deg, #050f0a 0, #0f2318 45%, #030807 100%)',
        dashboardBg: 'radial-gradient(circle at top, rgba(51,177,122,0.25), transparent 45%), radial-gradient(circle at 18% 22%, rgba(183,255,204,0.2), transparent 55%), linear-gradient(140deg, #05100c 0, #10281b 40%, #030706 100%)',
        menuHeaderBg: 'linear-gradient(120deg, rgba(12,40,28,0.95), rgba(16,60,40,0.85))',
        layoutBg: 'linear-gradient(160deg, rgba(30, 130, 85, 0.98), rgba(8, 40, 28, 0.98))',
        layoutSeat: 'rgba(18, 70, 46, 0.75)',
        layoutPanel: 'rgba(16, 60, 40, 0.75)',
        layoutBorder: 'rgba(183, 255, 204, 0.7)',
        cardBack: 'radial-gradient(circle at 30% 20%, #e1ffe9 0, #7de1aa 40%, #1b5e3f 100%)',
        cardBorder: 'rgba(183, 255, 204, 0.85)',
        diceBg: 'linear-gradient(160deg, #effff5, #bfead2)',
        diceColor: '#1c3a2a',
        ballBg: 'radial-gradient(circle at 30% 30%, #e8fff0 0, #7de1aa 45%, #1b5e3f 100%)'
      },
      {
        id: 'solar',
        name: 'Solar',
        description: 'Helder goud en zonlicht.',
        preview: 'linear-gradient(135deg, #b9770f, #f5c542)',
        primary: '#b9770f',
        secondary: '#f5c542',
        accent: '#ffe89a',
        cream: '#fff6dd',
        bodyBg: '#0f0b05',
        loginBg: 'radial-gradient(circle at top, rgba(245,197,66,0.28), transparent 55%), radial-gradient(circle at 18% 30%, rgba(185,119,15,0.25), transparent 45%), linear-gradient(150deg, #120b04 0, #2a1d08 45%, #080503 100%)',
        dashboardBg: 'radial-gradient(circle at top, rgba(245,197,66,0.28), transparent 45%), radial-gradient(circle at 18% 22%, rgba(255,232,154,0.22), transparent 55%), linear-gradient(140deg, #140c05 0, #2c1f08 40%, #080503 100%)',
        menuHeaderBg: 'linear-gradient(120deg, rgba(50,32,10,0.95), rgba(80,48,12,0.85))',
        layoutBg: 'linear-gradient(160deg, rgba(170, 110, 20, 0.98), rgba(50, 24, 6, 0.98))',
        layoutSeat: 'rgba(90, 54, 16, 0.75)',
        layoutPanel: 'rgba(78, 46, 14, 0.75)',
        layoutBorder: 'rgba(255, 232, 154, 0.7)',
        cardBack: 'radial-gradient(circle at 30% 20%, #fff2c7 0, #f5c542 40%, #b9770f 100%)',
        cardBorder: 'rgba(255, 232, 154, 0.85)',
        diceBg: 'linear-gradient(160deg, #fff7de, #f0d08b)',
        diceColor: '#4a300a',
        ballBg: 'radial-gradient(circle at 30% 30%, #fff7de 0, #f5c542 45%, #b9770f 100%)'
      },
      {
        id: 'obsidian',
        name: 'Obsidian',
        description: 'Diepe nachttinten met koel staal.',
        preview: 'linear-gradient(135deg, #1a1c27, #444b5d)',
        primary: '#1a1c27',
        secondary: '#444b5d',
        accent: '#9aa5c4',
        cream: '#e9edf6',
        bodyBg: '#05060a',
        loginBg: 'radial-gradient(circle at top, rgba(68,75,93,0.25), transparent 55%), radial-gradient(circle at 18% 30%, rgba(154,165,196,0.18), transparent 45%), linear-gradient(150deg, #06070c 0, #141822 45%, #030408 100%)',
        dashboardBg: 'radial-gradient(circle at top, rgba(68,75,93,0.25), transparent 45%), radial-gradient(circle at 18% 22%, rgba(154,165,196,0.2), transparent 55%), linear-gradient(140deg, #07080d 0, #171b27 40%, #030408 100%)',
        menuHeaderBg: 'linear-gradient(120deg, rgba(24,26,36,0.95), rgba(34,38,50,0.85))',
        layoutBg: 'linear-gradient(160deg, rgba(50, 60, 90, 0.98), rgba(16, 18, 30, 0.98))',
        layoutSeat: 'rgba(36, 40, 60, 0.75)',
        layoutPanel: 'rgba(30, 34, 54, 0.75)',
        layoutBorder: 'rgba(154, 165, 196, 0.65)',
        cardBack: 'radial-gradient(circle at 30% 20%, #e3e7f3 0, #7c879c 40%, #1a1c27 100%)',
        cardBorder: 'rgba(154, 165, 196, 0.85)',
        diceBg: 'linear-gradient(160deg, #f0f2f8, #c7ccd8)',
        diceColor: '#1b1f2c',
        ballBg: 'radial-gradient(circle at 30% 30%, #f0f2f8 0, #9aa5c4 45%, #1a1c27 100%)'
      }
    ];

    const themeLookup = Object.fromEntries(themeCatalog.map((theme) => [theme.id, theme]));

    const baseSkins = themeCatalog.map((theme) => ({
      id: theme.id,
      name: theme.name,
      description: theme.description,
      preview: theme.preview
    }));

    const skinCatalog = Object.fromEntries(
      Object.keys(gameLabels).map((gameKey) => [gameKey, baseSkins])
    );

    const gameSections = {
      blackjack: blackjackSection,
      poker: pokerSection,
      craps: crapsSection,
      baccarat: baccaratSection,
      roulette: rouletteSection,
      slots: slotsSection,
      horse: horseRaceSection,
      plinko: plinkoSection
    };

    function ensureSkinFields(user){
      if(!user) return;
      if(!user.gameSkins || typeof user.gameSkins !== 'object'){
        user.gameSkins = {};
      }
      Object.keys(gameLabels).forEach((gameKey) => {
        if(!user.gameSkins[gameKey]){
          user.gameSkins[gameKey] = 'classic';
        }
        if(user.shopSelection?.layouts?.[gameKey]){
          user.gameSkins[gameKey] = user.shopSelection.layouts[gameKey];
        }
      });
    }

    function hexToRgb(hex){
      if(!hex) return null;
      const cleaned = hex.replace('#', '');
      if(cleaned.length !== 6) return null;
      const num = parseInt(cleaned, 16);
      if(Number.isNaN(num)) return null;
      return {
        r: (num >> 16) & 255,
        g: (num >> 8) & 255,
        b: num & 255
      };
    }

    function rgbaFromHex(hex, alpha){
      const rgb = hexToRgb(hex);
      if(!rgb) return `rgba(0,0,0,${alpha})`;
      return `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${alpha})`;
    }

    function buildSurfacePalette(palette){
      return {
        menuSurface: `linear-gradient(140deg, ${rgbaFromHex(palette.primary, 0.78)}, ${rgbaFromHex(palette.secondary, 0.6)})`,
        menuSurfaceLight: `linear-gradient(140deg, ${rgbaFromHex(palette.primary, 0.6)}, ${rgbaFromHex(palette.secondary, 0.5)})`,
        loginShellBg: `linear-gradient(140deg, ${rgbaFromHex(palette.primary, 0.72)}, ${rgbaFromHex(palette.secondary, 0.55)})`,
        loginCardBg: `linear-gradient(160deg, ${rgbaFromHex(palette.primary, 0.62)}, ${rgbaFromHex(palette.secondary, 0.48)})`,
        loginPillBg: `linear-gradient(140deg, ${rgbaFromHex(palette.primary, 0.45)}, ${rgbaFromHex(palette.secondary, 0.35)})`,
        loginPillBorder: rgbaFromHex(palette.secondary, 0.45),
        loginInputBg: rgbaFromHex(palette.primary, 0.38),
        loginInputBorder: rgbaFromHex(palette.secondary, 0.35),
        loginLogoBg: `linear-gradient(140deg, ${palette.primary}, ${palette.secondary})`,
        loginLogoShadow: `0 0 18px ${rgbaFromHex(palette.secondary, 0.45)}`,
        claimDailyBg: `linear-gradient(120deg, ${rgbaFromHex(palette.primary, 0.9)}, ${rgbaFromHex(palette.secondary, 0.9)})`,
        claimDailyBorder: `1px solid ${rgbaFromHex(palette.secondary, 0.45)}`,
        claimDailyShadow: `0 8px 18px ${rgbaFromHex(palette.primary, 0.35)}`,
        leaderboardTabBg: `linear-gradient(120deg, ${rgbaFromHex(palette.primary, 0.95)}, ${rgbaFromHex(palette.secondary, 0.95)})`,
        leaderboardPopupBg: `linear-gradient(160deg, ${rgbaFromHex(palette.primary, 0.95)}, ${rgbaFromHex(palette.secondary, 0.88)})`,
        leaderboardEntryBg: `linear-gradient(135deg, ${rgbaFromHex(palette.primary, 0.55)}, ${rgbaFromHex(palette.secondary, 0.4)})`,
        leaderboardEntryYouBg: `linear-gradient(135deg, ${rgbaFromHex(palette.secondary, 0.75)}, ${rgbaFromHex(palette.primary, 0.65)})`,
        leaderboardBorder: rgbaFromHex(palette.secondary, 0.4),
        leaderboardBorderYou: rgbaFromHex(palette.accent, 0.7)
      };
    }

    const gameLayoutProfiles = {
      blackjack: { angle: 165, glow: '18% 18%', accent: 0.38, mid: 0.76, seat: 0.62, panel: 0.7 },
      poker: { angle: 145, glow: '78% 16%', accent: 0.32, mid: 0.72, seat: 0.6, panel: 0.68 },
      craps: { angle: 170, glow: '16% 78%', accent: 0.28, mid: 0.7, seat: 0.58, panel: 0.66 },
      baccarat: { angle: 155, glow: '52% 12%', accent: 0.34, mid: 0.74, seat: 0.6, panel: 0.68 },
      roulette: { angle: 150, glow: '82% 52%', accent: 0.4, mid: 0.78, seat: 0.62, panel: 0.7 },
      slots: { angle: 135, glow: '26% 70%', accent: 0.42, mid: 0.8, seat: 0.64, panel: 0.72 },
      horse: { angle: 168, glow: '70% 82%', accent: 0.3, mid: 0.72, seat: 0.58, panel: 0.66 },
      plinko: { angle: 140, glow: '30% 28%', accent: 0.45, mid: 0.8, seat: 0.64, panel: 0.72 }
    };

    function clampAlpha(value){
      return Math.min(Math.max(value, 0), 1);
    }

    function buildGameLayoutPalette(palette, gameKey){
      const profile = gameLayoutProfiles[gameKey] || {};
      const angle = profile.angle || 160;
      const glowSpot = profile.glow || '20% 20%';
      const accentAlpha = clampAlpha(profile.accent ?? 0.32);
      const midAlpha = clampAlpha(profile.mid ?? 0.72);
      const seatAlpha = clampAlpha(profile.seat ?? 0.6);
      const panelAlpha = clampAlpha(profile.panel ?? 0.68);
      const layoutBg = [
        `radial-gradient(circle at ${glowSpot}, ${rgbaFromHex(palette.accent, accentAlpha)}, transparent 60%)`,
        `linear-gradient(${angle}deg, ${rgbaFromHex(palette.primary, 0.96)} 0%, ${rgbaFromHex(palette.secondary, midAlpha)} 55%, ${rgbaFromHex(palette.primary, 0.98)} 100%)`
      ].join(', ');
      const layoutSeat = `linear-gradient(145deg, ${rgbaFromHex(palette.primary, seatAlpha)}, ${rgbaFromHex(palette.secondary, clampAlpha(seatAlpha - 0.12))})`;
      const layoutPanel = `linear-gradient(160deg, ${rgbaFromHex(palette.primary, panelAlpha)}, ${rgbaFromHex(palette.secondary, clampAlpha(panelAlpha - 0.14))})`;
      const layoutBorder = rgbaFromHex(palette.accent, clampAlpha(0.55 + accentAlpha * 0.35));

      return { layoutBg, layoutSeat, layoutPanel, layoutBorder };
    }

    function applyLayoutPalette(section, palette, gameKey){
      if(!section || !palette) return;
      const layoutPalette = buildGameLayoutPalette(palette, gameKey);
      section.style.setProperty('--layout-bg', layoutPalette.layoutBg);
      section.style.setProperty('--layout-seat', layoutPalette.layoutSeat);
      section.style.setProperty('--layout-panel', layoutPalette.layoutPanel);
      section.style.setProperty('--layout-border', layoutPalette.layoutBorder);
    }

    function getThemeById(id){
      return themeLookup[id] || themeCatalog[0];
    }

    const LOGIN_SKIN_STORAGE_KEY = 'gokken:last-login-skin';

    function getStoredLoginSkinId(){
      try{
        return localStorage.getItem(LOGIN_SKIN_STORAGE_KEY);
      } catch (error){
        return null;
      }
    }

    function setStoredLoginSkinId(themeId){
      if(!themeId) return;
      try{
        localStorage.setItem(LOGIN_SKIN_STORAGE_KEY, themeId);
      } catch (error){
        // Ignore storage errors (private mode, blocked storage, etc).
      }
    }

    function applyLoginSkinById(themeId){
      const palette = getThemeById(themeId);
      const surfaces = buildSurfacePalette(palette);
      const root = document.documentElement;
      root.style.setProperty('--theme-login-bg', palette.loginBg);
      root.style.setProperty('--theme-login-shell-bg', surfaces.loginShellBg);
      root.style.setProperty('--theme-login-card-bg', surfaces.loginCardBg);
      root.style.setProperty('--theme-login-pill-bg', surfaces.loginPillBg);
      root.style.setProperty('--theme-login-pill-border', surfaces.loginPillBorder);
      root.style.setProperty('--theme-login-input-bg', surfaces.loginInputBg);
      root.style.setProperty('--theme-login-input-border', surfaces.loginInputBorder);
      root.style.setProperty('--theme-login-logo-bg', surfaces.loginLogoBg);
      root.style.setProperty('--theme-login-logo-color', palette.cream);
      root.style.setProperty('--theme-login-logo-shadow', surfaces.loginLogoShadow);
    }

    function applyLoginSkinFromDevice(){
      const storedId = getStoredLoginSkinId();
      if(storedId){
        applyLoginSkinById(storedId);
      }
    }

    function getSelectedLayoutId(gameKey){
      return currentUser?.shopSelection?.layouts?.[gameKey]
        || currentUser?.gameSkins?.[gameKey]
        || 'classic';
    }

    function applyGameSkin(gameKey){
      if(!currentUser || !gameKey) return;
      const section = gameSections[gameKey];
      if(!section) return;
      const skinId = getSelectedLayoutId(gameKey);
      const palette = getThemeById(skinId);
      applyLayoutPalette(section, palette, gameKey);
    }

    function applyAllSkins(){
      if(!currentUser) return;
      Object.keys(gameLabels).forEach((gameKey) => applyGameSkin(gameKey));
    }

    let activeSkinGame = 'blackjack';
    let activeSkinsTab = 'games';

    const skinsTabsConfig = [
      { key: 'games', label: 'Games' },
      { key: 'themes', label: 'Themes' },
      { key: 'dice', label: 'Dice' },
      { key: 'cards', label: 'Playing cards' },
      { key: 'balls', label: 'Balls' }
    ];

    function renderSkinGameTabs(){
      if(!skinsGameTabs) return;
      skinsGameTabs.innerHTML = Object.entries(gameLabels).map(([key, label]) => `
        <button class="shop-game-tab ${key === activeSkinGame ? 'is-active' : ''}" type="button" data-game-key="${key}">
          ${label}
        </button>
      `).join('');
    }

    function setActiveSkinGame(gameKey){
      if(!gameKey || !gameLabels[gameKey]) return;
      activeSkinGame = gameKey;
      if(skinsGameTabs){
        skinsGameTabs.querySelectorAll('.shop-game-tab').forEach((tab) => {
          tab.classList.toggle('is-active', tab.dataset.gameKey === gameKey);
          tab.setAttribute('aria-selected', tab.dataset.gameKey === gameKey ? 'true' : 'false');
        });
      }
      renderSkinsGrid();
    }

    function buildSkinsCard({ id, name, description, preview, selected, actionType, icon, previewKey, gameKey }){
      const actionLabel = selected ? 'Geselecteerd' : 'Selecteer';
      const actionClass = selected ? 'shop-action selected' : 'shop-action';
      const previewMarkup = buildShopPreviewMarkup(previewKey, id);
      return `
        <div class="shop-card is-owned ${selected ? 'is-selected' : ''}">
          <div class="shop-item-image" style="background: ${preview};">
            ${previewMarkup}
            <span class="shop-preview-icon">${icon}</span>
          </div>
          <h4>${name}</h4>
          <p>${description}</p>
          <div class="shop-card-footer">
            <span class="price-tag">In bezit</span>
            <button class="${actionClass}" type="button" data-skin-type="${actionType}" data-skin-id="${id}" ${gameKey ? `data-game-key="${gameKey}"` : ''}>
              ${actionLabel}
            </button>
          </div>
        </div>
      `;
    }

    function renderSkinsGrid(){
      if(!skinsGrid || !skinsSubtitle) return;
      if(!currentUser){
        skinsGrid.innerHTML = '';
        skinsSubtitle.textContent = '';
        return;
      }
      ensureShopFields(currentUser);
      if(activeSkinsTab === 'games'){
        const ownedLayouts = currentUser?.shopInventory?.layouts?.[activeSkinGame] || ['classic'];
        const skins = (skinCatalog[activeSkinGame] || []).filter((skin) => ownedLayouts.includes(skin.id));
        const selected = getSelectedLayoutId(activeSkinGame);
        skinsSubtitle.textContent = `${gameLabels[activeSkinGame]} â€” ${skins.length} layouts in bezit`;
        skinsGrid.innerHTML = skins.map((skin) => buildSkinsCard({
          id: skin.id,
          name: `${skin.name} Layout`,
          description: skin.description,
          preview: skin.preview,
          selected: skin.id === selected,
          actionType: 'layout',
          icon: 'ðŸ§©',
          previewKey: 'layout',
          gameKey: activeSkinGame
        })).join('');
        return;
      }

      const accessoryMap = {
        themes: {
          items: getOwnedThemeItems(currentUser.shopInventory?.themes),
          selected: currentUser.shopSelection?.themeMode === 'custom' ? null : currentUser.shopSelection?.theme,
          label: 'Themaâ€™s',
          actionType: 'theme',
          icon: 'ðŸŽ¨',
          previewKey: 'bundles'
        },
        dice: {
          items: getOwnedThemeItems(currentUser.shopInventory?.diceSkins),
          selected: currentUser.shopSelection?.dice || 'classic',
          label: 'Dobbelstenen',
          actionType: 'accessory',
          accessoryType: 'dice',
          icon: 'ðŸŽ²',
          previewKey: 'dice'
        },
        cards: {
          items: getOwnedThemeItems(currentUser.shopInventory?.cardSkins),
          selected: currentUser.shopSelection?.cards || 'classic',
          label: 'Speelkaarten',
          actionType: 'accessory',
          accessoryType: 'cards',
          icon: 'ðŸ‚ ',
          previewKey: 'cards'
        },
        balls: {
          items: getOwnedThemeItems(currentUser.shopInventory?.ballSkins),
          selected: currentUser.shopSelection?.balls || 'classic',
          label: 'Ballen',
          actionType: 'accessory',
          accessoryType: 'balls',
          icon: 'âšª',
          previewKey: 'balls'
        }
      };

      const config = accessoryMap[activeSkinsTab];
      if(!config){
        skinsGrid.innerHTML = '';
        skinsSubtitle.textContent = '';
        return;
      }

      skinsSubtitle.textContent = `${config.label} â€” ${config.items.length} skins in bezit`;
      skinsGrid.innerHTML = config.items.map((item) => buildSkinsCard({
        id: item.id,
        name: item.name,
        description: item.description,
        preview: item.preview,
        selected: item.id === config.selected,
        actionType: config.actionType,
        icon: config.icon,
        previewKey: config.previewKey,
        gameKey: config.accessoryType
      })).join('');
    }

    function renderSkinsTabs(){
      if(!skinsTabs) return;
      skinsTabs.innerHTML = skinsTabsConfig.map((tab) => `
        <button class="shop-tab ${tab.key === activeSkinsTab ? 'is-active' : ''}" type="button" data-skins-tab="${tab.key}">
          ${tab.label}
        </button>
      `).join('');
    }

    function setActiveSkinsTab(tabKey){
      if(!tabKey) return;
      activeSkinsTab = tabKey;
      if(skinsTabs){
        skinsTabs.querySelectorAll('.shop-tab').forEach((tab) => {
          tab.classList.toggle('is-active', tab.dataset.skinsTab === tabKey);
          tab.setAttribute('aria-selected', tab.dataset.skinsTab === tabKey ? 'true' : 'false');
        });
      }
      if(skinsGameTabs){
        skinsGameTabs.style.display = tabKey === 'games' ? 'flex' : 'none';
      }
      renderSkinsGrid();
    }

    function getOwnedThemeItems(list){
      const owned = new Set(list || ['classic']);
      return themeCatalog.filter((theme) => owned.has(theme.id));
    }

    function getAccessoryConfig(type){
      if(type === 'dice') return { inventoryKey: 'diceSkins', selectionKey: 'dice', label: 'Dobbelstenen' };
      if(type === 'cards') return { inventoryKey: 'cardSkins', selectionKey: 'cards', label: 'Kaarten' };
      if(type === 'balls') return { inventoryKey: 'ballSkins', selectionKey: 'balls', label: 'Ballen' };
      return null;
    }

    function activateCustomMix(){
      if(!currentUser) return;
      ensureShopFields(currentUser);
      if(currentUser.shopSelection.themeMode !== 'custom'){
        currentUser.shopSelection.themeMode = 'custom';
      }
    }

    function updateSkinSelection(gameKey, skinId){
      if(!currentUser) return;
      ensureSkinFields(currentUser);
      ensureShopFields(currentUser);
      activateCustomMix();
      currentUser.gameSkins[gameKey] = skinId;
      currentUser.shopSelection.layouts[gameKey] = skinId;
      applyGameSkin(gameKey);
      renderSkinsGrid();
      saveCurrentUser();
    }

    function updateAccessorySelection(type, skinId){
      if(!currentUser) return;
      const config = getAccessoryConfig(type);
      if(!config) return;
      ensureShopFields(currentUser);
      activateCustomMix();
      currentUser.shopSelection[config.selectionKey] = skinId;
      applyShopSelections();
      renderSkinsGrid();
      saveCurrentUser();
    }

    function updateThemeSelection(themeId){
      if(!currentUser) return;
      ensureShopFields(currentUser);
      ensureSkinFields(currentUser);
      if(themeId === 'custom'){
        currentUser.shopSelection.themeMode = 'custom';
      } else {
        currentUser.shopSelection.themeMode = 'bundle';
        currentUser.shopSelection.theme = themeId;
        currentUser.shopSelection.login = themeId;
        currentUser.shopSelection.menu = themeId;
        currentUser.shopSelection.cards = themeId;
        currentUser.shopSelection.dice = themeId;
        currentUser.shopSelection.balls = themeId;
        Object.keys(gameLabels).forEach((gameKey) => {
          currentUser.shopSelection.layouts[gameKey] = themeId;
          currentUser.gameSkins[gameKey] = themeId;
        });
      }
      applyShopSelections();
      renderSkinsGrid();
      saveCurrentUser();
    }

    renderSkinGameTabs();
    setActiveSkinGame(activeSkinGame);
    renderSkinsTabs();
    setActiveSkinsTab(activeSkinsTab);

    if(skinsGameTabs){
      skinsGameTabs.addEventListener('click', (event) => {
        const tab = event.target.closest('.shop-game-tab');
        if(!tab) return;
        setActiveSkinGame(tab.dataset.gameKey);
      });
    }

    if(skinsGrid){
      skinsGrid.addEventListener('click', (event) => {
        const action = event.target.closest('.shop-action');
        if(!action) return;
        const skinType = action.dataset.skinType;
        const skinId = action.dataset.skinId;
        if(!skinType || !skinId) return;
        if(skinType === 'layout'){
          updateSkinSelection(action.dataset.gameKey || activeSkinGame, skinId);
          return;
        }
        if(skinType === 'theme'){
          updateThemeSelection(skinId);
          return;
        }
        if(skinType === 'accessory'){
          updateAccessorySelection(action.dataset.gameKey, skinId);
        }
      });
    }

    if(skinsTabs){
      skinsTabs.addEventListener('click', (event) => {
        const tab = event.target.closest('[data-skins-tab]');
        if(!tab) return;
        setActiveSkinsTab(tab.dataset.skinsTab);
      });
    }

    if(skinsTitle){
      skinsTitle.addEventListener('click', () => {
        trackingTapCount += 1;
        if(trackingTapTimer){
          clearTimeout(trackingTapTimer);
        }
        trackingTapTimer = setTimeout(() => {
          trackingTapCount = 0;
        }, 800);
        if(trackingTapCount === 3){
          trackingTapCount = 0;
          const password = prompt('Developer code:');
          if(password === 'pepjes'){
            openTrackingPanel();
          } else if(password !== null){
            showSiteMessage('Onjuist wachtwoord.');
          }
        }
      });
    }

    const shopTabsConfig = [
      { key: 'bundles', label: 'Bundels', price: 1000, subtitle: 'Thema bundles met kaarten, dobbelstenen, ballen en layouts.' },
      { key: 'login', label: 'Log in screen', price: 100, subtitle: 'Login achtergrondvariaties.' },
      { key: 'menu', label: 'Main menu', price: 200, subtitle: 'Nieuwe looks voor het hoofdmenu.' },
      { key: 'layout', label: 'Game layout', price: 200, subtitle: 'Kies een game en selecteer een layout.' },
      { key: 'cards', label: 'Playing cards', price: 100, subtitle: 'Kaartdesigns voor tafelgames.' },
      { key: 'dice', label: 'Dice', price: 75, subtitle: 'Deluxe dobbelstenen skins.' },
      { key: 'balls', label: 'Balls', price: 50, subtitle: 'Ballen voor plinko en roulette.' }
    ];

    let activeShopTab = 'bundles';
    let activeShopGame = 'blackjack';

    function ensureShopFields(user){
      if(!user) return;
      if(!user.shopInventory || typeof user.shopInventory !== 'object'){
        user.shopInventory = {};
      }
      if(!user.shopSelection || typeof user.shopSelection !== 'object'){
        user.shopSelection = {};
      }

      const inventory = user.shopInventory;
      const selection = user.shopSelection;

      const ensureList = (key) => {
        if(!Array.isArray(inventory[key])){
          inventory[key] = ['classic'];
        }
        if(!inventory[key].includes('classic')){
          inventory[key].unshift('classic');
        }
      };

      ensureList('themes');
      ensureList('loginSkins');
      ensureList('menuSkins');
      ensureList('cardSkins');
      ensureList('diceSkins');
      ensureList('ballSkins');

      if(!inventory.layouts || typeof inventory.layouts !== 'object'){
        inventory.layouts = {};
      }
      if(!selection.layouts || typeof selection.layouts !== 'object'){
        selection.layouts = {};
      }
      Object.keys(gameLabels).forEach((gameKey) => {
        if(!Array.isArray(inventory.layouts[gameKey])){
          inventory.layouts[gameKey] = ['classic'];
        }
        if(!inventory.layouts[gameKey].includes('classic')){
          inventory.layouts[gameKey].unshift('classic');
        }
        if(!selection.layouts[gameKey]){
          selection.layouts[gameKey] = 'classic';
        }
      });

      selection.theme = selection.theme || 'classic';
      selection.themeMode = selection.themeMode || 'bundle';
      selection.login = selection.login || 'classic';
      selection.menu = selection.menu || 'classic';
      selection.cards = selection.cards || 'classic';
      selection.dice = selection.dice || 'classic';
      selection.balls = selection.balls || 'classic';
    }

    function applyThemeVariables(palette){
      const root = document.documentElement;
      const surfaces = buildSurfacePalette(palette);
      root.style.setProperty('--theme-body-bg', palette.bodyBg);
      root.style.setProperty('--theme-primary', palette.primary);
      root.style.setProperty('--theme-secondary', palette.secondary);
      root.style.setProperty('--theme-accent', palette.accent);
      root.style.setProperty('--theme-cream', palette.cream);
      root.style.setProperty('--theme-layout-bg', palette.layoutBg);
      root.style.setProperty('--theme-layout-seat', palette.layoutSeat);
      root.style.setProperty('--theme-layout-panel', palette.layoutPanel);
      root.style.setProperty('--theme-layout-border', palette.layoutBorder);
      root.style.setProperty('--theme-login-logo-bg', surfaces.loginLogoBg);
      root.style.setProperty('--theme-login-logo-color', palette.cream);
      root.style.setProperty('--theme-login-logo-shadow', surfaces.loginLogoShadow);
      root.style.setProperty('--theme-claim-daily-bg', surfaces.claimDailyBg);
      root.style.setProperty('--theme-claim-daily-border', surfaces.claimDailyBorder);
      root.style.setProperty('--theme-claim-daily-color', palette.cream);
      root.style.setProperty('--theme-claim-daily-shadow', surfaces.claimDailyShadow);
      root.style.setProperty('--theme-leaderboard-tab-bg', surfaces.leaderboardTabBg);
      root.style.setProperty('--theme-leaderboard-popup-bg', surfaces.leaderboardPopupBg);
      root.style.setProperty('--theme-leaderboard-entry-bg', surfaces.leaderboardEntryBg);
      root.style.setProperty('--theme-leaderboard-entry-you-bg', surfaces.leaderboardEntryYouBg);
      root.style.setProperty('--theme-leaderboard-border', surfaces.leaderboardBorder);
      root.style.setProperty('--theme-leaderboard-border-you', surfaces.leaderboardBorderYou);
    }

    function applyShopSelections(){
      if(!currentUser) return;
      ensureShopFields(currentUser);
      const selection = currentUser.shopSelection;
      setStoredLoginSkinId(selection.login);

      const themePalette = getThemeById(selection.theme);
      applyThemeVariables(themePalette);

      const loginPalette = getThemeById(selection.login);
      const menuPalette = getThemeById(selection.menu);
      const cardPalette = getThemeById(selection.cards);
      const dicePalette = getThemeById(selection.dice);
      const ballPalette = getThemeById(selection.balls);
      const loginSurfaces = buildSurfacePalette(loginPalette);
      const menuSurfaces = buildSurfacePalette(menuPalette);

      const root = document.documentElement;
      root.style.setProperty('--theme-login-bg', loginPalette.loginBg);
      root.style.setProperty('--theme-dashboard-bg', menuPalette.dashboardBg);
      root.style.setProperty('--theme-menu-header-bg', menuPalette.menuHeaderBg);
      root.style.setProperty('--theme-card-back', cardPalette.cardBack);
      root.style.setProperty('--theme-card-border', cardPalette.cardBorder);
      root.style.setProperty('--theme-dice-bg', dicePalette.diceBg);
      root.style.setProperty('--theme-dice-color', dicePalette.diceColor);
      root.style.setProperty('--theme-ball-bg', ballPalette.ballBg);
      root.style.setProperty('--theme-login-shell-bg', loginSurfaces.loginShellBg);
      root.style.setProperty('--theme-login-card-bg', loginSurfaces.loginCardBg);
      root.style.setProperty('--theme-login-pill-bg', loginSurfaces.loginPillBg);
      root.style.setProperty('--theme-login-pill-border', loginSurfaces.loginPillBorder);
      root.style.setProperty('--theme-login-input-bg', loginSurfaces.loginInputBg);
      root.style.setProperty('--theme-login-input-border', loginSurfaces.loginInputBorder);
      root.style.setProperty('--theme-login-logo-bg', loginSurfaces.loginLogoBg);
      root.style.setProperty('--theme-login-logo-color', loginPalette.cream);
      root.style.setProperty('--theme-login-logo-shadow', loginSurfaces.loginLogoShadow);
      root.style.setProperty('--theme-menu-surface', menuSurfaces.menuSurface);
      root.style.setProperty('--theme-menu-surface-light', menuSurfaces.menuSurfaceLight);
      root.style.setProperty('--theme-claim-daily-bg', menuSurfaces.claimDailyBg);
      root.style.setProperty('--theme-claim-daily-border', menuSurfaces.claimDailyBorder);
      root.style.setProperty('--theme-claim-daily-color', menuPalette.cream);
      root.style.setProperty('--theme-claim-daily-shadow', menuSurfaces.claimDailyShadow);

      Object.keys(gameLabels).forEach((gameKey) => applyGameSkin(gameKey));
      refreshCrapsDicePips();
    }

    function getShopItemsForTab(tabKey){
      const config = shopTabsConfig.find((tab) => tab.key === tabKey);
      if(!config) return [];
      const price = config.price;
      const gameLabel = gameLabels[activeShopGame];

      switch(tabKey){
        case 'bundles':
          return themeCatalog.map((theme) => ({
            id: theme.id,
            name: `${theme.name} Bundle`,
            description: 'Thema + login, menu, layouts, kaarten, dobbelstenen en ballen.',
            preview: theme.preview,
            price,
            icon: 'ðŸŽ¨'
          }));
        case 'login':
          return themeCatalog.map((theme) => ({
            id: theme.id,
            name: `${theme.name} Login`,
            description: 'Nieuwe vibe voor het inlogscherm.',
            preview: theme.preview,
            price,
            icon: 'ðŸ”'
          }));
        case 'menu':
          return themeCatalog.map((theme) => ({
            id: theme.id,
            name: `${theme.name} Main Menu`,
            description: 'Stijl het hoofdmenu in thema-kleuren.',
            preview: theme.preview,
            price,
            icon: 'ðŸ '
          }));
        case 'layout':
          return themeCatalog.map((theme) => ({
            id: theme.id,
            name: `${theme.name} Layout`,
            description: `Layout voor ${gameLabel}.`,
            preview: theme.preview,
            price,
            icon: 'ðŸ§©'
          }));
        case 'cards':
          return themeCatalog.map((theme) => ({
            id: theme.id,
            name: `${theme.name} Cards`,
            description: 'Bijpassende kaartachterkanten.',
            preview: theme.preview,
            price,
            icon: 'ðŸ‚ '
          }));
        case 'dice':
          return themeCatalog.map((theme) => ({
            id: theme.id,
            name: `${theme.name} Dice`,
            description: 'Deluxe dice skin met thema kleuren.',
            preview: theme.preview,
            price,
            icon: 'ðŸŽ²'
          }));
        case 'balls':
          return themeCatalog.map((theme) => ({
            id: theme.id,
            name: `${theme.name} Balls`,
            description: 'Ball design voor roulette en plinko.',
            preview: theme.preview,
            price,
            icon: 'âšª'
          }));
        default:
          return [];
      }
    }

    function buildShopPreviewMarkup(tabKey, themeId){
      const palette = getThemeById(themeId);
      const pipSymbol = getDicePipSymbol(themeId);
      const previewCard = `<div class="shop-preview-card" style="--preview-card-bg: ${palette.cardBack}; --preview-card-border: ${palette.cardBorder};"></div>`;
      const previewDice = `
        <div class="shop-preview-die" style="--preview-dice-bg: ${palette.diceBg}; --preview-dice-color: ${palette.diceColor};">
          ${buildDicePipMarkup(5, pipSymbol)}
        </div>
      `;
      const previewBall = `<div class="shop-preview-ball" style="--preview-ball-bg: ${palette.ballBg};"></div>`;
      const previewScreen = (screenBg) => `
        <div class="shop-preview-screen" style="--preview-screen-bg: ${screenBg}; --preview-screen-accent: ${rgbaFromHex(palette.accent, 0.65)};"></div>
      `;

      if(tabKey === 'bundles'){
        return `
          <div class="shop-preview">
            <div class="shop-preview-group">
              ${previewCard}
              ${previewDice}
              ${previewBall}
            </div>
          </div>
        `;
      }

      if(tabKey === 'login'){
        return `<div class="shop-preview">${previewScreen(palette.loginBg)}</div>`;
      }

      if(tabKey === 'menu'){
        return `<div class="shop-preview">${previewScreen(palette.dashboardBg)}</div>`;
      }

      if(tabKey === 'layout'){
        return `<div class="shop-preview">${previewScreen(palette.layoutBg)}</div>`;
      }

      if(tabKey === 'cards'){
        return `<div class="shop-preview">${previewCard}</div>`;
      }

      if(tabKey === 'dice'){
        return `<div class="shop-preview">${previewDice}</div>`;
      }

      if(tabKey === 'balls'){
        return `<div class="shop-preview">${previewBall}</div>`;
      }

      return `<div class="shop-preview">${previewCard}</div>`;
    }

    function isItemOwned(tabKey, itemId){
      if(!currentUser) return false;
      const inventory = currentUser.shopInventory;
      if(tabKey === 'layout'){
        return inventory.layouts?.[activeShopGame]?.includes(itemId);
      }
      if(tabKey === 'bundles'){
        return inventory.themes?.includes(itemId);
      }
      if(tabKey === 'login'){
        return inventory.loginSkins?.includes(itemId);
      }
      if(tabKey === 'menu'){
        return inventory.menuSkins?.includes(itemId);
      }
      if(tabKey === 'cards'){
        return inventory.cardSkins?.includes(itemId);
      }
      if(tabKey === 'dice'){
        return inventory.diceSkins?.includes(itemId);
      }
      if(tabKey === 'balls'){
        return inventory.ballSkins?.includes(itemId);
      }
      return false;
    }

    function isItemSelected(tabKey, itemId){
      if(!currentUser) return false;
      const selection = currentUser.shopSelection;
      if(tabKey === 'layout'){
        return selection.layouts?.[activeShopGame] === itemId;
      }
      if(tabKey === 'bundles'){
        return selection.theme === itemId;
      }
      if(tabKey === 'login'){
        return selection.login === itemId;
      }
      if(tabKey === 'menu'){
        return selection.menu === itemId;
      }
      if(tabKey === 'cards'){
        return selection.cards === itemId;
      }
      if(tabKey === 'dice'){
        return selection.dice === itemId;
      }
      if(tabKey === 'balls'){
        return selection.balls === itemId;
      }
      return false;
    }

    function addInventoryItem(list, itemId){
      if(!list.includes(itemId)){
        list.push(itemId);
      }
    }

    function selectBundleTheme(themeId){
      ensureShopFields(currentUser);
      ensureSkinFields(currentUser);
      currentUser.shopSelection.themeMode = 'bundle';
      currentUser.shopSelection.theme = themeId;
      currentUser.shopSelection.login = themeId;
      currentUser.shopSelection.menu = themeId;
      currentUser.shopSelection.cards = themeId;
      currentUser.shopSelection.dice = themeId;
      currentUser.shopSelection.balls = themeId;
      Object.keys(gameLabels).forEach((gameKey) => {
        currentUser.shopSelection.layouts[gameKey] = themeId;
        currentUser.gameSkins[gameKey] = themeId;
      });
      applyShopSelections();
    }

    function selectItem(tabKey, itemId){
      ensureShopFields(currentUser);
      ensureSkinFields(currentUser);
      if(tabKey === 'bundles'){
        selectBundleTheme(itemId);
        return;
      }
      if(tabKey === 'layout'){
        currentUser.shopSelection.layouts[activeShopGame] = itemId;
        currentUser.gameSkins[activeShopGame] = itemId;
        applyGameSkin(activeShopGame);
        return;
      }
      if(tabKey === 'login'){
        currentUser.shopSelection.login = itemId;
      }
      if(tabKey === 'menu'){
        currentUser.shopSelection.menu = itemId;
      }
      if(tabKey === 'cards'){
        currentUser.shopSelection.cards = itemId;
      }
      if(tabKey === 'dice'){
        currentUser.shopSelection.dice = itemId;
      }
      if(tabKey === 'balls'){
        currentUser.shopSelection.balls = itemId;
      }
      applyShopSelections();
    }

    async function purchaseShopItem(tabKey, itemId){
      if(!currentUser) return;
      ensureShopFields(currentUser);
      const config = shopTabsConfig.find((tab) => tab.key === tabKey);
      if(!config) return;
      const price = config.price;

      if(currentUser.credits < price){
        showSiteMessage('Je hebt niet genoeg credits.');
        return;
      }

      currentUser.credits -= price;

      if(tabKey === 'bundles'){
        addInventoryItem(currentUser.shopInventory.themes, itemId);
        addInventoryItem(currentUser.shopInventory.loginSkins, itemId);
        addInventoryItem(currentUser.shopInventory.menuSkins, itemId);
        addInventoryItem(currentUser.shopInventory.cardSkins, itemId);
        addInventoryItem(currentUser.shopInventory.diceSkins, itemId);
        addInventoryItem(currentUser.shopInventory.ballSkins, itemId);
        Object.keys(gameLabels).forEach((gameKey) => {
          addInventoryItem(currentUser.shopInventory.layouts[gameKey], itemId);
        });
        selectBundleTheme(itemId);
      } else if(tabKey === 'layout'){
        addInventoryItem(currentUser.shopInventory.layouts[activeShopGame], itemId);
        selectItem(tabKey, itemId);
      } else if(tabKey === 'login'){
        addInventoryItem(currentUser.shopInventory.loginSkins, itemId);
        selectItem(tabKey, itemId);
      } else if(tabKey === 'menu'){
        addInventoryItem(currentUser.shopInventory.menuSkins, itemId);
        selectItem(tabKey, itemId);
      } else if(tabKey === 'cards'){
        addInventoryItem(currentUser.shopInventory.cardSkins, itemId);
        selectItem(tabKey, itemId);
      } else if(tabKey === 'dice'){
        addInventoryItem(currentUser.shopInventory.diceSkins, itemId);
        selectItem(tabKey, itemId);
      } else if(tabKey === 'balls'){
        addInventoryItem(currentUser.shopInventory.ballSkins, itemId);
        selectItem(tabKey, itemId);
      }

      await saveCurrentUser();
      renderDashboard();
      renderShopGrid();
      showSiteMessage('Aankoop succesvol!');
    }

    function renderShopTabs(){
      if(!shopTabs) return;
      shopTabs.innerHTML = shopTabsConfig.map((tab) => `
        <button class="shop-tab ${tab.key === activeShopTab ? 'is-active' : ''}" type="button" data-shop-tab="${tab.key}">
          ${tab.label}
        </button>
      `).join('');
    }

    function renderShopGameTabs(){
      if(!shopGameTabs) return;
      if(activeShopTab !== 'layout'){
        shopGameTabs.style.display = 'none';
        shopGameTabs.innerHTML = '';
        return;
      }
      shopGameTabs.style.display = 'flex';
      shopGameTabs.innerHTML = Object.entries(gameLabels).map(([key, label]) => `
        <button class="shop-game-tab ${key === activeShopGame ? 'is-active' : ''}" type="button" data-shop-game="${key}">
          ${label}
        </button>
      `).join('');
    }

    function renderShopGrid(){
      if(!shopGrid || !shopSubtitle) return;
      const config = shopTabsConfig.find((tab) => tab.key === activeShopTab);
      const items = getShopItemsForTab(activeShopTab);
      if(config){
        shopSubtitle.textContent = activeShopTab === 'layout'
          ? `${gameLabels[activeShopGame]} â€” ${items.length} variaties Â· ${config.price} credits`
          : `${items.length} items Â· ${config.price} credits`;
      }

      shopGrid.innerHTML = items.map((item) => {
        const owned = isItemOwned(activeShopTab, item.id);
        const selected = isItemSelected(activeShopTab, item.id);
        const actionLabel = selected ? 'Geselecteerd' : owned ? 'Selecteer' : `Koop ${item.price}`;
        const actionClass = selected ? 'shop-action selected' : owned ? 'shop-action' : 'shop-action buy';
        const actionType = selected ? 'selected' : owned ? 'select' : 'buy';

        return `
          <div class="shop-card ${owned ? 'is-owned' : ''} ${selected ? 'is-selected' : ''}">
            <div class="shop-item-image" style="background: ${item.preview};">
              ${buildShopPreviewMarkup(activeShopTab, item.id)}
              <span class="shop-preview-icon">${item.icon}</span>
            </div>
            <h4>${item.name}</h4>
            <p>${item.description}</p>
            <div class="shop-card-footer">
              <span class="price-tag">${item.price} credits</span>
              <button class="${actionClass}" type="button" data-item-id="${item.id}" data-item-action="${actionType}">
                ${actionLabel}
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderShop(){
      renderShopTabs();
      renderShopGameTabs();
      renderShopGrid();
    }

    if(shopTabs){
      shopTabs.addEventListener('click', (event) => {
        const tab = event.target.closest('[data-shop-tab]');
        if(!tab) return;
        activeShopTab = tab.dataset.shopTab;
        renderShop();
      });
    }

    if(shopGameTabs){
      shopGameTabs.addEventListener('click', (event) => {
        const tab = event.target.closest('[data-shop-game]');
        if(!tab) return;
        activeShopGame = tab.dataset.shopGame;
        renderShop();
      });
    }

    if(shopGrid){
      shopGrid.addEventListener('click', (event) => {
        const button = event.target.closest('[data-item-id]');
        if(!button) return;
        const itemId = button.dataset.itemId;
        const action = button.dataset.itemAction;
        if(action === 'selected') return;
        if(action === 'buy'){
          void purchaseShopItem(activeShopTab, itemId);
          return;
        }
        if(action === 'select'){
          selectItem(activeShopTab, itemId);
          saveCurrentUser();
          renderShopGrid();
          renderDashboard();
        }
      });
    }

    if(shopBtn){
      shopBtn.onclick = () => {
        if(!currentUser) return;
        dashboard.style.display = 'none';
        skinsSection.style.display = 'none';
        shopSection.style.display = 'block';
        renderShop();
      };
    }

    if(backFromShopBtn){
      backFromShopBtn.onclick = () => {
        shopSection.style.display = 'none';
        showDashboard(true);
      };
    }

    /* Blackjack refs */
    const startGameBtn = document.getElementById('startGame');
    const botSelect = document.getElementById('botCount');
    const betAmountInput = document.getElementById('betAmount');
    const bjDealerHand = document.getElementById('bjDealerHand');
    const bjDealerScore = document.getElementById('bjDealerScore');
    const bjPlayersArea = document.getElementById('bjPlayersArea');
    const bjStatus = document.getElementById('bjStatus');
    const bjShoeCount = document.getElementById('bjShoeCount');
    const bjShoe = document.getElementById('bjShoe');
    const hitBtn = document.getElementById('hitBtn');
    const standBtn = document.getElementById('standBtn');
    const backToMenuBtn = document.getElementById('backToMenu');

    /* Craps refs */
    const crapsBetInput = document.getElementById('crapsBet');
    const crapsDieOne = document.getElementById('crapsDieOne');
    const crapsDieTwo = document.getElementById('crapsDieTwo');
    const crapsPointEl = document.getElementById('crapsPoint');
    const crapsStatusEl = document.getElementById('crapsStatus');
    const rollCrapsBtn = document.getElementById('rollCrapsBtn');
    const resetCrapsBtn = document.getElementById('resetCrapsBtn');
    const backFromCrapsBtn = document.getElementById('backFromCrapsBtn');

    /* Baccarat refs */
    const baccaratBetInput = document.getElementById('baccaratBet');
    const baccaratBetType = document.getElementById('baccaratBetType');
    const baccaratPlayerRow = document.getElementById('baccaratPlayerRow');
    const baccaratBankerRow = document.getElementById('baccaratBankerRow');
    const baccaratStatusEl = document.getElementById('baccaratStatus');
    const baccaratShoe = document.getElementById('baccaratShoe');
    const dealBaccaratBtn = document.getElementById('dealBaccaratBtn');
    const backFromBaccaratBtn = document.getElementById('backFromBaccaratBtn');

    /* Roulette refs */
    const rouletteBetInput = document.getElementById('rouletteBet');
    const rouletteBetType = document.getElementById('rouletteBetType');
    const rouletteColor = document.getElementById('rouletteColor');
    const rouletteNumber = document.getElementById('rouletteNumber');
    const rouletteResult = document.getElementById('rouletteResult');
    const rouletteStatus = document.getElementById('rouletteStatus');
    const spinRouletteBtn = document.getElementById('spinRouletteBtn');
    const backFromRouletteBtn = document.getElementById('backFromRouletteBtn');
    const rouletteWheel = document.getElementById('rouletteWheel');
    const roulettePocketLayer = document.getElementById('roulettePocketLayer');
    const rouletteHatchLayer = document.getElementById('rouletteHatchLayer');
    const rouletteBallOrbit = document.getElementById('rouletteBallOrbit');
    const rouletteBall = document.getElementById('rouletteBall');

    /* Slots refs */
    const slotsBetInput = document.getElementById('slotsBet');
    const spinSlotsBtn = document.getElementById('spinSlotsBtn');
    const backFromSlotsBtn = document.getElementById('backFromSlotsBtn');
    const slotsStatus = document.getElementById('slotsStatus');
    const slotReelOne = document.getElementById('slotReelOne');
    const slotReelTwo = document.getElementById('slotReelTwo');
    const slotReelThree = document.getElementById('slotReelThree');

    /* Plinko refs */
    const plinkoBetInput = document.getElementById('plinkoBet');
    const plinkoBallCountInput = document.getElementById('plinkoBallCount');
    const plinkoPerBall = document.getElementById('plinkoPerBall');
    const dropPlinkoBtn = document.getElementById('dropPlinkoBtn');
    const backFromPlinkoBtn = document.getElementById('backFromPlinkoBtn');
    const plinkoBoard = document.getElementById('plinkoBoard');
    const plinkoPegs = document.getElementById('plinkoPegs');
    const plinkoSlots = document.getElementById('plinkoSlots');
    const plinkoMultipliers = document.getElementById('plinkoMultipliers');
    const plinkoStatus = document.getElementById('plinkoStatus');

    /* Poker refs */
    const pokerTableSelect = document.getElementById('pokerTableSelect');
    const joinPokerBtn = document.getElementById('joinPokerBtn');
    const leavePokerBtn = document.getElementById('leavePokerBtn');
    const pokerBotCountSelect = document.getElementById('pokerBotCount');
    const pokerPotEl = document.getElementById('pokerPot');
    const pokerBlindsEl = document.getElementById('pokerBlinds');
    const pokerStageEl = document.getElementById('pokerStage');
    const pokerCommunityEl = document.getElementById('pokerCommunity');
    const pokerPlayersEl = document.getElementById('pokerPlayers');
    const pokerUserSpotEl = document.getElementById('pokerUserSpot');
    const pokerCheckBtn = document.getElementById('pokerCheckBtn');
    const pokerBetBtn = document.getElementById('pokerBetBtn');
    const pokerFoldBtn = document.getElementById('pokerFoldBtn');
    const pokerBetAmountInput = document.getElementById('pokerBetAmount');
    const pokerStatusEl = document.getElementById('pokerStatus');
    const pokerDealerStatusEl = document.getElementById('pokerDealerStatus');

    /* Leaderboard refs */
    const lbTab = document.getElementById('lb-tab');
    const lbPopup = document.getElementById('lb-popup');
    const lbLeft = document.getElementById('lb-left');
    const lbRight = document.getElementById('lb-right');
    const lbClose = document.getElementById('lb-close');
    const lbTitle = document.getElementById('lb-title');
    const lbContent = document.getElementById('lb-content');

    const helpFab = document.getElementById('helpFab');
    const helpPanel = document.getElementById('helpPanel');
    const helpTitle = document.getElementById('helpTitle');
    const helpSubtitle = document.getElementById('helpSubtitle');
    const helpSteps = document.getElementById('helpSteps');
    const helpClose = document.getElementById('helpClose');

    const gameResultOverlay = document.getElementById('gameResultOverlay');
    const gameResultCard = document.getElementById('gameResultCard');
    const gameResultTitle = document.getElementById('gameResultTitle');
    const gameResultMessage = document.getElementById('gameResultMessage');
    const gameResultActions = document.getElementById('gameResultActions');
    const gameResultPlayAgain = document.getElementById('gameResultPlayAgain');
    const gameResultMainMenu = document.getElementById('gameResultMainMenu');
    const siteMessage = document.getElementById('siteMessage');
    const siteMessageTitle = document.getElementById('siteMessageTitle');
    const siteMessageText = document.getElementById('siteMessageText');
    const siteMessageClose = document.getElementById('siteMessageClose');

    function closeLeaderboardPopup(){
      if(lbPopup){
        lbPopup.style.display = 'none';
      }
    }

    const helpContent = {
      blackjack: {
        title: 'Blackjack â€” spelregels',
        subtitle: 'Doel: zo dicht mogelijk bij 21 komen zonder eroverheen te gaan.',
        steps: [
          { icon: 'ðŸ’¶', title: 'Inzet & start', text: 'Kies je inzet en klik op â€œStart rondeâ€. Jij en de dealer krijgen allebei 2 kaarten; Ã©Ã©n kaart van de dealer ligt open.' },
          { icon: 'ðŸƒ', title: 'Jouw keuzes', text: 'Hit = nog een kaart pakken. Stand = stoppen en passen. Kom je boven 21, dan ben je â€œbustâ€ en verlies je direct.' },
          { icon: 'ðŸ†', title: 'Dealer en volgende ronde', text: 'De dealer moet altijd kaarten pakken tot minimaal 17. Hoogste score wint. Gelijk = push (gelijkspel). Klik â€œStart rondeâ€ om opnieuw te spelen.' }
        ]
      },
      poker: {
        title: 'Texas Holdâ€™em Poker',
        subtitle: 'Je krijgt 2 eigen kaarten en gebruikt tot 5 kaarten om de beste hand te maken.',
        steps: [
          { icon: 'ðŸª™', title: 'Koop je in', text: 'Kies een tafel en betaal de buyâ€‘in. Small en big blinds zijn verplichte inzetten om de pot te starten.' },
          { icon: 'ðŸ—£ï¸', title: 'Mogelijke acties', text: 'Check = niets inzetten als er nog geen bet is. Call = meebetalen tot het huidige bedrag. Bet/Raise = (meer) inzetten; vul â€œRaise naarâ€ in. Fold = je hand weggooien en je doet niet meer mee.' },
          { icon: 'ðŸ…', title: 'Rondes & winst', text: 'Er komen 5 open kaarten op tafel: 3 (flop), 1 (turn), 1 (river). Maak de beste 5â€‘kaarten hand met jouw 2 kaarten + de open kaarten. Beste hand wint de pot of iedereen anders foldt.' }
        ]
      },
      craps: {
        title: 'Craps Royale',
        subtitle: 'Je gokt op de uitkomst van dobbelstenen. De eerste worp bepaalt het â€œpuntâ€.',
        steps: [
          { icon: 'ðŸ’¶', title: 'Plaats inzet', text: 'Zet minimaal 10 credits in en klik op â€œGooiâ€.' },
          { icon: 'ðŸŽ²', title: 'Eerste worp', text: 'Rol je 7 of 11, dan win je meteen. Rol je 2, 3 of 12, dan verlies je meteen. Elk ander getal wordt je â€œpuntâ€.' },
          { icon: 'ðŸŽ¯', title: 'Punt spelen', text: 'Blijf rollen tot je je punt opnieuw gooit (winst) of een 7 rolt (verlies). Daarna start je automatisch een nieuwe ronde.' }
        ]
      },
      baccarat: {
        title: 'Baccarat',
        subtitle: 'Je kiest op wie je wedt: Player, Banker of Tie. Wie het dichtst bij 9 komt wint.',
        steps: [
          { icon: 'ðŸª™', title: 'Kies inzet', text: 'Plaats je inzet op Player, Banker of Tie en klik â€œDeel kaartenâ€. Dat is de enige actie die je kiest.' },
          { icon: 'ðŸ‚¡', title: 'Waarden uitleg', text: 'A=1, 2â€‘9 zijn hun waarde, 10/J/Q/K = 0. Tel de kaarten op en neem alleen het laatste cijfer.' },
          { icon: 'ðŸ†', title: 'Wie wint', text: 'De hand die het dichtst bij 9 komt wint. Voorbeeld: Player heeft 7+6=13 â†’ telt als 3. Banker heeft 9+0=9 â†’ Banker wint.' }
        ]
      },
      roulette: {
        title: 'Roulette Royale',
        subtitle: 'Je zet in op een kleur of een exact nummer en daarna draait het wiel.',
        steps: [
          { icon: 'ðŸŽ¯', title: 'Kies je inzet', text: 'Selecteer kleur (rood/zwart/groen) of een exact nummer (0â€“36).' },
          { icon: 'ðŸŽ¡', title: 'Draai het wiel', text: 'Klik â€œDraaienâ€ om te spinnen. Je kunt maar Ã©Ã©n inzet per spin kiezen.' },
          { icon: 'ðŸ’°', title: 'Uitbetaling', text: 'Kleur betaalt 2x, groen 14x, exact nummer 36x. Voorbeeld: inzet 10 op nummer 12 â†’ winst 360 bij raak.' }
        ]
      },
      slots: {
        title: 'Slot Machines',
        subtitle: 'Drie rollen draaien tegelijk. Je wint als symbolen gelijk zijn.',
        steps: [
          { icon: 'ðŸŽ°', title: 'Spin', text: 'Kies je inzet en trek aan de hendel om te spinnen. Dat is je enige actie.' },
          { icon: 'âœ¨', title: 'Matches', text: '3 dezelfde symbolen = winst. 2 dezelfde = 2x je inzet.' },
          { icon: 'ðŸ’Ž', title: 'Bonus', text: '7ï¸âƒ£ betaalt 20x, ðŸ’Ž betaalt 15x, andere 3â€‘opâ€‘rij 10x. Voorbeeld: inzet 5 en 3x ðŸ’ â†’ winst 50.' }
        ]
      },
      plinko: {
        title: 'Plinko Drop',
        subtitle: 'Laat ballen vallen en kijk waar ze landen voor een multiplier.',
        steps: [
          { icon: 'ðŸª™', title: 'Inzet per bal', text: 'Kies je inzet en hoeveel ballen je laat vallen.' },
          { icon: 'ðŸ”»', title: 'Drop', text: 'Klik â€œDrop balâ€ om Ã©Ã©n bal te laten vallen. Herhaal tot je aantal ballen op is.' },
          { icon: 'ðŸ“ˆ', title: 'Multipliers', text: 'Het vak bepaalt je winst: 0,4x tot 4x. Voorbeeld: inzet 10 en vak 2,5x â†’ winst 25.' }
        ]
      },
      horse: {
        title: 'Paardenrace Royale',
        subtitle: 'Je gokt op welk paard als eerste finisht.',
        steps: [
          { icon: 'ðŸŽ', title: 'Kies paard', text: 'Selecteer je paard en kies je inzet. De race is willekeurig.' },
          { icon: 'ðŸ', title: 'Start', text: 'Klik â€œStart raceâ€. Dat is je enige actie tijdens de race.' },
          { icon: 'ðŸ’µ', title: 'Payout', text: 'Wint jouw paard, dan krijg je 3x je inzet. Voorbeeld: inzet 20 â†’ winst 60.' }
        ]
      },
      'lootbox-menu': {
        title: 'Lucky Boxes',
        subtitle: 'Ruil Lucky Coins voor beloningen en pak extra credits.',
        steps: [
          { icon: 'ðŸª™', title: 'Kies box', text: 'Selecteer een box van 1, 5 of 10 Lucky Coins.' },
          { icon: 'ðŸŽ', title: 'Open', text: 'Klik om te openen en je gaat naar het upgradeâ€‘scherm.' },
          { icon: 'ðŸ’³', title: 'Beloning', text: 'Hoe hoger het level, hoe meer credits je ontvangt.' }
        ]
      },
      'lootbox-open': {
        title: 'Lucky Box openen',
        subtitle: 'Je hebt drie klikken om je level te verhogen.',
        steps: [
          { icon: 'ðŸŽ', title: 'Klik om te upgraden', text: 'Elke klik heeft 12,5% kans om een level omhoog te gaan. Dat is je enige actie.' },
          { icon: 'â­', title: 'Drie kansen', text: 'Je hebt precies 3 klikken; daarna stopt het.' },
          { icon: 'ðŸ†', title: 'Beloning', text: 'Na de 3 klikken krijg je credits volgens je eindlevel. Voorbeeld: level 3 geeft meer dan level 1.' }
        ]
      }
    };

    let activeHelpKey = null;

    function renderHelpContent(key){
      const content = helpContent[key];
      if(!content) return;
      helpTitle.textContent = content.title;
      helpSubtitle.textContent = content.subtitle;
      helpSteps.innerHTML = content.steps.map(step => `
        <div class="help-step">
          <div class="help-icon">${step.icon}</div>
          <div>
            <div class="help-step-title">${step.title}</div>
            <div class="help-step-text">${step.text}</div>
          </div>
        </div>
      `).join('');
    }

    function setHelpContext(key){
      activeHelpKey = key;
      if(!helpFab || !helpPanel) return;
      if(!key || !helpContent[key]){
        helpFab.classList.remove('is-visible');
        helpPanel.classList.remove('is-open');
        helpPanel.setAttribute('aria-hidden', 'true');
        return;
      }
      renderHelpContent(key);
      helpFab.classList.add('is-visible');
      helpPanel.classList.remove('is-open');
      helpPanel.setAttribute('aria-hidden', 'true');
    }

    if(helpFab){
      helpFab.addEventListener('click', () => {
        if(!activeHelpKey) return;
        const isOpen = helpPanel.classList.toggle('is-open');
        helpPanel.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
      });
    }

    if(helpClose){
      helpClose.addEventListener('click', () => {
        helpPanel.classList.remove('is-open');
        helpPanel.setAttribute('aria-hidden', 'true');
      });
    }

    let gameResultAutoClose = null;
    let gameResultPlayAgainHandler = null;
    let gameResultMainMenuHandler = null;
    let siteMessageAutoClose = null;

    function hideGameResultOverlay(){
      if(!gameResultOverlay) return;
      gameResultOverlay.classList.remove('is-visible');
      gameResultOverlay.setAttribute('aria-hidden', 'true');
      gameResultPlayAgainHandler = null;
      gameResultMainMenuHandler = null;
      if(gameResultAutoClose){
        clearTimeout(gameResultAutoClose);
        gameResultAutoClose = null;
      }
    }

    function showGameResultOverlay({ outcome = 'win', title, message, showActions = false, autoCloseMs = 2200, onPlayAgain, onMainMenu } = {}){
      if(!gameResultOverlay || !gameResultCard) return;
      if(gameResultAutoClose){
        clearTimeout(gameResultAutoClose);
        gameResultAutoClose = null;
      }
      const resolvedTitle = title || (outcome === 'win' ? 'Je wint!' : outcome === 'lose' ? 'Je verliest' : 'Gelijkspel');
      gameResultTitle.textContent = resolvedTitle;
      gameResultMessage.textContent = message || '';
      gameResultCard.classList.remove('win', 'lose', 'push');
      gameResultCard.classList.add(outcome === 'lose' ? 'lose' : outcome === 'push' ? 'push' : 'win');
      gameResultActions.style.display = showActions ? 'flex' : 'none';
      gameResultPlayAgainHandler = typeof onPlayAgain === 'function' ? onPlayAgain : null;
      gameResultMainMenuHandler = typeof onMainMenu === 'function' ? onMainMenu : null;
      gameResultOverlay.classList.add('is-visible');
      gameResultOverlay.setAttribute('aria-hidden', 'false');

      if(!showActions){
        gameResultAutoClose = setTimeout(() => {
          hideGameResultOverlay();
        }, autoCloseMs);
      }
    }

    if(gameResultPlayAgain){
      gameResultPlayAgain.addEventListener('click', () => {
        hideGameResultOverlay();
        if(gameResultPlayAgainHandler){
          gameResultPlayAgainHandler();
        }
      });
    }

    if(gameResultMainMenu){
      gameResultMainMenu.addEventListener('click', () => {
        hideGameResultOverlay();
        if(gameResultMainMenuHandler){
          gameResultMainMenuHandler();
        }
      });
    }

    function hideSiteMessage(){
      if(!siteMessage) return;
      siteMessage.classList.remove('is-visible');
      siteMessage.setAttribute('aria-hidden', 'true');
      if(siteMessageAutoClose){
        clearTimeout(siteMessageAutoClose);
        siteMessageAutoClose = null;
      }
    }

    function showSiteMessage(message, { title = 'Melding', type = 'info', autoCloseMs = 2200 } = {}){
      if(!siteMessage || !siteMessageText || !siteMessageTitle) return;
      if(siteMessageAutoClose){
        clearTimeout(siteMessageAutoClose);
        siteMessageAutoClose = null;
      }
      siteMessage.dataset.type = type;
      siteMessageTitle.textContent = title;
      siteMessageText.textContent = message;
      siteMessage.classList.add('is-visible');
      siteMessage.setAttribute('aria-hidden', 'false');
      if(autoCloseMs){
        siteMessageAutoClose = setTimeout(() => {
          hideSiteMessage();
        }, autoCloseMs);
      }
    }

    if(siteMessageClose){
      siteMessageClose.addEventListener('click', hideSiteMessage);
    }

    const sleep = (ms)=>new Promise(resolve=>setTimeout(resolve, ms));

    /* ---------------------------
       Login / accounts
       --------------------------- */
    applyLoginSkinFromDevice();
    loginSection.style.display = 'flex';

    loginBtn.onclick = async ()=>{
      const rawName = usernameInput.value.trim();
      const passwd = passwordInput.value.trim();
      if(!rawName || !passwd) return showSiteMessage('Vul gebruikersnaam en wachtwoord in.');

      const key = keyForName(rawName);
      const existing = await loadUser(key);
      if(!existing) return showSiteMessage('Account bestaat niet.');
      if(existing.password !== passwd) return showSiteMessage('Wachtwoord onjuist.');

      const needsLuckyInit = typeof existing.luckyCoins !== 'number' || typeof existing.luckyCoinProgress !== 'number';
      const needsSkinInit = !existing.gameSkins;
      currentUser = existing;
      currentUser.key = key;
      ensureLuckyFields(currentUser);
      ensureSkinFields(currentUser);
      ensureTrackingFields(currentUser);
      loginSection.style.display='none';
      showDashboard(true);
      applyAllSkins();
      if(needsLuckyInit || needsSkinInit){
        saveCurrentUser();
      }
    };

    createAccountBtn.onclick = async ()=>{
      const rawName = usernameInput.value.trim();
      const passwd = passwordInput.value.trim();
      if(!rawName || !passwd) return showSiteMessage('Vul gebruikersnaam en wachtwoord in.');

      const key = keyForName(rawName);
      const existing = await loadUser(key);
      if(existing){
        showSiteMessage('Account bestaat al.');
        return;
      }

      currentUser = {
        key,
        name: rawName,
        password: passwd,
        credits: 1000,
        luckyCoins: 0,
        luckyCoinProgress: 0,
        lastDaily: null,
        wins: 0,
        losses: 0,
        gamesPlayed: 0,
        totalEarned: 0,
        bjWins: 0,
        bjLosses: 0,
        bjGames: 0,
        pkWins: 0,
        pkLosses: 0,
        pkGames: 0
      };
      ensureSkinFields(currentUser);
      ensureTrackingFields(currentUser);
      await saveCurrentUser();
      loginSection.style.display='none';
      showDashboard(true);
      applyAllSkins();
    };

    function ensureLuckyFields(user){
      if(!user) return;
      if(typeof user.luckyCoins !== 'number') user.luckyCoins = 0;
      if(typeof user.luckyCoinProgress !== 'number') user.luckyCoinProgress = 0;
    }

    function canPurchaseLuckyDrop(){
      return !!currentUser && currentUser.luckyCoins >= 1;
    }

    function updateLuckyDropIndicator(){
      if(!luckyDropBtn) return;
      if(canPurchaseLuckyDrop()){
        luckyDropBtn.classList.add('has-available');
      } else {
        luckyDropBtn.classList.remove('has-available');
      }
    }

    function triggerLuckyDropShake(){
      if(!luckyDropBtn || !canPurchaseLuckyDrop()) return;
      luckyDropBtn.classList.remove('shake');
      void luckyDropBtn.offsetWidth;
      luckyDropBtn.classList.add('shake');
    }

    function updateLuckyCoinDisplay(){
      if(!currentUser) return;
      ensureLuckyFields(currentUser);
      luckyCoinsEl.textContent = currentUser.luckyCoins;
      luckyCoinProgressEl.textContent = currentUser.luckyCoinProgress;
      updateLuckyDropIndicator();
    }

    function applyLuckyCoinProgress(amount){
      if(!currentUser || amount <= 0) return;
      ensureLuckyFields(currentUser);
      currentUser.luckyCoinProgress += amount;
      const earned = Math.floor(currentUser.luckyCoinProgress / 500);
      if(earned > 0){
        currentUser.luckyCoins += earned;
        currentUser.luckyCoinProgress = currentUser.luckyCoinProgress % 500;
      }
      updateLuckyCoinDisplay();
    }

    function recordGameResult(gameKey, outcome, winAmount = 0){
      if(!currentUser) return;
      const winKey = `${gameKey}Wins`;
      const lossKey = `${gameKey}Losses`;
      const gamesKey = `${gameKey}Games`;
      currentUser[gamesKey] = (currentUser[gamesKey] || 0) + 1;
      currentUser.gamesPlayed = (currentUser.gamesPlayed || 0) + 1;
      if(outcome === 'win'){
        currentUser[winKey] = (currentUser[winKey] || 0) + 1;
        currentUser.wins = (currentUser.wins || 0) + 1;
        currentUser.totalEarned = (currentUser.totalEarned || 0) + winAmount;
      } else if(outcome === 'lose'){
        currentUser[lossKey] = (currentUser[lossKey] || 0) + 1;
        currentUser.losses = (currentUser.losses || 0) + 1;
      }
    }

    const trackingSessions = {};
    let trackingGameIndex = 0;
    let trackingUsersCache = [];
    let trackingDatesCache = [];

    function ensureTrackingFields(user){
      if(!user) return;
      if(!user.tracking || typeof user.tracking !== 'object'){
        user.tracking = { days: {} };
      }
      if(!user.tracking.days || typeof user.tracking.days !== 'object'){
        user.tracking.days = {};
      }
    }

    function getDateKey(date = new Date()){
      return date.toISOString().slice(0, 10);
    }

    function getTrackingDates(){
      const dates = [];
      const today = new Date();
      for(let offset = 6; offset >= 0; offset -= 1){
        const date = new Date(today);
        date.setDate(today.getDate() - offset);
        dates.push(getDateKey(date));
      }
      return dates;
    }

    function getTrackingDayEntry(user, dateKey){
      ensureTrackingFields(user);
      if(!user.tracking.days[dateKey]){
        user.tracking.days[dateKey] = { totalCreditsNet: 0, games: {} };
      }
      return user.tracking.days[dateKey];
    }

    function getTrackingGameEntry(dayEntry, gameKey){
      if(!dayEntry.games[gameKey]){
        dayEntry.games[gameKey] = { bets: 0, net: 0, games: 0, timeMs: 0 };
      }
      return dayEntry.games[gameKey];
    }

    function updateTracking(gameKey, { betAmount = 0, netAmount = 0, gamesPlayed = 0, timeMs = 0 } = {}){
      if(!currentUser || !gameKey) return;
      ensureTrackingFields(currentUser);
      const dateKey = getDateKey();
      const dayEntry = getTrackingDayEntry(currentUser, dateKey);
      const gameEntry = getTrackingGameEntry(dayEntry, gameKey);
      gameEntry.bets += betAmount;
      gameEntry.net += netAmount;
      gameEntry.games += gamesPlayed;
      gameEntry.timeMs += timeMs;
      if(netAmount !== 0){
        dayEntry.totalCreditsNet += netAmount;
      }
    }

    function startTrackingSession(gameKey){
      if(!currentUser || !gameKey) return;
      if(trackingSessions[gameKey]) return;
      trackingSessions[gameKey] = Date.now();
    }

    function endTrackingSession(gameKey){
      if(!currentUser || !gameKey) return;
      const startedAt = trackingSessions[gameKey];
      if(!startedAt) return;
      const duration = Date.now() - startedAt;
      delete trackingSessions[gameKey];
      if(duration > 0){
        updateTracking(gameKey, { timeMs: duration });
        saveCurrentUser();
      }
    }

    function endAllTrackingSessions(){
      Object.keys(trackingSessions).forEach((gameKey) => {
        endTrackingSession(gameKey);
      });
    }

    function formatCredits(value){
      return Math.round(value).toLocaleString('nl-NL');
    }

    function formatPercent(value){
      if(!Number.isFinite(value)) return '0%';
      return `${value.toFixed(1)}%`;
    }

    function formatDuration(ms){
      const totalSeconds = Math.floor(ms / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      return `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
    }

    async function loadTrackingUsersFromDb(){
      const snap = await db.ref('users').once('value');
      const data = snap.val() || {};
      return Object.entries(data).map(([key, user]) => {
        const withKey = { ...user, key, name: user.name || key };
        ensureTrackingFields(withKey);
        return withKey;
      });
    }

    function sumGameStatForUser(user, gameKey, dates, field){
      return dates.reduce((total, dateKey) => {
        const day = user.tracking?.days?.[dateKey];
        const value = day?.games?.[gameKey]?.[field] || 0;
        return total + value;
      }, 0);
    }

    function sumDailyCreditsNet(user, dates){
      return dates.reduce((total, dateKey) => {
        const day = user.tracking?.days?.[dateKey];
        return total + (day?.totalCreditsNet || 0);
      }, 0);
    }

    function buildTrackingTable(title, headers, rows){
      return `
        <div class="tracking-table-block">
          <h4>${title}</h4>
          <table class="tracking-table">
            <thead>
              <tr>${headers.map(cell => `<th>${cell}</th>`).join('')}</tr>
            </thead>
            <tbody>
              ${rows.map(row => `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function renderTrackingTablesForGame(gameKey){
      if(!trackingTables || !trackingDatesCache.length) return;
      const dates = trackingDatesCache;
      const users = trackingUsersCache || [];
      const dayLabels = dates.map((_, index) => `day ${index + 1}`);
      const headers = ['Speler', ...dayLabels, 'total'];

      const totalBetsByDay = dates.map((dateKey) => (
        users.reduce((sum, user) => sum + (user.tracking?.days?.[dateKey]?.games?.[gameKey]?.bets || 0), 0)
      ));
      const totalNetByDay = dates.map((dateKey) => (
        users.reduce((sum, user) => sum + (user.tracking?.days?.[dateKey]?.games?.[gameKey]?.net || 0), 0)
      ));
      const totalPlayersByDay = dates.map((dateKey) => (
        users.filter(user => (user.tracking?.days?.[dateKey]?.games?.[gameKey]?.games || 0) > 0).length
      ));

      const totalBetsAll = totalBetsByDay.reduce((sum, value) => sum + value, 0);
      const totalNetAll = totalNetByDay.reduce((sum, value) => sum + value, 0);
      const totalPlayersAll = users.filter(user => sumGameStatForUser(user, gameKey, dates, 'games') > 0).length;

      const sortedUsers = [...users].sort((a, b) => (
        sumGameStatForUser(b, gameKey, dates, 'net') - sumGameStatForUser(a, gameKey, dates, 'net')
      ));

      const playersTableRows = [
        ['Total spelers', ...totalPlayersByDay.map(value => formatCredits(value)), formatCredits(totalPlayersAll)]
      ];

      const betRows = sortedUsers.map((user) => {
        const totals = dates.map((dateKey, index) => {
          const bet = user.tracking?.days?.[dateKey]?.games?.[gameKey]?.bets || 0;
          const percent = totalBetsByDay[index] ? (bet / totalBetsByDay[index]) * 100 : 0;
          return `${formatCredits(bet)} (${formatPercent(percent)})`;
        });
        const totalBet = sumGameStatForUser(user, gameKey, dates, 'bets');
        const totalPercent = totalBetsAll ? (totalBet / totalBetsAll) * 100 : 0;
        return [user.name, ...totals, `${formatCredits(totalBet)} (${formatPercent(totalPercent)})`];
      });

      const betTotalsRow = [
        'Totaal',
        ...totalBetsByDay.map(value => formatCredits(value)),
        `${formatCredits(totalBetsAll)} (${formatPercent(totalBetsAll ? 100 : 0)})`
      ];

      const casinoWinRows = [
        ['Casino win', ...totalNetByDay.map(value => formatCredits(-value)), formatCredits(-totalNetAll)]
      ];

      const netRows = sortedUsers.map((user) => {
        const dayValues = dates.map((dateKey) => formatCredits(user.tracking?.days?.[dateKey]?.games?.[gameKey]?.net || 0));
        const totalNet = sumGameStatForUser(user, gameKey, dates, 'net');
        return [user.name, ...dayValues, formatCredits(totalNet)];
      });

      const avgRows = sortedUsers.map((user) => {
        const dayValues = dates.map((dateKey) => {
          const entry = user.tracking?.days?.[dateKey]?.games?.[gameKey];
          const net = entry?.net || 0;
          const games = entry?.games || 0;
          const avg = games ? net / games : 0;
          return formatCredits(avg);
        });
        const totalNet = sumGameStatForUser(user, gameKey, dates, 'net');
        const totalGames = sumGameStatForUser(user, gameKey, dates, 'games');
        const totalAvg = totalGames ? totalNet / totalGames : 0;
        return [user.name, ...dayValues, formatCredits(totalAvg)];
      });

      const creditsNetRows = sortedUsers.map((user) => {
        const dayValues = dates.map((dateKey) => formatCredits(user.tracking?.days?.[dateKey]?.totalCreditsNet || 0));
        const totalCreditsNet = sumDailyCreditsNet(user, dates);
        return [user.name, ...dayValues, formatCredits(totalCreditsNet)];
      });

      const timeRows = sortedUsers.map((user) => {
        const dayValues = dates.map((dateKey) => formatDuration(user.tracking?.days?.[dateKey]?.games?.[gameKey]?.timeMs || 0));
        const totalTime = sumGameStatForUser(user, gameKey, dates, 'timeMs');
        return [user.name, ...dayValues, formatDuration(totalTime)];
      });

      trackingTables.innerHTML = [
        buildTrackingTable('Total individuele spelers', headers, playersTableRows),
        buildTrackingTable('Total credits bet (+ % van totaal)', headers, [...betRows, betTotalsRow]),
        buildTrackingTable('Casino win (credits)', headers, casinoWinRows),
        buildTrackingTable('Netto gain/loss per speler', headers, netRows),
        buildTrackingTable('Gemiddelde gain/loss per game', headers, avgRows),
        buildTrackingTable('Gain/loss totale credits', headers, creditsNetRows),
        buildTrackingTable('Tijd gespeeld', headers, timeRows)
      ].join('');
    }

    async function refreshTrackingData(){
      trackingUsersCache = await loadTrackingUsersFromDb();
      trackingDatesCache = getTrackingDates();
    }

    async function openTrackingPanel(){
      if(!playerTrackingPanel) return;
      await refreshTrackingData();
      trackingGameIndex = 0;
      const gameKey = Object.keys(gameLabels)[trackingGameIndex];
      if(trackingGameLabel) trackingGameLabel.textContent = gameLabels[gameKey];
      renderTrackingTablesForGame(gameKey);
      playerTrackingPanel.style.display = 'flex';
      playerTrackingPanel.setAttribute('aria-hidden', 'false');
    }

    function hideTrackingPanel(){
      if(!playerTrackingPanel) return;
      playerTrackingPanel.style.display = 'none';
      playerTrackingPanel.setAttribute('aria-hidden', 'true');
    }

    function renderDashboard(){
      if(!currentUser) return;
      ensureLuckyFields(currentUser);
      ensureShopFields(currentUser);
      ensureSkinFields(currentUser);
      displayName.textContent = currentUser.name;
      creditsEl.textContent = currentUser.credits;
      updateLuckyCoinDisplay();
      applyShopSelections();
      if(currencyDisplay){
        currencyDisplay.style.display = 'flex';
      }
    }

    function showDashboard(shouldShake = false){
      endAllTrackingSessions();
      dashboard.style.display = 'block';
      hideGameResultOverlay();
      renderDashboard();
      setHelpContext(null);
      if(skinsSection){
        skinsSection.style.display = 'none';
      }
      if(shopSection){
        shopSection.style.display = 'none';
      }
      if(shouldShake){
        triggerLuckyDropShake();
      }
    }

    logoutBtn.onclick = () => {
      endAllTrackingSessions();
      currentUser = null;
      hideTrackingPanel();
      closeLeaderboardPopup();
      dashboard.style.display = 'none';
      blackjackSection.style.display = 'none';
      pokerSection.style.display = 'none';
      crapsSection.style.display = 'none';
      baccaratSection.style.display = 'none';
      rouletteSection.style.display = 'none';
      slotsSection.style.display = 'none';
      plinkoSection.style.display = 'none';
      lootBoxMenuSection.style.display = 'none';
      lootBoxSection.style.display = 'none';
      shopSection.style.display = 'none';
      loginSection.style.display = 'flex';
      applyLoginSkinFromDevice();
      setHelpContext(null);
      if(currencyDisplay) currencyDisplay.style.display = 'none';
    };

    let developerClicks = 0;
    let developerClickTimer = null;
    let trackingTapCount = 0;
    let trackingTapTimer = null;

    function openDeveloperPortal(){
      if(!developerPortal) return;
      developerPortal.style.display = 'flex';
    }

    function closeDeveloperPortal(){
      if(!developerPortal) return;
      developerPortal.style.display = 'none';
    }

    if(welcomeBack){
      welcomeBack.addEventListener('click', () => {
        developerClicks += 1;
        if(developerClickTimer){
          clearTimeout(developerClickTimer);
        }
        developerClickTimer = setTimeout(() => {
          developerClicks = 0;
        }, 800);
        if(developerClicks === 3){
          developerClicks = 0;
          const password = prompt('Developer wachtwoord:');
          if(password === 'pepjes'){
            openDeveloperPortal();
          } else if(password !== null){
            showSiteMessage('Onjuist wachtwoord.');
          }
        }
      });
    }

    if(closeDevPortal){
      closeDevPortal.addEventListener('click', closeDeveloperPortal);
    }

    if(devCreditsBtn){
      devCreditsBtn.addEventListener('click', async () => {
        if(!currentUser) return;
        currentUser.credits = 999999999;
        await saveCurrentUser();
        renderDashboard();
        showSiteMessage('Oneindige credits geactiveerd.');
      });
    }

    if(devLuckyBtn){
      devLuckyBtn.addEventListener('click', async () => {
        if(!currentUser) return;
        ensureLuckyFields(currentUser);
        currentUser.luckyCoins = 999999999;
        currentUser.luckyCoinProgress = 0;
        await saveCurrentUser();
        renderDashboard();
        showSiteMessage('Oneindige lucky coins geactiveerd.');
      });
    }

    if(closeTrackingPanel){
      closeTrackingPanel.addEventListener('click', hideTrackingPanel);
    }

    if(trackingPrevGame){
      trackingPrevGame.addEventListener('click', () => {
        const keys = Object.keys(gameLabels);
        trackingGameIndex = (trackingGameIndex - 1 + keys.length) % keys.length;
        const gameKey = keys[trackingGameIndex];
        if(trackingGameLabel) trackingGameLabel.textContent = gameLabels[gameKey];
        renderTrackingTablesForGame(gameKey);
      });
    }

    if(trackingNextGame){
      trackingNextGame.addEventListener('click', () => {
        const keys = Object.keys(gameLabels);
        trackingGameIndex = (trackingGameIndex + 1) % keys.length;
        const gameKey = keys[trackingGameIndex];
        if(trackingGameLabel) trackingGameLabel.textContent = gameLabels[gameKey];
        renderTrackingTablesForGame(gameKey);
      });
    }

    claimDailyBtn.onclick = async ()=>{
      if(!currentUser) return;
      const t = new Date().toDateString();
      if(currentUser.lastDaily !== t){
        currentUser.credits += 250;
        currentUser.lastDaily = t;
        await saveCurrentUser();
        renderDashboard();
        showSiteMessage('Dagelijkse bonus geclaimd: +250 credits', { type: 'success' });
      } else {
        showSiteMessage('Je hebt vandaag al je bonus geclaimd.', { type: 'warning' });
      }
    };

    playBlackjackBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      slotsSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      skinsSection.style.display='none';
      applyGameSkin('blackjack');
      startTrackingSession('blackjack');
      blackjackSection.style.display='block';
      setHelpContext('blackjack');
    };

    playPokerBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      slotsSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      skinsSection.style.display='none';
      applyGameSkin('poker');
      startTrackingSession('poker');
      pokerSection.style.display='block';
      setHelpContext('poker');
    };

    playCrapsBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      slotsSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      skinsSection.style.display='none';
      applyGameSkin('craps');
      startTrackingSession('craps');
      crapsSection.style.display='block';
      setHelpContext('craps');
    };

    playBaccaratBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      rouletteSection.style.display='none';
      slotsSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      skinsSection.style.display='none';
      applyGameSkin('baccarat');
      startTrackingSession('baccarat');
      baccaratSection.style.display='block';
      setHelpContext('baccarat');
    };

    playRouletteBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      slotsSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      skinsSection.style.display='none';
      applyGameSkin('roulette');
      startTrackingSession('roulette');
      rouletteSection.style.display='block';
      setHelpContext('roulette');
    };

    playSlotsBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      skinsSection.style.display='none';
      applyGameSkin('slots');
      startTrackingSession('slots');
      slotsSection.style.display='block';
      setHelpContext('slots');
    };

    playPlinkoBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      slotsSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      skinsSection.style.display='none';
      applyGameSkin('plinko');
      startTrackingSession('plinko');
      plinkoSection.style.display='block';
      layoutPlinkoPegs();
      setHelpContext('plinko');
    };

    if(skinsBtn){
      skinsBtn.onclick = ()=>{
        if(!currentUser) return alert('Je moet eerst inloggen!');
        closeLeaderboardPopup();
        dashboard.style.display = 'none';
        blackjackSection.style.display = 'none';
        pokerSection.style.display = 'none';
        crapsSection.style.display = 'none';
        baccaratSection.style.display = 'none';
        rouletteSection.style.display = 'none';
        slotsSection.style.display = 'none';
        plinkoSection.style.display = 'none';
        lootBoxMenuSection.style.display = 'none';
        lootBoxSection.style.display = 'none';
        shopSection.style.display = 'none';
        skinsSection.style.display = 'block';
        setHelpContext(null);
        ensureShopFields(currentUser);
        ensureSkinFields(currentUser);
        renderSkinsTabs();
        setActiveSkinsTab(activeSkinsTab);
        renderSkinGameTabs();
        setActiveSkinGame(activeSkinGame);
      };
    }

    if(luckyDropBtn){
      luckyDropBtn.onclick = ()=>{
      if(!currentUser) return showSiteMessage('Je moet eerst inloggen!');
      closeLeaderboardPopup();
      dashboard.style.display = 'none';
        blackjackSection.style.display = 'none';
        pokerSection.style.display = 'none';
        crapsSection.style.display = 'none';
        baccaratSection.style.display = 'none';
        rouletteSection.style.display = 'none';
        slotsSection.style.display = 'none';
      plinkoSection.style.display = 'none';
      lootBoxSection.style.display = 'none';
      skinsSection.style.display = 'none';
      lootBoxMenuSection.style.display = 'block';
      setHelpContext('lootbox-menu');
      };
    }

    if(backFromSkinsBtn){
      backFromSkinsBtn.onclick = () => {
        skinsSection.style.display = 'none';
        showDashboard(true);
      };
    }

    const lootBoxConfigs = {
      lucky: { name: 'Lucky Box', cost: 1, startLevel: 1 },
      deluxe: { name: 'Deluxe Lucky Box', cost: 5, startLevel: 2 },
      ultra: { name: 'Ultra Deluxe Lucky Box', cost: 10, startLevel: 3 }
    };
    const lootBoxRewards = {
      1: 50,
      2: 150,
      3: 500,
      4: 1000,
      5: 2500
    };
    let currentLootBox = null;

    document.querySelectorAll('.lootbox-card[data-lootbox]').forEach((card)=>{
      card.addEventListener('click', ()=>{
        triggerLootBoxAnimation(card, 'is-tapped');
        const type = card.getAttribute('data-lootbox');
        openLootBox(type);
      });
    });

    function triggerLootBoxAnimation(card, className){
      if(!card) return;
      card.classList.remove(className);
      void card.offsetWidth;
      card.classList.add(className);
    }

    function updateLootBoxUI(){
      if(!currentLootBox) return;
      lootBoxTitle.textContent = currentLootBox.name;
      lootBoxSubtitle.textContent = `Klik op de box om te upgraden. ${currentLootBox.remainingChances} kansen over.`;
      lootBoxLevel.textContent = currentLootBox.level;
      lootBoxCard.className = `lootbox-card lootbox-level-${currentLootBox.level}`;
      if(currentLootBox.remainingChances === 0){
        lootBoxCard.classList.add('disabled');
      }
      const dots = lootBoxChances.querySelectorAll('.chance-dot');
      dots.forEach((dot, index)=>{
        dot.classList.toggle('used', index >= currentLootBox.remainingChances);
      });
    }

    function openLootBox(type){
      if(!currentUser) return showSiteMessage('Je moet eerst inloggen!');
      closeLeaderboardPopup();
      const config = lootBoxConfigs[type];
      ensureLuckyFields(currentUser);
      if(currentUser.luckyCoins < config.cost){
        showSiteMessage(`Je hebt ${config.cost} Lucky Coins nodig voor ${config.name}.`);
        return;
      }
      currentUser.luckyCoins -= config.cost;
      currentLootBox = {
        type,
        name: config.name,
        level: config.startLevel,
        remainingChances: 3
      };
      lootBoxReward.textContent = '';
      lootBoxHint.textContent = 'Klik om te upgraden (12,5% kans per klik).';
      dashboard.style.display = 'none';
      blackjackSection.style.display = 'none';
      pokerSection.style.display = 'none';
      lootBoxMenuSection.style.display = 'none';
      lootBoxSection.style.display = 'block';
      setHelpContext('lootbox-open');
      updateLuckyCoinDisplay();
      updateLootBoxUI();
      saveCurrentUser();
    }

    lootBoxCard.onclick = ()=>{
      if(!currentLootBox || currentLootBox.remainingChances === 0) return;
      const previousLevel = currentLootBox.level;
      currentLootBox.remainingChances -= 1;
      if(Math.random() < 0.125 && currentLootBox.level < 5){
        currentLootBox.level += 1;
      }
      triggerLootBoxAnimation(lootBoxCard, 'is-tapped');
      if(currentLootBox.level > previousLevel){
        triggerLootBoxAnimation(lootBoxCard, 'is-leveling');
      }
      if(currentLootBox.remainingChances === 0){
        const reward = lootBoxRewards[currentLootBox.level];
        currentUser.credits += reward;
        lootBoxHint.textContent = 'Kist geopend! Je beloning is uitgekeerd.';
        lootBoxReward.textContent = `Beloning: ${reward} credits (level ${currentLootBox.level}).`;
        saveCurrentUser().then(renderDashboard);
      }
      updateLootBoxUI();
    };
const playHorseRaceBtn = document.getElementById("playHorseRaceBtn");

playHorseRaceBtn.onclick = () => {
    closeLeaderboardPopup();
    showHorseRace();
};

    backToMenuBtn.onclick = ()=>{
      if(bjRoundActive || bjAnimating){
        showSiteMessage('Je kan niet weggaan terwijl je nog in een blackjack-ronde zit.');
        return;
      }
      endTrackingSession('blackjack');
      resetBlackjackSession();
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      showDashboard(true);
    };

    backToMenuFromLoot.onclick = ()=>{
      lootBoxSection.style.display = 'none';
      lootBoxMenuSection.style.display = 'block';
      setHelpContext('lootbox-menu');
    };

    backToMenuFromLuckyBoxes.onclick = ()=>{
      lootBoxMenuSection.style.display = 'none';
      showDashboard(true);
    };

    backFromCrapsBtn.onclick = ()=>{
      if(crapsRolling || crapsBet > 0 || crapsPoint !== null){
        showSiteMessage('Je kan niet weggaan terwijl je nog in een craps-ronde zit.');
        return;
      }
      endTrackingSession('craps');
      crapsSection.style.display = 'none';
      showDashboard(true);
    };

    backFromBaccaratBtn.onclick = ()=>{
      endTrackingSession('baccarat');
      baccaratSection.style.display = 'none';
      showDashboard(true);
    };

    backFromRouletteBtn.onclick = ()=>{
      endTrackingSession('roulette');
      rouletteSection.style.display = 'none';
      showDashboard(true);
    };

    backFromSlotsBtn.onclick = ()=>{
      endTrackingSession('slots');
      slotsSection.style.display = 'none';
      showDashboard(true);
    };

    backFromPlinkoBtn.onclick = ()=>{
      endTrackingSession('plinko');
      plinkoSection.style.display = 'none';
      showDashboard(true);
    };

    /* ---------------------------
       Craps / Baccarat / Roulette logic
       --------------------------- */
    const crapsPipLayouts = {
      1: [4],
      2: [0, 8],
      3: [0, 4, 8],
      4: [0, 2, 6, 8],
      5: [0, 2, 4, 6, 8],
      6: [0, 2, 3, 5, 6, 8]
    };

    const dicePipSymbols = {
      classic: 'â—',
      aurora: 'âœ¦',
      velvet: 'â™¦',
      ember: 'âœ¸',
      lagoon: 'â—ˆ',
      neon: 'âœ§',
      rose: 'â€',
      jade: 'â™£',
      solar: 'â˜€',
      obsidian: 'â˜¾'
    };

    function getDicePipSymbol(themeId){
      return dicePipSymbols[themeId] || dicePipSymbols.classic;
    }

    function buildDicePipMarkup(value, pipSymbol, className = 'craps-pip'){
      const layout = crapsPipLayouts[value] || [];
      return layout.map(pos => `<span class="${className} pos-${pos}">${pipSymbol}</span>`).join('');
    }
    let crapsPoint = null;
    let crapsBet = 0;
    let crapsRolling = false;

    function rollDie(){
      return Math.floor(Math.random() * 6) + 1;
    }

    function renderCrapsDie(dieEl, value){
      if(!dieEl) return;
      const themeId = currentUser?.shopSelection?.dice || 'classic';
      const pipSymbol = getDicePipSymbol(themeId);
      dieEl.dataset.value = value;
      dieEl.innerHTML = buildDicePipMarkup(value, pipSymbol);
    }

    function updateCrapsDice(d1, d2){
      renderCrapsDie(crapsDieOne, d1);
      renderCrapsDie(crapsDieTwo, d2);
    }

    function refreshCrapsDicePips(){
      const d1 = parseInt(crapsDieOne?.dataset?.value, 10) || 1;
      const d2 = parseInt(crapsDieTwo?.dataset?.value, 10) || 1;
      updateCrapsDice(d1, d2);
    }

    function resetCrapsRound(){
      crapsPoint = null;
      crapsBet = 0;
      crapsPointEl.textContent = 'Punt: -';
      crapsStatusEl.textContent = 'Plaats je inzet en gooi de dobbelstenen.';
      updateCrapsDice(1, 1);
    }

    rollCrapsBtn.onclick = async ()=>{
      if(!currentUser) return showSiteMessage('Je moet eerst inloggen!');
      if(crapsRolling) return;
      if(crapsPoint === null){
        const bet = parseInt(crapsBetInput.value) || 0;
        if(bet < 10) return showSiteMessage('Minimum inzet is 10 credits.');
        if(currentUser.credits < bet) return showSiteMessage('Je hebt niet genoeg credits!');
        crapsBet = bet;
        currentUser.credits -= bet;
        updateTracking('craps', { betAmount: bet, gamesPlayed: 1 });
        await saveCurrentUser();
        renderDashboard();
      }

      crapsRolling = true;
      rollCrapsBtn.disabled = true;
      if(resetCrapsBtn){
        resetCrapsBtn.disabled = true;
      }
      crapsDieOne.classList.add('dice-roll');
      crapsDieTwo.classList.add('dice-roll');
      crapsStatusEl.textContent = 'Dobbelstenen rollen...';
      await sleep(500);

      const d1 = rollDie();
      const d2 = rollDie();
      const total = d1 + d2;
      updateCrapsDice(d1, d2);
      crapsDieOne.classList.remove('dice-roll');
      crapsDieTwo.classList.remove('dice-roll');

      if(crapsPoint === null){
        if(total === 7 || total === 11){
          const winAmount = crapsBet * 2;
          currentUser.credits += winAmount;
          applyLuckyCoinProgress(winAmount);
          recordGameResult('craps', 'win', winAmount);
          updateTracking('craps', { netAmount: winAmount - crapsBet });
          crapsStatusEl.textContent = `Come-out ${total}! Je wint ${winAmount} credits.`;
          crapsPointEl.textContent = 'Punt: -';
          showGameResultOverlay({
            outcome: 'win',
            title: 'Craps: winst!',
            message: `Come-out ${total}. +${winAmount} credits.`
          });
          await saveCurrentUser();
          renderDashboard();
          crapsBet = 0;
        } else if([2,3,12].includes(total)){
          recordGameResult('craps', 'lose');
          updateTracking('craps', { netAmount: -crapsBet });
          crapsStatusEl.textContent = `Come-out ${total}. Je verliest je inzet.`;
          crapsPointEl.textContent = 'Punt: -';
          showGameResultOverlay({
            outcome: 'lose',
            title: 'Craps: verlies',
            message: `Come-out ${total}. Je verliest je inzet.`
          });
          await saveCurrentUser();
          renderDashboard();
          crapsBet = 0;
        } else {
          crapsPoint = total;
          crapsPointEl.textContent = `Punt: ${crapsPoint}`;
          crapsStatusEl.textContent = `Punt gezet op ${crapsPoint}. Gooi door om te winnen!`;
        }
      } else {
        if(total === crapsPoint){
          const winAmount = crapsBet * 2;
          currentUser.credits += winAmount;
          applyLuckyCoinProgress(winAmount);
          recordGameResult('craps', 'win', winAmount);
          updateTracking('craps', { netAmount: winAmount - crapsBet });
          crapsStatusEl.textContent = `Je rolt ${total} en maakt je punt! +${winAmount} credits.`;
          showGameResultOverlay({
            outcome: 'win',
            title: 'Craps: winst!',
            message: `Punt geraakt met ${total}. +${winAmount} credits.`
          });
          await saveCurrentUser();
          renderDashboard();
          crapsPoint = null;
          crapsBet = 0;
          crapsPointEl.textContent = 'Punt: -';
        } else if(total === 7){
          recordGameResult('craps', 'lose');
          updateTracking('craps', { netAmount: -crapsBet });
          crapsStatusEl.textContent = '7-out! Je verliest je inzet.';
          showGameResultOverlay({
            outcome: 'lose',
            title: 'Craps: verlies',
            message: '7-out! Je verliest je inzet.'
          });
          await saveCurrentUser();
          renderDashboard();
          crapsPoint = null;
          crapsBet = 0;
          crapsPointEl.textContent = 'Punt: -';
        } else {
          crapsStatusEl.textContent = `Je rolt ${total}. Punt blijft ${crapsPoint}.`;
        }
      }

      crapsRolling = false;
      rollCrapsBtn.disabled = false;
      if(resetCrapsBtn){
        resetCrapsBtn.disabled = false;
      }
    };

    if(resetCrapsBtn){
      resetCrapsBtn.onclick = ()=>{
        resetCrapsRound();
      };
    }

    resetCrapsRound();

    function baccaratCard(){
      const suits = ['â™ ','â™¥','â™¦','â™£'];
      const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
      const value = values[Math.floor(Math.random() * values.length)];
      const suit = suits[Math.floor(Math.random() * suits.length)];
      let points = parseInt(value, 10);
      if(Number.isNaN(points)){
        points = value === 'A' ? 1 : 0;
      }
      return { value, suit, points };
    }

    function baccaratScore(hand){
      return hand.reduce((sum, card)=>sum + card.points, 0) % 10;
    }

    function initBaccaratRow(row, label){
      row.innerHTML = '';
      const labelEl = document.createElement('strong');
      labelEl.className = 'baccarat-label';
      labelEl.textContent = `${label} (0)`;
      row.appendChild(labelEl);
    }

    function updateBaccaratLabel(row, hand, label){
      const labelEl = row.querySelector('.baccarat-label');
      if(labelEl){
        labelEl.textContent = `${label} (${baccaratScore(hand)})`;
      }
    }

    function appendBaccaratCard(row, card){
      const cardEl = document.createElement('div');
      cardEl.className = 'baccarat-card';
      cardEl.textContent = `${card.value}${card.suit}`;
      row.appendChild(cardEl);
      return cardEl;
    }

    function animateBaccaratDealTo(targetEl){
      if(!baccaratShoe || !targetEl) return Promise.resolve();
      const stackRect = baccaratShoe.getBoundingClientRect();
      const targetRect = targetEl.getBoundingClientRect();
      const flight = document.createElement('div');
      flight.className = 'baccarat-fly-card';
      flight.style.left = `${stackRect.left}px`;
      flight.style.top = `${stackRect.top}px`;
      document.body.appendChild(flight);
      const deltaX = targetRect.left - stackRect.left;
      const deltaY = targetRect.top - stackRect.top;

      return new Promise(resolve=>{
        requestAnimationFrame(()=>{
          flight.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
          flight.style.opacity = '0';
        });
        const cleanup = ()=>{
          flight.remove();
          resolve();
        };
        flight.addEventListener('transitionend', cleanup, { once: true });
        setTimeout(cleanup, 900);
      });
    }

    const baccaratDealDelay = 900;
    const baccaratInitialDelay = 600;

    async function dealBaccaratCard(hand, row, label, delay = baccaratDealDelay){
      const card = baccaratCard();
      hand.push(card);
      const cardEl = appendBaccaratCard(row, card);
      updateBaccaratLabel(row, hand, label);
      await animateBaccaratDealTo(cardEl);
      await sleep(delay);
      return card;
    }

    dealBaccaratBtn.onclick = async ()=>{
      if(!currentUser) return showSiteMessage('Je moet eerst inloggen!');
      if(dealBaccaratBtn.disabled) return;
      const bet = parseInt(baccaratBetInput.value) || 0;
      if(bet < 10) return showSiteMessage('Minimum inzet is 10 credits.');
      if(currentUser.credits < bet) return showSiteMessage('Je hebt niet genoeg credits!');

      dealBaccaratBtn.disabled = true;
      baccaratBetInput.disabled = true;
      baccaratBetType.disabled = true;
      baccaratStatusEl.textContent = 'Kaarten worden gedeeld...';

      currentUser.credits -= bet;
      updateTracking('baccarat', { betAmount: bet, gamesPlayed: 1 });
      await saveCurrentUser();
      renderDashboard();

      const playerHand = [];
      const bankerHand = [];
      initBaccaratRow(baccaratPlayerRow, 'Player');
      initBaccaratRow(baccaratBankerRow, 'Banker');
      await sleep(baccaratInitialDelay);
      await dealBaccaratCard(playerHand, baccaratPlayerRow, 'Player');
      await dealBaccaratCard(bankerHand, baccaratBankerRow, 'Banker');
      await dealBaccaratCard(playerHand, baccaratPlayerRow, 'Player');
      await dealBaccaratCard(bankerHand, baccaratBankerRow, 'Banker');

      const playerScore = baccaratScore(playerHand);
      const bankerScore = baccaratScore(bankerHand);

      if(playerScore < 8 && bankerScore < 8){
        if(playerScore <= 5){
          await dealBaccaratCard(playerHand, baccaratPlayerRow, 'Player');
        }
        const newBankerScore = baccaratScore(bankerHand);
        if(newBankerScore <= 5){
          await dealBaccaratCard(bankerHand, baccaratBankerRow, 'Banker');
        }
      }

      const finalPlayerScore = baccaratScore(playerHand);
      const finalBankerScore = baccaratScore(bankerHand);
      let winner = 'tie';
      if(finalPlayerScore > finalBankerScore) winner = 'player';
      if(finalBankerScore > finalPlayerScore) winner = 'banker';

      let winAmount = 0;
      if(baccaratBetType.value === winner){
        if(winner === 'tie'){
          winAmount = bet * 9;
        } else if(winner === 'banker'){
          winAmount = Math.floor(bet * 1.95);
        } else {
          winAmount = bet * 2;
        }
        currentUser.credits += winAmount;
        applyLuckyCoinProgress(winAmount);
        recordGameResult('baccarat', 'win', winAmount);
        updateTracking('baccarat', { netAmount: winAmount - bet });
        baccaratStatusEl.textContent = `Winner: ${winner.toUpperCase()}! Je wint ${winAmount} credits.`;
        showGameResultOverlay({
          outcome: 'win',
          title: 'Baccarat: winst!',
          message: `Winner: ${winner.toUpperCase()}. +${winAmount} credits.`
        });
      } else {
        recordGameResult('baccarat', 'lose');
        updateTracking('baccarat', { netAmount: -bet });
        baccaratStatusEl.textContent = `Winner: ${winner.toUpperCase()}. Je verliest je inzet.`;
        showGameResultOverlay({
          outcome: 'lose',
          title: 'Baccarat: verlies',
          message: `Winner: ${winner.toUpperCase()}. Je verliest je inzet.`
        });
      }

      await saveCurrentUser();
      renderDashboard();
      dealBaccaratBtn.disabled = false;
      baccaratBetInput.disabled = false;
      baccaratBetType.disabled = false;
    };

    const rouletteRedNumbers = new Set([
      1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36
    ]);
    const rouletteWheelOrder = [
      0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8,
      23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12,
      35, 3, 26
    ];
    const rouletteSlotAngle = 360 / rouletteWheelOrder.length;
    let rouletteWheelRotation = 0;
    let rouletteBallRotation = 0;

    function rouletteColorFor(number){
      if(number === 0) return 'green';
      return rouletteRedNumbers.has(number) ? 'red' : 'black';
    }

    function buildRouletteWheelDecor(){
      if(!roulettePocketLayer || !rouletteHatchLayer) return;
      roulettePocketLayer.innerHTML = '';
      rouletteHatchLayer.innerHTML = '';
      if(rouletteWheel){
        const segments = rouletteWheelOrder.map((number, index) => {
          const start = index * rouletteSlotAngle;
          const end = start + rouletteSlotAngle;
          const color = rouletteColorFor(number);
          const fill = color === 'green' ? '#1b7d3d' : color === 'red' ? '#c62828' : '#111';
          return `${fill} ${start}deg ${end}deg`;
        });
        rouletteWheel.style.setProperty('--roulette-wheel-gradient', `conic-gradient(${segments.join(', ')})`);
      }
      rouletteWheelOrder.forEach((number, index) => {
        const startAngle = index * rouletteSlotAngle;
        const centerAngle = startAngle + (rouletteSlotAngle / 2);
        const label = document.createElement('div');
        label.className = `roulette-number ${rouletteColorFor(number)}`;
        label.textContent = number;
        label.style.setProperty('--angle', `${centerAngle}deg`);
        roulettePocketLayer.appendChild(label);

        const hatch = document.createElement('div');
        hatch.className = 'roulette-hatch';
        hatch.style.setProperty('--angle', `${startAngle}deg`);
        rouletteHatchLayer.appendChild(hatch);
      });
    }

    function updateRouletteInputs(){
      const type = rouletteBetType.value;
      rouletteColor.disabled = type !== 'color';
      rouletteNumber.disabled = type !== 'number';
    }

    rouletteBetType.onchange = updateRouletteInputs;
    buildRouletteWheelDecor();
    updateRouletteInputs();

    let rouletteSpinning = false;
    spinRouletteBtn.onclick = async ()=>{
      if(!currentUser) return showSiteMessage('Je moet eerst inloggen!');
      if(rouletteSpinning) return;
      const bet = parseInt(rouletteBetInput.value) || 0;
      if(bet < 10) return showSiteMessage('Minimum inzet is 10 credits.');
      if(currentUser.credits < bet) return showSiteMessage('Je hebt niet genoeg credits!');

      rouletteSpinning = true;
      spinRouletteBtn.disabled = true;
      rouletteBetInput.disabled = true;
      rouletteBetType.disabled = true;
      rouletteColor.disabled = true;
      rouletteNumber.disabled = true;
      rouletteStatus.textContent = 'Het wiel draait...';
      rouletteResult.textContent = 'Resultaat: -';

      rouletteWheel?.getAnimations().forEach(anim => anim.cancel());
      rouletteBallOrbit?.getAnimations().forEach(anim => anim.cancel());
      rouletteBall?.classList.remove('is-dropping');
      rouletteBall?.style.setProperty('--ball-orbit-radius', '-156px');
      rouletteBall?.style.setProperty('--ball-drop-mid', '-132px');
      rouletteBall?.style.setProperty('--ball-drop-end', '-118px');
      rouletteBall?.style.setProperty('--ball-drop-duration', '520ms');

      const spinTurns = 4 + Math.floor(Math.random() * 3);
      const resultNumber = Math.floor(Math.random() * 37);
      const resultIndex = rouletteWheelOrder.indexOf(resultNumber);
      const targetAngle = (resultIndex * rouletteSlotAngle) + (rouletteSlotAngle / 2);
      const normalizedWheelRotation = ((rouletteWheelRotation % 360) + 360) % 360;
      const alignmentOffset = (360 - ((normalizedWheelRotation + targetAngle) % 360)) % 360;
      const finalRotation = (spinTurns * 360) + alignmentOffset;
      const spinDuration = 3000 + Math.random() * 800;
      const orbitDuration = spinDuration;
      const dropDuration = 520;
      const pocketInset = rouletteSlotAngle * 0.3;
      const pocketJitter = (Math.random() - 0.5) * (rouletteSlotAngle - pocketInset * 2);
      const ballTargetAngle = pocketJitter;

      rouletteWheel?.animate(
        [
          { transform: `rotate(${rouletteWheelRotation}deg)` },
          { transform: `rotate(${rouletteWheelRotation + finalRotation}deg)` }
        ],
        {
          duration: spinDuration,
          easing: 'cubic-bezier(0.16, 0.7, 0.12, 1)',
          fill: 'forwards'
        }
      );

      rouletteBallOrbit?.animate(
        [
          { transform: `rotate(${rouletteBallRotation}deg)` },
          { transform: `rotate(${rouletteBallRotation - (spinTurns * 360 + ballTargetAngle)}deg)` }
        ],
        {
          duration: orbitDuration,
          easing: 'cubic-bezier(0.2, 0.8, 0.2, 1)',
          fill: 'forwards'
        }
      );

      setTimeout(() => {
        rouletteStatus.textContent = 'De bal stuitert tussen de hatches...';
        rouletteBall?.classList.add('is-dropping');
      }, Math.max(0, orbitDuration - dropDuration));

      await sleep(spinDuration + dropDuration);

      currentUser.credits -= bet;
      updateTracking('roulette', { betAmount: bet, gamesPlayed: 1 });
      await saveCurrentUser();
      renderDashboard();

      const resultColor = rouletteColorFor(resultNumber);
      rouletteResult.textContent = `Resultaat: ${resultNumber} (${resultColor})`;

      let winAmount = 0;
      if(rouletteBetType.value === 'color'){
        if(rouletteColor.value === resultColor){
          winAmount = resultColor === 'green' ? bet * 14 : bet * 2;
        }
      } else {
        const chosenNumber = parseInt(rouletteNumber.value, 10);
        if(!Number.isNaN(chosenNumber) && chosenNumber === resultNumber){
          winAmount = bet * 36;
        }
      }

      if(winAmount > 0){
        currentUser.credits += winAmount;
        applyLuckyCoinProgress(winAmount);
        recordGameResult('roulette', 'win', winAmount);
        updateTracking('roulette', { netAmount: winAmount - bet });
        rouletteStatus.textContent = `Je wint ${winAmount} credits!`;
        showGameResultOverlay({
          outcome: 'win',
          title: 'Roulette: winst!',
          message: `Je wint ${winAmount} credits.`
        });
      } else {
        recordGameResult('roulette', 'lose');
        updateTracking('roulette', { netAmount: -bet });
        rouletteStatus.textContent = 'Helaas, geen winst deze draai.';
        showGameResultOverlay({
          outcome: 'lose',
          title: 'Roulette: verlies',
          message: 'Geen winst deze draai.'
        });
      }

      await saveCurrentUser();
      renderDashboard();
      rouletteWheelRotation = (rouletteWheelRotation + finalRotation) % 360;
      rouletteBallRotation = (rouletteBallRotation - (spinTurns * 360 + ballTargetAngle)) % 360;
      rouletteSpinning = false;
      spinRouletteBtn.disabled = false;
      rouletteBetInput.disabled = false;
      rouletteBetType.disabled = false;
      updateRouletteInputs();
    };

    /* ---------------------------
       Slots logic
       --------------------------- */
    const slotSymbols = ['ðŸ’','ðŸ‹','ðŸ””','ðŸ€','â­','ðŸ’Ž','7ï¸âƒ£','ðŸ‡'];
    const slotReelStrips = [slotReelOne, slotReelTwo, slotReelThree];
    const slotReelContainers = slotReelStrips.map(strip => strip.parentElement);
    const slotSymbolSize = 72;
    const slotRepeats = 6;
    let slotsSpinning = false;

    function buildSlotReel(strip){
      strip.innerHTML = '';
      const fragment = document.createDocumentFragment();
      for(let i = 0; i < slotRepeats; i++){
        slotSymbols.forEach(symbol => {
          const div = document.createElement('div');
          div.className = 'slot-symbol';
          div.textContent = symbol;
          fragment.appendChild(div);
        });
      }
      strip.appendChild(fragment);
    }

    slotReelStrips.forEach(buildSlotReel);

    function spinSlotReel(strip, container, stopIndex, duration, loops){
      return new Promise((resolve)=>{
        const finalIndex = (loops * slotSymbols.length) + stopIndex;
        const offset = -(finalIndex * slotSymbolSize);
        container.classList.add('spinning');
        strip.style.transition = 'none';
        strip.style.transform = 'translateY(0px)';
        void strip.offsetHeight;
        strip.style.transition = `transform ${duration}ms cubic-bezier(0.15, 0.65, 0.2, 1)`;
        strip.style.transform = `translateY(${offset}px)`;
        strip.addEventListener('transitionend', () => {
          container.classList.remove('spinning');
          resolve();
        }, { once: true });
      });
    }

    async function spinSlots(){
      if(slotsSpinning) return;
      if(!currentUser) return showSiteMessage('Je moet eerst inloggen!');
      const bet = parseInt(slotsBetInput.value) || 0;
      if(bet < 10) return showSiteMessage('Minimum inzet is 10 credits.');
      if(currentUser.credits < bet) return showSiteMessage('Je hebt niet genoeg credits!');

      currentUser.credits -= bet;
      updateTracking('slots', { betAmount: bet, gamesPlayed: 1 });
      await saveCurrentUser();
      renderDashboard();

      slotsSpinning = true;
      spinSlotsBtn.disabled = true;
      spinSlotsBtn.classList.remove('pulling');
      void spinSlotsBtn.offsetHeight;
      spinSlotsBtn.classList.add('pulling');
      slotsStatus.classList.remove('slots-win');
      slotsStatus.textContent = 'De rollen draaien...';

      const results = slotReelStrips.map(() => Math.floor(Math.random() * slotSymbols.length));
      const spinPromises = slotReelStrips.map((strip, index) => {
        const loops = 3 + index;
        const duration = 1200 + (index * 350);
        return spinSlotReel(strip, slotReelContainers[index], results[index], duration, loops);
      });

      await Promise.all(spinPromises);

      const [first, second, third] = results;
      let winAmount = 0;
      if(first === second && second === third){
        const symbol = slotSymbols[first];
        const multiplier = symbol === '7ï¸âƒ£' ? 20 : symbol === 'ðŸ’Ž' ? 15 : 10;
        winAmount = bet * multiplier;
      } else if(first === second || first === third || second === third){
        winAmount = bet * 2;
      }

      if(winAmount > 0){
        currentUser.credits += winAmount;
        applyLuckyCoinProgress(winAmount);
        recordGameResult('slots', 'win', winAmount);
        updateTracking('slots', { netAmount: winAmount - bet });
        slotsStatus.textContent = `Winst! Je ontvangt ${winAmount} credits.`;
        slotsStatus.classList.add('slots-win');
        showGameResultOverlay({
          outcome: 'win',
          title: 'Slots: winst!',
          message: `Je ontvangt ${winAmount} credits.`
        });
      } else {
        recordGameResult('slots', 'lose');
        updateTracking('slots', { netAmount: -bet });
        slotsStatus.textContent = 'Geen match deze spin. Probeer opnieuw.';
        showGameResultOverlay({
          outcome: 'lose',
          title: 'Slots: verlies',
          message: 'Geen match deze spin.'
        });
      }

      await saveCurrentUser();
      renderDashboard();
      slotsSpinning = false;
      spinSlotsBtn.disabled = false;
    }

    spinSlotsBtn.onclick = ()=>{ void spinSlots(); };

    /* ---------------------------
       Plinko logic
       --------------------------- */
    const plinkoSlotMultipliers = [8, 4, 2.4, 1.2, 0.9 , 0.7, 0.5, 0.7, 0.9, 1.2, 2.4, 4, 8];
    const plinkoPegRows = 9;
    const plinkoBallMin = 1;
    const plinkoBallMax = 10;
    let plinkoBallCount = 10;
    const plinkoBallRadius = 9;
    const plinkoPegRadius = 6;
    const plinkoGravity = 0.19;
    const plinkoBounce = 0.72;
    const plinkoCenterBias = 0;
    let plinkoDropping = false;
    let plinkoPegPoints = [];
    let plinkoBoardMetrics = null;
    let plinkoActiveBalls = [];
    let plinkoAnimationId = null;
    let plinkoActiveBatch = null;

    function updatePlinkoPerBallLabel(){
      if(!plinkoPerBall || !plinkoBetInput) return;
      const totalBet = parseInt(plinkoBetInput.value, 10) || 0;
      const ballCount = syncPlinkoBallCount();
      const perBall = ballCount > 0 ? totalBet / ballCount : 0;
      const displayValue = Number.isInteger(perBall) ? perBall : perBall.toFixed(2);
      plinkoPerBall.textContent = `Per bal: ${displayValue} credits`;
    }

    function syncPlinkoBallCount(){
      if(!plinkoBallCountInput) return plinkoBallCount;
      const rawValue = parseInt(plinkoBallCountInput.value, 10);
      const safeValue = Number.isFinite(rawValue) ? rawValue : plinkoBallCount;
      const clamped = Math.max(plinkoBallMin, Math.min(plinkoBallMax, safeValue));
      plinkoBallCount = clamped;
      plinkoBallCountInput.value = clamped;
      return plinkoBallCount;
    }

    function renderPlinkoSlots(){
      if(!plinkoSlots || !plinkoMultipliers) return;
      plinkoSlots.innerHTML = '';
      plinkoMultipliers.innerHTML = '';
      plinkoSlotMultipliers.forEach((multiplier)=>{
        const slot = document.createElement('div');
        slot.className = 'plinko-slot';
        plinkoSlots.appendChild(slot);
        const label = document.createElement('div');
        label.className = 'plinko-multiplier';
        label.textContent = `${multiplier}x`;
        plinkoMultipliers.appendChild(label);
      });
    }

    function layoutPlinkoPegs(){
      if(!plinkoPegs || !plinkoBoard) return;
      plinkoPegs.innerHTML = '';
      const boardRect = plinkoBoard.getBoundingClientRect();
      const pegRect = plinkoPegs.getBoundingClientRect();
      const pegAreaHeight = pegRect.height;
      const pegAreaWidth = pegRect.width;
      plinkoPegPoints = [];
      for(let row = 0; row < plinkoPegRows; row += 1){
        const cols = 8 + row;
        for(let col = 0; col < cols; col += 1){
          const peg = document.createElement('div');
          peg.className = 'plinko-peg';
          const x = ((col + 1) / (cols + 1)) * pegAreaWidth;
          const y = ((row + 1) / (plinkoPegRows + 1)) * pegAreaHeight;
          peg.style.left = `${x}px`;
          peg.style.top = `${y}px`;
          plinkoPegs.appendChild(peg);
          plinkoPegPoints.push({
            x: x + (pegRect.left - boardRect.left),
            y: y + (pegRect.top - boardRect.top)
          });
        }
      }
      const centerPeg = document.createElement('div');
      centerPeg.className = 'plinko-peg';
      const centerX = pegAreaWidth / 2;
      const centerY = pegAreaHeight * 0.08;
      centerPeg.style.left = `${centerX}px`;
      centerPeg.style.top = `${centerY}px`;
      plinkoPegs.appendChild(centerPeg);
      plinkoPegPoints.push({
        x: centerX + (pegRect.left - boardRect.left),
        y: centerY + (pegRect.top - boardRect.top)
      });
      const slotHeight = plinkoSlots?.getBoundingClientRect().height || 96;
      plinkoBoardMetrics = {
        width: boardRect.width,
        height: boardRect.height,
        slotWidth: boardRect.width / plinkoSlotMultipliers.length,
        slotHeight,
        centerX: boardRect.width / 2,
        landingY: boardRect.height - slotHeight + plinkoBallRadius
      };
    }

    function highlightPlinkoSlot(index){
      if(!plinkoSlots) return;
      [...plinkoSlots.children].forEach((slot, idx)=>{
        slot.classList.toggle('active', idx === index);
      });
      if(plinkoMultipliers){
        [...plinkoMultipliers.children].forEach((label, idx)=>{
          label.classList.toggle('active', idx === index);
        });
      }
    }

    function gaussianRandom(mean, deviation){
      let u = 0;
      let v = 0;
      while(u === 0) u = Math.random();
      while(v === 0) v = Math.random();
      const value = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
      return value * deviation + mean;
    }

    function spawnPlinkoBall(){
      if(!plinkoBoardMetrics) return;
      const startSpread = plinkoBoardMetrics.width * 0.04;
      const startX = Math.min(
        plinkoBoardMetrics.width - plinkoBallRadius,
        Math.max(
          plinkoBallRadius,
          gaussianRandom(plinkoBoardMetrics.centerX, startSpread)
        )
      );
      const ball = document.createElement('div');
      ball.className = 'plinko-ball';
      plinkoBoard.appendChild(ball);
      const ballState = {
        el: ball,
        x: startX,
        y: plinkoBallRadius + 8,
        vx: (Math.random() - 0.5) * 0.8,
        vy: 0,
        settled: false
      };
      plinkoActiveBalls.push(ballState);
      renderPlinkoBall(ballState);
    }

    function renderPlinkoBall(ballState){
      ballState.el.style.left = `${ballState.x - plinkoBallRadius}px`;
      ballState.el.style.top = `${ballState.y - plinkoBallRadius}px`;
    }

    function settlePlinkoBall(ballState, slotIndex){
      if(!plinkoActiveBatch) return;
      ballState.settled = true;
      highlightPlinkoSlot(slotIndex);
      const multiplier = plinkoSlotMultipliers[slotIndex];
      const winAmount = Math.round(plinkoActiveBatch.perBallBet * multiplier);
      plinkoActiveBatch.totalWin += winAmount;
      plinkoActiveBatch.landed += 1;
      plinkoStatus.textContent = `Bal ${plinkoActiveBatch.landed}/${plinkoBallCount} landt op ${multiplier}x.`;
      setTimeout(() => {
        ballState.el.remove();
      }, 400);
    }

    async function finishPlinkoBatch(){
      if(!plinkoActiveBatch) return;
      const totalWin = plinkoActiveBatch.totalWin;
      if(totalWin > 0){
        currentUser.credits += totalWin;
        applyLuckyCoinProgress(totalWin);
      }
      const net = totalWin - plinkoActiveBatch.totalBet;
      const outcome = totalWin >= plinkoActiveBatch.totalBet ? 'win' : 'lose';
      recordGameResult('plinko', outcome, totalWin);
      updateTracking('plinko', { netAmount: net });
      plinkoStatus.textContent = `Alle ${plinkoBallCount} ballen klaar. Totale winst: ${totalWin} credits (netto ${net}).`;
      showGameResultOverlay({
        outcome,
        title: outcome === 'win' ? 'Plinko: winst!' : 'Plinko: verlies',
        message: `Totale winst: ${totalWin} credits (netto ${net}).`
      });
      await saveCurrentUser();
      renderDashboard();
      plinkoDropping = false;
      dropPlinkoBtn.disabled = false;
      if(plinkoBallCountInput) plinkoBallCountInput.disabled = false;
      plinkoActiveBatch = null;
    }

    function updatePlinkoBalls(delta){
      if(!plinkoBoardMetrics) return;
      const ballCount = plinkoActiveBalls.length;
      if(ballCount === 0) return;
      const maxX = plinkoBoardMetrics.width - plinkoBallRadius;
      const minX = plinkoBallRadius;
      for(let i = plinkoActiveBalls.length - 1; i >= 0; i -= 1){
        const ball = plinkoActiveBalls[i];
        if(ball.settled) continue;
        ball.vy += plinkoGravity * delta;
        ball.vx += (plinkoBoardMetrics.centerX - ball.x) * plinkoCenterBias * delta;
        ball.x += ball.vx * delta;
        ball.y += ball.vy * delta;

        if(ball.x <= minX){
          ball.x = minX;
          ball.vx *= -0.5;
        }
        if(ball.x >= maxX){
          ball.x = maxX;
          ball.vx *= -0.5;
        }

        for(const peg of plinkoPegPoints){
          const dx = ball.x - peg.x;
          const dy = ball.y - peg.y;
          const distance = Math.hypot(dx, dy);
          const minDistance = plinkoBallRadius + plinkoPegRadius;
          if(distance > 0 && distance < minDistance){
            const nx = dx / distance;
            const ny = dy / distance;
            const overlap = minDistance - distance;
            ball.x += nx * overlap;
            ball.y += ny * overlap;
            const dot = ball.vx * nx + ball.vy * ny;
            if(dot < 0){
              ball.vx -= 2 * dot * nx;
              ball.vy -= 2 * dot * ny;
            }
            ball.vx *= plinkoBounce;
            ball.vy *= plinkoBounce;
            ball.vx += (Math.random() - 0.5) * 0.2;
          }
        }

        if(ball.y >= plinkoBoardMetrics.landingY){
          const slotIndex = Math.max(
            0,
            Math.min(
              plinkoSlotMultipliers.length - 1,
              Math.floor(ball.x / plinkoBoardMetrics.slotWidth)
            )
          );
          settlePlinkoBall(ball, slotIndex);
          plinkoActiveBalls.splice(i, 1);
          continue;
        }

        renderPlinkoBall(ball);
      }

      if(plinkoActiveBatch && plinkoActiveBatch.landed >= plinkoBallCount && plinkoActiveBalls.length === 0){
        void finishPlinkoBatch();
      }
    }

    function startPlinkoAnimation(){
      if(plinkoAnimationId) return;
      let lastTime = null;
      const step = (timestamp) => {
        if(lastTime === null) lastTime = timestamp;
        const delta = Math.min(2, (timestamp - lastTime) / 16.67);
        lastTime = timestamp;
        updatePlinkoBalls(delta);
        if(plinkoActiveBalls.length > 0){
          plinkoAnimationId = requestAnimationFrame(step);
        } else {
          plinkoAnimationId = null;
        }
      };
      plinkoAnimationId = requestAnimationFrame(step);
    }

    async function dropPlinkoBall(){
      if(plinkoDropping) return;
      if(!currentUser) return showSiteMessage('Je moet eerst inloggen!');
      const totalBet = parseInt(plinkoBetInput.value, 10) || 0;
      if(totalBet < 10) return showSiteMessage('Minimum inzet is 10 credits.');
      syncPlinkoBallCount();
      const perBallBet = totalBet / plinkoBallCount;
      if(currentUser.credits < totalBet) return showSiteMessage('Je hebt niet genoeg credits!');

      currentUser.credits -= totalBet;
      updateTracking('plinko', { betAmount: totalBet, gamesPlayed: 1 });
      await saveCurrentUser();
      renderDashboard();

      plinkoDropping = true;
      dropPlinkoBtn.disabled = true;
      if(plinkoBallCountInput) plinkoBallCountInput.disabled = true;
      highlightPlinkoSlot(-1);
      const displayPerBall = Number.isInteger(perBallBet) ? perBallBet : perBallBet.toFixed(2);
      plinkoStatus.textContent = `Dropping ${plinkoBallCount} ballen. Totale inzet ${totalBet} credits (${displayPerBall} per bal).`;
      plinkoActiveBatch = {
        perBallBet,
        totalBet,
        totalWin: 0,
        landed: 0
      };

      layoutPlinkoPegs();
      for(let i = 0; i < plinkoBallCount; i += 1){
        spawnPlinkoBall();
        startPlinkoAnimation();
        await new Promise(resolve => setTimeout(resolve, 140));
      }
    }

    window.addEventListener('resize', ()=>{ layoutPlinkoPegs(); });
    renderPlinkoSlots();
    layoutPlinkoPegs();
    dropPlinkoBtn.onclick = ()=>{ void dropPlinkoBall(); };
    plinkoBetInput.addEventListener('input', updatePlinkoPerBallLabel);
    plinkoBallCountInput?.addEventListener('input', updatePlinkoPerBallLabel);
    updatePlinkoPerBallLabel();

    /* ---------------------------
       Blackjack logic
       --------------------------- */
    const bjSuits = ['â™ ','â™¥','â™¦','â™£'];
    const bjValues = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    const bjShoeDecks = 6;
    let bjShoeCards = [];

    function bjShuffle(cards){
      for(let i = cards.length - 1; i > 0; i -= 1){
        const j = Math.floor(Math.random() * (i + 1));
        [cards[i], cards[j]] = [cards[j], cards[i]];
      }
    }

    function bjBuildShoe(){
      bjShoeCards = [];
      for(let d = 0; d < bjShoeDecks; d += 1){
        for(const suit of bjSuits){
          for(const value of bjValues){
            bjShoeCards.push({ suit, value });
          }
        }
      }
      bjShuffle(bjShoeCards);
      updateShoeCount();
    }

    function updateShoeCount(){
      bjShoeCount.textContent = `Shoe: ${bjShoeCards.length} kaarten`;
    }

    function bjDrawCard(){
      if(bjShoeCards.length < 30){
        bjBuildShoe();
      }
      const card = bjShoeCards.pop();
      updateShoeCount();
      return card;
    }

    function bjCardValue(card){
      if(['J','Q','K'].includes(card.value)) return 10;
      if(card.value === 'A') return 11;
      return parseInt(card.value, 10);
    }

    function bjHandValue(hand){
      let total = 0;
      let aces = 0;
      hand.forEach(card=>{
        total += bjCardValue(card);
        if(card.value === 'A') aces += 1;
      });
      while(total > 21 && aces > 0){
        total -= 10;
        aces -= 1;
      }
      return total;
    }

    function wait(ms){
      return new Promise(resolve=>setTimeout(resolve, ms));
    }

    function isRedSuit(suit){
      return suit === 'â™¥' || suit === 'â™¦';
    }

    let bjPlayers = [];
    const bjDealer = { hand: [] };
    let bjCurrentIndex = 0;
    let bjBet = 100;
    let bjRoundActive = false;
    let bjAnimating = false;
    let bjDealerReveal = false;
    let bjHasStarted = false;

    function updateStartGameLabel(){
      startGameBtn.textContent = bjHasStarted ? 'Volgende ronde' : 'Start ronde';
    }

    function createCardMarkup(card){
      const red = isRedSuit(card.suit);
      return `
        <div class="bj-card ${red ? 'red' : ''}">
          <div class="corner">${card.value}${card.suit}</div>
          <div class="center">${card.value}${card.suit}</div>
        </div>
      `;
    }

    function createCardBackMarkup(){
      return `<div class="bj-card is-back"></div>`;
    }

    function renderDealer(){
      const cardsHtml = bjDealer.hand.map(card=>{
        if(card.hidden){
          return createCardBackMarkup();
        }
        return createCardMarkup(card);
      }).join('');
      bjDealerHand.innerHTML = cardsHtml || '';
      const score = bjDealerReveal ? bjHandValue(bjDealer.hand) : '?';
      bjDealerScore.textContent = `Score: ${score}`;
    }

    function renderPlayers(){
      bjPlayersArea.innerHTML = bjPlayers.map((player, index)=>{
        const score = player.busted ? 'Bust' : bjHandValue(player.hand);
        const cardsHtml = player.hand.map(card=>createCardMarkup(card)).join('');
        return `
          <div class="bj-seat ${index === bjCurrentIndex && bjRoundActive ? 'active' : ''}" data-player-index="${index}">
            <h3>${player.name}</h3>
            <div class="bj-hand">${cardsHtml}</div>
            <div class="bj-score">Score: ${score}</div>
          </div>
        `;
      }).join('');
    }

    function renderBlackjack(){
      renderDealer();
      renderPlayers();
      setBlackjackControls();
    }

    function setBlackjackControls(){
      const isUserTurn = bjRoundActive && !bjAnimating && bjCurrentIndex === 0 && !bjDealerReveal;
      hitBtn.disabled = !isUserTurn;
      standBtn.disabled = !isUserTurn;
      startGameBtn.disabled = bjRoundActive || bjAnimating;
    }

    function animateDealTo(targetEl){
      if(!bjShoe || !targetEl) return Promise.resolve();
      const stackRect = bjShoe.getBoundingClientRect();
      const targetRect = targetEl.getBoundingClientRect();
      const flight = document.createElement('div');
      flight.className = 'bj-fly-card';
      flight.style.left = `${stackRect.left}px`;
      flight.style.top = `${stackRect.top}px`;
      document.body.appendChild(flight);
      const deltaX = targetRect.left - stackRect.left;
      const deltaY = targetRect.top - stackRect.top;

      return new Promise(resolve=>{
        requestAnimationFrame(()=>{
          flight.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
          flight.style.opacity = '0';
        });
        const cleanup = ()=>{
          flight.remove();
          resolve();
        };
        flight.addEventListener('transitionend', cleanup, { once: true });
        setTimeout(cleanup, 700);
      });
    }

    async function dealCardToPlayer(index){
      const card = bjDrawCard();
      bjPlayers[index].hand.push({ ...card });
      renderBlackjack();
      const seat = bjPlayersArea.querySelector(`[data-player-index="${index}"] .bj-hand`);
      const cardEl = seat?.lastElementChild;
      await animateDealTo(cardEl);
    }

    async function dealCardToDealer({ hidden = false } = {}){
      const card = bjDrawCard();
      bjDealer.hand.push({ ...card, hidden });
      renderBlackjack();
      const cardEl = bjDealerHand?.lastElementChild;
      await animateDealTo(cardEl);
    }

    async function dealInitialCards(){
      bjAnimating = true;
      setBlackjackControls();
      for(let round = 0; round < 2; round += 1){
        for(let i = 0; i < bjPlayers.length; i += 1){
          await dealCardToPlayer(i);
          await wait(120);
        }
        await dealCardToDealer({ hidden: round === 0 });
        await wait(160);
      }
      bjAnimating = false;
      setBlackjackControls();
    }

    function advanceTurn(){
      do {
        bjCurrentIndex += 1;
      } while(bjCurrentIndex < bjPlayers.length && (bjPlayers[bjCurrentIndex].busted || bjPlayers[bjCurrentIndex].standing));
    }

    async function nextPlayer(){
      advanceTurn();
      if(bjCurrentIndex >= bjPlayers.length){
        await dealerTurn();
        return;
      }
      const current = bjPlayers[bjCurrentIndex];
      if(current.bot){
        await botTurn(current);
      } else {
        bjStatus.textContent = 'Jij bent aan de beurt.';
        renderBlackjack();
      }
    }

    async function botTurn(bot){
      bjAnimating = true;
      setBlackjackControls();
      bjStatus.textContent = `${bot.name} denkt na...`;
      await wait(400);
      while(bjHandValue(bot.hand) < 16){
        await dealCardToPlayer(bjCurrentIndex);
        await wait(220);
        if(bjHandValue(bot.hand) > 21){
          bot.busted = true;
          break;
        }
      }
      if(!bot.busted){
        bot.standing = true;
      }
      bjAnimating = false;
      renderBlackjack();
      await wait(200);
      await nextPlayer();
    }

    async function dealerTurn(){
      bjAnimating = true;
      bjDealerReveal = true;
      bjDealer.hand.forEach(card=>{ card.hidden = false; });
      renderBlackjack();
      bjStatus.textContent = 'Dealer speelt de hand.';
      await wait(500);
      while(bjHandValue(bjDealer.hand) < 17){
        await dealCardToDealer();
        await wait(220);
      }
      bjAnimating = false;
      renderBlackjack();
      checkWinners();
    }

    function checkWinners(){
      const dealerScore = bjHandValue(bjDealer.hand);
      const results = [];
      let userOutcome = null;
      let userDelta = 0;

      bjPlayers.forEach((player, index)=>{
        const playerScore = bjHandValue(player.hand);
        let outcome = 'lose';
        if(player.busted){
          outcome = 'lose';
        } else if(dealerScore > 21 || playerScore > dealerScore){
          outcome = 'win';
        } else if(playerScore === dealerScore){
          outcome = 'push';
        }

      if(index === 0 && currentUser){
        let delta = 0;
        if(outcome === 'win') delta = Math.floor(bjBet * (player.blackjack ? 2.5 : 2));
        if(outcome === 'push') delta = bjBet;
        currentUser.credits += delta;
          if(outcome === 'win'){
            applyLuckyCoinProgress(delta);
          }
          currentUser.gamesPlayed = (currentUser.gamesPlayed || 0) + 1;
          if(outcome === 'win'){
            currentUser.wins = (currentUser.wins || 0) + 1;
            currentUser.totalEarned = (currentUser.totalEarned || 0) + delta;
            currentUser.bjWins = (currentUser.bjWins || 0) + 1;
          } else if(outcome === 'lose'){
            currentUser.losses = (currentUser.losses || 0) + 1;
            currentUser.bjLosses = (currentUser.bjLosses || 0) + 1;
        }
        currentUser.bjGames = (currentUser.bjGames || 0) + 1;
        userOutcome = outcome;
        userDelta = delta;
        updateTracking('blackjack', { netAmount: delta - bjBet });
      }

        const text = outcome === 'win'
          ? `${player.name} wint`
          : outcome === 'push'
            ? `${player.name} speelt gelijk`
            : `${player.name} verliest`;
        results.push(text);
      });

      bjStatus.textContent = `Dealer heeft ${dealerScore}. ${results.join('. ')}.`;
      bjRoundActive = false;
      setBlackjackControls();
      if(currentUser){
        saveCurrentUser().then(renderDashboard);
      }
      if(userOutcome){
        const outcomeLabel = userOutcome === 'win'
          ? `Je wint ${userDelta} credits.`
          : userOutcome === 'push'
            ? 'Gelijkspel! Je krijgt je inzet terug.'
            : 'Helaas, je verliest deze ronde.';
        showGameResultOverlay({
          outcome: userOutcome === 'push' ? 'push' : userOutcome,
          title: userOutcome === 'win' ? 'Blackjack: winst!' : userOutcome === 'push' ? 'Blackjack: gelijkspel' : 'Blackjack: verlies',
          message: outcomeLabel,
          showActions: true,
          onPlayAgain: () => { void startRound(); },
          onMainMenu: () => { backToMenuBtn?.click(); }
        });
      }
    }

    async function startRound(){
      if(!currentUser) return;
      hideGameResultOverlay();
      const requestedBet = parseInt(betAmountInput.value, 10) || 100;
      if(currentUser.credits < requestedBet){
        showSiteMessage('Je hebt niet genoeg credits voor deze inzet.');
        return;
      }
      bjBet = requestedBet;
      currentUser.credits -= bjBet;
      updateTracking('blackjack', { betAmount: bjBet, gamesPlayed: 1 });
      saveCurrentUser().then(renderDashboard);

      bjDealerReveal = false;
      bjRoundActive = true;
      bjCurrentIndex = 0;
      bjDealer.hand = [];
      bjPlayers.forEach(player=>{
        player.hand = [];
        player.busted = false;
        player.standing = false;
        player.blackjack = false;
      });

      if(bjShoeCards.length === 0){
        bjBuildShoe();
      }

      bjStatus.textContent = 'Kaarten worden gedeeld...';
      renderBlackjack();
      await dealInitialCards();
      if(bjHandValue(bjPlayers[0].hand) === 21){
        bjPlayers[0].blackjack = bjPlayers[0].hand.length === 2;
        bjPlayers[0].standing = true;
        await nextPlayer();
        return;
      }
      bjStatus.textContent = 'Jij bent aan de beurt.';
      renderBlackjack();
      if(bjPlayers[0].bot){
        await botTurn(bjPlayers[0]);
      }
    }

    function resetBlackjackSession(){
      bjHasStarted = false;
      bjRoundActive = false;
      bjAnimating = false;
      bjDealerReveal = false;
      bjCurrentIndex = 0;
      bjPlayers = [];
      bjDealer.hand = [];
      bjStatus.textContent = 'Kies je inzet en start de ronde.';
      updateStartGameLabel();
      renderBlackjack();
    }

    startGameBtn.onclick = ()=>{
      if(!currentUser) return showSiteMessage('Je moet eerst inloggen!');
      const botCount = parseInt(botSelect.value, 10);
      bjPlayers = [{ name: currentUser.name, bot: false, hand: [], busted: false, standing: false, blackjack: false }];
      for(let i = 1; i <= botCount; i += 1){
        bjPlayers.push({ name: `Bot ${i}`, bot: true, hand: [], busted: false, standing: false, blackjack: false });
      }
      startRound();
    };

    hitBtn.onclick = async ()=>{
      if(hitBtn.disabled) return;
      bjAnimating = true;
      setBlackjackControls();
      await dealCardToPlayer(bjCurrentIndex);
      const score = bjHandValue(bjPlayers[bjCurrentIndex].hand);
      if(score > 21){
        bjPlayers[bjCurrentIndex].busted = true;
        bjStatus.textContent = 'Bust! Je bent uitgespeeld.';
        bjAnimating = false;
        renderBlackjack();
        await nextPlayer();
        return;
      }
      if(score === 21){
        bjPlayers[bjCurrentIndex].standing = true;
        bjAnimating = false;
        renderBlackjack();
        await nextPlayer();
        return;
      }
      bjAnimating = false;
      renderBlackjack();
    };

    standBtn.onclick = ()=>{
      if(standBtn.disabled) return;
      bjPlayers[bjCurrentIndex].standing = true;
      bjStatus.textContent = 'Je past. Volgende speler...';
      renderBlackjack();
      void nextPlayer();
    };

    bjBuildShoe();
    renderBlackjack();
    updateStartGameLabel();

    /* ---------------------------
       Poker logic (casino stijl)
       --------------------------- */

    const pkSuits = ['â™ ','â™¥','â™¦','â™£'];
    const pkValues = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    const pkValueMap = {2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:11,Q:12,K:13,A:14};
    let pkDeck = [];

    function pkCreateDeck(){
      pkDeck = [];
      for(const s of pkSuits) for(const v of pkValues) pkDeck.push({suit:s,value:v});
      for(let i=pkDeck.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [pkDeck[i],pkDeck[j]]=[pkDeck[j],pkDeck[i]];
      }
    }

    let pokerPlayers = [];
    let pokerPot = 0;
    let pokerCommunity = [];
    let pokerCurrentPlayerIndex = 0;
    let pokerTableMin = 500;
    let pokerTurnLocked = false;
    let pokerDealerIndex = 0;
    let pokerSmallBlind = 50;
    let pokerBigBlind = 100;
    let pokerCurrentBet = 0;
    let pokerMinRaise = 0;
    let pokerStage = 'Pre-flop';
    let pokerRevealHands = false;
    let pokerHandActive = false;
    let pokerSmallBlindIndex = 0;
    let pokerBigBlindIndex = 0;
    let pokerDesiredBots = 3;

    function pkDraw(){ return pkDeck.pop(); }

    function pkFormatCard(card){
      const isRed = card.suit === 'â™¥' || card.suit === 'â™¦';
      const colorClass = isRed ? 'card-red' : '';
      return `
        <span class="card-corner ${colorClass}">${card.value}${card.suit}</span>
        <span class="card-center ${colorClass}">${card.suit}</span>
        <span class="card-corner bottom ${colorClass}">${card.value}${card.suit}</span>
      `;
    }

    function pkValueNum(value){
      return pkValueMap[value] || parseInt(value, 10);
    }

    function pkGetStraightHigh(values){
      const unique = Array.from(new Set(values)).sort((a,b)=>b-a);
      if(unique.includes(14)) unique.push(1);
      for(let i=0;i<=unique.length-5;i++){
        let run=true;
        for(let j=1;j<5;j++){
          if(unique[i+j] !== unique[i]-j){ run=false; break; }
        }
        if(run) return unique[i];
      }
      return null;
    }

    function pkEvaluateHand(cards){
      const values = cards.map(c=>pkValueNum(c.value));
      const suits = {};
      cards.forEach(c=>{
        suits[c.suit] = suits[c.suit] || [];
        suits[c.suit].push(pkValueNum(c.value));
      });

      const counts = {};
      values.forEach(v=>{ counts[v]=(counts[v]||0)+1; });
      const entries = Object.entries(counts)
        .map(([value,count])=>({value:Number(value),count}))
        .sort((a,b)=>b.count-a.count || b.value-a.value);

      const flushSuit = Object.keys(suits).find(s=>suits[s].length>=5);
      let flushValues = [];
      if(flushSuit){
        flushValues = suits[flushSuit].slice().sort((a,b)=>b-a);
      }

      const straightHigh = pkGetStraightHigh(values);
      let straightFlushHigh = null;
      if(flushSuit){
        straightFlushHigh = pkGetStraightHigh(flushValues);
      }

      if(straightFlushHigh){
        return {rank:8, tiebreak:[straightFlushHigh], name:'Straight flush'};
      }

      const four = entries.find(e=>e.count===4);
      if(four){
        const kicker = entries.find(e=>e.value!==four.value).value;
        return {rank:7, tiebreak:[four.value, kicker], name:'Four of a kind'};
      }

      const trips = entries.filter(e=>e.count===3).map(e=>e.value);
      const pairs = entries.filter(e=>e.count===2).map(e=>e.value);
      if(trips.length && (pairs.length || trips.length>1)){
        const tripValue = trips[0];
        const pairValue = pairs[0] || trips[1];
        return {rank:6, tiebreak:[tripValue, pairValue], name:'Full house'};
      }

      if(flushSuit){
        return {rank:5, tiebreak:flushValues.slice(0,5), name:'Flush'};
      }

      if(straightHigh){
        return {rank:4, tiebreak:[straightHigh], name:'Straight'};
      }

      if(trips.length){
        const kickers = entries.filter(e=>e.value!==trips[0]).map(e=>e.value).sort((a,b)=>b-a);
        return {rank:3, tiebreak:[trips[0], ...kickers.slice(0,2)], name:'Three of a kind'};
      }

      if(pairs.length>=2){
        const highPair = pairs[0];
        const lowPair = pairs[1];
        const kicker = entries.find(e=>e.value!==highPair && e.value!==lowPair).value;
        return {rank:2, tiebreak:[highPair, lowPair, kicker], name:'Two pair'};
      }

      if(pairs.length){
        const pairValue = pairs[0];
        const kickers = entries.filter(e=>e.value!==pairValue).map(e=>e.value).sort((a,b)=>b-a);
        return {rank:1, tiebreak:[pairValue, ...kickers.slice(0,3)], name:'Pair'};
      }

      const topValues = values.slice().sort((a,b)=>b-a).slice(0,5);
      return {rank:0, tiebreak:topValues, name:'High card'};
    }

    function pkCompareHands(a,b){
      if(a.rank !== b.rank) return a.rank - b.rank;
      for(let i=0;i<Math.max(a.tiebreak.length,b.tiebreak.length);i++){
        const diff = (a.tiebreak[i]||0) - (b.tiebreak[i]||0);
        if(diff !== 0) return diff;
      }
      return 0;
    }

    function pokerActivePlayers(){
      return pokerPlayers.filter(p=>!p.folded);
    }

    function pokerNextIndex(startIndex){
      if(pokerPlayers.length === 0) return -1;
      return (startIndex + 1) % pokerPlayers.length;
    }

    function pokerNextActiveIndex(startIndex, {includeAllIn=false} = {}){
      if(pokerPlayers.length === 0) return -1;
      let idx = startIndex;
      for(let i=0;i<pokerPlayers.length;i++){
        idx = pokerNextIndex(idx);
        const player = pokerPlayers[idx];
        if(!player) continue;
        if(player.folded) continue;
        if(!includeAllIn && player.allIn) continue;
        if(player.stack <= 0 && !includeAllIn) continue;
        return idx;
      }
      return -1;
    }

    function pokerUpdateBlinds(){
      const baseBlind = Math.max(1, Math.floor(pokerTableMin * 0.02));
      pokerSmallBlind = baseBlind;
      pokerBigBlind = baseBlind * 2;
      pokerBlindsEl.textContent = `${pokerSmallBlind} / ${pokerBigBlind}`;
    }

    function pokerResetBettingRound(){
      pokerPlayers.forEach(p=>{
        p.bet = 0;
        p.actedThisRound = p.folded || p.allIn;
      });
      pokerCurrentBet = 0;
      pokerMinRaise = pokerBigBlind;
    }

    function pokerPostBlind(player, amount){
      if(!player || player.folded) return 0;
      const blind = Math.min(amount, player.stack);
      player.stack -= blind;
      player.bet += blind;
      player.committed += blind;
      pokerPot += blind;
      if(player.stack === 0) player.allIn = true;
      if(currentUser && player.key === currentUser.key){
        updateTracking('poker', { betAmount: blind });
      }
      return blind;
    }

    function pkRender(){
      pokerPotEl.textContent = pokerPot;
      pokerStageEl.textContent = pokerStage;
      pokerBlindsEl.textContent = `${pokerSmallBlind} / ${pokerBigBlind}`;

      const communitySlots = 5;
      const communityMarkup = pokerCommunity.map(c=>`<div class="card-pk">${pkFormatCard(c)}</div>`).join('');
      const placeholderMarkup = Array.from({length: communitySlots - pokerCommunity.length})
        .map(()=>'<div class="card-pk back"></div>').join('');
      pokerCommunityEl.innerHTML = communityMarkup + placeholderMarkup;

      const userIndex = pokerUserIndex();
      const userPlayer = userIndex !== -1 ? pokerPlayers[userIndex] : null;
      if(userPlayer){
        const isActing = pokerHandActive && userIndex === pokerCurrentPlayerIndex;
        const badges = [];
        if(userIndex === pokerDealerIndex) badges.push('D');
        if(userIndex === pokerSmallBlindIndex) badges.push('SB');
        if(userIndex === pokerBigBlindIndex) badges.push('BB');
        const showHand = pokerHandActive || userPlayer.hand.length;
        pokerUserSpotEl.innerHTML = `
          <h4>${userPlayer.name} (jij)
            <span class="poker-badges">${badges.map(b=>`<span>${b}</span>`).join('')}</span>
          </h4>
          <div class="hand">${userPlayer.hand.map(c=>showHand ? `<div class="card-pk">${pkFormatCard(c)}</div>` : '<div class="card-pk back"></div>').join('')}</div>
          <div class="poker-info-row">Stack: ${userPlayer.stack}</div>
          <div class="poker-info-row">Bet: ${userPlayer.bet} | Totaal: ${userPlayer.committed}</div>
          <div class="poker-seat-row">Seat ${userPlayer.seat} ${userPlayer.folded?'[FOLD]':''} ${userPlayer.allIn?'[ALL-IN]':''}</div>
          ${isActing ? '<div class="poker-seat-row">Aan zet</div>' : ''}
        `;
      } else {
        pokerUserSpotEl.innerHTML = '<small>Sluit je aan om jouw hand te zien.</small>';
      }

      let botCounter = 0;
      pokerPlayersEl.innerHTML = pokerPlayers
        .map((p,i)=>({ player: p, index: i }))
        .filter(({ player })=>!(currentUser && player.key === currentUser.key))
        .map(({ player, index })=>{
          const isActing = pokerHandActive && index === pokerCurrentPlayerIndex;
          const showHand = pokerRevealHands && !pokerHandActive;
          const badges = [];
          if(index===pokerDealerIndex) badges.push('D');
          if(index===pokerSmallBlindIndex) badges.push('SB');
          if(index===pokerBigBlindIndex) badges.push('BB');
          const botSlot = player.isBot ? ++botCounter : 0;
          const botSlotClass = player.isBot ? ` bot-slot-${botSlot}` : '';
          return `<div class="poker-player ${player.isBot ? 'bot' : ''}${botSlotClass} ${isActing ? 'active' : ''}">
            <h4>${player.name}
              <span class="poker-badges">${badges.map(b=>`<span>${b}</span>`).join('')}</span>
            </h4>
            <div class="hand">${player.hand.map(c=>showHand ? `<div class="card-pk">${pkFormatCard(c)}</div>` : '<div class="card-pk back"></div>').join('')}</div>
            <div class="poker-info-row">Stack: ${player.stack}</div>
            <div class="poker-info-row">Bet: ${player.bet} | Totaal: ${player.committed}</div>
            <div class="poker-seat-row">Seat ${player.seat} ${player.folded?'[FOLD]':''} ${player.allIn?'[ALL-IN]':''}</div>
          </div>`;
        }).join('');
    }

    function pokerUserIndex(){
      if(!currentUser) return -1;
      return pokerPlayers.findIndex(p=>p.key === currentUser.key);
    }

    function pokerIsUserTurn(){
      const idx = pokerUserIndex();
      return idx !== -1 && idx === pokerCurrentPlayerIndex;
    }

    function setPokerControlsEnabled(enabled){
      pokerCheckBtn.disabled = !enabled;
      pokerBetBtn.disabled = !enabled;
      pokerFoldBtn.disabled = !enabled;
      pokerBetAmountInput.disabled = !enabled;
    }

    function pokerUpdateActionLabels(){
      const player = pokerPlayers[pokerCurrentPlayerIndex];
      if(!player) return;
      const toCall = Math.max(0, pokerCurrentBet - player.bet);
      pokerCheckBtn.textContent = toCall === 0 ? 'Check' : `Call ${toCall}`;
      pokerBetBtn.textContent = pokerCurrentBet === 0 ? 'Bet' : 'Raise';
      const minRaiseTo = pokerCurrentBet === 0 ? pokerBigBlind : pokerCurrentBet + pokerMinRaise;
      pokerBetAmountInput.min = minRaiseTo;
      if(parseInt(pokerBetAmountInput.value, 10) < minRaiseTo){
        pokerBetAmountInput.value = minRaiseTo;
      }
    }

    function updatePokerTurnState(){
      const userCanAct = pokerIsUserTurn() && !pokerTurnLocked;
      setPokerControlsEnabled(userCanAct);
      pokerUpdateActionLabels();
      if(!pokerHandActive){
        pokerStatusEl.textContent = 'Wacht op spelers om de volgende hand te starten.';
        return;
      }
      if(!userCanAct && pokerPlayers[pokerCurrentPlayerIndex]){
        pokerStatusEl.textContent = `${pokerPlayers[pokerCurrentPlayerIndex].name} is aan zet...`;
      } else if(userCanAct){
        pokerStatusEl.textContent = 'Jij bent aan zet.';
      }
    }

    function pokerIsBettingRoundComplete(){
      const active = pokerPlayers.filter(p=>!p.folded && !p.allIn);
      if(active.length === 0) return true;
      return active.every(p=>p.bet === pokerCurrentBet && p.actedThisRound);
    }

    function pokerAwardPot(winners, handName){
      const potTotal = pokerPot;
      const share = Math.floor(potTotal / winners.length);
      const remainder = potTotal % winners.length;
      winners.forEach((winner, idx)=>{
        winner.stack += share + (idx === 0 ? remainder : 0);
      });
      const names = winners.map(w=>w.name).join(' & ');
      if(handName === 'folds'){
        pokerStatusEl.textContent = `${names} wint ${potTotal} omdat iedereen foldt.`;
      } else {
        pokerStatusEl.textContent = `${names} wint ${potTotal} met ${handName}.`;
      }
      pokerDealerStatusEl.textContent = `Pot uitbetaald aan ${names}.`;
      pokerPot = 0;
      pokerRevealHands = handName !== 'folds';
      return { potTotal, share, remainder };
    }

    function pokerHandleHandComplete({ winners, handName, potInfo }){
      pokerHandActive = false;
      pkRender();
      updatePokerTurnState();
      const userIdx = pokerUserIndex();
      if(userIdx === -1 || !currentUser) return;
      const user = pokerPlayers[userIdx];
      const netDelta = user.stack - (user.handStartStack ?? user.stack);
      const userWon = winners.some(w=>w.key === user.key);
      let winAmount = 0;
      if(userWon && potInfo){
        const winnerIndex = winners.findIndex(w=>w.key === user.key);
        winAmount = potInfo.share + (winnerIndex === 0 ? potInfo.remainder : 0);
        applyLuckyCoinProgress(winAmount);
      }
      recordGameResult('pk', userWon ? 'win' : 'lose', winAmount);
      updateTracking('poker', { netAmount: netDelta });
      saveCurrentUser().then(renderDashboard);
      const detail = handName === 'folds' ? 'fold' : handName;
      const winnerSummary = potInfo
        ? winners.map((winner, idx)=>{
            const share = potInfo.share + (idx === 0 ? potInfo.remainder : 0);
            return `${winner.name} (+${share})`;
          }).join(', ')
        : winners.map(w=>w.name).join(', ');
      const outcomeLine = netDelta >= 0
        ? `Je winst: ${netDelta} chips.`
        : `Je verlies: ${Math.abs(netDelta)} chips.`;
      const message = `Winnaar(s): ${winnerSummary}. ${outcomeLine} (${detail}).`;
      showGameResultOverlay({
        outcome: userWon ? 'win' : 'lose',
        title: userWon ? 'Poker: winst!' : 'Poker: verlies',
        message,
        showActions: true,
        onPlayAgain: () => { pkNewHand(); },
        onMainMenu: () => { leavePokerTable({ silent: true, goToMenu: true }); }
      });
    }

    function pokerShowdown(){
      pokerStage = 'Showdown';
      pokerRevealHands = true;
      pkRender();
      const active = pokerActivePlayers();
      if(active.length === 0){
        pokerStatusEl.textContent = 'Iedereen heeft gefold.';
        pokerHandActive = false;
        return;
      }
      const scored = active.map(player=>{
        const score = pkEvaluateHand([...player.hand, ...pokerCommunity]);
        return {player, score};
      });
      scored.sort((a,b)=>pkCompareHands(b.score,a.score));
      const best = scored[0].score;
      const winners = scored.filter(s=>pkCompareHands(s.score, best) === 0).map(s=>s.player);
      const potInfo = pokerAwardPot(winners, best.name);
      pokerHandleHandComplete({ winners, handName: best.name, potInfo });
    }

    function pokerProceedToNextStage({skipAction=false} = {}){
      if(pokerStage === 'Pre-flop'){
        pokerCommunity.push(pkDraw(), pkDraw(), pkDraw());
        pokerStage = 'Flop';
        pokerDealerStatusEl.textContent = 'Dealer deelt de flop.';
      } else if(pokerStage === 'Flop'){
        pokerCommunity.push(pkDraw());
        pokerStage = 'Turn';
        pokerDealerStatusEl.textContent = 'Dealer deelt de turn.';
      } else if(pokerStage === 'Turn'){
        pokerCommunity.push(pkDraw());
        pokerStage = 'River';
        pokerDealerStatusEl.textContent = 'Dealer deelt de river.';
      } else {
        pokerShowdown();
        return;
      }

      pokerResetBettingRound();
      const nextIndex = pokerNextActiveIndex(pokerDealerIndex, {includeAllIn:false});
      pokerCurrentPlayerIndex = nextIndex === -1 ? pokerDealerIndex : nextIndex;
      pkRender();
      if(!skipAction){
        updatePokerTurnState();
        if(pokerPlayers[pokerCurrentPlayerIndex]?.isBot){
          void pokerBotTurn();
        }
      }
    }

    function pokerCheckForAllInRunout(){
      if(pokerStage === 'Showdown') return;
      const actingPlayers = pokerPlayers.filter(p=>!p.folded && !p.allIn);
      if(actingPlayers.length === 0){
        while(pokerStage !== 'River'){
          pokerProceedToNextStage({skipAction:true});
          if(pokerStage === 'Showdown') return;
        }
        pokerShowdown();
      }
    }

    function pokerAdvanceTurn(){
      if(!pokerHandActive) return;
      const active = pokerActivePlayers();
      if(active.length <= 1){
        const winner = active[0];
        if(winner){
          const potInfo = pokerAwardPot([winner], 'folds');
          pokerHandleHandComplete({ winners: [winner], handName: 'folds', potInfo });
        } else {
          pokerHandActive = false;
          pkRender();
        }
        return;
      }

      if(pokerIsBettingRoundComplete()){
        pokerProceedToNextStage();
        pokerCheckForAllInRunout();
        return;
      }

      const nextIndex = pokerNextActiveIndex(pokerCurrentPlayerIndex, {includeAllIn:false});
      if(nextIndex === -1){
        pokerProceedToNextStage();
        return;
      }
      pokerCurrentPlayerIndex = nextIndex;
      pkRender();
      updatePokerTurnState();
      if(pokerPlayers[pokerCurrentPlayerIndex]?.isBot){
        void pokerBotTurn();
      }
    }

    function pokerBotStrength(bot){
      if(!bot.hand || bot.hand.length<2) return 0;
      const v1 = pkValueNum(bot.hand[0].value);
      const v2 = pkValueNum(bot.hand[1].value);
      const high = Math.max(v1,v2);
      const low = Math.min(v1,v2);
      let score = 0;
      if(v1 === v2) score += 3;
      if(high >= 13) score += 2;
      if(high >= 10) score += 1;
      if(bot.hand[0].suit === bot.hand[1].suit) score += 1;
      if(Math.abs(high - low) === 1) score += 1;
      return score;
    }

    async function pokerBotTurn(){
      pokerTurnLocked = true;
      updatePokerTurnState();
      await sleep(800);
      const bot = pokerPlayers[pokerCurrentPlayerIndex];
      if(!bot || !bot.isBot){
        pokerTurnLocked = false;
        updatePokerTurnState();
        return;
      }
      const toCall = Math.max(0, pokerCurrentBet - bot.bet);
      const strength = pokerBotStrength(bot);
      const willFold = toCall > 0 && strength <= 1 && Math.random() < 0.5;
      const canRaise = bot.stack > toCall + pokerMinRaise;
      if(willFold){
        bot.folded = true;
        bot.actedThisRound = true;
        pokerStatusEl.textContent = `${bot.name} foldt.`;
      } else if(canRaise && strength >= 4 && Math.random() < 0.35){
        const raiseAmount = Math.min(pokerMinRaise + Math.floor(Math.random()*pokerMinRaise), bot.stack - toCall);
        const totalTo = pokerCurrentBet + raiseAmount;
        const betNeeded = totalTo - bot.bet;
        bot.stack -= betNeeded;
        bot.bet += betNeeded;
        bot.committed += betNeeded;
        pokerPot += betNeeded;
        pokerCurrentBet = totalTo;
        pokerMinRaise = raiseAmount;
        bot.actedThisRound = true;
        pokerPlayers.forEach(p=>{ if(p!==bot) p.actedThisRound = p.folded || p.allIn; });
        pokerStatusEl.textContent = `${bot.name} raiset naar ${totalTo}.`;
      } else {
        const callAmount = Math.min(toCall, bot.stack);
        bot.stack -= callAmount;
        bot.bet += callAmount;
        bot.committed += callAmount;
        pokerPot += callAmount;
        if(bot.stack === 0) bot.allIn = true;
        bot.actedThisRound = true;
        pokerStatusEl.textContent = toCall === 0 ? `${bot.name} checkt.` : `${bot.name} callt ${callAmount}.`;
      }
      pkRender();
      pokerTurnLocked = false;
      pokerAdvanceTurn();
    }

    function pkNewHand(){
      hideGameResultOverlay();
      if(pokerPlayers.length < 2){
        pokerHandActive = false;
        pokerDealerStatusEl.textContent = 'Wacht op minimaal 2 spelers.';
        pkRender();
        return;
      }
      pkCreateDeck();
      pokerPot = 0;
      pokerCommunity = [];
      pokerRevealHands = false;
      pokerHandActive = true;
      pokerStage = 'Pre-flop';
      pokerDealerIndex = pokerPlayers.length ? (pokerDealerIndex + 1) % pokerPlayers.length : 0;
      pokerUpdateBlinds();

      pokerPlayers.forEach(p=>{
        p.hand = [pkDraw(), pkDraw()];
        p.bet = 0;
        p.committed = 0;
        p.handStartStack = p.stack;
        p.folded = false;
        p.allIn = false;
        p.actedThisRound = false;
      });
      if(pokerUserIndex() !== -1){
        updateTracking('poker', { gamesPlayed: 1 });
      }

      pokerSmallBlindIndex = pokerNextActiveIndex(pokerDealerIndex, {includeAllIn:true});
      pokerBigBlindIndex = pokerNextActiveIndex(pokerSmallBlindIndex, {includeAllIn:true});

      pokerPostBlind(pokerPlayers[pokerSmallBlindIndex], pokerSmallBlind);
      pokerPostBlind(pokerPlayers[pokerBigBlindIndex], pokerBigBlind);

      pokerCurrentBet = pokerBigBlind;
      pokerMinRaise = pokerBigBlind;
      pokerCurrentPlayerIndex = pokerNextActiveIndex(pokerBigBlindIndex, {includeAllIn:false});

      pokerDealerStatusEl.textContent = 'Dealer deelt twee hole cards.';
      pkRender();
      updatePokerTurnState();
      if(pokerPlayers[pokerCurrentPlayerIndex]?.isBot){
        void pokerBotTurn();
      }
    }

    function PK_syncBots(){
      const desiredBots = Math.max(1, pokerDesiredBots || 1);
      const botPlayers = pokerPlayers.filter(p=>p.isBot);
      if(botPlayers.length > desiredBots){
        let removeCount = botPlayers.length - desiredBots;
        for(let i = pokerPlayers.length - 1; i >= 0 && removeCount > 0; i -= 1){
          if(pokerPlayers[i].isBot){
            pokerPlayers.splice(i, 1);
            removeCount -= 1;
          }
        }
      }

      const occupiedSeats = new Set(pokerPlayers.map(p=>p.seat));
      let nextSeat = 1;
      while(pokerPlayers.filter(p=>p.isBot).length < desiredBots){
        while(occupiedSeats.has(nextSeat)) nextSeat++;
        const seatIdx = nextSeat;
        occupiedSeats.add(seatIdx);
        const nextIdx = pokerPlayers.filter(p=>p.isBot).length + 1;
        const player = {
          key: 'bot'+nextIdx,
          name: 'Bot '+nextIdx,
          stack: pokerTableMin,
          entryStack: pokerTableMin,
          hand: [],
          bet: 0,
          committed: 0,
          folded: false,
          allIn: false,
          isBot: true,
          actedThisRound: false,
          seat: seatIdx
        };
        pokerPlayers.push(player);
      }
    }

    joinPokerBtn.onclick = ()=>{
      if(!currentUser) return showSiteMessage('Je moet inloggen.');
      const min = parseInt(pokerTableSelect.value)||500;
      if(currentUser.credits < min){
        showSiteMessage('Je hebt niet genoeg credits voor deze tafel.');
        return;
      }
      pokerTableMin = min;
      if(pokerBotCountSelect){
        pokerDesiredBots = Math.max(1, parseInt(pokerBotCountSelect.value, 10) || 1);
      }

      if(pokerPlayers.some(p=>p.key===currentUser.key)){
        showSiteMessage('Je zit al aan de tafel.');
        return;
      }

      currentUser.credits -= pokerTableMin;
      currentUser.entryStack = pokerTableMin;
      const seat = pokerPlayers.length ? Math.max(...pokerPlayers.map(p=>p.seat))+1 : 1;
      pokerPlayers.push({
        key: currentUser.key,
        name: currentUser.name,
        stack: pokerTableMin,
        entryStack: pokerTableMin,
        hand:[],
        bet:0,
        committed:0,
        folded:false,
        allIn:false,
        isBot:false,
        actedThisRound:false,
        seat
      });

      PK_syncBots();
      saveCurrentUser().then(renderDashboard);
      pkNewHand();
      pokerSection.style.display='block';
      dashboard.style.display='none';
      setHelpContext('poker');
    };

    function pokerUserHasActiveStake(){
      const idx = pokerUserIndex();
      if(idx === -1) return false;
      const player = pokerPlayers[idx];
      if(!player) return false;
      return pokerHandActive && (player.bet > 0 || player.committed > 0 || !player.folded);
    }

    function leavePokerTable({ silent = false, goToMenu = false } = {}){
      if(!currentUser) return;
      const idx = pokerPlayers.findIndex(p=>p.key===currentUser.key);
      if(idx===-1){
        if(!silent){
          showSiteMessage('Je zit niet aan de tafel.');
        }
        return;
      }
      if(pokerUserHasActiveStake()){
        if(!silent){
          showSiteMessage('Je kan niet weggaan terwijl je nog in de hand zit of een bet hebt lopen.');
        }
        return;
      }
      const pl = pokerPlayers[idx];
      const leavingDuringHand = pokerHandActive;
      currentUser.credits += pl.stack;
      pokerPlayers.splice(idx,1);
      if(leavingDuringHand && pokerPlayers.length >= 2){
        const adjustIndex = (value) => {
          if(value > idx) return value - 1;
          if(value === idx) return value - 1;
          return value;
        };
        pokerDealerIndex = adjustIndex(pokerDealerIndex);
        pokerSmallBlindIndex = adjustIndex(pokerSmallBlindIndex);
        pokerBigBlindIndex = adjustIndex(pokerBigBlindIndex);
        pokerCurrentPlayerIndex = adjustIndex(pokerCurrentPlayerIndex);
      } else {
        pokerHandActive = false;
        pokerPot = 0;
        pokerCommunity = [];
        pokerRevealHands = false;
      }
      setPokerControlsEnabled(false);
      pokerDealerStatusEl.textContent = 'Speler verlaat de tafel.';
      pkRender();
      if(leavingDuringHand && pokerPlayers.length >= 2){
        pokerCurrentPlayerIndex = pokerCurrentPlayerIndex < -1 ? -1 : pokerCurrentPlayerIndex;
        pokerAdvanceTurn();
      }
      saveCurrentUser().then(()=>{
        renderDashboard();
        if(!silent){
          showSiteMessage('Tafel verlaten. Je hebt nu weer '+currentUser.credits+' credits.');
        }
        if(goToMenu){
          pokerSection.style.display = 'none';
          showDashboard(true);
        }
      });
    }

    leavePokerBtn.onclick = ()=>{
      leavePokerTable();
    };

    backFromPokerBtn.onclick = ()=>{
      if(pokerUserHasActiveStake()){
        showSiteMessage('Je kan niet weggaan terwijl je nog in de hand zit of een bet hebt lopen.');
        return;
      }
      endTrackingSession('poker');
      pokerSection.style.display = 'none';
      blackjackSection.style.display = 'none';
      setPokerControlsEnabled(false);
      showDashboard(true);
    };

    pokerCheckBtn.onclick = ()=>{
      if(!pokerIsUserTurn()){
        pokerStatusEl.textContent = 'Wacht op je beurt om te checken.';
        return;
      }
      const player = pokerPlayers[pokerCurrentPlayerIndex];
      const toCall = Math.max(0, pokerCurrentBet - player.bet);
      const callAmount = Math.min(toCall, player.stack);
      player.stack -= callAmount;
      player.bet += callAmount;
      player.committed += callAmount;
      pokerPot += callAmount;
      if(player.stack === 0) player.allIn = true;
      if(callAmount > 0 && currentUser && player.key === currentUser.key){
        updateTracking('poker', { betAmount: callAmount });
      }
      player.actedThisRound = true;
      pokerStatusEl.textContent = toCall === 0 ? 'Check.' : `Call ${callAmount}.`;
      pkRender();
      pokerAdvanceTurn();
    };

    pokerBetBtn.onclick = ()=>{
      if(!pokerIsUserTurn()){
        pokerStatusEl.textContent = 'Wacht op je beurt om te raisen.';
        return;
      }
      const player = pokerPlayers[pokerCurrentPlayerIndex];
      if(!player || player.stack <= 0){
        pokerStatusEl.textContent = 'Je hebt geen chips meer om te betten.';
        return;
      }
      const raiseTo = Math.max(0, parseInt(pokerBetAmountInput.value, 10) || 0);
      if(raiseTo <= pokerCurrentBet){
        pokerStatusEl.textContent = 'Raise-bedrag moet hoger zijn dan de huidige bet.';
        return;
      }
      const minTo = pokerCurrentBet + pokerMinRaise;
      if(raiseTo < minTo){
        pokerStatusEl.textContent = `Minimale raise is ${minTo}.`;
        return;
      }
      const betNeeded = raiseTo - player.bet;
      if(betNeeded > player.stack){
        pokerStatusEl.textContent = 'Je hebt niet genoeg chips voor deze raise.';
        return;
      }
      const previousBet = pokerCurrentBet;
      player.stack -= betNeeded;
      player.bet += betNeeded;
      player.committed += betNeeded;
      pokerPot += betNeeded;
      pokerCurrentBet = raiseTo;
      pokerMinRaise = raiseTo - previousBet;
      if(currentUser && player.key === currentUser.key){
        updateTracking('poker', { betAmount: betNeeded });
      }
      player.actedThisRound = true;
      pokerPlayers.forEach(p=>{ if(p!==player) p.actedThisRound = p.folded || p.allIn; });
      pokerStatusEl.textContent = `Raise naar ${raiseTo}.`;
      pkRender();
      pokerAdvanceTurn();
    };

    pokerFoldBtn.onclick = ()=>{
      if(!pokerIsUserTurn()){
        pokerStatusEl.textContent = 'Wacht op je beurt om te folden.';
        return;
      }
      const player = pokerPlayers[pokerCurrentPlayerIndex];
      if(player){
        player.folded = true;
        player.actedThisRound = true;
      }
      pokerStatusEl.textContent = 'Fold uitgevoerd.';
      pkRender();
      pokerAdvanceTurn();
    };
// ==================== PAARDENRACE LOGICA (GEFIXT) ====================

const startRaceBtn = document.getElementById("startRaceBtn");
const backToMenuRace = document.getElementById("backToMenuRace");
const horseBetInput = document.getElementById("horseBet");
const horseSelect = document.getElementById("horseSelect");
const raceStatus = document.getElementById("raceStatus");
const raceResults = document.getElementById("raceResults");
const raceTrack = document.getElementById("raceTrack");
const finishLine = document.getElementById("finishLine");

const horses = [
    document.getElementById("horse1"),
    document.getElementById("horse2"),
    document.getElementById("horse3"),
    document.getElementById("horse4")
];
const horseMeta = horses.map((horse, index) => ({
    name: horse?.dataset?.horseName || `Paard ${index + 1}`
}));
let raceInProgress = false;

function showHorseRace(){
    dashboard.style.display = "none";
    blackjackSection.style.display = "none";
    pokerSection.style.display = "none";
    crapsSection.style.display = "none";
    baccaratSection.style.display = "none";
    rouletteSection.style.display = "none";
    slotsSection.style.display = "none";
    plinkoSection.style.display = "none";
    lootBoxMenuSection.style.display = "none";
    lootBoxSection.style.display = "none";
    skinsSection.style.display = "none";
    applyGameSkin('horse');
    startTrackingSession('horse');
    horseRaceSection.style.display = "block";
    setHelpContext('horse');
}

backToMenuRace.onclick = () => {
    endTrackingSession('horse');
    horseRaceSection.style.display = "none";
    showDashboard(true);
};

// START RACE
startRaceBtn.onclick = async () => {
    if(raceInProgress) return;
    const bet = parseInt(horseBetInput.value);
    const chosenHorse = parseInt(horseSelect.value);

    if (bet < 10) return showSiteMessage("Minimum inzet is 10 credits.");
    if (currentUser.credits < bet) return showSiteMessage("Je hebt niet genoeg credits!");

    // credits afschrijven
    currentUser.credits -= bet;
    updateTracking('horse', { betAmount: bet, gamesPlayed: 1 });
    await saveCurrentUser();
    renderDashboard();

    // reset horse positions
    horses.forEach(h => {
        h.style.left = "0px";
        h.classList.remove("winner");
    });
    raceResults.classList.remove("show");
    raceResults.innerHTML = "";
    raceStatus.textContent = "De race is gestart... houd de finish in de gaten!";
    raceInProgress = true;
    startRaceBtn.disabled = true;

    await new Promise(requestAnimationFrame);
    const startTime = performance.now();
    const horseStates = horses.map((horse, index) => ({
        horse,
        index,
        finished: false,
        finishTime: null,
        position: 0,
        pace: 1.6 + Math.random() * 1.6
    }));
    const finishPositions = horseStates.map((state) => {
        const lane = state.horse.parentElement;
        const laneRect = lane.getBoundingClientRect();
        const finishRect = finishLine.getBoundingClientRect();
        const horseWidth = state.horse.offsetWidth;
        const finishX = finishRect.left - laneRect.left - horseWidth + finishRect.width;
        return Math.max(0, Math.min(finishX, lane.clientWidth - horseWidth));
    });

    async function finalizeRace(states){
        const ranking = [...states].sort((a, b) => a.finishTime - b.finishTime);
        const winner = ranking[0].index + 1;
        const photoFinishGap = ranking[1].finishTime - ranking[0].finishTime;
        const isPhotoFinish = photoFinishGap <= 120;
        ranking[0].horse.classList.add("winner");

        const resultsHtml = `
          <div class="race-results-title">Uitslag</div>
          <div class="race-results-grid">
            ${ranking.map((entry, idx) => `
              <div class="race-result-item">
                <span>#${idx + 1} â€” ${horseMeta[entry.index].name}</span>
                <span>${(entry.finishTime / 1000).toFixed(2)}s</span>
              </div>
            `).join("")}
          </div>
          ${isPhotoFinish ? `<div class="photo-finish">ðŸ“¸ Foto finish! Verschil: ${(photoFinishGap).toFixed(0)}ms</div>` : ""}
        `;

        raceResults.innerHTML = resultsHtml;
        raceResults.classList.add("show");
        raceStatus.textContent = `Race klaar! ${horseMeta[winner - 1].name} wint.`;

        if(winner === chosenHorse){
            const winAmount = bet * 3;
            currentUser.credits += winAmount;
            applyLuckyCoinProgress(winAmount);
            recordGameResult('horse', 'win', winAmount);
            updateTracking('horse', { netAmount: winAmount - bet });
            await saveCurrentUser();
            renderDashboard();
            showSiteMessage("ðŸŽ‰ Je paard heeft gewonnen! +" + winAmount + " credits");
        } else {
            recordGameResult('horse', 'lose');
            updateTracking('horse', { netAmount: -bet });
            await saveCurrentUser();
            renderDashboard();
            showSiteMessage("âŒ Paard " + winner + " won. Je hebt verloren.");
        }

        raceInProgress = false;
        startRaceBtn.disabled = false;
    }

    let lastFrame = startTime;
    function raceTick(now){
        const delta = Math.min(2.5, (now - lastFrame) / 16.67);
        lastFrame = now;

        horseStates.forEach((state, index) => {
            if(state.finished) return;
            const tempoBoost = Math.random() * 2.6;
            const stride = (state.pace + tempoBoost) * delta;
            state.position = Math.min(state.position + stride, finishPositions[index]);
            state.horse.style.left = `${state.position}px`;

            if(state.position >= finishPositions[index]){
                state.finished = true;
                state.finishTime = now - startTime;
            }
        });

        if(horseStates.every(state => state.finished)){
            void finalizeRace(horseStates);
            return;
        }

        requestAnimationFrame(raceTick);
    }

    requestAnimationFrame(raceTick);
};

    /* ---------------------------
       Leaderboard popup
       --------------------------- */
    let lbIndex = 0;
    const leaderboardConfigs = [
      {
        key: 'earnings',
        title: 'All-Time Earnings',
        value: (u)=>u.totalEarned||0,
        extra: (u)=>`${u.totalEarned||0} credits`
      },
      {
        key: 'winrate',
        title: 'Win Percentage (overall)',
        value: (u)=>u.games ? (u.wins/u.games) : 0,
        extra: (u)=>`${u.games?Math.round(100*u.wins/u.games):0}%`
      },
      {
        key: 'bjwinrate',
        title: 'Blackjack Win Percentage',
        value: (u)=>u.bjGames ? (u.bjWins/u.bjGames) : 0,
        extra: (u)=>`${u.bjGames?Math.round(100*u.bjWins/u.bjGames):0}%`
      },
      {
        key: 'pkwinrate',
        title: 'Poker Win Percentage',
        value: (u)=>u.pkGames ? (u.pkWins/u.pkGames) : 0,
        extra: (u)=>`${u.pkGames?Math.round(100*u.pkWins/u.pkGames):0}%`
      },
      {
        key: 'crapswinrate',
        title: 'Craps Win Percentage',
        value: (u)=>u.crapsGames ? (u.crapsWins/u.crapsGames) : 0,
        extra: (u)=>`${u.crapsGames?Math.round(100*u.crapsWins/u.crapsGames):0}%`
      },
      {
        key: 'baccaratwinrate',
        title: 'Baccarat Win Percentage',
        value: (u)=>u.baccaratGames ? (u.baccaratWins/u.baccaratGames) : 0,
        extra: (u)=>`${u.baccaratGames?Math.round(100*u.baccaratWins/u.baccaratGames):0}%`
      },
      {
        key: 'roulettewinrate',
        title: 'Roulette Win Percentage',
        value: (u)=>u.rouletteGames ? (u.rouletteWins/u.rouletteGames) : 0,
        extra: (u)=>`${u.rouletteGames?Math.round(100*u.rouletteWins/u.rouletteGames):0}%`
      },
      {
        key: 'slotswinrate',
        title: 'Slots Win Percentage',
        value: (u)=>u.slotsGames ? (u.slotsWins/u.slotsGames) : 0,
        extra: (u)=>`${u.slotsGames?Math.round(100*u.slotsWins/u.slotsGames):0}%`
      },
      {
        key: 'plinkowinrate',
        title: 'Plinko Win Percentage',
        value: (u)=>u.plinkoGames ? (u.plinkoWins/u.plinkoGames) : 0,
        extra: (u)=>`${u.plinkoGames?Math.round(100*u.plinkoWins/u.plinkoGames):0}%`
      },
      {
        key: 'horsewinrate',
        title: 'Horse Race Win Percentage',
        value: (u)=>u.horseGames ? (u.horseWins/u.horseGames) : 0,
        extra: (u)=>`${u.horseGames?Math.round(100*u.horseWins/u.horseGames):0}%`
      }
    ];

    async function loadUsersArrayFromDb(){
      const snap = await db.ref('users').once('value');
      const obj = snap.val() || {};
      return Object.entries(obj).map(([k,u])=>({
        key: k,
        name: u.name,
        totalEarned: u.totalEarned||0,
        wins: u.wins||0,
        losses: u.losses||0,
        games: u.gamesPlayed||0,
        bjWins: u.bjWins||0,
        bjLosses: u.bjLosses||0,
        bjGames: u.bjGames||0,
        pkWins: u.pkWins||0,
        pkLosses: u.pkLosses||0,
        pkGames: u.pkGames||0,
        crapsWins: u.crapsWins||0,
        crapsLosses: u.crapsLosses||0,
        crapsGames: u.crapsGames||0,
        baccaratWins: u.baccaratWins||0,
        baccaratLosses: u.baccaratLosses||0,
        baccaratGames: u.baccaratGames||0,
        rouletteWins: u.rouletteWins||0,
        rouletteLosses: u.rouletteLosses||0,
        rouletteGames: u.rouletteGames||0,
        slotsWins: u.slotsWins||0,
        slotsLosses: u.slotsLosses||0,
        slotsGames: u.slotsGames||0,
        plinkoWins: u.plinkoWins||0,
        plinkoLosses: u.plinkoLosses||0,
        plinkoGames: u.plinkoGames||0,
        horseWins: u.horseWins||0,
        horseLosses: u.horseLosses||0,
        horseGames: u.horseGames||0
      }));
    }

    async function openLeaderboard(){
      lbPopup.style.display='block';
      const config = leaderboardConfigs[lbIndex];
      lbTitle.textContent = config.title;

      const arr = await loadUsersArrayFromDb();
      arr.sort((a,b)=>config.value(b) - config.value(a));

      let html='';
      const top=arr.slice(0,10);
      top.forEach((u,i)=>{
        const isYou=currentUser && (u.key===currentUser.key);
        const extra = config.extra(u);
        html+=`
          <div class="lb-entry ${isYou ? 'you' : ''}">
            <span class="lb-rank">${i+1}.</span>
            <span class="lb-name">${u.name} ${isYou ? '<em>(jij)</em>' : ''}</span>
            <span class="lb-extra">${extra}</span>
          </div>
        `;
      });

      let yourRank=-1;
      if(currentUser) yourRank=arr.findIndex(x=>x.key===currentUser.key);
      if(yourRank>9){
        const u=arr[yourRank];
        const extra = config.extra(u);
        html+=`<hr><div class="lb-entry">
          <span class="lb-rank">${yourRank+1}.</span>
          <span class="lb-name">${u.name}</span>
          <span class="lb-extra">${extra}</span>
        </div>`;
      } else if(yourRank===-1 && currentUser){
        html+=`<hr><div class="lb-entry"><span class="lb-name">Jij staat nog niet in de statistieken.</span></div>`;
      }
      lbContent.innerHTML=html;
    }

    lbTab.onclick = ()=>{ lbIndex=0; openLeaderboard(); };
    lbClose.onclick = ()=>{ lbPopup.style.display='none'; };
    lbLeft.onclick = ()=>{ lbIndex=(lbIndex-1+leaderboardConfigs.length)%leaderboardConfigs.length; openLeaderboard(); };
    lbRight.onclick = ()=>{ lbIndex=(lbIndex+1)%leaderboardConfigs.length; openLeaderboard(); };

    const blockCopyHandlers = (event)=>event.preventDefault();
    ['copy', 'cut', 'paste', 'contextmenu', 'selectstart', 'dragstart'].forEach((eventName)=>{
      document.addEventListener(eventName, blockCopyHandlers);
    });
    document.addEventListener('mousedown', (event)=>{
      if(event.detail > 1) event.preventDefault();
    });

  </script>
</body>
</html>
