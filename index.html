<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Goksite PWS — Multiplayer Blackjack & Poker</title>
  <style>
    /* ============================ LEADERBOARD TAB STYLE ============================ */
    #lb-tab{
        position: fixed;
        right: 20px;
        bottom: 20px;
        background: linear-gradient(120deg, var(--maria-blue), var(--maria-blue-bright));
        padding: 10px 18px;
        border-radius: 14px;
        cursor: pointer;
        font-weight: 700;
        color: #f8fbff;
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: 0 12px 24px rgba(6, 18, 40, 0.45);
        z-index: 9999;
        letter-spacing: 0.3px;
        text-transform: uppercase;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
    }

    #lb-tab:hover{
        transform: translateY(-2px);
        box-shadow: 0 16px 28px rgba(6, 18, 40, 0.55);
        filter: brightness(1.08);
    }

    /* ============================ POPUP WINDOW ============================ */
    #lb-popup{
        position: fixed;
        bottom: 0;
        right: 0;
        width: 360px;
        height: 460px;
        background: linear-gradient(160deg, rgba(7, 20, 45, 0.98), rgba(4, 10, 22, 0.98));
        border-radius: 20px 0 0 0;
        display: none;
        z-index: 99999;
        color: white;
        border: 1px solid rgba(114, 179, 255, 0.25);
        box-shadow: 0 24px 40px rgba(0,0,0,0.55);
    }

    #lb-popup-inner{
        padding: 18px;
        height: 100%;
        position: relative;
    }

    /* ============================ ARROWS ============================ */
    .lb-arrow{
        position: absolute;
        top: 12px;
        font-size: 26px;
        cursor: pointer;
        user-select: none;
        color: #8fc5ff;
        transition: transform 0.2s ease, color 0.2s ease;
    }
    .lb-arrow:hover{
        transform: scale(1.05);
        color: #ffe8a6;
    }
    #lb-left{ left: 10px; }
    #lb-right{ right: 10px; }

    #lb-title{
        text-align: center;
        margin: 6px 0 0;
        font-size: 18px;
        letter-spacing: 0.4px;
        color: #f6fbff;
    }

    /* ============================ CONTENT AREA ============================ */
    #lb-content{
        margin-top: 52px;
        height: 330px;
        overflow-y: auto;
        font-size: 16px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .lb-entry{
        display: grid;
        grid-template-columns: 28px 1fr auto;
        align-items: center;
        gap: 10px;
        padding: 8px 12px;
        background: rgba(15, 40, 86, 0.6);
        border-radius: 12px;
        border: 1px solid rgba(140, 200, 255, 0.2);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.03);
    }

    .lb-entry.you{
        background: rgba(25, 79, 164, 0.75);
        border-color: rgba(255, 221, 128, 0.6);
    }

    .lb-rank{
        font-weight: 700;
        color: #ffe8a6;
    }

    .lb-name{
        font-weight: 600;
        color: #f2f7ff;
    }

    .lb-extra{
        font-size: 14px;
        color: #b9d8ff;
    }

    #lb-close{
        position: absolute;
        bottom: 14px;
        left: 50%;
        transform: translateX(-50%);
        padding: 8px 20px;
        border-radius: 10px;
        cursor: pointer;
        background: linear-gradient(135deg, #ffd986, #c9971d);
        color: #2b1a00;
        border: 1px solid rgba(255, 221, 128, 0.8);
        box-shadow: 0 8px 16px rgba(0,0,0,0.4);
    }

    /* ============================ GAME RESULT OVERLAY ============================ */
    .game-result-overlay{
      position: fixed;
      inset: 0;
      background: rgba(3, 8, 18, 0.78);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
      z-index: 100000;
    }

    .game-result-overlay.is-visible{
      opacity: 1;
      pointer-events: auto;
    }

    .game-result-card{
      position: relative;
      width: min(420px, 90vw);
      padding: 26px 28px 22px;
      border-radius: 18px;
      background: linear-gradient(160deg, rgba(15, 35, 75, 0.96), rgba(8, 16, 36, 0.96));
      color: #f5f8ff;
      text-align: center;
      border: 2px solid rgba(140, 200, 255, 0.2);
      box-shadow: 0 20px 45px rgba(0,0,0,0.45);
      animation: resultPop 0.35s ease;
      overflow: hidden;
    }

    .game-result-card::before{
      content: "";
      position: absolute;
      inset: -3px;
      border-radius: 20px;
      border: 2px solid transparent;
      background: conic-gradient(from 180deg, rgba(255,255,255,0.05), rgba(255,215,128,0.65), rgba(114,179,255,0.65), rgba(255,255,255,0.05)) border-box;
      mask: linear-gradient(#000 0 0) padding-box, linear-gradient(#000 0 0);
      mask-composite: exclude;
      animation: resultGlow 2s linear infinite;
      opacity: 0.85;
      pointer-events: none;
    }

    .game-result-card.win{
      border-color: rgba(255, 221, 128, 0.7);
      box-shadow: 0 25px 50px rgba(255, 221, 128, 0.25);
    }

    .game-result-card.lose{
      border-color: rgba(255, 120, 120, 0.6);
      box-shadow: 0 25px 50px rgba(255, 120, 120, 0.22);
    }

    .game-result-card.push{
      border-color: rgba(160, 200, 255, 0.6);
    }

    .game-result-title{
      font-size: 26px;
      letter-spacing: 0.6px;
      margin-bottom: 8px;
      font-weight: 800;
    }

    .game-result-message{
      font-size: 16px;
      color: #dfe9ff;
      margin-bottom: 18px;
      line-height: 1.5;
    }

    .game-result-actions{
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .game-result-actions button{
      padding: 10px 18px;
      border-radius: 12px;
      border: 1px solid rgba(255, 221, 128, 0.7);
      background: linear-gradient(135deg, #ffd986, #c9971d);
      color: #2b1a00;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }

    .game-result-actions button.secondary{
      background: rgba(255, 215, 128, 0.12);
      border-color: rgba(255, 221, 128, 0.4);
      color: #f6e9c4;
    }

    .game-result-actions button:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(0,0,0,0.35);
    }

    @keyframes resultPop{
      from{ transform: scale(0.92); opacity: 0; }
      to{ transform: scale(1); opacity: 1; }
    }

    @keyframes resultGlow{
      0%{ filter: hue-rotate(0deg); }
      100%{ filter: hue-rotate(360deg); }
    }

    /* ============================ Loot box styles ============================ */
    #lootBoxMenuSection{
      background: radial-gradient(circle at top, #2a1b4a 0, #050515 60%, #020208 100%);
      min-height: 100vh;
      text-align: center;
      padding: 24px;
    }

    #lootBoxMenuSection h2{
      font-size: 28px;
      letter-spacing: 0.8px;
      margin-bottom: 6px;
      text-transform: uppercase;
      color: #f6e9c4;
    }

    #lootBoxMenuSection p{
      color: rgba(235, 226, 197, 0.75);
      margin-top: 0;
    }

    .lootbox-menu-grid{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 22px;
      margin: 28px auto 10px;
      max-width: 860px;
    }

    .lootbox-option{
      padding: 18px;
      border-radius: 24px;
      background: linear-gradient(150deg, rgba(12, 24, 46, 0.8), rgba(6, 12, 26, 0.9));
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 18px 40px rgba(0,0,0,0.55);
      position: relative;
      overflow: hidden;
    }

    .lootbox-option::after{
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 10%, rgba(255, 222, 138, 0.18), transparent 55%);
      opacity: 0.8;
      pointer-events: none;
    }

    .lootbox-star-row{
      display: flex;
      justify-content: center;
      gap: 6px;
      font-size: 20px;
      color: #ffe48a;
      margin-bottom: 6px;
      text-shadow: 0 0 6px rgba(0,0,0,0.6);
    }

    #lootBoxSection{
      background: radial-gradient(circle at top, #1f1b3a 0, #050515 60%, #020208 100%);
      min-height: 100vh;
      text-align: center;
      padding: 24px;
    }

    .lootbox-stage{
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      margin-top: 20px;
    }

    .lootbox-card{
      width: 220px;
      height: 220px;
      border-radius: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 22px;
      font-weight: 700;
      color: #041014;
      box-shadow: 0 18px 35px rgba(0,0,0,0.6);
      cursor: pointer;
      position: relative;
      transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
      overflow: hidden;
    }

    .lootbox-card:hover{
      transform: translateY(-4px);
      box-shadow: 0 24px 40px rgba(0,0,0,0.7);
      filter: brightness(1.08);
    }

    .lootbox-card.disabled{
      cursor: default;
      opacity: 0.8;
    }

    .lootbox-card::before{
      content: "";
      position: absolute;
      inset: -3px;
      border-radius: 26px;
      border: 2px solid transparent;
      background: conic-gradient(from 140deg, rgba(255,255,255,0.05), rgba(255,215,128,0.75), rgba(120,190,255,0.75), rgba(255,255,255,0.05)) border-box;
      mask: linear-gradient(#000 0 0) padding-box, linear-gradient(#000 0 0);
      mask-composite: exclude;
      opacity: 0.6;
      pointer-events: none;
    }

    .lootbox-card::after{
      content: "";
      position: absolute;
      inset: 12px;
      border-radius: 18px;
      background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.45), transparent 40%);
      opacity: 0.5;
      pointer-events: none;
    }

    .lootbox-icon{
      font-size: 54px;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,0.35));
    }

    .lootbox-chances{
      display: flex;
      gap: 10px;
    }

    .chance-dot{
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffe48a;
      font-size: 16px;
      background: rgba(0,0,0,0.3);
      transition: opacity 0.2s ease, filter 0.2s ease;
    }

    .chance-dot.used{
      opacity: 0.3;
      filter: grayscale(1);
    }

    .lootbox-level-1{ background: linear-gradient(140deg, #55f0ff, #1aa7c9); }
    .lootbox-level-2{ background: linear-gradient(140deg, #63e28a, #2e9c58); }
    .lootbox-level-3{ background: linear-gradient(140deg, #c3844b, #8b4d20); }
    .lootbox-level-4{ background: linear-gradient(140deg, #d8dbe2, #8b8f9c); }
    .lootbox-level-5{ background: linear-gradient(140deg, #ffe48a, #c79a1b); }

    .lootbox-card.is-tapped{
      animation: lootboxTap 0.35s ease;
    }

    .lootbox-card.is-leveling{
      animation: lootboxLevelUp 0.75s ease;
    }

    .lootbox-card.is-leveling::before{
      opacity: 0.9;
      animation: lootboxGlow 1.6s linear infinite;
    }

    .lootbox-card.is-leveling .lootbox-icon{
      animation: lootboxSparkle 0.9s ease;
    }

    @keyframes lootboxTap{
      0%{ transform: scale(1); }
      35%{ transform: scale(0.96) rotate(-1deg); }
      70%{ transform: scale(1.04) rotate(1deg); }
      100%{ transform: scale(1); }
    }

    @keyframes lootboxLevelUp{
      0%{ transform: scale(1); box-shadow: 0 18px 35px rgba(0,0,0,0.6); }
      35%{ transform: scale(1.08); box-shadow: 0 30px 50px rgba(255,215,128,0.45); }
      70%{ transform: scale(0.98); box-shadow: 0 26px 46px rgba(120,190,255,0.35); }
      100%{ transform: scale(1); box-shadow: 0 22px 40px rgba(0,0,0,0.6); }
    }

    @keyframes lootboxGlow{
      0%{ filter: hue-rotate(0deg); }
      100%{ filter: hue-rotate(360deg); }
    }

    @keyframes lootboxSparkle{
      0%{ transform: scale(1); filter: drop-shadow(0 0 0 rgba(255,255,255,0)); }
      40%{ transform: scale(1.18); filter: drop-shadow(0 0 16px rgba(255,255,255,0.85)); }
      100%{ transform: scale(1); filter: drop-shadow(0 0 0 rgba(255,255,255,0)); }
    }

    /* ============================ Rest of page ============================ */
    :root{
      --maria-blue: #0b4f7b;
      --maria-blue-bright: #0f6fb2;
      --maria-blue-deep: #062339;
      --casino-gold: #d4af37;
      --casino-cream: #f6e9c4;
      --menu-surface: rgba(10, 22, 36, 0.88);
      --menu-surface-light: rgba(18, 44, 70, 0.82);
    }

    body {
      margin:0;
      font-family: "Segoe UI", system-ui, sans-serif;
      background:#050515;
      color:#fff;
    }
    #login, #dashboard, #blackjackSection, #pokerSection, #lootBoxMenuSection, #lootBoxSection, #slotsSection { display: none; padding: 20px; text-align:center; }
    #login {
      position: relative;
      background:
        radial-gradient(circle at top, rgba(15,111,178,0.28), transparent 52%),
        radial-gradient(circle at 15% 30%, rgba(212,175,55,0.2), transparent 45%),
        linear-gradient(150deg, #02070f 0, #040f1e 45%, #020408 100%);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding: 48px 20px;
      overflow: hidden;
    }

    #login::before{
      content:"";
      position:absolute;
      inset: 0;
      background:
        radial-gradient(circle at 85% 20%, rgba(114,179,255,0.18), transparent 40%),
        radial-gradient(circle at 10% 90%, rgba(212,175,55,0.14), transparent 35%);
      pointer-events: none;
    }

    .login-shell{
      position: relative;
      z-index: 1;
      max-width: 980px;
      width: 100%;
      display: grid;
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.85fr);
      gap: 32px;
      padding: 34px;
      border-radius: 26px;
      background: linear-gradient(130deg, rgba(7, 22, 40, 0.9), rgba(6, 16, 32, 0.95));
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 30px 60px rgba(0,0,0,0.45);
    }

    .login-branding{
      display: flex;
      flex-direction: column;
      gap: 18px;
      text-align: left;
      padding: 10px 6px;
    }

    .login-logo{
      width: 58px;
      height: 58px;
      border-radius: 16px;
      background: linear-gradient(140deg, var(--maria-blue), var(--maria-blue-bright));
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--casino-cream);
      font-size: 26px;
      box-shadow: 0 0 18px rgba(15,111,178,0.45);
    }

    .login-branding h2{
      margin: 0;
      font-size: 28px;
      letter-spacing: 0.4px;
    }

    .login-branding p{
      margin: 0;
      color: rgba(246,233,196,0.8);
      line-height: 1.5;
      max-width: 340px;
    }

    .login-highlights{
      display: grid;
      gap: 10px;
    }

    .login-pill{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(12, 34, 56, 0.7);
      border: 1px solid rgba(140,200,255,0.25);
      color: #eaf3ff;
      font-size: 14px;
      letter-spacing: 0.2px;
    }

    .login-pill span{
      color: var(--casino-gold);
      font-weight: 700;
    }

    .login-card{
      background: linear-gradient(160deg, rgba(10, 28, 48, 0.95), rgba(7, 18, 34, 0.92));
      border-radius: 22px;
      padding: 26px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02), 0 22px 35px rgba(0,0,0,0.45);
      display: flex;
      flex-direction: column;
      gap: 16px;
      text-align: left;
    }

    .login-card h3{
      margin: 0;
      font-size: 22px;
    }

    .login-card p{
      margin: 0;
      color: rgba(185,216,255,0.75);
      font-size: 14px;
    }

    .login-field{
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 13px;
      color: rgba(246,233,196,0.85);
    }

    .login-field input{
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(140,200,255,0.2);
      background: rgba(8, 18, 32, 0.9);
      color: #fff;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
    }

    .login-field input:focus{
      outline: none;
      border-color: rgba(255,221,128,0.6);
      box-shadow: 0 0 0 2px rgba(255,221,128,0.15);
    }

    .login-actions{
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .login-actions button{
      width: 100%;
    }

    .login-note{
      font-size: 12px;
      color: rgba(185,216,255,0.7);
    }

    @media (max-width: 860px){
      .login-shell{
        grid-template-columns: 1fr;
        padding: 26px;
      }
    }
    #dashboard {
      background:
        radial-gradient(circle at top, rgba(15,111,178,0.25), transparent 40%),
        radial-gradient(circle at 20% 20%, rgba(212,175,55,0.18), transparent 55%),
        linear-gradient(140deg, #030b14 0, #051729 35%, #071f33 60%, #030b14 100%);
      min-height:100vh;
      text-align:left;
    }
    #dashboard h2, #login h2 { margin-bottom:10px; }
    button {
      padding: 10px 14px;
      margin: 6px;
      border-radius: 10px;
      border: 1px solid rgba(255, 221, 128, 0.75);
      cursor: pointer;
      background: linear-gradient(135deg, #ffd986, #c9971d);
      color: #2b1a00;
      font-weight: 700;
      letter-spacing: 0.2px;
      box-shadow: 0 10px 18px rgba(10, 8, 2, 0.35);
      transition: transform 0.15s ease, box-shadow 0.2s ease, filter 0.2s ease;
    }
    button:hover{
      transform: translateY(-1px);
      filter: brightness(1.06);
      box-shadow: 0 14px 22px rgba(10, 8, 2, 0.45);
    }
    input { padding:8px 10px; border-radius:8px; border:1px solid #2b4055; background:#111a23; color:#fff; }

    /* ============================ Dashboard menu overhaul ============================ */
    .menu-wrapper{
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px 10px 50px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .menu-header{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap:16px;
      padding: 16px 22px;
      border-radius: 18px;
      background: linear-gradient(120deg, rgba(7,30,49,0.95), rgba(8,40,60,0.8));
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
      position: relative;
    }

    .menu-brand{
      display:flex;
      align-items:center;
      gap:12px;
      margin-left: 54px;
    }

    .menu-logo{
      width:48px;
      height:48px;
      border-radius:14px;
      background: linear-gradient(140deg, var(--maria-blue), var(--maria-blue-bright));
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--casino-cream);
      font-size:22px;
      box-shadow: 0 0 16px rgba(15,111,178,0.5);
    }

    .menu-brand h2{
      margin:0;
      font-size: 20px;
      font-weight: 700;
    }

    .menu-brand small{
      color: rgba(246,233,196,0.75);
    }

    .menu-stats{
      display:flex;
      gap: 14px;
      flex-wrap: wrap;
    }

    .menu-stat{
      background: rgba(8, 26, 40, 0.75);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 10px 14px;
      border-radius: 12px;
      min-width: 140px;
    }

    .menu-stat span{
      display:block;
      font-size:12px;
      color: rgba(255,255,255,0.65);
    }

    .menu-stat strong{
      font-size:16px;
      color: var(--casino-cream);
    }

    .menu-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .menu-action-btn{
      background: linear-gradient(135deg, #f6d37a, #b88311);
      border: 1px solid rgba(255, 221, 128, 0.8);
      color: #2b1a00;
      padding: 8px 14px;
      box-shadow: 0 10px 18px rgba(10, 8, 2, 0.35);
    }

    .menu-action-btn.primary{
      background: linear-gradient(135deg, #ffd986, #c9971d);
      border: 1px solid rgba(255, 221, 128, 0.85);
      box-shadow: 0 12px 20px rgba(10, 8, 2, 0.4);
      color: #2b1a00;
    }

    #claimDailyBtn{
      background: linear-gradient(120deg, var(--maria-blue), var(--maria-blue-bright));
      border: none;
      color: #f8fbff;
      box-shadow: 0 8px 18px rgba(10,90,140,0.35);
    }

    #logoutBtn{
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff;
      box-shadow: none;
    }

    .lucky-drop-btn{
      position: absolute;
      left: 16px;
      top: 16px;
      width: 42px;
      height: 42px;
      border-radius: 14px;
      border: 1px solid rgba(255, 221, 128, 0.6);
      background: linear-gradient(140deg, rgba(255, 215, 128, 0.85), rgba(168, 118, 18, 0.85));
      box-shadow: 0 10px 18px rgba(0,0,0,0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      margin: 0;
    }

    .lucky-drop-btn:hover{
      transform: translateY(-1px);
      filter: brightness(1.08);
    }

    .lucky-drop-icon{
      font-size: 20px;
    }

    .lucky-drop-badge{
      position: absolute;
      top: -6px;
      right: -6px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: linear-gradient(140deg, #ffd769, #b78608);
      color: #3b2600;
      font-size: 12px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transform: scale(0.6);
      transition: opacity 0.2s ease, transform 0.2s ease;
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    }

    .lucky-drop-btn.has-available .lucky-drop-badge{
      opacity: 1;
      transform: scale(1);
    }

    .lucky-drop-btn.shake{
      animation: luckyDropShake 0.6s ease-in-out;
    }

    @keyframes luckyDropShake{
      0%{ transform: translateX(0); }
      20%{ transform: translateX(-2px); }
      40%{ transform: translateX(2px); }
      60%{ transform: translateX(-1px); }
      80%{ transform: translateX(1px); }
      100%{ transform: translateX(0); }
    }

    .menu-hero{
      padding: 24px;
      border-radius: 20px;
      background: radial-gradient(circle at top left, rgba(15,111,178,0.35), transparent 45%), var(--menu-surface);
      border: 1px solid rgba(255,255,255,0.08);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 20px;
      box-shadow: inset 0 0 40px rgba(0,0,0,0.35);
    }

    .menu-hero-text h3{
      margin:0 0 6px 0;
      font-size: 26px;
    }

    .menu-hero-text p{
      margin:0;
      color: rgba(255,255,255,0.7);
    }

    .menu-hero-highlight{
      background: linear-gradient(130deg, rgba(212,175,55,0.12), rgba(15,111,178,0.2));
      border: 1px solid rgba(212,175,55,0.3);
      padding: 14px 18px;
      border-radius: 16px;
      text-align:center;
      min-width: 180px;
    }

    .menu-hero-highlight strong{
      font-size: 22px;
      color: var(--casino-cream);
    }

    .menu-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap:18px;
    }

    .menu-card{
      background: var(--menu-surface-light);
      border-radius: 18px;
      padding: 18px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 14px 28px rgba(0,0,0,0.4);
      text-align:left;
      display:flex;
      flex-direction:column;
      gap:12px;
      position: relative;
      overflow: hidden;
    }

    .menu-card::after{
      content:'';
      position:absolute;
      inset:0;
      background: radial-gradient(circle at top right, rgba(15,111,178,0.35), transparent 55%);
      opacity:0.8;
      pointer-events:none;
    }

    .menu-card h4{
      margin:0;
      font-size:18px;
    }

    .menu-card p{
      margin:0;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
    }

    .menu-card .cta-button{
      margin:0;
      align-self: flex-start;
      background: linear-gradient(130deg, var(--casino-gold), #f0c96a);
      color:#1b1b1b;
      font-weight: 700;
    }

    .menu-card .cta-button.alt{
      background: linear-gradient(130deg, #f6d37a, #b88311);
      color:#2b1a00;
    }

    .menu-highlight{
      border:1px solid rgba(212,175,55,0.45);
      box-shadow: 0 14px 30px rgba(212,175,55,0.22);
    }

    .menu-cta-row{
      display:flex;
      gap:12px;
      flex-wrap: wrap;
    }

    .menu-cta-row button{
      margin:0;
    }

    @media (max-width: 840px){
      .menu-header{
        flex-direction: column;
        align-items: flex-start;
        padding-top: 64px;
      }
      .menu-brand{
        margin-left: 0;
      }
      .lucky-drop-btn{
        top: 12px;
        left: 12px;
      }
      .menu-actions{
        width:100%;
        justify-content:flex-start;
      }
      .menu-hero{
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* Blackjack sectie */
    #blackjackSection {
      min-height: 100vh;
      color: #f7fbff;
      background:
        radial-gradient(circle at 20% 0%, rgba(255,255,255,0.08), transparent 55%),
        radial-gradient(circle at 80% 100%, rgba(255,255,255,0.06), transparent 55%),
        linear-gradient(135deg, #082420 0%, #0e4c3b 45%, #031614 100%);
      padding-bottom: 40px;
    }

    .bj-shell{
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .bj-header{
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      background: rgba(6, 22, 20, 0.7);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 18px;
      padding: 16px 18px;
      box-shadow: 0 16px 30px rgba(0,0,0,0.4);
    }

    .bj-header h2{
      margin: 0;
      font-size: 22px;
      letter-spacing: 0.4px;
    }

    .bj-setup{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .bj-setup label{
      font-size: 13px;
      color: rgba(255,255,255,0.7);
      margin-right: 6px;
    }

    .bj-setup select,
    .bj-setup input{
      min-width: 110px;
    }

    .bj-table{
      position: relative;
      background:
        radial-gradient(circle at top, rgba(255,255,255,0.08), transparent 55%),
        radial-gradient(circle at 50% 85%, rgba(0,0,0,0.6), transparent 55%),
        linear-gradient(160deg, rgba(12,66,50,0.95), rgba(6,25,20,0.95));
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.1);
      padding: 26px;
      min-height: 440px;
      box-shadow: inset 0 0 30px rgba(0,0,0,0.6), 0 25px 50px rgba(0,0,0,0.45);
      overflow: hidden;
    }

    .bj-table::before{
      content: '';
      position: absolute;
      inset: 18px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.08);
      pointer-events: none;
    }

    .bj-shoe{
      position: absolute;
      right: 30px;
      top: 26px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      z-index: 4;
    }

    .bj-shoe-stack{
      position: relative;
      width: 76px;
      height: 108px;
    }

    .bj-shoe-card{
      position: absolute;
      inset: 0;
      border-radius: 12px;
      border: 2px solid #d4af37;
      background: radial-gradient(circle at 30% 20%, #fff3c1 0, #cda23b 40%, #7a5a16 100%);
      box-shadow:
        0 6px 14px rgba(0,0,0,0.65),
        inset 0 0 0 1px rgba(255,255,255,0.85);
    }

    .bj-shoe-card:nth-child(1){ transform: translate(0,0); }
    .bj-shoe-card:nth-child(2){ transform: translate(4px,-4px); }
    .bj-shoe-card:nth-child(3){ transform: translate(8px,-8px); }

    .bj-shoe-count{
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 999px;
      background: rgba(8, 30, 26, 0.8);
      border: 1px solid rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.8);
    }

    .bj-lane{
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
      text-align: center;
    }

    .bj-lane .bj-hand{
      display: flex;
      gap: 10px;
      min-height: 132px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }

    .bj-lane .bj-score{
      font-size: 14px;
      color: rgba(255,255,255,0.75);
    }

    .bj-table-grid{
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 22px;
      height: 100%;
    }

    .bj-dealer{
      padding-top: 8px;
    }

    .bj-players{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 14px;
      align-items: stretch;
    }

    .bj-seat{
      background: rgba(8, 28, 24, 0.65);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 180px;
      position: relative;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .bj-seat.active{
      transform: translateY(-4px);
      box-shadow: 0 0 18px rgba(255,215,0,0.45);
    }

    .bj-seat h3{
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }

    .bj-seat .bj-score{
      font-size: 13px;
    }

    .bj-seat .bj-hand{
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      min-height: 132px;
    }

    .bj-card{
      width: 76px;
      height: 110px;
      border-radius: 12px;
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
      border: 2px solid #d4af37;
      color: #111;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow:
        0 6px 14px rgba(0,0,0,0.55),
        inset 0 0 0 1px rgba(255,255,255,0.75);
    }

    .bj-card .corner{
      position: absolute;
      top: 8px;
      left: 8px;
      font-size: 12px;
      font-weight: 700;
    }

    .bj-card .center{
      font-size: 22px;
      line-height: 1;
    }

    .bj-card.red{
      color: #b01e2d;
    }

    .bj-card.is-back{
      background: radial-gradient(circle at 30% 20%, #fff3c1 0, #cda23b 40%, #7a5a16 100%);
      color: transparent;
    }

    .bj-card.is-back::after{
      content: '♣';
      color: rgba(255,255,255,0.85);
      font-size: 24px;
    }

    .bj-actions{
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      background: rgba(6, 22, 20, 0.7);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 14px 18px;
      box-shadow: 0 12px 24px rgba(0,0,0,0.35);
    }

    .bj-status{
      font-size: 14px;
      color: rgba(255,255,255,0.8);
      max-width: 520px;
      text-align: left;
    }

    .bj-actions-buttons{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .bj-fly-card{
      position: fixed;
      width: 76px;
      height: 110px;
      border-radius: 12px;
      border: 2px solid #d4af37;
      background: radial-gradient(circle at 30% 20%, #fff3c1 0, #cda23b 40%, #7a5a16 100%);
      box-shadow:
        0 8px 18px rgba(0,0,0,0.65),
        inset 0 0 0 1px rgba(255,255,255,0.85);
      z-index: 9999;
      pointer-events: none;
      transition: transform 0.5s ease, opacity 0.4s ease;
    }

    .chair {
      width:50px;
      height:50px;
      background:radial-gradient(circle at 30% 20%, #555, #222);
      border-radius:50%;
      position:absolute;
      box-shadow:
        0 4px 10px rgba(0,0,0,0.6),
        inset 0 -4px 8px rgba(0,0,0,0.8);
      border:2px solid #666;
    }

    #controls { margin-top:20px; }

    /* Poker section */
    #pokerSection {
      background: radial-gradient(circle at top, #153f35 0, #0a1f1a 65%, #050f0d 100%);
      min-height: 100vh;
      color: #f4f7ff;
      padding-bottom: 40px;
    }

    .poker-lobby {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 18px;
      margin: 16px auto 10px;
      max-width: 980px;
      text-align: center;
    }

    .poker-lobby-card {
      background: rgba(0,0,0,0.45);
      border-radius: 14px;
      padding: 14px 18px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 10px 24px rgba(0,0,0,0.55);
    }

    .poker-table {
      width: 92%;
      max-width: 1100px;
      margin: 20px auto;
      background: radial-gradient(circle at 50% 20%, #1f6b57 0, #0d2b24 65%, #061511 100%);
      border-radius: 20px;
      padding: 20px 24px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.08);
      position: relative;
      overflow: hidden;
    }

    .poker-dealer {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
      padding: 10px 14px;
      border-radius: 16px;
      background: rgba(5, 10, 16, 0.55);
      border: 1px solid rgba(255,255,255,0.08);
    }

    .dealer-avatar {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffe8a6 0, #c39a2f 45%, #6b4c0b 100%);
      display: grid;
      place-items: center;
      font-size: 26px;
      color: #2b1b00;
      box-shadow: 0 6px 16px rgba(0,0,0,0.5);
    }

    .dealer-info h3 {
      margin: 0;
      font-size: 16px;
      letter-spacing: 0.4px;
    }

    .dealer-info p {
      margin: 4px 0 0;
      font-size: 12px;
      color: #cfe6ff;
    }

    .poker-board {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 16px;
    }

    .poker-community {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 8px 0;
    }

    .card-pk {
      width: 72px;
      height: 102px;
      background: #fdfdfd;
      color: #0b0b0b;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      box-shadow: 0 6px 16px rgba(0,0,0,0.7);
      animation: dealCard 0.35s ease;
      border: 2px solid #d5b467;
    }

    .card-pk.back {
      background: linear-gradient(135deg, #183b6a, #0a1c31);
      color: transparent;
      border: 2px solid rgba(255,255,255,0.3);
      position: relative;
    }

    .card-pk.back::after {
      content: "♠";
      color: rgba(255,255,255,0.6);
      font-size: 28px;
    }

    .poker-seats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 14px;
      margin-top: 18px;
    }

    .poker-player {
      padding: 12px;
      border-radius: 12px;
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.08);
      position: relative;
    }

    .poker-player.active {
      box-shadow: 0 0 0 2px rgba(255, 221, 128, 0.7);
    }

    .poker-player h4 {
      margin: 0 0 6px 0;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .poker-badges {
      display: flex;
      gap: 6px;
      font-size: 10px;
    }

    .poker-badges span {
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.16);
      border: 1px solid rgba(255,255,255,0.25);
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }

    .poker-player .hand {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin: 6px 0;
    }

    .poker-info-row {
      margin-top: 6px;
      font-size: 12px;
      color: #d9e4ff;
    }

    .poker-seat-row {
      font-size: 11px;
      color: #b7c3e6;
      margin-top: 4px;
    }

    .poker-actions {
      margin-top: 18px;
      display: grid;
      gap: 10px;
      background: rgba(0,0,0,0.5);
      border-radius: 14px;
      padding: 14px;
      border: 1px solid rgba(255,255,255,0.08);
    }

    .poker-action-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    .poker-status {
      font-size: 12px;
      color: #cfe6ff;
      text-align: center;
    }

    .poker-meta {
      display: flex;
      justify-content: center;
      gap: 14px;
      flex-wrap: wrap;
      font-size: 13px;
    }

    .poker-meta span {
      background: rgba(0,0,0,0.35);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    small { font-size:12px; color:#ddd; }

    /* Table games */
    #crapsSection,
    #baccaratSection,
    #rouletteSection{
      min-height: 100vh;
      color: white;
      padding: 24px;
      background: radial-gradient(circle at top, #1c2235 0, #0c101c 60%, #06070c 100%);
      text-align: center;
    }

    .table-game-panel{
      max-width: 860px;
      margin: 20px auto;
      background: rgba(0,0,0,0.55);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 10px 28px rgba(0,0,0,0.5);
    }

    .craps-panel{
      background: linear-gradient(160deg, rgba(8, 16, 30, 0.88), rgba(3, 6, 14, 0.96));
      border: 1px solid rgba(255, 215, 128, 0.18);
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    }

    .craps-header{
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: center;
      margin-bottom: 16px;
    }

    .craps-header h2{
      margin: 0;
      font-size: 30px;
      letter-spacing: 1px;
      color: #ffe9b0;
      text-transform: uppercase;
    }

    .craps-header p{
      margin: 0;
      font-size: 14px;
      color: #cfe2ff;
    }

    .craps-meta{
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: center;
      font-size: 13px;
      color: #c7d8ff;
      margin-top: 4px;
    }

    .craps-meta span{
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 215, 128, 0.2);
      background: rgba(12, 24, 48, 0.6);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
    }

    .craps-field{
      margin: 16px auto;
      padding: 22px 18px;
      border-radius: 24px;
      background: radial-gradient(circle at top, #1f6c43 0%, #0f4a2d 45%, #0b2f1d 100%);
      border: 2px solid rgba(255, 215, 128, 0.35);
      box-shadow: inset 0 0 24px rgba(0,0,0,0.4), 0 16px 32px rgba(0,0,0,0.55);
      position: relative;
      overflow: hidden;
    }

    .craps-field::before{
      content: "";
      position: absolute;
      inset: 8px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.08);
      pointer-events: none;
      box-shadow: 0 0 18px rgba(255, 215, 128, 0.15);
    }

    .dice-row{
      display:flex;
      justify-content:center;
      gap:16px;
      margin: 14px 0;
      font-size: 48px;
    }

    .dice-row div{
      width: 64px;
      height: 64px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius: 12px;
      background: rgba(255,255,255,0.08);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.12);
    }

    .craps-dice{
      margin: 0;
      position: relative;
      z-index: 2;
    }

    .craps-die{
      width: 70px;
      height: 70px;
      border-radius: 16px;
      font-size: 44px;
      color: #1b2233;
      background: linear-gradient(160deg, #f9f5ef, #e8ded0);
      border: 2px solid rgba(255, 215, 128, 0.7);
      box-shadow: 0 16px 30px rgba(0,0,0,0.4), inset 0 0 0 2px rgba(255,255,255,0.6);
      text-shadow: 0 2px 3px rgba(0,0,0,0.2);
      position: relative;
      overflow: hidden;
    }

    .craps-die::after{
      content: "";
      position: absolute;
      inset: 8px 10px 14px;
      border-radius: 10px;
      background: linear-gradient(140deg, rgba(255,255,255,0.55), rgba(255,255,255,0));
      opacity: 0.7;
      pointer-events: none;
    }

    .dice-roll{
      animation: diceRoll 0.85s cubic-bezier(0.25, 0.75, 0.3, 1.1);
    }

    @keyframes diceRoll{
      0% { transform: translateX(-12px) translateY(6px) rotate(0deg) scale(0.9); filter: blur(0px); }
      25% { transform: translateX(18px) translateY(-8px) rotate(95deg) scale(1.05); filter: blur(0.6px); }
      55% { transform: translateX(-10px) translateY(10px) rotate(190deg) scale(0.95); filter: blur(0.2px); }
      80% { transform: translateX(8px) translateY(-4px) rotate(310deg) scale(1.04); filter: blur(0px); }
      100% { transform: translateX(0) translateY(0) rotate(360deg) scale(1); filter: blur(0px); }
    }

    .craps-status{
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: center;
      margin-top: 12px;
      font-size: 14px;
      color: #dce8ff;
    }

    .craps-point{
      font-weight: 700;
      font-size: 16px;
      color: #ffe9b0;
    }

    .baccarat-row,
    .roulette-row{
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap: wrap;
      margin: 14px 0;
    }

    .baccarat-card{
      width: 70px;
      height: 100px;
      background: #fdfdfd;
      color:#111;
      border-radius: 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      border:2px solid #d4af37;
      box-shadow: 0 6px 16px rgba(0,0,0,0.6);
      animation: dealCard 0.35s ease;
    }

    .roulette-wheel{
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background: conic-gradient(#c62828 0 20deg, #111 20deg 40deg, #c62828 40deg 60deg, #111 60deg 80deg, #c62828 80deg 100deg, #111 100deg 120deg, #c62828 120deg 140deg, #111 140deg 160deg, #c62828 160deg 180deg, #1b7d3d 180deg 200deg, #111 200deg 220deg, #c62828 220deg 240deg, #111 240deg 260deg, #c62828 260deg 280deg, #111 280deg 300deg, #c62828 300deg 320deg, #111 320deg 340deg, #c62828 340deg 360deg);
      border: 6px solid #d4af37;
      box-shadow: 0 10px 30px rgba(0,0,0,0.65);
      margin: 0 auto;
    }

    .roulette-wheel.spinning{
      animation: rouletteSpin 1.2s cubic-bezier(0.22, 0.6, 0.2, 1);
    }

    @keyframes rouletteSpin{
      from { transform: rotate(0deg); }
      to { transform: rotate(920deg); }
    }

    .roulette-result{
      font-size: 20px;
      font-weight: 700;
      margin-top: 12px;
    }

    /* Slot machine */
    #slotsSection{
      min-height: 100vh;
      color: #fff;
      padding: 24px;
      background: radial-gradient(circle at top, #351a1f 0, #12070b 55%, #050205 100%);
      text-align: center;
    }

    .slots-machine{
      --slot-symbol-size: 72px;
      max-width: 720px;
      margin: 30px auto;
      padding: 30px;
      border-radius: 26px;
      background: linear-gradient(160deg, rgba(55,20,28,0.98), rgba(15,5,12,0.98));
      border: 1px solid rgba(255,215,125,0.35);
      box-shadow: 0 26px 50px rgba(0,0,0,0.7);
      position: relative;
    }

    .slots-marquee{
      text-transform: uppercase;
      font-weight: 800;
      letter-spacing: 2px;
      font-size: 18px;
      padding: 10px 18px;
      border-radius: 999px;
      background: linear-gradient(120deg, #f0d27b, #bb7d23);
      color: #2a0b10;
      box-shadow: inset 0 2px 4px rgba(255,255,255,0.4), 0 12px 20px rgba(0,0,0,0.4);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 18px;
    }

    .slots-body{
      display: flex;
      gap: 26px;
      align-items: stretch;
      justify-content: center;
    }

    .slots-cabinet{
      flex: 1;
      padding: 18px;
      border-radius: 20px;
      background: linear-gradient(160deg, rgba(90,28,38,0.95), rgba(20,8,15,0.95));
      border: 1px solid rgba(255, 220, 140, 0.25);
      box-shadow: inset 0 0 18px rgba(0,0,0,0.65), 0 16px 26px rgba(0,0,0,0.35);
      position: relative;
    }

    .slots-header{
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
      margin-bottom: 16px;
    }

    .slots-window{
      padding: 14px;
      border-radius: 18px;
      background: radial-gradient(circle at top, rgba(16,16,25,0.95), rgba(5,5,8,0.9));
      border: 2px solid rgba(255, 232, 162, 0.4);
      box-shadow: inset 0 0 18px rgba(0,0,0,0.85);
    }

    .slots-reels{
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
      margin: 20px auto;
      max-width: 420px;
    }

    .slot-reel{
      background: rgba(8,8,14,0.85);
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: inset 0 0 12px rgba(0,0,0,0.8);
      overflow: hidden;
      height: var(--slot-symbol-size);
      position: relative;
    }

    .slot-reel::after{
      content: '';
      position: absolute;
      inset: 0;
      border-top: 1px solid rgba(255,255,255,0.1);
      border-bottom: 1px solid rgba(255,255,255,0.12);
      box-shadow: inset 0 0 18px rgba(255,255,255,0.08);
      pointer-events: none;
    }

    .slot-reel-strip{
      display: flex;
      flex-direction: column;
      align-items: center;
      transform: translateY(0);
      transition: transform 1s cubic-bezier(0.2, 0.6, 0.1, 1);
      will-change: transform;
    }

    .slot-symbol{
      height: var(--slot-symbol-size);
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      text-shadow: 0 8px 14px rgba(0,0,0,0.6);
    }

    .slot-reel.spinning .slot-reel-strip{
      filter: blur(1.2px);
    }

    .slots-controls{
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      align-items: center;
      margin-top: 16px;
    }

    .slots-status{
      margin-top: 14px;
      font-weight: 600;
      min-height: 24px;
    }

    .slots-win{
      color: #ffe28a;
      text-shadow: 0 0 12px rgba(255,215,125,0.5);
    }

    .slots-lever{
      width: 80px;
      min-width: 80px;
      border: none;
      background: transparent;
      cursor: pointer;
      position: relative;
      padding: 0;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    .slots-lever:disabled{
      cursor: not-allowed;
      filter: grayscale(0.2) brightness(0.85);
    }

    .slots-lever-track{
      width: 54px;
      height: 220px;
      background: linear-gradient(180deg, rgba(15,8,12,0.9), rgba(8,4,6,0.9));
      border-radius: 30px;
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
      position: relative;
      overflow: hidden;
    }

    .lever-handle{
      position: absolute;
      top: 26px;
      left: 50%;
      width: 14px;
      height: 140px;
      transform: translateX(-50%);
      background: linear-gradient(180deg, #f8e4a4, #c38b2f);
      border-radius: 20px;
      box-shadow: inset 0 2px 4px rgba(255,255,255,0.5), 0 8px 16px rgba(0,0,0,0.5);
      transform-origin: top center;
    }

    .lever-knob{
      position: absolute;
      top: 4px;
      left: 50%;
      width: 40px;
      height: 40px;
      transform: translateX(-50%);
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ff7a7a, #c41022);
      box-shadow: inset 0 3px 6px rgba(255,255,255,0.4), 0 10px 18px rgba(0,0,0,0.55);
      border: 2px solid rgba(255,255,255,0.25);
    }

    .slots-lever.pulling .lever-handle{
      animation: leverPull 0.6s ease-in-out;
    }

    .slots-lever.pulling .lever-knob{
      animation: leverKnobPull 0.6s ease-in-out;
    }

    @keyframes leverPull{
      0%{ transform: translateX(-50%) translateY(0); }
      40%{ transform: translateX(-50%) translateY(64px); }
      70%{ transform: translateX(-50%) translateY(54px); }
      100%{ transform: translateX(-50%) translateY(0); }
    }

    @keyframes leverKnobPull{
      0%{ transform: translateX(-50%) translateY(0); }
      40%{ transform: translateX(-50%) translateY(86px); }
      70%{ transform: translateX(-50%) translateY(70px); }
      100%{ transform: translateX(-50%) translateY(0); }
    }

    @media (max-width: 720px){
      .slots-body{
        flex-direction: column;
        align-items: center;
      }

      .slots-lever{
        width: 100%;
        align-items: center;
      }
    }

    /* Plinko */
    #plinkoSection{
      min-height: 100vh;
      color: #fff;
      padding: 24px;
      text-align: center;
      background: radial-gradient(circle at top, #1a1430 0, #0a0716 60%, #05030d 100%);
    }

    .plinko-panel{
      max-width: 980px;
      margin: 0 auto;
    }

    .plinko-controls{
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      align-items: center;
      margin-top: 12px;
    }

    .plinko-board{
      position: relative;
      width: min(780px, 96vw);
      height: 620px;
      margin: 26px auto 12px;
      border-radius: 24px;
      background: linear-gradient(160deg, rgba(22,18,44,0.96), rgba(10,8,22,0.96));
      border: 1px solid rgba(148, 176, 255, 0.25);
      box-shadow: 0 26px 50px rgba(0,0,0,0.7);
      overflow: hidden;
    }

    .plinko-pegs{
      position: absolute;
      inset: 28px 36px 150px 36px;
    }

    .plinko-peg{
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #f7f6ff, #8aa2ff);
      box-shadow: 0 0 10px rgba(120,150,255,0.75);
      transform: translate(-50%, -50%);
    }

    .plinko-ball{
      position: absolute;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffd988, #f08b2c);
      box-shadow: 0 8px 16px rgba(0,0,0,0.55), 0 0 12px rgba(255,200,120,0.6);
      left: 50%;
      top: 16px;
      transform: translateX(-50%);
      pointer-events: none;
    }

    .plinko-slots{
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 110px;
      display: grid;
      grid-template-columns: repeat(9, minmax(0, 1fr));
      gap: 6px;
      padding: 0 12px 16px;
      align-items: end;
    }

    .plinko-slot{
      background: rgba(15, 24, 60, 0.8);
      border: 1px solid rgba(120,150,255,0.35);
      border-radius: 12px;
      padding: 10px 4px;
      font-weight: 700;
      font-size: 13px;
      color: #cfe0ff;
      transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    }

    .plinko-slot.active{
      transform: translateY(-8px);
      background: rgba(255, 199, 122, 0.22);
      box-shadow: 0 0 16px rgba(255,198,120,0.5);
      color: #ffe3b0;
    }

    .plinko-status{
      margin-top: 12px;
      font-weight: 600;
      min-height: 24px;
    }

    .plinko-note{
      font-size: 12px;
      opacity: 0.7;
      letter-spacing: 0.02em;
    }

    /* Global currency display */
    #currencyDisplay{
      position: fixed;
      top: 12px;
      right: 12px;
      display: none;
      gap: 12px;
      z-index: 99999;
      align-items: center;
      flex-wrap: wrap;
    }

    .currency-chip{
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(6, 12, 24, 0.75);
      color: #fff;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: 0 8px 22px rgba(0,0,0,0.45);
      min-width: 150px;
    }

    .currency-values{
      display: flex;
      flex-direction: column;
      line-height: 1.1;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      opacity: 0.85;
    }

    .currency-values strong{
      font-size: 18px;
      letter-spacing: 0.02em;
      text-transform: none;
      opacity: 1;
    }

    .currency-sub{
      font-size: 11px;
      text-transform: none;
      letter-spacing: 0.02em;
      opacity: 0.7;
    }

    .coin-icon{
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-weight: 700;
      font-size: 14px;
      box-shadow: inset 0 2px 5px rgba(255,255,255,0.35), inset 0 -2px 6px rgba(0,0,0,0.4);
    }

    .coin-silver{
      background: radial-gradient(circle at 30% 30%, #f4f7fb 0%, #cfd5df 45%, #8b94a1 100%);
      border: 1px solid #d7dde6;
      color: #fdfdfd;
      text-shadow: 0 1px 2px rgba(0,0,0,0.6);
    }

    .coin-gold{
      background: radial-gradient(circle at 30% 30%, #ffe9a6 0%, #d6a93b 52%, #9a6a06 100%);
      border: 1px solid #f1d37a;
      color: #7a5200;
      font-size: 15px;
      text-shadow: 0 1px 1px rgba(255,255,255,0.6);
    }

    /* Developer portal */
    #developerPortal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100000;
    }

    .developer-card{
      background: #0f1624;
      color: #fff;
      padding: 24px;
      border-radius: 16px;
      width: min(420px, 90vw);
      box-shadow: 0 24px 50px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .developer-card h3{
      margin: 0 0 8px;
      font-size: 22px;
    }

    .developer-actions{
      display: grid;
      gap: 10px;
      margin-top: 16px;
    }

/* ===== Paardenrace Lanes ===== */
#horseRaceSection{
    background: radial-gradient(circle at top, rgba(18, 36, 20, 0.95) 0, rgba(8, 14, 10, 0.98) 60%, #050507 100%);
    min-height: 100vh;
}

.race-shell{
    max-width: 1100px;
    margin: 0 auto;
    padding: 20px 12px 36px;
}

.race-header{
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
}

.race-title{
    text-align: left;
}

.race-title h2{
    margin: 0;
    font-size: 30px;
    letter-spacing: 0.6px;
}

.race-title p{
    margin: 6px 0 0;
    color: rgba(255,255,255,0.7);
}

.race-controls{
    background: rgba(8, 12, 14, 0.7);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 16px;
    padding: 16px;
    display: grid;
    gap: 10px;
    box-shadow: 0 16px 30px rgba(0,0,0,0.45);
}

.race-controls-row{
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
    justify-content: center;
}

.race-controls label{
    font-weight: 600;
    color: rgba(255,255,255,0.75);
}

.race-controls input,
.race-controls select{
    background: rgba(12, 18, 22, 0.85);
    border: 1px solid rgba(255,255,255,0.18);
    border-radius: 10px;
    color: #f1f6ff;
    padding: 8px 12px;
    font-size: 15px;
}

.race-track{
    position: relative;
    width: min(100%, 980px);
    margin: 28px auto 0;
    padding: 26px 28px 30px;
    border-radius: 22px;
    border: 1px solid rgba(255, 215, 120, 0.4);
    background: linear-gradient(135deg, rgba(15, 52, 22, 0.95), rgba(10, 26, 16, 0.98));
    box-shadow: 0 25px 45px rgba(0,0,0,0.55), inset 0 0 0 1px rgba(255,255,255,0.04);
    overflow: hidden;
    z-index: 1;
}

.race-track::before{
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at top, rgba(255,255,255,0.08), transparent 55%);
    pointer-events: none;
}

.race-lights{
    position: absolute;
    inset: 16px 26px auto;
    display: flex;
    gap: 6px;
}

.race-light{
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: radial-gradient(circle, #ffeaa3 0, #ffb732 55%, #7d4400 100%);
    box-shadow: 0 0 12px rgba(255, 200, 90, 0.65);
    animation: lightPulse 1.6s ease-in-out infinite;
}

.race-light:nth-child(2){ animation-delay: 0.3s; }
.race-light:nth-child(3){ animation-delay: 0.6s; }
.race-light:nth-child(4){ animation-delay: 0.9s; }
.race-light:nth-child(5){ animation-delay: 1.2s; }

.finish-line{
    position: absolute;
    top: 20px;
    right: 72px;
    bottom: 20px;
    width: 18px;
    border-radius: 10px;
    background:
        repeating-linear-gradient(
            180deg,
            #f8f4e8 0,
            #f8f4e8 12px,
            #1b1b1b 12px,
            #1b1b1b 24px
        );
    box-shadow: 0 0 20px rgba(255, 233, 175, 0.5), inset 0 0 0 2px rgba(255,255,255,0.2);
    z-index: 2;
}

.finish-banner{
    position: absolute;
    top: -10px;
    right: 42px;
    background: linear-gradient(135deg, #2b1605, #7c4a10);
    padding: 6px 14px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 0.4px;
    text-transform: uppercase;
    border: 1px solid rgba(255, 218, 140, 0.8);
    box-shadow: 0 8px 18px rgba(0,0,0,0.45);
    z-index: 2;
}

.raceLane {
    position: relative;
    height: 72px;
    margin: 16px 0;
    border-radius: 16px;
    border: 1px solid rgba(255, 215, 140, 0.45);
    background: linear-gradient(90deg, rgba(21, 69, 30, 0.9), rgba(13, 44, 20, 0.95));
    overflow: hidden;
    z-index: 1;
}

.raceLane::after{
    content: "";
    position: absolute;
    inset: 10px 24px;
    border: 1px dashed rgba(255,255,255,0.1);
    border-radius: 12px;
}

.lane-label{
    position: absolute;
    left: 16px;
    top: 12px;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    color: rgba(255,255,255,0.6);
}

.horse {
    position: absolute;
    left: 0;
    top: 10px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 999px;
    background: rgba(10, 15, 18, 0.85);
    border: 1px solid rgba(255,255,255,0.2);
    font-weight: 600;
    font-size: 16px;
    color: #f8fbff;
    box-shadow: 0 12px 24px rgba(0,0,0,0.4);
    transition: left 0.18s linear;
    animation: gallop 0.45s ease-in-out infinite;
    z-index: 3;
}

.horse.winner{
    background: linear-gradient(135deg, rgba(255, 215, 125, 0.95), rgba(255, 236, 190, 0.85));
    color: #2b1605;
    border-color: rgba(255, 215, 125, 0.9);
    box-shadow: 0 0 18px rgba(255, 220, 140, 0.7);
}

.horse-emoji{
    font-size: 22px;
}

.horse-name{
    font-weight: 700;
    letter-spacing: 0.3px;
}

.horse-tag{
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 999px;
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.25);
    color: rgba(255,255,255,0.85);
    text-transform: uppercase;
    letter-spacing: 0.4px;
}

.horse--sprinter{
    background: linear-gradient(120deg, rgba(255, 220, 120, 0.95), rgba(255, 142, 82, 0.92));
    border-color: rgba(255, 214, 140, 0.9);
    color: #4a2200;
}

.horse--sprinter .horse-tag{
    background: rgba(255, 255, 255, 0.25);
    border-color: rgba(255, 255, 255, 0.45);
    color: #6a2a00;
}

.horse--steady{
    background: linear-gradient(120deg, rgba(124, 170, 255, 0.95), rgba(64, 96, 180, 0.9));
    border-color: rgba(170, 210, 255, 0.75);
}

.horse--steady .horse-tag{
    background: rgba(18, 30, 64, 0.35);
}

.horse--precision{
    background: linear-gradient(120deg, rgba(116, 255, 208, 0.92), rgba(34, 140, 120, 0.9));
    border-color: rgba(154, 255, 225, 0.8);
    color: #053a2f;
}

.horse--precision .horse-tag{
    background: rgba(5, 60, 50, 0.3);
    color: rgba(215, 255, 245, 0.9);
}

.horse--wild{
    background: linear-gradient(120deg, rgba(255, 120, 138, 0.95), rgba(160, 36, 62, 0.92));
    border-color: rgba(255, 160, 190, 0.8);
}

.horse--wild .horse-tag{
    background: rgba(60, 10, 24, 0.35);
    color: rgba(255, 220, 230, 0.9);
}

.race-status{
    margin-top: 12px;
    font-weight: 600;
    color: #ffe8a6;
    text-shadow: 0 0 10px rgba(0,0,0,0.6);
}

.race-results{
    margin-top: 10px;
    padding: 12px 16px;
    border-radius: 14px;
    border: 1px solid rgba(255, 255, 255, 0.18);
    background: rgba(8, 12, 14, 0.72);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03);
    display: none;
}

.race-results.show{
    display: block;
}

.race-results-title{
    font-weight: 700;
    margin-bottom: 6px;
}

.race-results-grid{
    display: grid;
    gap: 6px;
}

.race-result-item{
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    color: rgba(255,255,255,0.85);
}

.photo-finish{
    margin-top: 8px;
    padding: 6px 12px;
    border-radius: 999px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(255, 215, 125, 0.12);
    border: 1px solid rgba(255, 215, 125, 0.6);
    font-size: 13px;
    color: #ffe8a6;
}

@keyframes gallop{
    0%, 100%{ transform: translateY(0); }
    50%{ transform: translateY(-2px); }
}

@keyframes lightPulse{
    0%, 100%{ opacity: 0.5; transform: scale(0.9); }
    50%{ opacity: 1; transform: scale(1.2); }
}

    /* small responsive */
    @media (max-width:600px){
      #lb-popup { width: 100%; right:0; left:0; height: 50vh; border-radius: 12px 12px 0 0;}
      .bj-card{ width:56px; height:84px; }
      .bj-table{ min-height: 360px; }
      .card-pk{ width:56px; height:84px; }
    }
  </style>
</head>
<body>

  <!-- Globale currency overlay -->
  <div id="currencyDisplay">
    <div class="currency-chip">
      <span class="coin-icon coin-silver">C</span>
      <div class="currency-values">
        <span>Credits</span>
        <strong><span id="credits">0</span></strong>
      </div>
    </div>
    <div class="currency-chip">
      <span class="coin-icon coin-gold">L</span>
      <div class="currency-values">
        <span>Lucky Coins</span>
        <strong><span id="luckyCoins">0</span></strong>
        <span class="currency-sub"><span id="luckyCoinProgress">0</span>/500</span>
      </div>
    </div>
  </div>

  <!-- Developer portal -->
  <div id="developerPortal">
    <div class="developer-card">
      <h3>Developer Portal</h3>
      <p>Geef jezelf direct oneindige credits of lucky coins.</p>
      <div class="developer-actions">
        <button id="devCreditsBtn" class="menu-action-btn primary">Geef oneindig credits</button>
        <button id="devLuckyBtn" class="menu-action-btn primary">Geef oneindig lucky coins</button>
        <button id="closeDevPortal" class="menu-action-btn">Sluiten</button>
      </div>
    </div>
  </div>

  <!-- Login / Account aanmaken -->
  <section id="login">
    <div class="login-shell">
      <div class="login-branding">
        <div class="login-logo">♠</div>
        <h2>Ignatius Casino</h2>
        <p>Stap binnen in de premium lounge. Snel inloggen, exclusieve bonussen en een luxe casino vibe.</p>
        <div class="login-highlights">
          <div class="login-pill"><span>✦</span> Dagelijkse bonus & vip drops</div>
          <div class="login-pill"><span>✦</span> Multiplayer tafels met live feeling</div>
          <div class="login-pill"><span>✦</span> Veilig account, instant toegang</div>
        </div>
      </div>
      <div class="login-card">
        <h3>Welkom terug</h3>
        <p>Log in met je account of maak direct een nieuwe speler aan.</p>
        <label class="login-field">
          Gebruikersnaam
          <input type="text" id="usernameInput" placeholder="Voer je gebruikersnaam in">
        </label>
        <label class="login-field">
          Wachtwoord
          <input type="password" id="passwordInput" placeholder="Voer je wachtwoord in">
        </label>
        <div class="login-actions">
          <button id="loginBtn">Inloggen</button>
          <button id="createAccountBtn">Account aanmaken</button>
        </div>
        <small class="login-note">Door verder te gaan ga je akkoord met de huisregels van Ignatius Casino.</small>
      </div>
    </div>
  </section>

  <!-- Dashboard -->
  <section id="dashboard">
    <div class="menu-wrapper">
      <header class="menu-header">
        <button id="luckyDropBtn" class="lucky-drop-btn" aria-label="Open Lucky Drops" title="Lucky Drops">
          <span class="lucky-drop-icon">🍀</span>
          <span class="lucky-drop-badge" aria-hidden="true">!</span>
        </button>
        <div class="menu-brand">
          <div class="menu-logo">♠</div>
          <div>
            <h2>Ignatius Casino</h2>
            <small id="welcomeBack">Welkom terug, <span id="displayName"></span></small>
          </div>
        </div>
        <div class="menu-actions">
          <button id="claimDailyBtn" class="menu-action-btn primary">Claim dagelijkse bonus</button>
          <button id="logoutBtn" class="menu-action-btn">Uitloggen</button>
        </div>
      </header>

      <section class="menu-hero">
        <div class="menu-hero-text">
          <h3>Jouw casinovloer is klaar</h3>
          <p>Pak je voordeel: snelle games, speciale acties en een luxe sfeer om meteen te spelen.</p>
        </div>
        <div class="menu-hero-highlight">
          <div>Dagelijkse boost</div>
          <strong>+250 credits</strong>
          <div style="font-size:12px; color: rgba(255,255,255,0.7);">Mis je bonus niet!</div>
        </div>
      </section>

      <div class="menu-grid">
        <div class="menu-card menu-highlight">
          <h4>Blackjack Lounge</h4>
          <p>Casino vibes met live feeling. Strategisch en snel uitbetalen.</p>
          <button id="playBlackjackBtn" class="cta-button">Play Blackjack</button>
        </div>
        <div class="menu-card">
          <h4>Poker Royale</h4>
          <p>Ga all-in of speel slim. Kies je tafel en domineer.</p>
          <button id="playPokerBtn" class="cta-button alt">Speel Poker</button>
        </div>
        <div class="menu-card">
          <h4>Craps Arena</h4>
          <p>Gooi de dobbelstenen en bouw je punt op.</p>
          <button id="playCrapsBtn" class="cta-button">Speel Craps</button>
        </div>
        <div class="menu-card">
          <h4>Baccarat Salon</h4>
          <p>Elegante snelle rondes voor high-roller vibes.</p>
          <button id="playBaccaratBtn" class="cta-button alt">Speel Baccarat</button>
        </div>
        <div class="menu-card">
          <h4>Roulette Table</h4>
          <p>Voorspel kleur of nummer en laat het wiel draaien.</p>
          <button id="playRouletteBtn" class="cta-button">Speel Roulette</button>
        </div>
        <div class="menu-card">
          <h4>Slot Machines</h4>
          <p>Drie rollen, dikke payouts. Trek de hendel en voel de spanning.</p>
          <button id="playSlotsBtn" class="cta-button alt">Speel Slots</button>
        </div>
        <div class="menu-card">
          <h4>Paardenrace Club</h4>
          <p>Stap in de VIP-tribune en kies jouw winnaar.</p>
          <button id="playHorseRaceBtn" class="cta-button alt">Start race</button>
        </div>
        <div class="menu-card">
          <h4>Plinko Drop</h4>
          <p>Laat de bal vallen en pak multipliers met een smooth landing.</p>
          <button id="playPlinkoBtn" class="cta-button">Speel Plinko</button>
        </div>
      </div>
      <div id="lb-tab">🏆 Leaderboard</div>
    </div>
  </section>

  <!-- Loot Boxes menu -->
  <section id="lootBoxMenuSection" style="display:none;">
    <h2>Lucky Boxes</h2>
    <p>Kies een box om te openen. Je betaalt met Lucky Coins.</p>
    <div class="lootbox-menu-grid">
      <div class="lootbox-option">
        <div class="lootbox-star-row">★</div>
        <div class="lootbox-card lootbox-level-1" data-lootbox="lucky">
          <div class="lootbox-icon">🎁</div>
          <div>Lucky Box</div>
          <small>1 Lucky Coin</small>
        </div>
      </div>
      <div class="lootbox-option">
        <div class="lootbox-star-row">★ ★</div>
        <div class="lootbox-card lootbox-level-2" data-lootbox="deluxe">
          <div class="lootbox-icon">🎁</div>
          <div>Deluxe Lucky Box</div>
          <small>5 Lucky Coins</small>
        </div>
      </div>
      <div class="lootbox-option">
        <div class="lootbox-star-row">★ ★ ★</div>
        <div class="lootbox-card lootbox-level-3" data-lootbox="ultra">
          <div class="lootbox-icon">🎁</div>
          <div>Ultra Deluxe Lucky Box</div>
          <small>10 Lucky Coins</small>
        </div>
      </div>
    </div>
    <button id="backToMenuFromLuckyBoxes">Terug naar menu</button>
  </section>

  <!-- Loot Box opening -->
  <section id="lootBoxSection" style="display:none;">
    <h2 id="lootBoxTitle">Lucky Box</h2>
    <p id="lootBoxSubtitle">Klik op de box om te upgraden. Je hebt 3 kansen.</p>
    <div class="lootbox-stage">
      <div id="lootBoxCard" class="lootbox-card lootbox-level-1">
        <div class="lootbox-icon">🎁</div>
        <div>Reward level <span id="lootBoxLevel">1</span></div>
      </div>
      <div id="lootBoxChances" class="lootbox-chances">
        <div class="chance-dot">★</div>
        <div class="chance-dot">★</div>
        <div class="chance-dot">★</div>
      </div>
      <div id="lootBoxHint">Klik om te upgraden (12,5% kans per klik).</div>
      <div id="lootBoxReward"></div>
    </div>
    <button id="backToMenuFromLoot">Terug naar menu</button>
  </section>

  <!-- Blackjack -->
  <section id="blackjackSection">
    <div class="bj-shell">
      <div class="bj-header">
        <h2>Blackjack</h2>
        <div class="bj-setup">
          <label for="botCount">Bots:</label>
          <select id="botCount">
            <option value="0">0 bots</option>
            <option value="1">1 bot</option>
            <option value="2">2 bots</option>
            <option value="3">3 bots</option>
            <option value="4">4 bots</option>
            <option value="5">5 bots</option>
            <option value="6">6 bots</option>
          </select>
          <label for="betAmount">Inzet:</label>
          <input type="number" id="betAmount" min="1" value="100">
          <button id="startGame">Start ronde</button>
          <button id="backToMenu">Terug naar menu</button>
        </div>
      </div>

      <div class="bj-table">
        <div class="bj-shoe">
          <div class="bj-shoe-stack" id="bjShoe">
            <div class="bj-shoe-card"></div>
            <div class="bj-shoe-card"></div>
            <div class="bj-shoe-card"></div>
          </div>
          <div class="bj-shoe-count" id="bjShoeCount">Shoe: -- kaarten</div>
        </div>
        <div class="bj-table-grid">
          <div class="bj-lane bj-dealer">
            <div class="bj-label">Dealer</div>
            <div class="bj-hand" id="bjDealerHand"></div>
            <div class="bj-score" id="bjDealerScore">Score: -</div>
          </div>
          <div class="bj-players" id="bjPlayersArea"></div>
        </div>
      </div>

      <div class="bj-actions">
        <div class="bj-status" id="bjStatus">Kies je inzet en start de ronde.</div>
        <div class="bj-actions-buttons">
          <button id="hitBtn">Hit</button>
          <button id="standBtn">Stand</button>
          <button id="nextRoundBtn">Volgende ronde</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Poker -->
  <section id="pokerSection">
    <h2>Texas Hold'em Poker</h2>

    <div class="poker-lobby">
      <div class="poker-lobby-card">
        <label>Minimale credits om mee te doen: 500. Kies tafel:</label><br>
        <select id="pokerTableSelect">
          <option value="500">Tafel 500</option>
          <option value="1500">Tafel 1500</option>
          <option value="3500">Tafel 3500</option>
          <option value="5000">Tafel 5000</option>
        </select>
        <div style="margin-top:10px;">
          <button id="joinPokerBtn">Deelnemen</button>
          <button id="leavePokerBtn">Tafel verlaten</button>
          <button id="backFromPokerBtn">Terug naar menu</button>
        </div>
      </div>
      <div class="poker-lobby-card poker-meta">
        <span>Blinds: <strong id="pokerBlinds">—</strong></span>
        <span>Fase: <strong id="pokerStage">—</strong></span>
        <span>Pot: <strong id="pokerPot">0</strong></span>
      </div>
    </div>

    <div class="poker-table">
      <div class="poker-dealer">
        <div class="dealer-avatar">🃏</div>
        <div class="dealer-info">
          <h3>Dealer Sofia</h3>
          <p id="pokerDealerStatus">Dealer wacht op spelers...</p>
        </div>
      </div>

      <div class="poker-board">
        <div class="poker-community" id="pokerCommunity"></div>
      </div>

      <div class="poker-seats" id="pokerPlayers"></div>

      <div class="poker-actions">
        <div class="poker-action-row">
          <button id="pokerCheckBtn">Check / Call</button>
          <button id="pokerBetBtn">Bet / Raise</button>
          <button id="pokerFoldBtn">Fold</button>
        </div>
        <div class="poker-action-row">
          <label for="pokerBetAmount">Raise naar:</label>
          <input type="number" id="pokerBetAmount" min="0" value="200" style="width:120px;">
        </div>
        <div class="poker-status">
          <strong>Status:</strong> <span id="pokerStatus">Sluit je aan om te spelen.</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Craps -->
  <section id="crapsSection" style="display:none;">
    <div class="table-game-panel craps-panel">
      <div class="craps-header">
        <h2>🎲 Craps Royale</h2>
        <p>Come-out roll: 7/11 wint, 2/3/12 verliest. Anders zet je een punt.</p>
        <div class="craps-meta">
          <span>Hoge inzet, hoge winst</span>
          <span>Premium felt tafel</span>
        </div>
      </div>
      <label>Inzet (credits):</label>
      <input type="number" id="crapsBet" min="10" value="100">
      <div class="craps-field">
        <div class="dice-row craps-dice">
          <div id="crapsDieOne" class="craps-die">⚀</div>
          <div id="crapsDieTwo" class="craps-die">⚀</div>
        </div>
      </div>
      <div class="craps-status">
        <div id="crapsPoint" class="craps-point">Punt: -</div>
        <div id="crapsStatus">Plaats je inzet en gooi de dobbelstenen.</div>
      </div>
      <div style="margin-top:12px;">
        <button id="rollCrapsBtn">Gooi</button>
        <button id="resetCrapsBtn">Reset ronde</button>
        <button id="backFromCrapsBtn">Terug naar menu</button>
      </div>
    </div>
  </section>

  <!-- Baccarat -->
  <section id="baccaratSection" style="display:none;">
    <h2>🂡 Baccarat</h2>
    <p>Kies je inzet op Player, Banker of Tie en laat de kaarten spreken.</p>
    <div class="table-game-panel">
      <label>Inzet (credits):</label>
      <input type="number" id="baccaratBet" min="10" value="200">
      <label style="margin-left:8px;">Inzet op:</label>
      <select id="baccaratBetType">
        <option value="player">Player</option>
        <option value="banker">Banker</option>
        <option value="tie">Tie</option>
      </select>
      <div class="baccarat-row" id="baccaratPlayerRow"></div>
      <div class="baccarat-row" id="baccaratBankerRow"></div>
      <div id="baccaratStatus">Plaats je inzet en start een ronde.</div>
      <div style="margin-top:12px;">
        <button id="dealBaccaratBtn">Deel kaarten</button>
        <button id="backFromBaccaratBtn">Terug naar menu</button>
      </div>
    </div>
  </section>

  <!-- Roulette -->
  <section id="rouletteSection" style="display:none;">
    <h2>🎡 Roulette</h2>
    <p>Kies je inzettype en draai het wiel.</p>
    <div class="table-game-panel">
      <label>Inzet (credits):</label>
      <input type="number" id="rouletteBet" min="10" value="150">
      <label style="margin-left:8px;">Inzettype:</label>
      <select id="rouletteBetType">
        <option value="color">Kleur</option>
        <option value="number">Nummer</option>
      </select>
      <div class="roulette-row">
        <select id="rouletteColor">
          <option value="red">Rood</option>
          <option value="black">Zwart</option>
          <option value="green">Groen (0)</option>
        </select>
        <input type="number" id="rouletteNumber" min="0" max="36" value="7" style="width:90px;">
      </div>
      <div class="roulette-wheel"></div>
      <div class="roulette-result" id="rouletteResult">Resultaat: -</div>
      <div id="rouletteStatus">Plaats je inzet en draai.</div>
      <div style="margin-top:12px;">
        <button id="spinRouletteBtn">Draaien</button>
        <button id="backFromRouletteBtn">Terug naar menu</button>
      </div>
    </div>
  </section>

  <!-- Slots -->
  <section id="slotsSection" style="display:none;">
    <h2>🎰 Slot Machines</h2>
    <p>Laat de rollen draaien en pak de jackpot.</p>
    <div class="slots-machine">
      <div class="slots-marquee">Royal Spin</div>
      <div class="slots-body">
        <div class="slots-cabinet">
          <div class="slots-header">
            <div><strong>Uitbetaling</strong>: 3 dezelfde = grote winst, 2 dezelfde = kleine winst.</div>
            <div>Jackpot op 7️⃣ of 💎.</div>
          </div>
          <div class="slots-window">
            <div class="slots-reels">
              <div class="slot-reel">
                <div class="slot-reel-strip" id="slotReelOne"></div>
              </div>
              <div class="slot-reel">
                <div class="slot-reel-strip" id="slotReelTwo"></div>
              </div>
              <div class="slot-reel">
                <div class="slot-reel-strip" id="slotReelThree"></div>
              </div>
            </div>
          </div>
        </div>
        <button id="spinSlotsBtn" class="slots-lever" type="button" aria-label="Trek aan de hendel om te draaien">
          <span class="slots-lever-track">
            <span class="lever-knob"></span>
            <span class="lever-handle"></span>
          </span>
        </button>
      </div>
      <div class="slots-controls">
        <label>Inzet (credits):</label>
        <input type="number" id="slotsBet" min="10" value="100">
        <button id="backFromSlotsBtn">Terug naar menu</button>
      </div>
      <div class="slots-status" id="slotsStatus">Plaats je inzet en spin voor de winst.</div>
    </div>
  </section>
  
<!-- ==================== PAARDENRACE SPEL ==================== -->
<section id="horseRaceSection" style="display:none; text-align:center; padding:20px; color:white;">
    <div class="race-shell">
        <div class="race-header">
            <div class="race-title">
                <h2>🏇 Paardenrace Royale</h2>
                <p>VIP-tribune, cinematic lights en een officiële foto-finish.</p>
            </div>
        </div>

        <div class="race-controls">
            <div class="race-controls-row">
                <label for="horseBet">Inzet (credits):</label>
                <input type="number" id="horseBet" min="10" value="100">
                <label for="horseSelect">Kies een paard:</label>
                <select id="horseSelect">
                    <option value="1">Paard 1 – ⚡ Sprinter</option>
                    <option value="2">Paard 2 – 🛡 Steady Boy</option>
                    <option value="3">Paard 3 – 🎯 Precision</option>
                    <option value="4">Paard 4 – 🔥 Wild Power</option>
                </select>
            </div>
            <div class="race-controls-row">
                <button id="startRaceBtn">Start race</button>
                <button id="backToMenuRace">Terug naar menu</button>
            </div>
        </div>

        <div id="raceStatus" class="race-status">Kies je paard en zet je credits in.</div>
        <div id="raceResults" class="race-results" aria-live="polite"></div>

        <!-- Race Track -->
        <div id="raceTrack" class="race-track">
            <div class="race-lights">
                <div class="race-light"></div>
                <div class="race-light"></div>
                <div class="race-light"></div>
                <div class="race-light"></div>
                <div class="race-light"></div>
            </div>
            <div class="finish-line" id="finishLine"></div>
            <div class="finish-banner">Finish</div>

            <div class="raceLane" id="lane1">
                <div class="lane-label">Lane 1</div>
                <div class="horse horse--sprinter" id="horse1" data-horse-name="Sprinter">
                    <span class="horse-emoji">⚡</span>
                    <span class="horse-name">Sprinter</span>
                    <span class="horse-tag">Bliksemsnel</span>
                </div>
            </div>
            <div class="raceLane" id="lane2">
                <div class="lane-label">Lane 2</div>
                <div class="horse horse--steady" id="horse2" data-horse-name="Steady Boy">
                    <span class="horse-emoji">🛡️</span>
                    <span class="horse-name">Steady Boy</span>
                    <span class="horse-tag">Staalvast</span>
                </div>
            </div>
            <div class="raceLane" id="lane3">
                <div class="lane-label">Lane 3</div>
                <div class="horse horse--precision" id="horse3" data-horse-name="Precision">
                    <span class="horse-emoji">🎯</span>
                    <span class="horse-name">Precision</span>
                    <span class="horse-tag">Haarscherp</span>
                </div>
            </div>
            <div class="raceLane" id="lane4">
                <div class="lane-label">Lane 4</div>
                <div class="horse horse--wild" id="horse4" data-horse-name="Wild Power">
                    <span class="horse-emoji">🔥</span>
                    <span class="horse-name">Wild Power</span>
                    <span class="horse-tag">Ongetemd</span>
                </div>
            </div>

        </div>
    </div>
</section>

  <!-- Plinko -->
  <section id="plinkoSection" style="display:none;">
    <h2>🟣 Plinko Drop</h2>
    <p>Drop de bal en mik op de hoogste multiplier. Smooth animaties, snelle payouts.</p>
    <div class="plinko-panel">
      <div class="plinko-controls">
        <label for="plinkoBet">Inzet:</label>
        <input type="number" id="plinkoBet" min="10" value="150">
        <label for="plinkoBallCount">Ballen:</label>
        <input type="number" id="plinkoBallCount" min="1" max="15" value="10">
        <span class="plinko-note" id="plinkoPerBall">Per bal: 150 credits</span>
        <button id="dropPlinkoBtn">Drop bal</button>
        <button id="backFromPlinkoBtn">Terug naar menu</button>
      </div>
      <div class="plinko-board" id="plinkoBoard">
        <div class="plinko-pegs" id="plinkoPegs"></div>
        <div class="plinko-slots" id="plinkoSlots"></div>
      </div>
      <div class="plinko-status" id="plinkoStatus">Plaats je inzet en drop een bal.</div>
    </div>
  </section>
  
  <!-- Leaderboard popup -->
  <div id="lb-popup">
      <div id="lb-popup-inner">
          <div id="lb-left" class="lb-arrow">←</div>
          <h2 id="lb-title">All-Time Earnings</h2>
          <div id="lb-content"></div>
          <div id="lb-right" class="lb-arrow">→</div>
          <button id="lb-close">Sluiten</button>
      </div>
  </div>

  <!-- Game result overlay -->
  <div id="gameResultOverlay" class="game-result-overlay" aria-hidden="true">
    <div class="game-result-card" id="gameResultCard">
      <div class="game-result-title" id="gameResultTitle">Resultaat</div>
      <div class="game-result-message" id="gameResultMessage"></div>
      <div class="game-result-actions" id="gameResultActions">
        <button id="gameResultPlayAgain">Speel opnieuw</button>
        <button id="gameResultMainMenu" class="secondary">Hoofdmenu</button>
      </div>
    </div>
  </div>

  <!-- Firebase v8 (online accounts & leaderboards) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyARtIFfUXzlkJppkcUSx5ril2FerJltwNs",
      authDomain: "gokken4school.firebaseapp.com",
      databaseURL: "https://gokken4school-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gokken4school",
      storageBucket: "gokken4school.firebasestorage.app",
      messagingSenderId: "210902717668",
      appId: "1:210902717668:web:16ebea58067718ffce48f1",
      measurementId: "G-G9SVYLDMWC"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <script>
    /* ---------------------------
       Data & helpers
       --------------------------- */
    let users = {};
    let currentUser = null;

    function keyForName(name){ return name.trim().toLowerCase(); }

    async function loadUser(key){
      const snap = await db.ref('users/'+key).once('value');
      return snap.val() || null;
    }
    async function saveCurrentUser(){
      if(!currentUser || !currentUser.key) return;
      await db.ref('users/'+currentUser.key).set(currentUser);
    }

    /* ---------------------------
       UI refs
       --------------------------- */
    const loginSection = document.getElementById('login');
    const dashboard = document.getElementById('dashboard');
    const blackjackSection = document.getElementById('blackjackSection');
    const pokerSection = document.getElementById('pokerSection');
    const crapsSection = document.getElementById('crapsSection');
    const baccaratSection = document.getElementById('baccaratSection');
    const rouletteSection = document.getElementById('rouletteSection');
    const slotsSection = document.getElementById('slotsSection');
    const plinkoSection = document.getElementById('plinkoSection');
    const lootBoxMenuSection = document.getElementById('lootBoxMenuSection');
    const lootBoxSection = document.getElementById('lootBoxSection');
    const backFromPokerBtn = document.getElementById('backFromPokerBtn');

    const usernameInput = document.getElementById('usernameInput');
    const passwordInput = document.getElementById('passwordInput');
    const loginBtn = document.getElementById('loginBtn');
    const createAccountBtn = document.getElementById('createAccountBtn');
    const displayName = document.getElementById('displayName');
    const creditsEl = document.getElementById('credits');
    const currencyDisplay = document.getElementById('currencyDisplay');
    const welcomeBack = document.getElementById('welcomeBack');
    const developerPortal = document.getElementById('developerPortal');
    const devCreditsBtn = document.getElementById('devCreditsBtn');
    const devLuckyBtn = document.getElementById('devLuckyBtn');
    const closeDevPortal = document.getElementById('closeDevPortal');
    const claimDailyBtn = document.getElementById('claimDailyBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const playBlackjackBtn = document.getElementById('playBlackjackBtn');
    const playPokerBtn = document.getElementById('playPokerBtn');
    const playCrapsBtn = document.getElementById('playCrapsBtn');
    const playBaccaratBtn = document.getElementById('playBaccaratBtn');
    const playRouletteBtn = document.getElementById('playRouletteBtn');
    const playSlotsBtn = document.getElementById('playSlotsBtn');
    const playPlinkoBtn = document.getElementById('playPlinkoBtn');
    const luckyDropBtn = document.getElementById('luckyDropBtn');
    const openLeaderboardsBtn = document.getElementById('openLeaderboardsBtn');
    const luckyCoinsEl = document.getElementById('luckyCoins');
    const luckyCoinProgressEl = document.getElementById('luckyCoinProgress');

    const lootBoxTitle = document.getElementById('lootBoxTitle');
    const lootBoxSubtitle = document.getElementById('lootBoxSubtitle');
    const lootBoxCard = document.getElementById('lootBoxCard');
    const lootBoxLevel = document.getElementById('lootBoxLevel');
    const lootBoxChances = document.getElementById('lootBoxChances');
    const lootBoxHint = document.getElementById('lootBoxHint');
    const lootBoxReward = document.getElementById('lootBoxReward');
    const backToMenuFromLoot = document.getElementById('backToMenuFromLoot');
    const backToMenuFromLuckyBoxes = document.getElementById('backToMenuFromLuckyBoxes');

    /* Blackjack refs */
    const startGameBtn = document.getElementById('startGame');
    const botSelect = document.getElementById('botCount');
    const betAmountInput = document.getElementById('betAmount');
    const bjDealerHand = document.getElementById('bjDealerHand');
    const bjDealerScore = document.getElementById('bjDealerScore');
    const bjPlayersArea = document.getElementById('bjPlayersArea');
    const bjStatus = document.getElementById('bjStatus');
    const bjShoeCount = document.getElementById('bjShoeCount');
    const bjShoe = document.getElementById('bjShoe');
    const hitBtn = document.getElementById('hitBtn');
    const standBtn = document.getElementById('standBtn');
    const nextRoundBtn = document.getElementById('nextRoundBtn');
    const backToMenuBtn = document.getElementById('backToMenu');

    /* Craps refs */
    const crapsBetInput = document.getElementById('crapsBet');
    const crapsDieOne = document.getElementById('crapsDieOne');
    const crapsDieTwo = document.getElementById('crapsDieTwo');
    const crapsPointEl = document.getElementById('crapsPoint');
    const crapsStatusEl = document.getElementById('crapsStatus');
    const rollCrapsBtn = document.getElementById('rollCrapsBtn');
    const resetCrapsBtn = document.getElementById('resetCrapsBtn');
    const backFromCrapsBtn = document.getElementById('backFromCrapsBtn');

    /* Baccarat refs */
    const baccaratBetInput = document.getElementById('baccaratBet');
    const baccaratBetType = document.getElementById('baccaratBetType');
    const baccaratPlayerRow = document.getElementById('baccaratPlayerRow');
    const baccaratBankerRow = document.getElementById('baccaratBankerRow');
    const baccaratStatusEl = document.getElementById('baccaratStatus');
    const dealBaccaratBtn = document.getElementById('dealBaccaratBtn');
    const backFromBaccaratBtn = document.getElementById('backFromBaccaratBtn');

    /* Roulette refs */
    const rouletteBetInput = document.getElementById('rouletteBet');
    const rouletteBetType = document.getElementById('rouletteBetType');
    const rouletteColor = document.getElementById('rouletteColor');
    const rouletteNumber = document.getElementById('rouletteNumber');
    const rouletteResult = document.getElementById('rouletteResult');
    const rouletteStatus = document.getElementById('rouletteStatus');
    const spinRouletteBtn = document.getElementById('spinRouletteBtn');
    const backFromRouletteBtn = document.getElementById('backFromRouletteBtn');
    const rouletteWheel = document.querySelector('.roulette-wheel');

    /* Slots refs */
    const slotsBetInput = document.getElementById('slotsBet');
    const spinSlotsBtn = document.getElementById('spinSlotsBtn');
    const backFromSlotsBtn = document.getElementById('backFromSlotsBtn');
    const slotsStatus = document.getElementById('slotsStatus');
    const slotReelOne = document.getElementById('slotReelOne');
    const slotReelTwo = document.getElementById('slotReelTwo');
    const slotReelThree = document.getElementById('slotReelThree');

    /* Plinko refs */
    const plinkoBetInput = document.getElementById('plinkoBet');
    const plinkoBallCountInput = document.getElementById('plinkoBallCount');
    const plinkoPerBall = document.getElementById('plinkoPerBall');
    const dropPlinkoBtn = document.getElementById('dropPlinkoBtn');
    const backFromPlinkoBtn = document.getElementById('backFromPlinkoBtn');
    const plinkoBoard = document.getElementById('plinkoBoard');
    const plinkoPegs = document.getElementById('plinkoPegs');
    const plinkoSlots = document.getElementById('plinkoSlots');
    const plinkoStatus = document.getElementById('plinkoStatus');

    /* Poker refs */
    const pokerTableSelect = document.getElementById('pokerTableSelect');
    const joinPokerBtn = document.getElementById('joinPokerBtn');
    const leavePokerBtn = document.getElementById('leavePokerBtn');
    const pokerPotEl = document.getElementById('pokerPot');
    const pokerBlindsEl = document.getElementById('pokerBlinds');
    const pokerStageEl = document.getElementById('pokerStage');
    const pokerCommunityEl = document.getElementById('pokerCommunity');
    const pokerPlayersEl = document.getElementById('pokerPlayers');
    const pokerCheckBtn = document.getElementById('pokerCheckBtn');
    const pokerBetBtn = document.getElementById('pokerBetBtn');
    const pokerFoldBtn = document.getElementById('pokerFoldBtn');
    const pokerBetAmountInput = document.getElementById('pokerBetAmount');
    const pokerStatusEl = document.getElementById('pokerStatus');
    const pokerDealerStatusEl = document.getElementById('pokerDealerStatus');

    /* Leaderboard refs */
    const lbTab = document.getElementById('lb-tab');
    const lbPopup = document.getElementById('lb-popup');
    const lbLeft = document.getElementById('lb-left');
    const lbRight = document.getElementById('lb-right');
    const lbClose = document.getElementById('lb-close');
    const lbTitle = document.getElementById('lb-title');
    const lbContent = document.getElementById('lb-content');

    const gameResultOverlay = document.getElementById('gameResultOverlay');
    const gameResultCard = document.getElementById('gameResultCard');
    const gameResultTitle = document.getElementById('gameResultTitle');
    const gameResultMessage = document.getElementById('gameResultMessage');
    const gameResultActions = document.getElementById('gameResultActions');
    const gameResultPlayAgain = document.getElementById('gameResultPlayAgain');
    const gameResultMainMenu = document.getElementById('gameResultMainMenu');

    function closeLeaderboardPopup(){
      if(lbPopup){
        lbPopup.style.display = 'none';
      }
    }

    let gameResultAutoClose = null;
    let gameResultPlayAgainHandler = null;
    let gameResultMainMenuHandler = null;

    function hideGameResultOverlay(){
      if(!gameResultOverlay) return;
      gameResultOverlay.classList.remove('is-visible');
      gameResultOverlay.setAttribute('aria-hidden', 'true');
      gameResultPlayAgainHandler = null;
      gameResultMainMenuHandler = null;
      if(gameResultAutoClose){
        clearTimeout(gameResultAutoClose);
        gameResultAutoClose = null;
      }
    }

    function showGameResultOverlay({ outcome = 'win', title, message, showActions = false, autoCloseMs = 2200, onPlayAgain, onMainMenu } = {}){
      if(!gameResultOverlay || !gameResultCard) return;
      if(gameResultAutoClose){
        clearTimeout(gameResultAutoClose);
        gameResultAutoClose = null;
      }
      const resolvedTitle = title || (outcome === 'win' ? 'Je wint!' : outcome === 'lose' ? 'Je verliest' : 'Gelijkspel');
      gameResultTitle.textContent = resolvedTitle;
      gameResultMessage.textContent = message || '';
      gameResultCard.classList.remove('win', 'lose', 'push');
      gameResultCard.classList.add(outcome === 'lose' ? 'lose' : outcome === 'push' ? 'push' : 'win');
      gameResultActions.style.display = showActions ? 'flex' : 'none';
      gameResultPlayAgainHandler = typeof onPlayAgain === 'function' ? onPlayAgain : null;
      gameResultMainMenuHandler = typeof onMainMenu === 'function' ? onMainMenu : null;
      gameResultOverlay.classList.add('is-visible');
      gameResultOverlay.setAttribute('aria-hidden', 'false');

      if(!showActions){
        gameResultAutoClose = setTimeout(() => {
          hideGameResultOverlay();
        }, autoCloseMs);
      }
    }

    if(gameResultPlayAgain){
      gameResultPlayAgain.addEventListener('click', () => {
        hideGameResultOverlay();
        if(gameResultPlayAgainHandler){
          gameResultPlayAgainHandler();
        }
      });
    }

    if(gameResultMainMenu){
      gameResultMainMenu.addEventListener('click', () => {
        hideGameResultOverlay();
        if(gameResultMainMenuHandler){
          gameResultMainMenuHandler();
        }
      });
    }

    const sleep = (ms)=>new Promise(resolve=>setTimeout(resolve, ms));

    /* ---------------------------
       Login / accounts
       --------------------------- */
    loginSection.style.display = 'flex';

    loginBtn.onclick = async ()=>{
      const rawName = usernameInput.value.trim();
      const passwd = passwordInput.value.trim();
      if(!rawName || !passwd) return alert('Vul gebruikersnaam en wachtwoord in.');

      const key = keyForName(rawName);
      const existing = await loadUser(key);
      if(!existing) return alert('Account bestaat niet.');
      if(existing.password !== passwd) return alert('Wachtwoord onjuist.');

      const needsLuckyInit = typeof existing.luckyCoins !== 'number' || typeof existing.luckyCoinProgress !== 'number';
      currentUser = existing;
      currentUser.key = key;
      ensureLuckyFields(currentUser);
      loginSection.style.display='none';
      showDashboard(true);
      if(needsLuckyInit){
        saveCurrentUser();
      }
    };

    createAccountBtn.onclick = async ()=>{
      const rawName = usernameInput.value.trim();
      const passwd = passwordInput.value.trim();
      if(!rawName || !passwd) return alert('Vul gebruikersnaam en wachtwoord in.');

      const key = keyForName(rawName);
      const existing = await loadUser(key);
      if(existing){
        alert('Account bestaat al.');
        return;
      }

      currentUser = {
        key,
        name: rawName,
        password: passwd,
        credits: 1000,
        luckyCoins: 0,
        luckyCoinProgress: 0,
        lastDaily: null,
        wins: 0,
        losses: 0,
        gamesPlayed: 0,
        totalEarned: 0,
        bjWins: 0,
        bjLosses: 0,
        bjGames: 0,
        pkWins: 0,
        pkLosses: 0,
        pkGames: 0
      };
      await saveCurrentUser();
      loginSection.style.display='none';
      showDashboard(true);
    };

    function ensureLuckyFields(user){
      if(!user) return;
      if(typeof user.luckyCoins !== 'number') user.luckyCoins = 0;
      if(typeof user.luckyCoinProgress !== 'number') user.luckyCoinProgress = 0;
    }

    function canPurchaseLuckyDrop(){
      return !!currentUser && currentUser.luckyCoins >= 1;
    }

    function updateLuckyDropIndicator(){
      if(!luckyDropBtn) return;
      if(canPurchaseLuckyDrop()){
        luckyDropBtn.classList.add('has-available');
      } else {
        luckyDropBtn.classList.remove('has-available');
      }
    }

    function triggerLuckyDropShake(){
      if(!luckyDropBtn || !canPurchaseLuckyDrop()) return;
      luckyDropBtn.classList.remove('shake');
      void luckyDropBtn.offsetWidth;
      luckyDropBtn.classList.add('shake');
    }

    function updateLuckyCoinDisplay(){
      if(!currentUser) return;
      ensureLuckyFields(currentUser);
      luckyCoinsEl.textContent = currentUser.luckyCoins;
      luckyCoinProgressEl.textContent = currentUser.luckyCoinProgress;
      updateLuckyDropIndicator();
    }

    function applyLuckyCoinProgress(amount){
      if(!currentUser || amount <= 0) return;
      ensureLuckyFields(currentUser);
      currentUser.luckyCoinProgress += amount;
      const earned = Math.floor(currentUser.luckyCoinProgress / 500);
      if(earned > 0){
        currentUser.luckyCoins += earned;
        currentUser.luckyCoinProgress = currentUser.luckyCoinProgress % 500;
      }
      updateLuckyCoinDisplay();
    }

    function recordGameResult(gameKey, outcome, winAmount = 0){
      if(!currentUser) return;
      const winKey = `${gameKey}Wins`;
      const lossKey = `${gameKey}Losses`;
      const gamesKey = `${gameKey}Games`;
      currentUser[gamesKey] = (currentUser[gamesKey] || 0) + 1;
      currentUser.gamesPlayed = (currentUser.gamesPlayed || 0) + 1;
      if(outcome === 'win'){
        currentUser[winKey] = (currentUser[winKey] || 0) + 1;
        currentUser.wins = (currentUser.wins || 0) + 1;
        currentUser.totalEarned = (currentUser.totalEarned || 0) + winAmount;
      } else if(outcome === 'lose'){
        currentUser[lossKey] = (currentUser[lossKey] || 0) + 1;
        currentUser.losses = (currentUser.losses || 0) + 1;
      }
    }

    function renderDashboard(){
      if(!currentUser) return;
      ensureLuckyFields(currentUser);
      displayName.textContent = currentUser.name;
      creditsEl.textContent = currentUser.credits;
      updateLuckyCoinDisplay();
      if(currencyDisplay){
        currencyDisplay.style.display = 'flex';
      }
    }

    function showDashboard(shouldShake = false){
      dashboard.style.display = 'block';
      hideGameResultOverlay();
      renderDashboard();
      if(shouldShake){
        triggerLuckyDropShake();
      }
    }

    logoutBtn.onclick = () => {
      currentUser = null;
      closeLeaderboardPopup();
      dashboard.style.display = 'none';
      blackjackSection.style.display = 'none';
      pokerSection.style.display = 'none';
      crapsSection.style.display = 'none';
      baccaratSection.style.display = 'none';
      rouletteSection.style.display = 'none';
      slotsSection.style.display = 'none';
      plinkoSection.style.display = 'none';
      lootBoxMenuSection.style.display = 'none';
      lootBoxSection.style.display = 'none';
      loginSection.style.display = 'flex';
      if(currencyDisplay) currencyDisplay.style.display = 'none';
    };

    let developerClicks = 0;
    let developerClickTimer = null;

    function openDeveloperPortal(){
      if(!developerPortal) return;
      developerPortal.style.display = 'flex';
    }

    function closeDeveloperPortal(){
      if(!developerPortal) return;
      developerPortal.style.display = 'none';
    }

    if(welcomeBack){
      welcomeBack.addEventListener('click', () => {
        developerClicks += 1;
        if(developerClickTimer){
          clearTimeout(developerClickTimer);
        }
        developerClickTimer = setTimeout(() => {
          developerClicks = 0;
        }, 800);
        if(developerClicks === 3){
          developerClicks = 0;
          const password = prompt('Developer wachtwoord:');
          if(password === 'pepjes'){
            openDeveloperPortal();
          } else if(password !== null){
            alert('Onjuist wachtwoord.');
          }
        }
      });
    }

    if(closeDevPortal){
      closeDevPortal.addEventListener('click', closeDeveloperPortal);
    }

    if(devCreditsBtn){
      devCreditsBtn.addEventListener('click', async () => {
        if(!currentUser) return;
        currentUser.credits = 999999999;
        await saveCurrentUser();
        renderDashboard();
        alert('Oneindige credits geactiveerd.');
      });
    }

    if(devLuckyBtn){
      devLuckyBtn.addEventListener('click', async () => {
        if(!currentUser) return;
        ensureLuckyFields(currentUser);
        currentUser.luckyCoins = 999999999;
        currentUser.luckyCoinProgress = 0;
        await saveCurrentUser();
        renderDashboard();
        alert('Oneindige lucky coins geactiveerd.');
      });
    }

    claimDailyBtn.onclick = async ()=>{
      if(!currentUser) return;
      const t = new Date().toDateString();
      if(currentUser.lastDaily !== t){
        currentUser.credits += 100;
        currentUser.lastDaily = t;
        await saveCurrentUser();
        renderDashboard();
        alert('Dagelijkse bonus geclaimd: +100 credits');
      } else {
        alert('Je hebt vandaag al je bonus geclaimd.');
      }
    };

    playBlackjackBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      slotsSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      blackjackSection.style.display='block';
    };

    playPokerBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      slotsSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      pokerSection.style.display='block';
    };

    playCrapsBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      slotsSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      crapsSection.style.display='block';
    };

    playBaccaratBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      rouletteSection.style.display='none';
      slotsSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      baccaratSection.style.display='block';
    };

    playRouletteBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      slotsSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      rouletteSection.style.display='block';
    };

    playSlotsBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      plinkoSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      slotsSection.style.display='block';
    };

    playPlinkoBtn.onclick = ()=>{
      closeLeaderboardPopup();
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      slotsSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      plinkoSection.style.display='block';
      layoutPlinkoPegs();
    };

    if(luckyDropBtn){
      luckyDropBtn.onclick = ()=>{
        if(!currentUser) return alert('Je moet eerst inloggen!');
        closeLeaderboardPopup();
        dashboard.style.display = 'none';
        blackjackSection.style.display = 'none';
        pokerSection.style.display = 'none';
        crapsSection.style.display = 'none';
        baccaratSection.style.display = 'none';
        rouletteSection.style.display = 'none';
        slotsSection.style.display = 'none';
        plinkoSection.style.display = 'none';
        lootBoxSection.style.display = 'none';
        lootBoxMenuSection.style.display = 'block';
      };
    }

    const lootBoxConfigs = {
      lucky: { name: 'Lucky Box', cost: 1, startLevel: 1 },
      deluxe: { name: 'Deluxe Lucky Box', cost: 5, startLevel: 2 },
      ultra: { name: 'Ultra Deluxe Lucky Box', cost: 10, startLevel: 3 }
    };
    const lootBoxRewards = {
      1: 50,
      2: 150,
      3: 500,
      4: 1000,
      5: 2500
    };
    let currentLootBox = null;

    document.querySelectorAll('.lootbox-card[data-lootbox]').forEach((card)=>{
      card.addEventListener('click', ()=>{
        triggerLootBoxAnimation(card, 'is-tapped');
        const type = card.getAttribute('data-lootbox');
        openLootBox(type);
      });
    });

    function triggerLootBoxAnimation(card, className){
      if(!card) return;
      card.classList.remove(className);
      void card.offsetWidth;
      card.classList.add(className);
    }

    function updateLootBoxUI(){
      if(!currentLootBox) return;
      lootBoxTitle.textContent = currentLootBox.name;
      lootBoxSubtitle.textContent = `Klik op de box om te upgraden. ${currentLootBox.remainingChances} kansen over.`;
      lootBoxLevel.textContent = currentLootBox.level;
      lootBoxCard.className = `lootbox-card lootbox-level-${currentLootBox.level}`;
      if(currentLootBox.remainingChances === 0){
        lootBoxCard.classList.add('disabled');
      }
      const dots = lootBoxChances.querySelectorAll('.chance-dot');
      dots.forEach((dot, index)=>{
        dot.classList.toggle('used', index >= currentLootBox.remainingChances);
      });
    }

    function openLootBox(type){
      if(!currentUser) return alert('Je moet eerst inloggen!');
      closeLeaderboardPopup();
      const config = lootBoxConfigs[type];
      ensureLuckyFields(currentUser);
      if(currentUser.luckyCoins < config.cost){
        alert(`Je hebt ${config.cost} Lucky Coins nodig voor ${config.name}.`);
        return;
      }
      currentUser.luckyCoins -= config.cost;
      currentLootBox = {
        type,
        name: config.name,
        level: config.startLevel,
        remainingChances: 3
      };
      lootBoxReward.textContent = '';
      lootBoxHint.textContent = 'Klik om te upgraden (12,5% kans per klik).';
      dashboard.style.display = 'none';
      blackjackSection.style.display = 'none';
      pokerSection.style.display = 'none';
      lootBoxMenuSection.style.display = 'none';
      lootBoxSection.style.display = 'block';
      updateLuckyCoinDisplay();
      updateLootBoxUI();
      saveCurrentUser();
    }

    lootBoxCard.onclick = ()=>{
      if(!currentLootBox || currentLootBox.remainingChances === 0) return;
      const previousLevel = currentLootBox.level;
      currentLootBox.remainingChances -= 1;
      if(Math.random() < 0.125 && currentLootBox.level < 5){
        currentLootBox.level += 1;
      }
      triggerLootBoxAnimation(lootBoxCard, 'is-tapped');
      if(currentLootBox.level > previousLevel){
        triggerLootBoxAnimation(lootBoxCard, 'is-leveling');
      }
      if(currentLootBox.remainingChances === 0){
        const reward = lootBoxRewards[currentLootBox.level];
        currentUser.credits += reward;
        lootBoxHint.textContent = 'Kist geopend! Je beloning is uitgekeerd.';
        lootBoxReward.textContent = `Beloning: ${reward} credits (level ${currentLootBox.level}).`;
        saveCurrentUser().then(renderDashboard);
      }
      updateLootBoxUI();
    };
const playHorseRaceBtn = document.getElementById("playHorseRaceBtn");

playHorseRaceBtn.onclick = () => {
    closeLeaderboardPopup();
    dashboard.style.display = "none";
    lootBoxMenuSection.style.display = "none";
    lootBoxSection.style.display = "none";
    crapsSection.style.display = "none";
    baccaratSection.style.display = "none";
    rouletteSection.style.display = "none";
    slotsSection.style.display = "none";
    plinkoSection.style.display = "none";
    horseRaceSection.style.display = "block";
};

    backToMenuBtn.onclick = ()=>{
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      showDashboard(true);
    };

    backToMenuFromLoot.onclick = ()=>{
      lootBoxSection.style.display = 'none';
      lootBoxMenuSection.style.display = 'block';
    };

    backToMenuFromLuckyBoxes.onclick = ()=>{
      lootBoxMenuSection.style.display = 'none';
      showDashboard(true);
    };

    backFromCrapsBtn.onclick = ()=>{
      crapsSection.style.display = 'none';
      showDashboard(true);
    };

    backFromBaccaratBtn.onclick = ()=>{
      baccaratSection.style.display = 'none';
      showDashboard(true);
    };

    backFromRouletteBtn.onclick = ()=>{
      rouletteSection.style.display = 'none';
      showDashboard(true);
    };

    backFromSlotsBtn.onclick = ()=>{
      slotsSection.style.display = 'none';
      showDashboard(true);
    };

    backFromPlinkoBtn.onclick = ()=>{
      plinkoSection.style.display = 'none';
      showDashboard(true);
    };

    /* ---------------------------
       Craps / Baccarat / Roulette logic
       --------------------------- */
    const diceFaces = ['⚀','⚁','⚂','⚃','⚄','⚅'];
    let crapsPoint = null;
    let crapsBet = 0;
    let crapsRolling = false;

    function rollDie(){
      return Math.floor(Math.random() * 6) + 1;
    }

    function updateCrapsDice(d1, d2){
      crapsDieOne.textContent = diceFaces[d1 - 1];
      crapsDieTwo.textContent = diceFaces[d2 - 1];
    }

    function resetCrapsRound(){
      crapsPoint = null;
      crapsBet = 0;
      crapsPointEl.textContent = 'Punt: -';
      crapsStatusEl.textContent = 'Plaats je inzet en gooi de dobbelstenen.';
      updateCrapsDice(1, 1);
    }

    rollCrapsBtn.onclick = async ()=>{
      if(!currentUser) return alert('Je moet eerst inloggen!');
      if(crapsRolling) return;
      if(crapsPoint === null){
        const bet = parseInt(crapsBetInput.value) || 0;
        if(bet < 10) return alert('Minimum inzet is 10 credits.');
        if(currentUser.credits < bet) return alert('Je hebt niet genoeg credits!');
        crapsBet = bet;
        currentUser.credits -= bet;
        await saveCurrentUser();
        renderDashboard();
      }

      crapsRolling = true;
      rollCrapsBtn.disabled = true;
      resetCrapsBtn.disabled = true;
      crapsDieOne.classList.add('dice-roll');
      crapsDieTwo.classList.add('dice-roll');
      crapsStatusEl.textContent = 'Dobbelstenen rollen...';
      await sleep(500);

      const d1 = rollDie();
      const d2 = rollDie();
      const total = d1 + d2;
      updateCrapsDice(d1, d2);
      crapsDieOne.classList.remove('dice-roll');
      crapsDieTwo.classList.remove('dice-roll');

      if(crapsPoint === null){
        if(total === 7 || total === 11){
          const winAmount = crapsBet * 2;
          currentUser.credits += winAmount;
          applyLuckyCoinProgress(winAmount);
          recordGameResult('craps', 'win', winAmount);
          crapsStatusEl.textContent = `Come-out ${total}! Je wint ${winAmount} credits.`;
          crapsPointEl.textContent = 'Punt: -';
          showGameResultOverlay({
            outcome: 'win',
            title: 'Craps: winst!',
            message: `Come-out ${total}. +${winAmount} credits.`
          });
          await saveCurrentUser();
          renderDashboard();
          crapsBet = 0;
        } else if([2,3,12].includes(total)){
          recordGameResult('craps', 'lose');
          crapsStatusEl.textContent = `Come-out ${total}. Je verliest je inzet.`;
          crapsPointEl.textContent = 'Punt: -';
          showGameResultOverlay({
            outcome: 'lose',
            title: 'Craps: verlies',
            message: `Come-out ${total}. Je verliest je inzet.`
          });
          await saveCurrentUser();
          renderDashboard();
          crapsBet = 0;
        } else {
          crapsPoint = total;
          crapsPointEl.textContent = `Punt: ${crapsPoint}`;
          crapsStatusEl.textContent = `Punt gezet op ${crapsPoint}. Gooi door om te winnen!`;
        }
      } else {
        if(total === crapsPoint){
          const winAmount = crapsBet * 2;
          currentUser.credits += winAmount;
          applyLuckyCoinProgress(winAmount);
          recordGameResult('craps', 'win', winAmount);
          crapsStatusEl.textContent = `Je rolt ${total} en maakt je punt! +${winAmount} credits.`;
          showGameResultOverlay({
            outcome: 'win',
            title: 'Craps: winst!',
            message: `Punt geraakt met ${total}. +${winAmount} credits.`
          });
          await saveCurrentUser();
          renderDashboard();
          crapsPoint = null;
          crapsBet = 0;
          crapsPointEl.textContent = 'Punt: -';
        } else if(total === 7){
          recordGameResult('craps', 'lose');
          crapsStatusEl.textContent = '7-out! Je verliest je inzet.';
          showGameResultOverlay({
            outcome: 'lose',
            title: 'Craps: verlies',
            message: '7-out! Je verliest je inzet.'
          });
          await saveCurrentUser();
          renderDashboard();
          crapsPoint = null;
          crapsBet = 0;
          crapsPointEl.textContent = 'Punt: -';
        } else {
          crapsStatusEl.textContent = `Je rolt ${total}. Punt blijft ${crapsPoint}.`;
        }
      }

      crapsRolling = false;
      rollCrapsBtn.disabled = false;
      resetCrapsBtn.disabled = false;
    };

    resetCrapsBtn.onclick = ()=>{
      resetCrapsRound();
    };

    resetCrapsRound();

    function baccaratCard(){
      const suits = ['♠','♥','♦','♣'];
      const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
      const value = values[Math.floor(Math.random() * values.length)];
      const suit = suits[Math.floor(Math.random() * suits.length)];
      let points = parseInt(value, 10);
      if(Number.isNaN(points)){
        points = value === 'A' ? 1 : 0;
      }
      return { value, suit, points };
    }

    function baccaratScore(hand){
      return hand.reduce((sum, card)=>sum + card.points, 0) % 10;
    }

    function renderBaccaratHand(row, hand, label){
      row.innerHTML = `<strong style="width:100%; text-align:center;">${label} (${baccaratScore(hand)})</strong>` +
        hand.map(card=>`<div class="baccarat-card">${card.value}${card.suit}</div>`).join('');
    }

    dealBaccaratBtn.onclick = async ()=>{
      if(!currentUser) return alert('Je moet eerst inloggen!');
      if(dealBaccaratBtn.disabled) return;
      const bet = parseInt(baccaratBetInput.value) || 0;
      if(bet < 10) return alert('Minimum inzet is 10 credits.');
      if(currentUser.credits < bet) return alert('Je hebt niet genoeg credits!');

      dealBaccaratBtn.disabled = true;
      baccaratBetInput.disabled = true;
      baccaratBetType.disabled = true;
      baccaratStatusEl.textContent = 'Kaarten worden gedeeld...';
      await sleep(450);

      currentUser.credits -= bet;
      await saveCurrentUser();
      renderDashboard();

      const playerHand = [baccaratCard(), baccaratCard()];
      const bankerHand = [baccaratCard(), baccaratCard()];

      const playerScore = baccaratScore(playerHand);
      const bankerScore = baccaratScore(bankerHand);

      if(playerScore < 8 && bankerScore < 8){
        if(playerScore <= 5){
          playerHand.push(baccaratCard());
        }
        const newBankerScore = baccaratScore(bankerHand);
        if(newBankerScore <= 5){
          bankerHand.push(baccaratCard());
        }
      }

      const finalPlayerScore = baccaratScore(playerHand);
      const finalBankerScore = baccaratScore(bankerHand);
      let winner = 'tie';
      if(finalPlayerScore > finalBankerScore) winner = 'player';
      if(finalBankerScore > finalPlayerScore) winner = 'banker';

      renderBaccaratHand(baccaratPlayerRow, playerHand, 'Player');
      renderBaccaratHand(baccaratBankerRow, bankerHand, 'Banker');

      let winAmount = 0;
      if(baccaratBetType.value === winner){
        if(winner === 'tie'){
          winAmount = bet * 9;
        } else if(winner === 'banker'){
          winAmount = Math.floor(bet * 1.95);
        } else {
          winAmount = bet * 2;
        }
        currentUser.credits += winAmount;
        applyLuckyCoinProgress(winAmount);
        recordGameResult('baccarat', 'win', winAmount);
        baccaratStatusEl.textContent = `Winner: ${winner.toUpperCase()}! Je wint ${winAmount} credits.`;
        showGameResultOverlay({
          outcome: 'win',
          title: 'Baccarat: winst!',
          message: `Winner: ${winner.toUpperCase()}. +${winAmount} credits.`
        });
      } else {
        recordGameResult('baccarat', 'lose');
        baccaratStatusEl.textContent = `Winner: ${winner.toUpperCase()}. Je verliest je inzet.`;
        showGameResultOverlay({
          outcome: 'lose',
          title: 'Baccarat: verlies',
          message: `Winner: ${winner.toUpperCase()}. Je verliest je inzet.`
        });
      }

      await saveCurrentUser();
      renderDashboard();
      dealBaccaratBtn.disabled = false;
      baccaratBetInput.disabled = false;
      baccaratBetType.disabled = false;
    };

    const rouletteRedNumbers = new Set([
      1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36
    ]);

    function rouletteColorFor(number){
      if(number === 0) return 'green';
      return rouletteRedNumbers.has(number) ? 'red' : 'black';
    }

    function updateRouletteInputs(){
      const type = rouletteBetType.value;
      rouletteColor.disabled = type !== 'color';
      rouletteNumber.disabled = type !== 'number';
    }

    rouletteBetType.onchange = updateRouletteInputs;
    updateRouletteInputs();

    let rouletteSpinning = false;
    spinRouletteBtn.onclick = async ()=>{
      if(!currentUser) return alert('Je moet eerst inloggen!');
      if(rouletteSpinning) return;
      const bet = parseInt(rouletteBetInput.value) || 0;
      if(bet < 10) return alert('Minimum inzet is 10 credits.');
      if(currentUser.credits < bet) return alert('Je hebt niet genoeg credits!');

      rouletteSpinning = true;
      spinRouletteBtn.disabled = true;
      rouletteBetInput.disabled = true;
      rouletteBetType.disabled = true;
      rouletteColor.disabled = true;
      rouletteNumber.disabled = true;
      rouletteWheel?.classList.add('spinning');
      rouletteStatus.textContent = 'Het wiel draait...';
      await sleep(1100);

      currentUser.credits -= bet;
      await saveCurrentUser();
      renderDashboard();

      const resultNumber = Math.floor(Math.random() * 37);
      const resultColor = rouletteColorFor(resultNumber);
      rouletteResult.textContent = `Resultaat: ${resultNumber} (${resultColor})`;

      let winAmount = 0;
      if(rouletteBetType.value === 'color'){
        if(rouletteColor.value === resultColor){
          winAmount = resultColor === 'green' ? bet * 14 : bet * 2;
        }
      } else {
        const chosenNumber = parseInt(rouletteNumber.value, 10);
        if(!Number.isNaN(chosenNumber) && chosenNumber === resultNumber){
          winAmount = bet * 36;
        }
      }

      if(winAmount > 0){
        currentUser.credits += winAmount;
        applyLuckyCoinProgress(winAmount);
        recordGameResult('roulette', 'win', winAmount);
        rouletteStatus.textContent = `Je wint ${winAmount} credits!`;
        showGameResultOverlay({
          outcome: 'win',
          title: 'Roulette: winst!',
          message: `Je wint ${winAmount} credits.`
        });
      } else {
        recordGameResult('roulette', 'lose');
        rouletteStatus.textContent = 'Helaas, geen winst deze draai.';
        showGameResultOverlay({
          outcome: 'lose',
          title: 'Roulette: verlies',
          message: 'Geen winst deze draai.'
        });
      }

      await saveCurrentUser();
      renderDashboard();
      rouletteWheel?.classList.remove('spinning');
      rouletteSpinning = false;
      spinRouletteBtn.disabled = false;
      rouletteBetInput.disabled = false;
      rouletteBetType.disabled = false;
      updateRouletteInputs();
    };

    /* ---------------------------
       Slots logic
       --------------------------- */
    const slotSymbols = ['🍒','🍋','🔔','🍀','⭐','💎','7️⃣','🍇'];
    const slotReelStrips = [slotReelOne, slotReelTwo, slotReelThree];
    const slotReelContainers = slotReelStrips.map(strip => strip.parentElement);
    const slotSymbolSize = 72;
    const slotRepeats = 6;
    let slotsSpinning = false;

    function buildSlotReel(strip){
      strip.innerHTML = '';
      const fragment = document.createDocumentFragment();
      for(let i = 0; i < slotRepeats; i++){
        slotSymbols.forEach(symbol => {
          const div = document.createElement('div');
          div.className = 'slot-symbol';
          div.textContent = symbol;
          fragment.appendChild(div);
        });
      }
      strip.appendChild(fragment);
    }

    slotReelStrips.forEach(buildSlotReel);

    function spinSlotReel(strip, container, stopIndex, duration, loops){
      return new Promise((resolve)=>{
        const finalIndex = (loops * slotSymbols.length) + stopIndex;
        const offset = -(finalIndex * slotSymbolSize);
        container.classList.add('spinning');
        strip.style.transition = 'none';
        strip.style.transform = 'translateY(0px)';
        void strip.offsetHeight;
        strip.style.transition = `transform ${duration}ms cubic-bezier(0.15, 0.65, 0.2, 1)`;
        strip.style.transform = `translateY(${offset}px)`;
        strip.addEventListener('transitionend', () => {
          container.classList.remove('spinning');
          resolve();
        }, { once: true });
      });
    }

    async function spinSlots(){
      if(slotsSpinning) return;
      if(!currentUser) return alert('Je moet eerst inloggen!');
      const bet = parseInt(slotsBetInput.value) || 0;
      if(bet < 10) return alert('Minimum inzet is 10 credits.');
      if(currentUser.credits < bet) return alert('Je hebt niet genoeg credits!');

      currentUser.credits -= bet;
      await saveCurrentUser();
      renderDashboard();

      slotsSpinning = true;
      spinSlotsBtn.disabled = true;
      spinSlotsBtn.classList.remove('pulling');
      void spinSlotsBtn.offsetHeight;
      spinSlotsBtn.classList.add('pulling');
      slotsStatus.classList.remove('slots-win');
      slotsStatus.textContent = 'De rollen draaien...';

      const results = slotReelStrips.map(() => Math.floor(Math.random() * slotSymbols.length));
      const spinPromises = slotReelStrips.map((strip, index) => {
        const loops = 3 + index;
        const duration = 1200 + (index * 350);
        return spinSlotReel(strip, slotReelContainers[index], results[index], duration, loops);
      });

      await Promise.all(spinPromises);

      const [first, second, third] = results;
      let winAmount = 0;
      if(first === second && second === third){
        const symbol = slotSymbols[first];
        const multiplier = symbol === '7️⃣' ? 20 : symbol === '💎' ? 15 : 10;
        winAmount = bet * multiplier;
      } else if(first === second || first === third || second === third){
        winAmount = bet * 2;
      }

      if(winAmount > 0){
        currentUser.credits += winAmount;
        applyLuckyCoinProgress(winAmount);
        recordGameResult('slots', 'win', winAmount);
        slotsStatus.textContent = `Winst! Je ontvangt ${winAmount} credits.`;
        slotsStatus.classList.add('slots-win');
        showGameResultOverlay({
          outcome: 'win',
          title: 'Slots: winst!',
          message: `Je ontvangt ${winAmount} credits.`
        });
      } else {
        recordGameResult('slots', 'lose');
        slotsStatus.textContent = 'Geen match deze spin. Probeer opnieuw.';
        showGameResultOverlay({
          outcome: 'lose',
          title: 'Slots: verlies',
          message: 'Geen match deze spin.'
        });
      }

      await saveCurrentUser();
      renderDashboard();
      slotsSpinning = false;
      spinSlotsBtn.disabled = false;
    }

    spinSlotsBtn.onclick = ()=>{ void spinSlots(); };

    /* ---------------------------
       Plinko logic
       --------------------------- */
    const plinkoSlotMultipliers = [3, 2, 1.5, 1, 0.6, 1, 1.5, 2, 3];
    const plinkoPegRows = 7;
    const plinkoBallMin = 1;
    const plinkoBallMax = 15;
    let plinkoBallCount = 10;
    const plinkoBallRadius = 9;
    const plinkoPegRadius = 6;
    const plinkoGravity = 0.38;
    const plinkoBounce = 0.72;
    const plinkoCenterBias = 0.0018;
    let plinkoDropping = false;
    let plinkoPegPoints = [];
    let plinkoBoardMetrics = null;
    let plinkoActiveBalls = [];
    let plinkoAnimationId = null;
    let plinkoActiveBatch = null;

    function updatePlinkoPerBallLabel(){
      if(!plinkoPerBall || !plinkoBetInput) return;
      const bet = parseInt(plinkoBetInput.value, 10) || 0;
      plinkoPerBall.textContent = `Per bal: ${bet} credits`;
    }

    function syncPlinkoBallCount(){
      if(!plinkoBallCountInput) return plinkoBallCount;
      const rawValue = parseInt(plinkoBallCountInput.value, 10);
      const safeValue = Number.isFinite(rawValue) ? rawValue : plinkoBallCount;
      const clamped = Math.max(plinkoBallMin, Math.min(plinkoBallMax, safeValue));
      plinkoBallCount = clamped;
      plinkoBallCountInput.value = clamped;
      return plinkoBallCount;
    }

    function renderPlinkoSlots(){
      if(!plinkoSlots) return;
      plinkoSlots.innerHTML = '';
      plinkoSlotMultipliers.forEach((multiplier)=>{
        const slot = document.createElement('div');
        slot.className = 'plinko-slot';
        slot.textContent = `${multiplier}x`;
        plinkoSlots.appendChild(slot);
      });
    }

    function layoutPlinkoPegs(){
      if(!plinkoPegs || !plinkoBoard) return;
      plinkoPegs.innerHTML = '';
      const boardRect = plinkoBoard.getBoundingClientRect();
      const pegRect = plinkoPegs.getBoundingClientRect();
      const pegAreaHeight = pegRect.height;
      const pegAreaWidth = pegRect.width;
      plinkoPegPoints = [];
      for(let row = 0; row < plinkoPegRows; row += 1){
        const cols = 6 + row;
        for(let col = 0; col < cols; col += 1){
          const peg = document.createElement('div');
          peg.className = 'plinko-peg';
          const x = ((col + 1) / (cols + 1)) * pegAreaWidth;
          const y = ((row + 1) / (plinkoPegRows + 1)) * pegAreaHeight;
          peg.style.left = `${x}px`;
          peg.style.top = `${y}px`;
          plinkoPegs.appendChild(peg);
          plinkoPegPoints.push({
            x: x + (pegRect.left - boardRect.left),
            y: y + (pegRect.top - boardRect.top)
          });
        }
      }
      const slotHeight = plinkoSlots?.getBoundingClientRect().height || 96;
      plinkoBoardMetrics = {
        width: boardRect.width,
        height: boardRect.height,
        slotWidth: boardRect.width / plinkoSlotMultipliers.length,
        slotHeight,
        centerX: boardRect.width / 2,
        landingY: boardRect.height - slotHeight + plinkoBallRadius
      };
    }

    function highlightPlinkoSlot(index){
      if(!plinkoSlots) return;
      [...plinkoSlots.children].forEach((slot, idx)=>{
        slot.classList.toggle('active', idx === index);
      });
    }

    function gaussianRandom(mean, deviation){
      let u = 0;
      let v = 0;
      while(u === 0) u = Math.random();
      while(v === 0) v = Math.random();
      const value = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
      return value * deviation + mean;
    }

    function spawnPlinkoBall(){
      if(!plinkoBoardMetrics) return;
      const startSpread = plinkoBoardMetrics.width * 0.12;
      const startX = Math.min(
        plinkoBoardMetrics.width - plinkoBallRadius,
        Math.max(
          plinkoBallRadius,
          gaussianRandom(plinkoBoardMetrics.centerX, startSpread)
        )
      );
      const ball = document.createElement('div');
      ball.className = 'plinko-ball';
      plinkoBoard.appendChild(ball);
      const ballState = {
        el: ball,
        x: startX,
        y: plinkoBallRadius + 8,
        vx: (Math.random() - 0.5) * 0.8,
        vy: 0,
        settled: false
      };
      plinkoActiveBalls.push(ballState);
      renderPlinkoBall(ballState);
    }

    function renderPlinkoBall(ballState){
      ballState.el.style.left = `${ballState.x - plinkoBallRadius}px`;
      ballState.el.style.top = `${ballState.y - plinkoBallRadius}px`;
    }

    function settlePlinkoBall(ballState, slotIndex){
      if(!plinkoActiveBatch) return;
      ballState.settled = true;
      highlightPlinkoSlot(slotIndex);
      const multiplier = plinkoSlotMultipliers[slotIndex];
      const winAmount = Math.round(plinkoActiveBatch.bet * multiplier);
      plinkoActiveBatch.totalWin += winAmount;
      plinkoActiveBatch.landed += 1;
      plinkoStatus.textContent = `Bal ${plinkoActiveBatch.landed}/${plinkoBallCount} landt op ${multiplier}x.`;
      setTimeout(() => {
        ballState.el.remove();
      }, 400);
    }

    async function finishPlinkoBatch(){
      if(!plinkoActiveBatch) return;
      const totalWin = plinkoActiveBatch.totalWin;
      if(totalWin > 0){
        currentUser.credits += totalWin;
        applyLuckyCoinProgress(totalWin);
      }
      const net = totalWin - plinkoActiveBatch.totalBet;
      const outcome = totalWin >= plinkoActiveBatch.totalBet ? 'win' : 'lose';
      recordGameResult('plinko', outcome, totalWin);
      plinkoStatus.textContent = `Alle ${plinkoBallCount} ballen klaar. Totale winst: ${totalWin} credits (netto ${net}).`;
      showGameResultOverlay({
        outcome,
        title: outcome === 'win' ? 'Plinko: winst!' : 'Plinko: verlies',
        message: `Totale winst: ${totalWin} credits (netto ${net}).`
      });
      await saveCurrentUser();
      renderDashboard();
      plinkoDropping = false;
      dropPlinkoBtn.disabled = false;
      if(plinkoBallCountInput) plinkoBallCountInput.disabled = false;
      plinkoActiveBatch = null;
    }

    function updatePlinkoBalls(delta){
      if(!plinkoBoardMetrics) return;
      const ballCount = plinkoActiveBalls.length;
      if(ballCount === 0) return;
      const maxX = plinkoBoardMetrics.width - plinkoBallRadius;
      const minX = plinkoBallRadius;
      for(let i = plinkoActiveBalls.length - 1; i >= 0; i -= 1){
        const ball = plinkoActiveBalls[i];
        if(ball.settled) continue;
        ball.vy += plinkoGravity * delta;
        ball.vx += (plinkoBoardMetrics.centerX - ball.x) * plinkoCenterBias * delta;
        ball.x += ball.vx * delta;
        ball.y += ball.vy * delta;

        if(ball.x <= minX){
          ball.x = minX;
          ball.vx *= -0.5;
        }
        if(ball.x >= maxX){
          ball.x = maxX;
          ball.vx *= -0.5;
        }

        for(const peg of plinkoPegPoints){
          const dx = ball.x - peg.x;
          const dy = ball.y - peg.y;
          const distance = Math.hypot(dx, dy);
          const minDistance = plinkoBallRadius + plinkoPegRadius;
          if(distance > 0 && distance < minDistance){
            const nx = dx / distance;
            const ny = dy / distance;
            const overlap = minDistance - distance;
            ball.x += nx * overlap;
            ball.y += ny * overlap;
            const dot = ball.vx * nx + ball.vy * ny;
            if(dot < 0){
              ball.vx -= 2 * dot * nx;
              ball.vy -= 2 * dot * ny;
            }
            ball.vx *= plinkoBounce;
            ball.vy *= plinkoBounce;
            ball.vx += (Math.random() - 0.5) * 0.2;
          }
        }

        if(ball.y >= plinkoBoardMetrics.landingY){
          const slotIndex = Math.max(
            0,
            Math.min(
              plinkoSlotMultipliers.length - 1,
              Math.floor(ball.x / plinkoBoardMetrics.slotWidth)
            )
          );
          settlePlinkoBall(ball, slotIndex);
          plinkoActiveBalls.splice(i, 1);
          continue;
        }

        renderPlinkoBall(ball);
      }

      if(plinkoActiveBatch && plinkoActiveBatch.landed >= plinkoBallCount && plinkoActiveBalls.length === 0){
        void finishPlinkoBatch();
      }
    }

    function startPlinkoAnimation(){
      if(plinkoAnimationId) return;
      let lastTime = null;
      const step = (timestamp) => {
        if(lastTime === null) lastTime = timestamp;
        const delta = Math.min(2, (timestamp - lastTime) / 16.67);
        lastTime = timestamp;
        updatePlinkoBalls(delta);
        if(plinkoActiveBalls.length > 0){
          plinkoAnimationId = requestAnimationFrame(step);
        } else {
          plinkoAnimationId = null;
        }
      };
      plinkoAnimationId = requestAnimationFrame(step);
    }

    async function dropPlinkoBall(){
      if(plinkoDropping) return;
      if(!currentUser) return alert('Je moet eerst inloggen!');
      const bet = parseInt(plinkoBetInput.value, 10) || 0;
      if(bet < 10) return alert('Minimum inzet is 10 credits.');
      syncPlinkoBallCount();
      const totalBet = bet * plinkoBallCount;
      if(currentUser.credits < totalBet) return alert('Je hebt niet genoeg credits!');

      currentUser.credits -= totalBet;
      await saveCurrentUser();
      renderDashboard();

      plinkoDropping = true;
      dropPlinkoBtn.disabled = true;
      if(plinkoBallCountInput) plinkoBallCountInput.disabled = true;
      highlightPlinkoSlot(-1);
      plinkoStatus.textContent = `Dropping ${plinkoBallCount} ballen. Totale inzet ${totalBet} credits.`;
      plinkoActiveBatch = {
        bet,
        totalBet,
        totalWin: 0,
        landed: 0
      };

      layoutPlinkoPegs();
      for(let i = 0; i < plinkoBallCount; i += 1){
        spawnPlinkoBall();
        startPlinkoAnimation();
        await new Promise(resolve => setTimeout(resolve, 140));
      }
    }

    window.addEventListener('resize', ()=>{ layoutPlinkoPegs(); });
    renderPlinkoSlots();
    layoutPlinkoPegs();
    dropPlinkoBtn.onclick = ()=>{ void dropPlinkoBall(); };
    plinkoBetInput.addEventListener('input', updatePlinkoPerBallLabel);
    plinkoBallCountInput?.addEventListener('input', syncPlinkoBallCount);
    updatePlinkoPerBallLabel();

    /* ---------------------------
       Blackjack logic
       --------------------------- */
    const bjSuits = ['♠','♥','♦','♣'];
    const bjValues = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    const bjShoeDecks = 6;
    let bjShoeCards = [];

    function bjShuffle(cards){
      for(let i = cards.length - 1; i > 0; i -= 1){
        const j = Math.floor(Math.random() * (i + 1));
        [cards[i], cards[j]] = [cards[j], cards[i]];
      }
    }

    function bjBuildShoe(){
      bjShoeCards = [];
      for(let d = 0; d < bjShoeDecks; d += 1){
        for(const suit of bjSuits){
          for(const value of bjValues){
            bjShoeCards.push({ suit, value });
          }
        }
      }
      bjShuffle(bjShoeCards);
      updateShoeCount();
    }

    function updateShoeCount(){
      bjShoeCount.textContent = `Shoe: ${bjShoeCards.length} kaarten`;
    }

    function bjDrawCard(){
      if(bjShoeCards.length < 30){
        bjBuildShoe();
      }
      const card = bjShoeCards.pop();
      updateShoeCount();
      return card;
    }

    function bjCardValue(card){
      if(['J','Q','K'].includes(card.value)) return 10;
      if(card.value === 'A') return 11;
      return parseInt(card.value, 10);
    }

    function bjHandValue(hand){
      let total = 0;
      let aces = 0;
      hand.forEach(card=>{
        total += bjCardValue(card);
        if(card.value === 'A') aces += 1;
      });
      while(total > 21 && aces > 0){
        total -= 10;
        aces -= 1;
      }
      return total;
    }

    function wait(ms){
      return new Promise(resolve=>setTimeout(resolve, ms));
    }

    function isRedSuit(suit){
      return suit === '♥' || suit === '♦';
    }

    let bjPlayers = [];
    const bjDealer = { hand: [] };
    let bjCurrentIndex = 0;
    let bjBet = 100;
    let bjRoundActive = false;
    let bjAnimating = false;
    let bjDealerReveal = false;

    function createCardMarkup(card){
      const red = isRedSuit(card.suit);
      return `
        <div class="bj-card ${red ? 'red' : ''}">
          <div class="corner">${card.value}${card.suit}</div>
          <div class="center">${card.value}${card.suit}</div>
        </div>
      `;
    }

    function createCardBackMarkup(){
      return `<div class="bj-card is-back"></div>`;
    }

    function renderDealer(){
      const cardsHtml = bjDealer.hand.map(card=>{
        if(card.hidden){
          return createCardBackMarkup();
        }
        return createCardMarkup(card);
      }).join('');
      bjDealerHand.innerHTML = cardsHtml || '';
      const score = bjDealerReveal ? bjHandValue(bjDealer.hand) : '?';
      bjDealerScore.textContent = `Score: ${score}`;
    }

    function renderPlayers(){
      bjPlayersArea.innerHTML = bjPlayers.map((player, index)=>{
        const score = player.busted ? 'Bust' : bjHandValue(player.hand);
        const cardsHtml = player.hand.map(card=>createCardMarkup(card)).join('');
        return `
          <div class="bj-seat ${index === bjCurrentIndex && bjRoundActive ? 'active' : ''}" data-player-index="${index}">
            <h3>${player.name}</h3>
            <div class="bj-hand">${cardsHtml}</div>
            <div class="bj-score">Score: ${score}</div>
          </div>
        `;
      }).join('');
    }

    function renderBlackjack(){
      renderDealer();
      renderPlayers();
      setBlackjackControls();
    }

    function setBlackjackControls(){
      const isUserTurn = bjRoundActive && !bjAnimating && bjCurrentIndex === 0 && !bjDealerReveal;
      hitBtn.disabled = !isUserTurn;
      standBtn.disabled = !isUserTurn;
      nextRoundBtn.disabled = bjRoundActive || bjPlayers.length === 0 || bjAnimating;
    }

    function animateDealTo(targetEl){
      if(!bjShoe || !targetEl) return Promise.resolve();
      const stackRect = bjShoe.getBoundingClientRect();
      const targetRect = targetEl.getBoundingClientRect();
      const flight = document.createElement('div');
      flight.className = 'bj-fly-card';
      flight.style.left = `${stackRect.left}px`;
      flight.style.top = `${stackRect.top}px`;
      document.body.appendChild(flight);
      const deltaX = targetRect.left - stackRect.left;
      const deltaY = targetRect.top - stackRect.top;

      return new Promise(resolve=>{
        requestAnimationFrame(()=>{
          flight.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
          flight.style.opacity = '0';
        });
        const cleanup = ()=>{
          flight.remove();
          resolve();
        };
        flight.addEventListener('transitionend', cleanup, { once: true });
        setTimeout(cleanup, 700);
      });
    }

    async function dealCardToPlayer(index){
      const card = bjDrawCard();
      bjPlayers[index].hand.push({ ...card });
      renderBlackjack();
      const seat = bjPlayersArea.querySelector(`[data-player-index="${index}"] .bj-hand`);
      const cardEl = seat?.lastElementChild;
      await animateDealTo(cardEl);
    }

    async function dealCardToDealer({ hidden = false } = {}){
      const card = bjDrawCard();
      bjDealer.hand.push({ ...card, hidden });
      renderBlackjack();
      const cardEl = bjDealerHand?.lastElementChild;
      await animateDealTo(cardEl);
    }

    async function dealInitialCards(){
      bjAnimating = true;
      setBlackjackControls();
      for(let round = 0; round < 2; round += 1){
        for(let i = 0; i < bjPlayers.length; i += 1){
          await dealCardToPlayer(i);
          await wait(120);
        }
        await dealCardToDealer({ hidden: round === 0 });
        await wait(160);
      }
      bjAnimating = false;
      setBlackjackControls();
    }

    function advanceTurn(){
      do {
        bjCurrentIndex += 1;
      } while(bjCurrentIndex < bjPlayers.length && (bjPlayers[bjCurrentIndex].busted || bjPlayers[bjCurrentIndex].standing));
    }

    async function nextPlayer(){
      advanceTurn();
      if(bjCurrentIndex >= bjPlayers.length){
        await dealerTurn();
        return;
      }
      const current = bjPlayers[bjCurrentIndex];
      if(current.bot){
        await botTurn(current);
      } else {
        bjStatus.textContent = 'Jij bent aan de beurt.';
        renderBlackjack();
      }
    }

    async function botTurn(bot){
      bjAnimating = true;
      setBlackjackControls();
      bjStatus.textContent = `${bot.name} denkt na...`;
      await wait(400);
      while(bjHandValue(bot.hand) < 16){
        await dealCardToPlayer(bjCurrentIndex);
        await wait(220);
        if(bjHandValue(bot.hand) > 21){
          bot.busted = true;
          break;
        }
      }
      if(!bot.busted){
        bot.standing = true;
      }
      bjAnimating = false;
      renderBlackjack();
      await wait(200);
      await nextPlayer();
    }

    async function dealerTurn(){
      bjAnimating = true;
      bjDealerReveal = true;
      bjDealer.hand.forEach(card=>{ card.hidden = false; });
      renderBlackjack();
      bjStatus.textContent = 'Dealer speelt de hand.';
      await wait(500);
      while(bjHandValue(bjDealer.hand) < 17){
        await dealCardToDealer();
        await wait(220);
      }
      bjAnimating = false;
      renderBlackjack();
      checkWinners();
    }

    function checkWinners(){
      const dealerScore = bjHandValue(bjDealer.hand);
      const results = [];
      let userOutcome = null;
      let userDelta = 0;

      bjPlayers.forEach((player, index)=>{
        const playerScore = bjHandValue(player.hand);
        let outcome = 'lose';
        if(player.busted){
          outcome = 'lose';
        } else if(dealerScore > 21 || playerScore > dealerScore){
          outcome = 'win';
        } else if(playerScore === dealerScore){
          outcome = 'push';
        }

        if(index === 0 && currentUser){
          let delta = 0;
          if(outcome === 'win') delta = Math.floor(bjBet * 1.5);
          if(outcome === 'push') delta = bjBet;
          currentUser.credits += delta;
          if(outcome === 'win'){
            applyLuckyCoinProgress(delta);
          }
          currentUser.gamesPlayed = (currentUser.gamesPlayed || 0) + 1;
          if(outcome === 'win'){
            currentUser.wins = (currentUser.wins || 0) + 1;
            currentUser.totalEarned = (currentUser.totalEarned || 0) + delta;
            currentUser.bjWins = (currentUser.bjWins || 0) + 1;
          } else if(outcome === 'lose'){
            currentUser.losses = (currentUser.losses || 0) + 1;
            currentUser.bjLosses = (currentUser.bjLosses || 0) + 1;
          }
          currentUser.bjGames = (currentUser.bjGames || 0) + 1;
          userOutcome = outcome;
          userDelta = delta;
        }

        const text = outcome === 'win'
          ? `${player.name} wint`
          : outcome === 'push'
            ? `${player.name} speelt gelijk`
            : `${player.name} verliest`;
        results.push(text);
      });

      bjStatus.textContent = `Dealer heeft ${dealerScore}. ${results.join('. ')}.`;
      bjRoundActive = false;
      setBlackjackControls();
      if(currentUser){
        saveCurrentUser().then(renderDashboard);
      }
      if(userOutcome){
        const outcomeLabel = userOutcome === 'win'
          ? `Je wint ${userDelta} credits.`
          : userOutcome === 'push'
            ? 'Gelijkspel! Je krijgt je inzet terug.'
            : 'Helaas, je verliest deze ronde.';
        showGameResultOverlay({
          outcome: userOutcome === 'push' ? 'push' : userOutcome,
          title: userOutcome === 'win' ? 'Blackjack: winst!' : userOutcome === 'push' ? 'Blackjack: gelijkspel' : 'Blackjack: verlies',
          message: outcomeLabel,
          showActions: true,
          onPlayAgain: () => { void startRound(); },
          onMainMenu: () => { backToMenuBtn?.click(); }
        });
      }
    }

    async function startRound(){
      if(!currentUser) return;
      hideGameResultOverlay();
      const requestedBet = parseInt(betAmountInput.value, 10) || 100;
      if(currentUser.credits < requestedBet){
        alert('Je hebt niet genoeg credits voor deze inzet.');
        return;
      }
      bjBet = requestedBet;
      currentUser.credits -= bjBet;
      saveCurrentUser().then(renderDashboard);

      bjDealerReveal = false;
      bjRoundActive = true;
      bjCurrentIndex = 0;
      bjDealer.hand = [];
      bjPlayers.forEach(player=>{
        player.hand = [];
        player.busted = false;
        player.standing = false;
      });

      if(bjShoeCards.length === 0){
        bjBuildShoe();
      }

      bjStatus.textContent = 'Kaarten worden gedeeld...';
      renderBlackjack();
      await dealInitialCards();
      if(bjHandValue(bjPlayers[0].hand) === 21){
        bjPlayers[0].standing = true;
        await nextPlayer();
        return;
      }
      bjStatus.textContent = 'Jij bent aan de beurt.';
      renderBlackjack();
      if(bjPlayers[0].bot){
        await botTurn(bjPlayers[0]);
      }
    }

    startGameBtn.onclick = ()=>{
      if(!currentUser) return alert('Je moet eerst inloggen!');
      const botCount = parseInt(botSelect.value, 10);
      bjPlayers = [{ name: currentUser.name, bot: false, hand: [], busted: false, standing: false }];
      for(let i = 1; i <= botCount; i += 1){
        bjPlayers.push({ name: `Bot ${i}`, bot: true, hand: [], busted: false, standing: false });
      }
      bjDealer.hand = [];
      startRound();
    };

    hitBtn.onclick = async ()=>{
      if(hitBtn.disabled) return;
      bjAnimating = true;
      setBlackjackControls();
      await dealCardToPlayer(bjCurrentIndex);
      const score = bjHandValue(bjPlayers[bjCurrentIndex].hand);
      if(score > 21){
        bjPlayers[bjCurrentIndex].busted = true;
        bjStatus.textContent = 'Bust! Je bent uitgespeeld.';
        bjAnimating = false;
        renderBlackjack();
        await nextPlayer();
        return;
      }
      if(score === 21){
        bjPlayers[bjCurrentIndex].standing = true;
        bjAnimating = false;
        renderBlackjack();
        await nextPlayer();
        return;
      }
      bjAnimating = false;
      renderBlackjack();
    };

    standBtn.onclick = ()=>{
      if(standBtn.disabled) return;
      bjPlayers[bjCurrentIndex].standing = true;
      bjStatus.textContent = 'Je past. Volgende speler...';
      renderBlackjack();
      void nextPlayer();
    };

    nextRoundBtn.onclick = ()=>{
      if(nextRoundBtn.disabled) return;
      void startRound();
    };

    bjBuildShoe();
    renderBlackjack();

    /* ---------------------------
       Poker logic (casino stijl)
       --------------------------- */

    const pkSuits = ['♠','♥','♦','♣'];
    const pkValues = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    const pkValueMap = {2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:11,Q:12,K:13,A:14};
    let pkDeck = [];

    function pkCreateDeck(){
      pkDeck = [];
      for(const s of pkSuits) for(const v of pkValues) pkDeck.push({suit:s,value:v});
      for(let i=pkDeck.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [pkDeck[i],pkDeck[j]]=[pkDeck[j],pkDeck[i]];
      }
    }

    let pokerPlayers = [];
    let pokerPot = 0;
    let pokerCommunity = [];
    let pokerCurrentPlayerIndex = 0;
    let pokerTableMin = 500;
    let pokerTurnLocked = false;
    let pokerDealerIndex = 0;
    let pokerSmallBlind = 50;
    let pokerBigBlind = 100;
    let pokerCurrentBet = 0;
    let pokerMinRaise = 0;
    let pokerStage = 'Pre-flop';
    let pokerRevealHands = false;
    let pokerHandActive = false;
    let pokerSmallBlindIndex = 0;
    let pokerBigBlindIndex = 0;

    function pkDraw(){ return pkDeck.pop(); }

    function pkFormatCard(card){
      return `${card.value}${card.suit}`;
    }

    function pkValueNum(value){
      return pkValueMap[value] || parseInt(value, 10);
    }

    function pkGetStraightHigh(values){
      const unique = Array.from(new Set(values)).sort((a,b)=>b-a);
      if(unique.includes(14)) unique.push(1);
      for(let i=0;i<=unique.length-5;i++){
        let run=true;
        for(let j=1;j<5;j++){
          if(unique[i+j] !== unique[i]-j){ run=false; break; }
        }
        if(run) return unique[i];
      }
      return null;
    }

    function pkEvaluateHand(cards){
      const values = cards.map(c=>pkValueNum(c.value));
      const suits = {};
      cards.forEach(c=>{
        suits[c.suit] = suits[c.suit] || [];
        suits[c.suit].push(pkValueNum(c.value));
      });

      const counts = {};
      values.forEach(v=>{ counts[v]=(counts[v]||0)+1; });
      const entries = Object.entries(counts)
        .map(([value,count])=>({value:Number(value),count}))
        .sort((a,b)=>b.count-a.count || b.value-a.value);

      const flushSuit = Object.keys(suits).find(s=>suits[s].length>=5);
      let flushValues = [];
      if(flushSuit){
        flushValues = suits[flushSuit].slice().sort((a,b)=>b-a);
      }

      const straightHigh = pkGetStraightHigh(values);
      let straightFlushHigh = null;
      if(flushSuit){
        straightFlushHigh = pkGetStraightHigh(flushValues);
      }

      if(straightFlushHigh){
        return {rank:8, tiebreak:[straightFlushHigh], name:'Straight flush'};
      }

      const four = entries.find(e=>e.count===4);
      if(four){
        const kicker = entries.find(e=>e.value!==four.value).value;
        return {rank:7, tiebreak:[four.value, kicker], name:'Four of a kind'};
      }

      const trips = entries.filter(e=>e.count===3).map(e=>e.value);
      const pairs = entries.filter(e=>e.count===2).map(e=>e.value);
      if(trips.length && (pairs.length || trips.length>1)){
        const tripValue = trips[0];
        const pairValue = pairs[0] || trips[1];
        return {rank:6, tiebreak:[tripValue, pairValue], name:'Full house'};
      }

      if(flushSuit){
        return {rank:5, tiebreak:flushValues.slice(0,5), name:'Flush'};
      }

      if(straightHigh){
        return {rank:4, tiebreak:[straightHigh], name:'Straight'};
      }

      if(trips.length){
        const kickers = entries.filter(e=>e.value!==trips[0]).map(e=>e.value).sort((a,b)=>b-a);
        return {rank:3, tiebreak:[trips[0], ...kickers.slice(0,2)], name:'Three of a kind'};
      }

      if(pairs.length>=2){
        const highPair = pairs[0];
        const lowPair = pairs[1];
        const kicker = entries.find(e=>e.value!==highPair && e.value!==lowPair).value;
        return {rank:2, tiebreak:[highPair, lowPair, kicker], name:'Two pair'};
      }

      if(pairs.length){
        const pairValue = pairs[0];
        const kickers = entries.filter(e=>e.value!==pairValue).map(e=>e.value).sort((a,b)=>b-a);
        return {rank:1, tiebreak:[pairValue, ...kickers.slice(0,3)], name:'Pair'};
      }

      const topValues = values.slice().sort((a,b)=>b-a).slice(0,5);
      return {rank:0, tiebreak:topValues, name:'High card'};
    }

    function pkCompareHands(a,b){
      if(a.rank !== b.rank) return a.rank - b.rank;
      for(let i=0;i<Math.max(a.tiebreak.length,b.tiebreak.length);i++){
        const diff = (a.tiebreak[i]||0) - (b.tiebreak[i]||0);
        if(diff !== 0) return diff;
      }
      return 0;
    }

    function pokerActivePlayers(){
      return pokerPlayers.filter(p=>!p.folded);
    }

    function pokerNextIndex(startIndex){
      if(pokerPlayers.length === 0) return -1;
      return (startIndex + 1) % pokerPlayers.length;
    }

    function pokerNextActiveIndex(startIndex, {includeAllIn=false} = {}){
      if(pokerPlayers.length === 0) return -1;
      let idx = startIndex;
      for(let i=0;i<pokerPlayers.length;i++){
        idx = pokerNextIndex(idx);
        const player = pokerPlayers[idx];
        if(!player) continue;
        if(player.folded) continue;
        if(!includeAllIn && player.allIn) continue;
        if(player.stack <= 0 && !includeAllIn) continue;
        return idx;
      }
      return -1;
    }

    function pokerUpdateBlinds(){
      const baseBlind = Math.max(50, Math.floor(pokerTableMin * 0.05));
      pokerSmallBlind = baseBlind;
      pokerBigBlind = baseBlind * 2;
      pokerBlindsEl.textContent = `${pokerSmallBlind} / ${pokerBigBlind}`;
    }

    function pokerResetBettingRound(){
      pokerPlayers.forEach(p=>{
        p.bet = 0;
        p.actedThisRound = p.folded || p.allIn;
      });
      pokerCurrentBet = 0;
      pokerMinRaise = pokerBigBlind;
    }

    function pokerPostBlind(player, amount){
      if(!player || player.folded) return 0;
      const blind = Math.min(amount, player.stack);
      player.stack -= blind;
      player.bet += blind;
      player.committed += blind;
      pokerPot += blind;
      if(player.stack === 0) player.allIn = true;
      return blind;
    }

    function pkRender(){
      pokerPotEl.textContent = pokerPot;
      pokerStageEl.textContent = pokerStage;
      pokerBlindsEl.textContent = `${pokerSmallBlind} / ${pokerBigBlind}`;

      const communitySlots = 5;
      const communityMarkup = pokerCommunity.map(c=>`<div class="card-pk">${pkFormatCard(c)}</div>`).join('');
      const placeholderMarkup = Array.from({length: communitySlots - pokerCommunity.length})
        .map(()=>'<div class="card-pk back"></div>').join('');
      pokerCommunityEl.innerHTML = communityMarkup + placeholderMarkup;

      pokerPlayersEl.innerHTML = pokerPlayers.map((p,i)=>{
        const isYou = currentUser && p.key===currentUser.key;
        const isActing = pokerHandActive && i===pokerCurrentPlayerIndex;
        const showHand = isYou || pokerRevealHands;
        const badges = [];
        if(i===pokerDealerIndex) badges.push('D');
        if(i===pokerSmallBlindIndex) badges.push('SB');
        if(i===pokerBigBlindIndex) badges.push('BB');
        return `<div class="poker-player ${isActing ? 'active' : ''}">
          <h4>${p.name} ${isYou?'(jij)':''}
            <span class="poker-badges">${badges.map(b=>`<span>${b}</span>`).join('')}</span>
          </h4>
          <div class="hand">${p.hand.map(c=>showHand ? `<div class="card-pk">${pkFormatCard(c)}</div>` : '<div class="card-pk back"></div>').join('')}</div>
          <div class="poker-info-row">Stack: ${p.stack}</div>
          <div class="poker-info-row">Bet: ${p.bet} | Totaal: ${p.committed}</div>
          <div class="poker-seat-row">Seat ${p.seat} ${p.folded?'[FOLD]':''} ${p.allIn?'[ALL-IN]':''}</div>
        </div>`;
      }).join('');
    }

    function pokerUserIndex(){
      if(!currentUser) return -1;
      return pokerPlayers.findIndex(p=>p.key === currentUser.key);
    }

    function pokerIsUserTurn(){
      const idx = pokerUserIndex();
      return idx !== -1 && idx === pokerCurrentPlayerIndex;
    }

    function setPokerControlsEnabled(enabled){
      pokerCheckBtn.disabled = !enabled;
      pokerBetBtn.disabled = !enabled;
      pokerFoldBtn.disabled = !enabled;
      pokerBetAmountInput.disabled = !enabled;
    }

    function pokerUpdateActionLabels(){
      const player = pokerPlayers[pokerCurrentPlayerIndex];
      if(!player) return;
      const toCall = Math.max(0, pokerCurrentBet - player.bet);
      pokerCheckBtn.textContent = toCall === 0 ? 'Check' : `Call ${toCall}`;
      pokerBetBtn.textContent = pokerCurrentBet === 0 ? 'Bet' : 'Raise';
      const minRaiseTo = pokerCurrentBet === 0 ? pokerBigBlind : pokerCurrentBet + pokerMinRaise;
      pokerBetAmountInput.min = minRaiseTo;
      if(parseInt(pokerBetAmountInput.value, 10) < minRaiseTo){
        pokerBetAmountInput.value = minRaiseTo;
      }
    }

    function updatePokerTurnState(){
      const userCanAct = pokerIsUserTurn() && !pokerTurnLocked;
      setPokerControlsEnabled(userCanAct);
      pokerUpdateActionLabels();
      if(!pokerHandActive){
        pokerStatusEl.textContent = 'Wacht op spelers om de volgende hand te starten.';
        return;
      }
      if(!userCanAct && pokerPlayers[pokerCurrentPlayerIndex]){
        pokerStatusEl.textContent = `${pokerPlayers[pokerCurrentPlayerIndex].name} is aan zet...`;
      } else if(userCanAct){
        pokerStatusEl.textContent = 'Jij bent aan zet.';
      }
    }

    function pokerIsBettingRoundComplete(){
      const active = pokerPlayers.filter(p=>!p.folded && !p.allIn);
      if(active.length === 0) return true;
      return active.every(p=>p.bet === pokerCurrentBet && p.actedThisRound);
    }

    function pokerAwardPot(winners, handName){
      const potTotal = pokerPot;
      const share = Math.floor(potTotal / winners.length);
      const remainder = potTotal % winners.length;
      winners.forEach((winner, idx)=>{
        winner.stack += share + (idx === 0 ? remainder : 0);
      });
      const names = winners.map(w=>w.name).join(' & ');
      if(handName === 'folds'){
        pokerStatusEl.textContent = `${names} wint ${potTotal} omdat iedereen foldt.`;
      } else {
        pokerStatusEl.textContent = `${names} wint ${potTotal} met ${handName}.`;
      }
      pokerDealerStatusEl.textContent = `Pot uitbetaald aan ${names}.`;
      pokerPot = 0;
      pokerRevealHands = handName !== 'folds';
      return { potTotal, share, remainder };
    }

    function pokerHandleHandComplete({ winners, handName, potInfo }){
      pokerHandActive = false;
      pkRender();
      updatePokerTurnState();
      const userIdx = pokerUserIndex();
      if(userIdx === -1 || !currentUser) return;
      const user = pokerPlayers[userIdx];
      const userWon = winners.some(w=>w.key === user.key);
      let winAmount = 0;
      if(userWon && potInfo){
        const winnerIndex = winners.findIndex(w=>w.key === user.key);
        winAmount = potInfo.share + (winnerIndex === 0 ? potInfo.remainder : 0);
        applyLuckyCoinProgress(winAmount);
      }
      recordGameResult('pk', userWon ? 'win' : 'lose', winAmount);
      saveCurrentUser().then(renderDashboard);
      const detail = handName === 'folds' ? 'fold' : handName;
      const message = userWon
        ? `Je wint ${winAmount} chips met ${detail}.`
        : `Je verliest deze hand (${detail}).`;
      showGameResultOverlay({
        outcome: userWon ? 'win' : 'lose',
        title: userWon ? 'Poker: winst!' : 'Poker: verlies',
        message,
        showActions: true,
        onPlayAgain: () => { pkNewHand(); },
        onMainMenu: () => { leavePokerTable({ silent: true, goToMenu: true }); }
      });
    }

    function pokerShowdown(){
      pokerStage = 'Showdown';
      pokerRevealHands = true;
      pkRender();
      const active = pokerActivePlayers();
      if(active.length === 0){
        pokerStatusEl.textContent = 'Iedereen heeft gefold.';
        pokerHandActive = false;
        return;
      }
      const scored = active.map(player=>{
        const score = pkEvaluateHand([...player.hand, ...pokerCommunity]);
        return {player, score};
      });
      scored.sort((a,b)=>pkCompareHands(b.score,a.score));
      const best = scored[0].score;
      const winners = scored.filter(s=>pkCompareHands(s.score, best) === 0).map(s=>s.player);
      const potInfo = pokerAwardPot(winners, best.name);
      pokerHandleHandComplete({ winners, handName: best.name, potInfo });
    }

    function pokerProceedToNextStage({skipAction=false} = {}){
      if(pokerStage === 'Pre-flop'){
        pokerCommunity.push(pkDraw(), pkDraw(), pkDraw());
        pokerStage = 'Flop';
        pokerDealerStatusEl.textContent = 'Dealer deelt de flop.';
      } else if(pokerStage === 'Flop'){
        pokerCommunity.push(pkDraw());
        pokerStage = 'Turn';
        pokerDealerStatusEl.textContent = 'Dealer deelt de turn.';
      } else if(pokerStage === 'Turn'){
        pokerCommunity.push(pkDraw());
        pokerStage = 'River';
        pokerDealerStatusEl.textContent = 'Dealer deelt de river.';
      } else {
        pokerShowdown();
        return;
      }

      pokerResetBettingRound();
      const nextIndex = pokerNextActiveIndex(pokerDealerIndex, {includeAllIn:false});
      pokerCurrentPlayerIndex = nextIndex === -1 ? pokerDealerIndex : nextIndex;
      pkRender();
      if(!skipAction){
        updatePokerTurnState();
        if(pokerPlayers[pokerCurrentPlayerIndex]?.isBot){
          void pokerBotTurn();
        }
      }
    }

    function pokerCheckForAllInRunout(){
      if(pokerStage === 'Showdown') return;
      const actingPlayers = pokerPlayers.filter(p=>!p.folded && !p.allIn);
      if(actingPlayers.length === 0){
        while(pokerStage !== 'River'){
          pokerProceedToNextStage({skipAction:true});
          if(pokerStage === 'Showdown') return;
        }
        pokerShowdown();
      }
    }

    function pokerAdvanceTurn(){
      if(!pokerHandActive) return;
      const active = pokerActivePlayers();
      if(active.length <= 1){
        const winner = active[0];
        if(winner){
          const potInfo = pokerAwardPot([winner], 'folds');
          pokerHandleHandComplete({ winners: [winner], handName: 'folds', potInfo });
        } else {
          pokerHandActive = false;
          pkRender();
        }
        return;
      }

      if(pokerIsBettingRoundComplete()){
        pokerProceedToNextStage();
        pokerCheckForAllInRunout();
        return;
      }

      const nextIndex = pokerNextActiveIndex(pokerCurrentPlayerIndex, {includeAllIn:false});
      if(nextIndex === -1){
        pokerProceedToNextStage();
        return;
      }
      pokerCurrentPlayerIndex = nextIndex;
      pkRender();
      updatePokerTurnState();
      if(pokerPlayers[pokerCurrentPlayerIndex]?.isBot){
        void pokerBotTurn();
      }
    }

    function pokerBotStrength(bot){
      if(!bot.hand || bot.hand.length<2) return 0;
      const v1 = pkValueNum(bot.hand[0].value);
      const v2 = pkValueNum(bot.hand[1].value);
      const high = Math.max(v1,v2);
      const low = Math.min(v1,v2);
      let score = 0;
      if(v1 === v2) score += 3;
      if(high >= 13) score += 2;
      if(high >= 10) score += 1;
      if(bot.hand[0].suit === bot.hand[1].suit) score += 1;
      if(Math.abs(high - low) === 1) score += 1;
      return score;
    }

    async function pokerBotTurn(){
      pokerTurnLocked = true;
      updatePokerTurnState();
      await sleep(800);
      const bot = pokerPlayers[pokerCurrentPlayerIndex];
      if(!bot || !bot.isBot){
        pokerTurnLocked = false;
        updatePokerTurnState();
        return;
      }
      const toCall = Math.max(0, pokerCurrentBet - bot.bet);
      const strength = pokerBotStrength(bot);
      const willFold = toCall > 0 && strength <= 1 && Math.random() < 0.5;
      const canRaise = bot.stack > toCall + pokerMinRaise;
      if(willFold){
        bot.folded = true;
        bot.actedThisRound = true;
        pokerStatusEl.textContent = `${bot.name} foldt.`;
      } else if(canRaise && strength >= 4 && Math.random() < 0.35){
        const raiseAmount = Math.min(pokerMinRaise + Math.floor(Math.random()*pokerMinRaise), bot.stack - toCall);
        const totalTo = pokerCurrentBet + raiseAmount;
        const betNeeded = totalTo - bot.bet;
        bot.stack -= betNeeded;
        bot.bet += betNeeded;
        bot.committed += betNeeded;
        pokerPot += betNeeded;
        pokerCurrentBet = totalTo;
        pokerMinRaise = raiseAmount;
        bot.actedThisRound = true;
        pokerPlayers.forEach(p=>{ if(p!==bot) p.actedThisRound = p.folded || p.allIn; });
        pokerStatusEl.textContent = `${bot.name} raiset naar ${totalTo}.`;
      } else {
        const callAmount = Math.min(toCall, bot.stack);
        bot.stack -= callAmount;
        bot.bet += callAmount;
        bot.committed += callAmount;
        pokerPot += callAmount;
        if(bot.stack === 0) bot.allIn = true;
        bot.actedThisRound = true;
        pokerStatusEl.textContent = toCall === 0 ? `${bot.name} checkt.` : `${bot.name} callt ${callAmount}.`;
      }
      pkRender();
      pokerTurnLocked = false;
      pokerAdvanceTurn();
    }

    function pkNewHand(){
      hideGameResultOverlay();
      if(pokerPlayers.length < 2){
        pokerHandActive = false;
        pokerDealerStatusEl.textContent = 'Wacht op minimaal 2 spelers.';
        pkRender();
        return;
      }
      pkCreateDeck();
      pokerPot = 0;
      pokerCommunity = [];
      pokerRevealHands = false;
      pokerHandActive = true;
      pokerStage = 'Pre-flop';
      pokerDealerIndex = pokerPlayers.length ? (pokerDealerIndex + 1) % pokerPlayers.length : 0;
      pokerUpdateBlinds();

      pokerPlayers.forEach(p=>{
        p.hand = [pkDraw(), pkDraw()];
        p.bet = 0;
        p.committed = 0;
        p.folded = false;
        p.allIn = false;
        p.actedThisRound = false;
      });

      pokerSmallBlindIndex = pokerNextActiveIndex(pokerDealerIndex, {includeAllIn:true});
      pokerBigBlindIndex = pokerNextActiveIndex(pokerSmallBlindIndex, {includeAllIn:true});

      pokerPostBlind(pokerPlayers[pokerSmallBlindIndex], pokerSmallBlind);
      pokerPostBlind(pokerPlayers[pokerBigBlindIndex], pokerBigBlind);

      pokerCurrentBet = pokerBigBlind;
      pokerMinRaise = pokerBigBlind;
      pokerCurrentPlayerIndex = pokerNextActiveIndex(pokerBigBlindIndex, {includeAllIn:false});

      pokerDealerStatusEl.textContent = 'Dealer deelt twee hole cards.';
      pkRender();
      updatePokerTurnState();
      if(pokerPlayers[pokerCurrentPlayerIndex]?.isBot){
        void pokerBotTurn();
      }
    }

    function PK_addBotsIfNeeded(){
      const desiredSeats = 6;
      const occupiedSeats = new Set(pokerPlayers.map(p=>p.seat));
      let nextSeat = 1;
      while(occupiedSeats.size < desiredSeats){
        while(occupiedSeats.has(nextSeat)) nextSeat++;
        const seatIdx = nextSeat;
        occupiedSeats.add(seatIdx);
        const nextIdx = pokerPlayers.filter(p=>p.isBot).length + 1;
        const player = {
          key: 'bot'+nextIdx,
          name: 'Bot '+nextIdx,
          stack: 2000,
          entryStack: 2000,
          hand: [],
          bet: 0,
          committed: 0,
          folded: false,
          allIn: false,
          isBot: true,
          actedThisRound: false,
          seat: seatIdx
        };
        pokerPlayers.push(player);
      }
    }

    joinPokerBtn.onclick = ()=>{
      if(!currentUser) return alert('Je moet inloggen.');
      const min = parseInt(pokerTableSelect.value)||500;
      if(currentUser.credits < min){
        alert('Je hebt niet genoeg credits voor deze tafel.');
        return;
      }
      pokerTableMin = min;

      if(pokerPlayers.some(p=>p.key===currentUser.key)){
        alert('Je zit al aan de tafel.');
        return;
      }

      currentUser.credits -= pokerTableMin;
      currentUser.entryStack = pokerTableMin;
      const seat = pokerPlayers.length ? Math.max(...pokerPlayers.map(p=>p.seat))+1 : 1;
      pokerPlayers.push({
        key: currentUser.key,
        name: currentUser.name,
        stack: pokerTableMin,
        entryStack: pokerTableMin,
        hand:[],
        bet:0,
        committed:0,
        folded:false,
        allIn:false,
        isBot:false,
        actedThisRound:false,
        seat
      });

      PK_addBotsIfNeeded();
      saveCurrentUser().then(renderDashboard);
      pkNewHand();
      pokerSection.style.display='block';
      dashboard.style.display='none';
    };

    function leavePokerTable({ silent = false, goToMenu = false } = {}){
      if(!currentUser) return;
      const idx = pokerPlayers.findIndex(p=>p.key===currentUser.key);
      if(idx===-1){
        if(!silent){
          alert('Je zit niet aan de tafel.');
        }
        return;
      }
      const pl = pokerPlayers[idx];
      currentUser.credits += pl.stack;
      pokerPlayers.splice(idx,1);
      pokerHandActive = false;
      pokerPot = 0;
      pokerCommunity = [];
      pokerRevealHands = false;
      setPokerControlsEnabled(false);
      pokerDealerStatusEl.textContent = 'Speler verlaat de tafel.';
      pkRender();
      saveCurrentUser().then(()=>{
        renderDashboard();
        if(!silent){
          alert('Tafel verlaten. Je hebt nu weer '+currentUser.credits+' credits.');
        }
        if(goToMenu){
          pokerSection.style.display = 'none';
          showDashboard(true);
        }
      });
    }

    leavePokerBtn.onclick = ()=>{
      leavePokerTable();
    };

    backFromPokerBtn.onclick = ()=>{
      pokerSection.style.display = 'none';
      blackjackSection.style.display = 'none';
      setPokerControlsEnabled(false);
      showDashboard(true);
    };

    pokerCheckBtn.onclick = ()=>{
      if(!pokerIsUserTurn()){
        pokerStatusEl.textContent = 'Wacht op je beurt om te checken.';
        return;
      }
      const player = pokerPlayers[pokerCurrentPlayerIndex];
      const toCall = Math.max(0, pokerCurrentBet - player.bet);
      const callAmount = Math.min(toCall, player.stack);
      player.stack -= callAmount;
      player.bet += callAmount;
      player.committed += callAmount;
      pokerPot += callAmount;
      if(player.stack === 0) player.allIn = true;
      player.actedThisRound = true;
      pokerStatusEl.textContent = toCall === 0 ? 'Check.' : `Call ${callAmount}.`;
      pkRender();
      pokerAdvanceTurn();
    };

    pokerBetBtn.onclick = ()=>{
      if(!pokerIsUserTurn()){
        pokerStatusEl.textContent = 'Wacht op je beurt om te raisen.';
        return;
      }
      const player = pokerPlayers[pokerCurrentPlayerIndex];
      if(!player || player.stack <= 0){
        pokerStatusEl.textContent = 'Je hebt geen chips meer om te betten.';
        return;
      }
      const raiseTo = Math.max(0, parseInt(pokerBetAmountInput.value, 10) || 0);
      if(raiseTo <= pokerCurrentBet){
        pokerStatusEl.textContent = 'Raise-bedrag moet hoger zijn dan de huidige bet.';
        return;
      }
      const minTo = pokerCurrentBet + pokerMinRaise;
      if(raiseTo < minTo){
        pokerStatusEl.textContent = `Minimale raise is ${minTo}.`;
        return;
      }
      const betNeeded = raiseTo - player.bet;
      if(betNeeded > player.stack){
        pokerStatusEl.textContent = 'Je hebt niet genoeg chips voor deze raise.';
        return;
      }
      const previousBet = pokerCurrentBet;
      player.stack -= betNeeded;
      player.bet += betNeeded;
      player.committed += betNeeded;
      pokerPot += betNeeded;
      pokerCurrentBet = raiseTo;
      pokerMinRaise = raiseTo - previousBet;
      player.actedThisRound = true;
      pokerPlayers.forEach(p=>{ if(p!==player) p.actedThisRound = p.folded || p.allIn; });
      pokerStatusEl.textContent = `Raise naar ${raiseTo}.`;
      pkRender();
      pokerAdvanceTurn();
    };

    pokerFoldBtn.onclick = ()=>{
      if(!pokerIsUserTurn()){
        pokerStatusEl.textContent = 'Wacht op je beurt om te folden.';
        return;
      }
      const player = pokerPlayers[pokerCurrentPlayerIndex];
      if(player){
        player.folded = true;
        player.actedThisRound = true;
      }
      pokerStatusEl.textContent = 'Fold uitgevoerd.';
      pkRender();
      pokerAdvanceTurn();
    };
// ==================== PAARDENRACE LOGICA (GEFIXT) ====================

const horseRaceSection = document.getElementById("horseRaceSection");
const startRaceBtn = document.getElementById("startRaceBtn");
const backToMenuRace = document.getElementById("backToMenuRace");
const horseBetInput = document.getElementById("horseBet");
const horseSelect = document.getElementById("horseSelect");
const raceStatus = document.getElementById("raceStatus");
const raceResults = document.getElementById("raceResults");
const raceTrack = document.getElementById("raceTrack");
const finishLine = document.getElementById("finishLine");

const horses = [
    document.getElementById("horse1"),
    document.getElementById("horse2"),
    document.getElementById("horse3"),
    document.getElementById("horse4")
];
const horseMeta = horses.map((horse, index) => ({
    name: horse?.dataset?.horseName || `Paard ${index + 1}`
}));
let raceInProgress = false;

function showHorseRace(){
    dashboard.style.display = "none";
    blackjackSection.style.display = "none";
    pokerSection.style.display = "none";
    crapsSection.style.display = "none";
    baccaratSection.style.display = "none";
    rouletteSection.style.display = "none";
    slotsSection.style.display = "none";
    plinkoSection.style.display = "none";
    lootBoxMenuSection.style.display = "none";
    lootBoxSection.style.display = "none";
    horseRaceSection.style.display = "block";
}

backToMenuRace.onclick = () => {
    horseRaceSection.style.display = "none";
    showDashboard(true);
};

// START RACE
startRaceBtn.onclick = async () => {
    if(raceInProgress) return;
    const bet = parseInt(horseBetInput.value);
    const chosenHorse = parseInt(horseSelect.value);

    if (bet < 10) return alert("Minimum inzet is 10 credits.");
    if (currentUser.credits < bet) return alert("Je hebt niet genoeg credits!");

    // credits afschrijven
    currentUser.credits -= bet;
    await db.ref("users/" + currentUser.key).update({
        credits: currentUser.credits
    });
    renderDashboard();

    // reset horse positions
    horses.forEach(h => {
        h.style.left = "0px";
        h.classList.remove("winner");
    });
    raceResults.classList.remove("show");
    raceResults.innerHTML = "";
    raceStatus.textContent = "De race is gestart... houd de finish in de gaten!";
    raceInProgress = true;
    startRaceBtn.disabled = true;

    await new Promise(requestAnimationFrame);
    const startTime = performance.now();
    const horseStates = horses.map((horse, index) => ({
        horse,
        index,
        finished: false,
        finishTime: null,
        position: 0,
        pace: 1.6 + Math.random() * 1.6
    }));
    const finishPositions = horseStates.map((state) => {
        const lane = state.horse.parentElement;
        const laneRect = lane.getBoundingClientRect();
        const finishRect = finishLine.getBoundingClientRect();
        const horseWidth = state.horse.offsetWidth;
        const finishX = finishRect.left - laneRect.left - horseWidth + finishRect.width;
        return Math.max(0, Math.min(finishX, lane.clientWidth - horseWidth));
    });

    async function finalizeRace(states){
        const ranking = [...states].sort((a, b) => a.finishTime - b.finishTime);
        const winner = ranking[0].index + 1;
        const photoFinishGap = ranking[1].finishTime - ranking[0].finishTime;
        const isPhotoFinish = photoFinishGap <= 120;
        ranking[0].horse.classList.add("winner");

        const resultsHtml = `
          <div class="race-results-title">Uitslag</div>
          <div class="race-results-grid">
            ${ranking.map((entry, idx) => `
              <div class="race-result-item">
                <span>#${idx + 1} — ${horseMeta[entry.index].name}</span>
                <span>${(entry.finishTime / 1000).toFixed(2)}s</span>
              </div>
            `).join("")}
          </div>
          ${isPhotoFinish ? `<div class="photo-finish">📸 Foto finish! Verschil: ${(photoFinishGap).toFixed(0)}ms</div>` : ""}
        `;

        raceResults.innerHTML = resultsHtml;
        raceResults.classList.add("show");
        raceStatus.textContent = `Race klaar! ${horseMeta[winner - 1].name} wint.`;

        if(winner === chosenHorse){
            const winAmount = bet * 3;
            currentUser.credits += winAmount;
            applyLuckyCoinProgress(winAmount);
            recordGameResult('horse', 'win', winAmount);
            await saveCurrentUser();
            renderDashboard();
            alert("🎉 Je paard heeft gewonnen! +" + winAmount + " credits");
        } else {
            recordGameResult('horse', 'lose');
            await saveCurrentUser();
            renderDashboard();
            alert("❌ Paard " + winner + " won. Je hebt verloren.");
        }

        raceInProgress = false;
        startRaceBtn.disabled = false;
    }

    let lastFrame = startTime;
    function raceTick(now){
        const delta = Math.min(2.5, (now - lastFrame) / 16.67);
        lastFrame = now;

        horseStates.forEach((state, index) => {
            if(state.finished) return;
            const tempoBoost = Math.random() * 2.6;
            const stride = (state.pace + tempoBoost) * delta;
            state.position = Math.min(state.position + stride, finishPositions[index]);
            state.horse.style.left = `${state.position}px`;

            if(state.position >= finishPositions[index]){
                state.finished = true;
                state.finishTime = now - startTime;
            }
        });

        if(horseStates.every(state => state.finished)){
            void finalizeRace(horseStates);
            return;
        }

        requestAnimationFrame(raceTick);
    }

    requestAnimationFrame(raceTick);
};

    /* ---------------------------
       Leaderboard popup
       --------------------------- */
    let lbIndex = 0;
    const leaderboardConfigs = [
      {
        key: 'earnings',
        title: 'All-Time Earnings',
        value: (u)=>u.totalEarned||0,
        extra: (u)=>`${u.totalEarned||0} credits`
      },
      {
        key: 'winrate',
        title: 'Win Percentage (overall)',
        value: (u)=>u.games ? (u.wins/u.games) : 0,
        extra: (u)=>`${u.games?Math.round(100*u.wins/u.games):0}%`
      },
      {
        key: 'bjwinrate',
        title: 'Blackjack Win Percentage',
        value: (u)=>u.bjGames ? (u.bjWins/u.bjGames) : 0,
        extra: (u)=>`${u.bjGames?Math.round(100*u.bjWins/u.bjGames):0}%`
      },
      {
        key: 'pkwinrate',
        title: 'Poker Win Percentage',
        value: (u)=>u.pkGames ? (u.pkWins/u.pkGames) : 0,
        extra: (u)=>`${u.pkGames?Math.round(100*u.pkWins/u.pkGames):0}%`
      },
      {
        key: 'crapswinrate',
        title: 'Craps Win Percentage',
        value: (u)=>u.crapsGames ? (u.crapsWins/u.crapsGames) : 0,
        extra: (u)=>`${u.crapsGames?Math.round(100*u.crapsWins/u.crapsGames):0}%`
      },
      {
        key: 'baccaratwinrate',
        title: 'Baccarat Win Percentage',
        value: (u)=>u.baccaratGames ? (u.baccaratWins/u.baccaratGames) : 0,
        extra: (u)=>`${u.baccaratGames?Math.round(100*u.baccaratWins/u.baccaratGames):0}%`
      },
      {
        key: 'roulettewinrate',
        title: 'Roulette Win Percentage',
        value: (u)=>u.rouletteGames ? (u.rouletteWins/u.rouletteGames) : 0,
        extra: (u)=>`${u.rouletteGames?Math.round(100*u.rouletteWins/u.rouletteGames):0}%`
      },
      {
        key: 'slotswinrate',
        title: 'Slots Win Percentage',
        value: (u)=>u.slotsGames ? (u.slotsWins/u.slotsGames) : 0,
        extra: (u)=>`${u.slotsGames?Math.round(100*u.slotsWins/u.slotsGames):0}%`
      },
      {
        key: 'plinkowinrate',
        title: 'Plinko Win Percentage',
        value: (u)=>u.plinkoGames ? (u.plinkoWins/u.plinkoGames) : 0,
        extra: (u)=>`${u.plinkoGames?Math.round(100*u.plinkoWins/u.plinkoGames):0}%`
      },
      {
        key: 'horsewinrate',
        title: 'Horse Race Win Percentage',
        value: (u)=>u.horseGames ? (u.horseWins/u.horseGames) : 0,
        extra: (u)=>`${u.horseGames?Math.round(100*u.horseWins/u.horseGames):0}%`
      }
    ];

    async function loadUsersArrayFromDb(){
      const snap = await db.ref('users').once('value');
      const obj = snap.val() || {};
      return Object.entries(obj).map(([k,u])=>({
        key: k,
        name: u.name,
        totalEarned: u.totalEarned||0,
        wins: u.wins||0,
        losses: u.losses||0,
        games: u.gamesPlayed||0,
        bjWins: u.bjWins||0,
        bjLosses: u.bjLosses||0,
        bjGames: u.bjGames||0,
        pkWins: u.pkWins||0,
        pkLosses: u.pkLosses||0,
        pkGames: u.pkGames||0,
        crapsWins: u.crapsWins||0,
        crapsLosses: u.crapsLosses||0,
        crapsGames: u.crapsGames||0,
        baccaratWins: u.baccaratWins||0,
        baccaratLosses: u.baccaratLosses||0,
        baccaratGames: u.baccaratGames||0,
        rouletteWins: u.rouletteWins||0,
        rouletteLosses: u.rouletteLosses||0,
        rouletteGames: u.rouletteGames||0,
        slotsWins: u.slotsWins||0,
        slotsLosses: u.slotsLosses||0,
        slotsGames: u.slotsGames||0,
        plinkoWins: u.plinkoWins||0,
        plinkoLosses: u.plinkoLosses||0,
        plinkoGames: u.plinkoGames||0,
        horseWins: u.horseWins||0,
        horseLosses: u.horseLosses||0,
        horseGames: u.horseGames||0
      }));
    }

    async function openLeaderboard(){
      lbPopup.style.display='block';
      const config = leaderboardConfigs[lbIndex];
      lbTitle.textContent = config.title;

      const arr = await loadUsersArrayFromDb();
      arr.sort((a,b)=>config.value(b) - config.value(a));

      let html='';
      const top=arr.slice(0,10);
      top.forEach((u,i)=>{
        const isYou=currentUser && (u.key===currentUser.key);
        const extra = config.extra(u);
        html+=`
          <div class="lb-entry ${isYou ? 'you' : ''}">
            <span class="lb-rank">${i+1}.</span>
            <span class="lb-name">${u.name} ${isYou ? '<em>(jij)</em>' : ''}</span>
            <span class="lb-extra">${extra}</span>
          </div>
        `;
      });

      let yourRank=-1;
      if(currentUser) yourRank=arr.findIndex(x=>x.key===currentUser.key);
      if(yourRank>9){
        const u=arr[yourRank];
        const extra = config.extra(u);
        html+=`<hr><div class="lb-entry">
          <span class="lb-rank">${yourRank+1}.</span>
          <span class="lb-name">${u.name}</span>
          <span class="lb-extra">${extra}</span>
        </div>`;
      } else if(yourRank===-1 && currentUser){
        html+=`<hr><div class="lb-entry"><span class="lb-name">Jij staat nog niet in de statistieken.</span></div>`;
      }
      lbContent.innerHTML=html;
    }

    lbTab.onclick = ()=>{ lbIndex=0; openLeaderboard(); };
    lbClose.onclick = ()=>{ lbPopup.style.display='none'; };
    lbLeft.onclick = ()=>{ lbIndex=(lbIndex-1+leaderboardConfigs.length)%leaderboardConfigs.length; openLeaderboard(); };
    lbRight.onclick = ()=>{ lbIndex=(lbIndex+1)%leaderboardConfigs.length; openLeaderboard(); };

  </script>
</body>
</html>
