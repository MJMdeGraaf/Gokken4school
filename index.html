<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Goksite PWS ‚Äî Multiplayer Blackjack & Poker</title>
  <style>
    /* ============================ LEADERBOARD TAB STYLE ============================ */
    #lb-tab{
        position: fixed;
        right: 20px;
        bottom: 20px;
        background: gold;
        padding: 12px 20px;
        border-radius: 16px;
        cursor: pointer;
        font-weight: bold;
        box-shadow: 0 0 10px rgba(0,0,0,0.4);
        z-index: 9999;
    }

    /* ============================ POPUP WINDOW ============================ */
    #lb-popup{
        position: fixed;
        bottom: 0;
        right: 0;
        width: 360px;
        height: 460px;
        background: rgba(0,0,0,0.88);
        border-radius: 20px 0 0 0;
        display: none;
        z-index: 99999;
        color: white;
    }

    #lb-popup-inner{
        padding: 18px;
        height: 100%;
        position: relative;
    }

    /* ============================ ARROWS ============================ */
    .lb-arrow{
        position: absolute;
        top: 12px;
        font-size: 26px;
        cursor: pointer;
        user-select: none;
    }
    #lb-left{ left: 10px; }
    #lb-right{ right: 10px; }

    /* ============================ CONTENT AREA ============================ */
    #lb-content{
        margin-top: 52px;
        height: 330px;
        overflow-y: auto;
        font-size: 16px;
    }

    #lb-close{
        position: absolute;
        bottom: 14px;
        left: 50%;
        transform: translateX(-50%);
        padding: 8px 20px;
        border-radius: 10px;
        cursor: pointer;
    }

    /* ============================ Music menu style ============================ */
    #musicMenu{
      position: fixed;
      left: 20px;
      bottom: 80px;
      width: 300px;
      background: rgba(0,0,0,0.92);
      color: white;
      padding: 15px;
      border-radius: 12px;
      display: none;
      z-index: 99999;
    }

    #musicMenuInner{
      text-align: center;
    }

    #musicMenu input[type=range]{
      width: 80%;
    }

    #musicControl{
      position: fixed;
      left: 20px;
      bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      box-shadow: 0 0 12px rgba(0,0,0,0.45);
      z-index: 99998;
    }

    #musicControl img{
      width: 22px;
      height: 22px;
    }

    /* ============================ Loot box styles ============================ */
    #lootBoxMenuSection{
      background: radial-gradient(circle at top, #2a1b4a 0, #050515 60%, #020208 100%);
      min-height: 100vh;
      text-align: center;
      padding: 24px;
    }

    .lootbox-menu-grid{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin: 24px auto 10px;
      max-width: 820px;
    }

    .lootbox-star-row{
      display: flex;
      justify-content: center;
      gap: 6px;
      font-size: 20px;
      color: #ffe48a;
      margin-bottom: 6px;
      text-shadow: 0 0 6px rgba(0,0,0,0.6);
    }

    #lootBoxSection{
      background: radial-gradient(circle at top, #1f1b3a 0, #050515 60%, #020208 100%);
      min-height: 100vh;
      text-align: center;
      padding: 24px;
    }

    .lootbox-stage{
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      margin-top: 20px;
    }

    .lootbox-card{
      width: 220px;
      height: 220px;
      border-radius: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 22px;
      font-weight: 700;
      color: #041014;
      box-shadow: 0 18px 35px rgba(0,0,0,0.6);
      cursor: pointer;
      position: relative;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .lootbox-card:hover{
      transform: translateY(-4px);
      box-shadow: 0 24px 40px rgba(0,0,0,0.7);
    }

    .lootbox-card.disabled{
      cursor: default;
      opacity: 0.8;
    }

    .lootbox-icon{
      font-size: 54px;
    }

    .lootbox-chances{
      display: flex;
      gap: 10px;
    }

    .chance-dot{
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffe48a;
      font-size: 16px;
      background: rgba(0,0,0,0.3);
      transition: opacity 0.2s ease, filter 0.2s ease;
    }

    .chance-dot.used{
      opacity: 0.3;
      filter: grayscale(1);
    }

    .lootbox-level-1{ background: linear-gradient(140deg, #55f0ff, #1aa7c9); }
    .lootbox-level-2{ background: linear-gradient(140deg, #63e28a, #2e9c58); }
    .lootbox-level-3{ background: linear-gradient(140deg, #c3844b, #8b4d20); }
    .lootbox-level-4{ background: linear-gradient(140deg, #d8dbe2, #8b8f9c); }
    .lootbox-level-5{ background: linear-gradient(140deg, #ffe48a, #c79a1b); }

    /* ============================ Rest of page ============================ */
    :root{
      --maria-blue: #0b4f7b;
      --maria-blue-bright: #0f6fb2;
      --maria-blue-deep: #062339;
      --casino-gold: #d4af37;
      --casino-cream: #f6e9c4;
      --menu-surface: rgba(10, 22, 36, 0.88);
      --menu-surface-light: rgba(18, 44, 70, 0.82);
    }

    body {
      margin:0;
      font-family: "Segoe UI", system-ui, sans-serif;
      background:#050515;
      color:#fff;
    }
    #login, #dashboard, #blackjackSection, #pokerSection, #lootBoxMenuSection, #lootBoxSection { display: none; padding: 20px; text-align:center; }
    #login { background: radial-gradient(circle at top, #551a8b 0, #050515 55%, #020208 100%); height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:8px; }
    #dashboard {
      background:
        radial-gradient(circle at top, rgba(15,111,178,0.25), transparent 40%),
        radial-gradient(circle at 20% 20%, rgba(212,175,55,0.18), transparent 55%),
        linear-gradient(140deg, #030b14 0, #051729 35%, #071f33 60%, #030b14 100%);
      min-height:100vh;
      text-align:left;
    }
    #dashboard h2, #login h2 { margin-bottom:10px; }
    button { padding: 10px 14px; margin: 6px; border-radius: 10px; border:none; cursor:pointer; background:#e21a4d; color:#fff; font-weight:600; letter-spacing:0.2px; }
    button:hover{ filter:brightness(1.08); }
    input { padding:8px 10px; border-radius:8px; border:1px solid #2b4055; background:#111a23; color:#fff; }

    /* ============================ Dashboard menu overhaul ============================ */
    .menu-wrapper{
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px 10px 50px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .menu-header{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap:16px;
      padding: 16px 22px;
      border-radius: 18px;
      background: linear-gradient(120deg, rgba(7,30,49,0.95), rgba(8,40,60,0.8));
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
    }

    .menu-brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .menu-logo{
      width:48px;
      height:48px;
      border-radius:14px;
      background: linear-gradient(140deg, var(--maria-blue), var(--maria-blue-bright));
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--casino-cream);
      font-size:22px;
      box-shadow: 0 0 16px rgba(15,111,178,0.5);
    }

    .menu-brand h2{
      margin:0;
      font-size: 20px;
      font-weight: 700;
    }

    .menu-brand small{
      color: rgba(246,233,196,0.75);
    }

    .menu-stats{
      display:flex;
      gap: 14px;
      flex-wrap: wrap;
    }

    .menu-stat{
      background: rgba(8, 26, 40, 0.75);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 10px 14px;
      border-radius: 12px;
      min-width: 140px;
    }

    .menu-stat span{
      display:block;
      font-size:12px;
      color: rgba(255,255,255,0.65);
    }

    .menu-stat strong{
      font-size:16px;
      color: var(--casino-cream);
    }

    .menu-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .menu-action-btn{
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff;
      padding: 8px 14px;
    }

    .menu-action-btn.primary{
      background: linear-gradient(120deg, var(--maria-blue), var(--maria-blue-bright));
      border: none;
      box-shadow: 0 8px 18px rgba(10,90,140,0.35);
    }

    .menu-hero{
      padding: 24px;
      border-radius: 20px;
      background: radial-gradient(circle at top left, rgba(15,111,178,0.35), transparent 45%), var(--menu-surface);
      border: 1px solid rgba(255,255,255,0.08);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 20px;
      box-shadow: inset 0 0 40px rgba(0,0,0,0.35);
    }

    .menu-hero-text h3{
      margin:0 0 6px 0;
      font-size: 26px;
    }

    .menu-hero-text p{
      margin:0;
      color: rgba(255,255,255,0.7);
    }

    .menu-hero-highlight{
      background: linear-gradient(130deg, rgba(212,175,55,0.12), rgba(15,111,178,0.2));
      border: 1px solid rgba(212,175,55,0.3);
      padding: 14px 18px;
      border-radius: 16px;
      text-align:center;
      min-width: 180px;
    }

    .menu-hero-highlight strong{
      font-size: 22px;
      color: var(--casino-cream);
    }

    .menu-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap:18px;
    }

    .menu-card{
      background: var(--menu-surface-light);
      border-radius: 18px;
      padding: 18px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 14px 28px rgba(0,0,0,0.4);
      text-align:left;
      display:flex;
      flex-direction:column;
      gap:12px;
      position: relative;
      overflow: hidden;
    }

    .menu-card::after{
      content:'';
      position:absolute;
      inset:0;
      background: radial-gradient(circle at top right, rgba(15,111,178,0.35), transparent 55%);
      opacity:0.8;
      pointer-events:none;
    }

    .menu-card h4{
      margin:0;
      font-size:18px;
    }

    .menu-card p{
      margin:0;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
    }

    .menu-card .cta-button{
      margin:0;
      align-self: flex-start;
      background: linear-gradient(130deg, var(--casino-gold), #f0c96a);
      color:#1b1b1b;
      font-weight: 700;
    }

    .menu-card .cta-button.alt{
      background: linear-gradient(130deg, var(--maria-blue), var(--maria-blue-bright));
      color:#fff;
    }

    .menu-highlight{
      border:1px solid rgba(212,175,55,0.45);
      box-shadow: 0 14px 30px rgba(212,175,55,0.22);
    }

    .menu-cta-row{
      display:flex;
      gap:12px;
      flex-wrap: wrap;
    }

    .menu-cta-row button{
      margin:0;
    }

    @media (max-width: 840px){
      .menu-header{
        flex-direction: column;
        align-items: flex-start;
      }
      .menu-actions{
        width:100%;
        justify-content:flex-start;
      }
      .menu-hero{
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* Blackjack sectie */
    #blackjackSection {
      height: 100vh;
      color: white;
      background:
        radial-gradient(circle at 20% 0%, rgba(255,255,255,0.08), transparent 55%),
        radial-gradient(circle at 80% 100%, rgba(255,255,255,0.04), transparent 55%),
        radial-gradient(circle at center, #1c7b52 0, #094432 55%, #031614 100%);
    }

    .table-container {
      position: relative;
      width: 90%;
      max-width: 900px;
      margin: 36px auto;
      height: 520px;
      perspective: 900px;
    }

    .table {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 20%, #2fbf7a 0, #12724b 45%, #063024 100%);
      box-shadow:
        0 18px 40px rgba(0,0,0,0.8),
        inset 0 0 25px rgba(0,0,0,0.85);
      border: 8px solid #c59b45;
      transform: rotateX(18deg);
      transform-origin: center 120%;
    }

    .table::before{
      content:'';
      position:absolute;
      inset:18%;
      border-radius:50%;
      border:2px solid rgba(255,255,255,0.15);
      box-shadow:0 0 12px rgba(0,0,0,0.7);
      pointer-events:none;
    }

    .player-area { position:absolute; text-align:center; color: white; transition: transform 0.2s ease, box-shadow 0.2s ease; }

    .player-area.active-player {
      transform: translateY(-6px) scale(1.05);
      box-shadow: 0 0 18px rgba(255, 215, 0, 0.65);
    }

    .cards { display:flex; justify-content:center; gap:8px; margin-top:8px; }

    .card-bj {
      width:80px;
      height:120px;
      border-radius:10px;
      background:linear-gradient(145deg,#fdfdfd,#f3f3f3);
      color:#111;
      border:2px solid #d4af37;
      display:flex;
      justify-content:center;
      align-items:center;
      font-weight:700;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size:20px;
      box-shadow:
        0 6px 14px rgba(0,0,0,0.7),
        inset 0 0 0 1px rgba(255,255,255,0.8);
      position:relative;
      overflow:hidden;
      transition: transform 0.18s ease, box-shadow 0.18s ease;
    }

    .card-bj.card-back {
      background: radial-gradient(circle at 30% 20%, #fff8d0 0, #d4af37 35%, #8b6b1f 100%);
      box-shadow:
        0 6px 18px rgba(0,0,0,0.8),
        inset 0 0 0 1px rgba(255,255,255,0.9);
    }

    .chair {
      width:50px;
      height:50px;
      background:radial-gradient(circle at 30% 20%, #555, #222);
      border-radius:50%;
      position:absolute;
      box-shadow:
        0 4px 10px rgba(0,0,0,0.6),
        inset 0 -4px 8px rgba(0,0,0,0.8);
      border:2px solid #666;
    }

    #controls { margin-top:20px; }

    /* Poker section */
    #pokerSection { background:#0f2b2a; min-height:100vh; color:white; padding-bottom:40px; }
    .poker-table { width:90%; max-width:1000px; margin:20px auto; background:linear-gradient(145deg,#123835,#041817); border-radius:16px; padding:18px; box-shadow:0 8px 30px rgba(0,0,0,0.5); }
    .community { display:flex; justify-content:center; gap:8px; margin:12px 0; }
    .card-pk { width:72px; height:102px; background:white; color:black; border-radius:8px; display:flex; justify-content:center; align-items:center; font-weight:bold; box-shadow:0 6px 16px rgba(0,0,0,0.7); }
    .poker-players { display:flex; flex-wrap:wrap; justify-content:center; gap:12px; margin-top:16px; }
    .poker-player { min-width:140px; padding:10px; border-radius:10px; background:rgba(0,0,0,0.4); border:1px solid rgba(255,255,255,0.06); }
    .poker-player h4{ margin:0 0 6px 0; font-size:14px; }
    .poker-player .hand{ display:flex; justify-content:center; gap:6px; margin:6px 0; }
    .poker-info-row{ margin-top:8px; font-size:13px; }
    .poker-pot-row{ margin-top:8px; font-weight:bold; }
    .poker-seat-row{ font-size:12px; color:#ccc; }
    small { font-size:12px; color:#ddd; }

    .poker-controls { margin-top:14px; }

    /* Table games */
    #crapsSection,
    #baccaratSection,
    #rouletteSection{
      min-height: 100vh;
      color: white;
      padding: 24px;
      background: radial-gradient(circle at top, #1c2235 0, #0c101c 60%, #06070c 100%);
      text-align: center;
    }

    .table-game-panel{
      max-width: 860px;
      margin: 20px auto;
      background: rgba(0,0,0,0.55);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 10px 28px rgba(0,0,0,0.5);
    }

    .dice-row{
      display:flex;
      justify-content:center;
      gap:16px;
      margin: 14px 0;
      font-size: 48px;
    }

    .baccarat-row,
    .roulette-row{
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap: wrap;
      margin: 14px 0;
    }

    .baccarat-card{
      width: 70px;
      height: 100px;
      background: #fdfdfd;
      color:#111;
      border-radius: 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      border:2px solid #d4af37;
      box-shadow: 0 6px 16px rgba(0,0,0,0.6);
    }

    .roulette-wheel{
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background: conic-gradient(#c62828 0 20deg, #111 20deg 40deg, #c62828 40deg 60deg, #111 60deg 80deg, #c62828 80deg 100deg, #111 100deg 120deg, #c62828 120deg 140deg, #111 140deg 160deg, #c62828 160deg 180deg, #1b7d3d 180deg 200deg, #111 200deg 220deg, #c62828 220deg 240deg, #111 240deg 260deg, #c62828 260deg 280deg, #111 280deg 300deg, #c62828 300deg 320deg, #111 320deg 340deg, #c62828 340deg 360deg);
      border: 6px solid #d4af37;
      box-shadow: 0 10px 30px rgba(0,0,0,0.65);
      margin: 0 auto;
    }

    .roulette-result{
      font-size: 20px;
      font-weight: 700;
      margin-top: 12px;
    }

    /* Global credits display */
    #creditsDisplayGlobal{
      position: fixed;
      top: 12px;
      left: 12px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 16px;
      z-index: 99999;
      display: none;
    }

/* ===== Paardenrace Lanes ===== */
.raceLane {
    position: relative;
    height: 60px;
    margin: 18px 0;
    background: repeating-linear-gradient(90deg, #145200, #145200 40px, #1a6600 40px, #1a6600 80px);
    border-radius: 10px;
    border: 2px solid #d4af37;
}

.horse {
    position: absolute;
    font-size: 40px;
    left: 0;
    top: 10px;
    transition: left 0.2s linear;
}

    /* small responsive */
    @media (max-width:600px){
      #lb-popup { width: 100%; right:0; left:0; height: 50vh; border-radius: 12px 12px 0 0;}
      .card-bj{ width:56px; height:84px; }
      .table-container{ height:360px; }
      .card-pk{ width:56px; height:84px; }
    }
  </style>
</head>
<body>

  <!-- Globale credits overlay -->
  <div id="creditsDisplayGlobal">
    Credits: <span id="globalCredits">0</span>
  </div>

  <!-- Login / Account aanmaken -->
  <section id="login">
    <h2>Welkom! Maak een account of log in</h2>
    <input type="text" id="usernameInput" placeholder="Gebruikersnaam">
    <input type="password" id="passwordInput" placeholder="Wachtwoord">
    <button id="loginBtn">Login</button>
    <button id="createAccountBtn">Account aanmaken</button>
  </section>

  <!-- Dashboard -->
  <section id="dashboard">
    <div class="menu-wrapper">
      <header class="menu-header">
        <div class="menu-brand">
          <div class="menu-logo">‚ô†</div>
          <div>
            <h2>Ignatius Casino</h2>
            <small>Welkom terug, <span id="displayName"></span></small>
          </div>
        </div>
        <div class="menu-stats">
          <div class="menu-stat">
            <span>Credits</span>
            <strong><span id="credits"></span></strong>
          </div>
          <div class="menu-stat">
            <span>Lucky Coins</span>
            <strong><span id="luckyCoins"></span> ‚Ä¢ <span id="luckyCoinProgress"></span>/500</strong>
          </div>
        </div>
        <div class="menu-actions">
          <button id="claimDailyBtn" class="menu-action-btn primary">Claim dagelijkse bonus</button>
          <button id="logoutBtn" class="menu-action-btn">Uitloggen</button>
        </div>
      </header>

      <section class="menu-hero">
        <div class="menu-hero-text">
          <h3>Jouw casinovloer is klaar</h3>
          <p>Pak je voordeel: snelle games, speciale acties en een luxe sfeer om meteen te spelen.</p>
        </div>
        <div class="menu-hero-highlight">
          <div>Dagelijkse boost</div>
          <strong>+250 credits</strong>
          <div style="font-size:12px; color: rgba(255,255,255,0.7);">Mis je bonus niet!</div>
        </div>
      </section>

      <div class="menu-grid">
        <div class="menu-card menu-highlight">
          <h4>Blackjack Lounge</h4>
          <p>Casino vibes met live feeling. Strategisch en snel uitbetalen.</p>
          <button id="playBlackjackBtn" class="cta-button">Play Blackjack</button>
        </div>
        <div class="menu-card">
          <h4>Poker Royale</h4>
          <p>Ga all-in of speel slim. Kies je tafel en domineer.</p>
          <button id="playPokerBtn" class="cta-button alt">Speel Poker</button>
        </div>
        <div class="menu-card">
          <h4>Craps Arena</h4>
          <p>Gooi de dobbelstenen en bouw je punt op.</p>
          <button id="playCrapsBtn" class="cta-button">Speel Craps</button>
        </div>
        <div class="menu-card">
          <h4>Baccarat Salon</h4>
          <p>Elegante snelle rondes voor high-roller vibes.</p>
          <button id="playBaccaratBtn" class="cta-button alt">Speel Baccarat</button>
        </div>
        <div class="menu-card">
          <h4>Roulette Table</h4>
          <p>Voorspel kleur of nummer en laat het wiel draaien.</p>
          <button id="playRouletteBtn" class="cta-button">Speel Roulette</button>
        </div>
        <div class="menu-card">
          <h4>Lucky Boxes</h4>
          <p>Open luxe boxes met Lucky Coins en win power-ups.</p>
          <button id="openLuckyBoxesTab" class="cta-button alt">Open Lucky Boxes</button>
        </div>
        <div class="menu-card">
          <h4>Paardenrace Club</h4>
          <p>Stap in de VIP-tribune en kies jouw winnaar.</p>
          <button id="playHorseRaceBtn" class="cta-button alt">Start race</button>
        </div>
        <div class="menu-card">
          <h4>Casino Sound</h4>
          <p>Vibe harder met luxe soundtracks. Pas direct je muziek aan.</p>
          <button id="musicControl" class="cta-button alt" aria-label="Muziek menu">
            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><path fill='%23ffffff' d='M48 6v36.6a9.4 9.4 0 1 1-4-7.7V18.4l-20 4.6V48a9.4 9.4 0 1 1-4-7.7V13.3L48 6z'/></svg>" alt="Kwartnoot">
          </button>
        </div>
      </div>

      <!-- Music control -->
      <audio id="bgMusic" loop>
        <source src="https://cdn.pixabay.com/audio/2023/03/07/audio_2ea36d1deb.mp3" type="audio/mpeg">
        <source src="https://cdn.pixabay.com/audio/2023/03/15/audio_e3bbcbfce7.mp3" type="audio/mpeg">
        <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_8f17fc4b42.mp3" type="audio/mpeg">
      </audio>
    </div>
  </section>

  <!-- Loot Boxes menu -->
  <section id="lootBoxMenuSection" style="display:none;">
    <h2>Lucky Boxes</h2>
    <p>Kies een box om te openen. Je betaalt met Lucky Coins.</p>
    <div class="lootbox-menu-grid">
      <div class="lootbox-option">
        <div class="lootbox-star-row">‚òÖ</div>
        <div class="lootbox-card lootbox-level-1" data-lootbox="lucky">
          <div class="lootbox-icon">üéÅ</div>
          <div>Lucky Box</div>
          <small>1 Lucky Coin</small>
        </div>
      </div>
      <div class="lootbox-option">
        <div class="lootbox-star-row">‚òÖ ‚òÖ</div>
        <div class="lootbox-card lootbox-level-2" data-lootbox="deluxe">
          <div class="lootbox-icon">üéÅ</div>
          <div>Deluxe Lucky Box</div>
          <small>5 Lucky Coins</small>
        </div>
      </div>
      <div class="lootbox-option">
        <div class="lootbox-star-row">‚òÖ ‚òÖ ‚òÖ</div>
        <div class="lootbox-card lootbox-level-3" data-lootbox="ultra">
          <div class="lootbox-icon">üéÅ</div>
          <div>Ultra Deluxe Lucky Box</div>
          <small>10 Lucky Coins</small>
        </div>
      </div>
    </div>
    <button id="backToMenuFromLuckyBoxes">Terug naar menu</button>
  </section>

  <!-- Loot Box opening -->
  <section id="lootBoxSection" style="display:none;">
    <h2 id="lootBoxTitle">Lucky Box</h2>
    <p id="lootBoxSubtitle">Klik op de box om te upgraden. Je hebt 3 kansen.</p>
    <div class="lootbox-stage">
      <div id="lootBoxCard" class="lootbox-card lootbox-level-1">
        <div class="lootbox-icon">üéÅ</div>
        <div>Reward level <span id="lootBoxLevel">1</span></div>
      </div>
      <div id="lootBoxChances" class="lootbox-chances">
        <div class="chance-dot">‚òÖ</div>
        <div class="chance-dot">‚òÖ</div>
        <div class="chance-dot">‚òÖ</div>
      </div>
      <div id="lootBoxHint">Klik om te upgraden (12,5% kans per klik).</div>
      <div id="lootBoxReward"></div>
    </div>
    <button id="backToMenuFromLoot">Terug naar menu</button>
  </section>

  <!-- Blackjack -->
  <section id="blackjackSection">
    <h2>Blackjack</h2>
    <div>
      <label>Kies aantal bots:</label>
      <select id="botCount">
        <option value="0">0 bots</option>
        <option value="1">1 bot</option>
        <option value="2">2 bots</option>
        <option value="3">3 bots</option>
        <option value="4">4 bots</option>
        <option value="5">5 bots</option>
        <option value="6">6 bots</option>
      </select><br><br>
      <label>Inzet (credits):</label>
      <input type="number" id="betAmount" min="1" value="100">
      <button id="startGame">Start spel</button>
      <button id="backToMenu">Terug naar menu</button>
    </div>
    <div class="table-container">
      <div class="table" id="table">
        <!-- Stoelen + spelergebieden komen hier dynamisch -->
      </div>
    </div>
    <div id="controls">
      <button id="hitBtn">Hit</button>
      <button id="standBtn">Stand</button>
      <button id="nextRoundBtn" style="display:none">Volgende ronde</button>
    </div>
  </section>

  <!-- Poker -->
  <section id="pokerSection">
    <h2>Texas Hold'em Poker</h2>

    <div style="margin:10px 0;">
      <label>Minimale credits om mee te doen: 500. Kies tafel:</label><br>
      <select id="pokerTableSelect">
        <option value="500">Tafel 500</option>
        <option value="1500">Tafel 1500</option>
        <option value="3500">Tafel 3500</option>
        <option value="5000">Tafel 5000</option>
      </select>
      <button id="joinPokerBtn">Deelnemen</button>
      <button id="leavePokerBtn">Tafel verlaten</button>
      <button id="backFromPokerBtn">Terug naar menu</button>
    </div>

    <div class="poker-table">
      <div class="poker-pot-row">
        Pot: <span id="pokerPot">0</span> | Side pot: <span id="pokerSidePot">0</span>
      </div>
      <div class="community" id="pokerCommunity"></div>
      <div class="poker-players" id="pokerPlayers"></div>

      <div class="poker-controls">
        <p><strong>Jouw actie:</strong></p>
        <button id="pokerCheckBtn">Check / Call</button>
        <button id="pokerBetBtn">Bet / Raise</button>
        <button id="pokerFoldBtn">Fold</button>
        <div style="margin-top:6px;">
          <label>Bet bedrag:</label>
          <input type="number" id="pokerBetAmount" min="0" value="100" style="width:100px;">
        </div>
        <small id="pokerStatus"></small>
      </div>
    </div>
  </section>

  <!-- Craps -->
  <section id="crapsSection" style="display:none;">
    <h2>üé≤ Craps</h2>
    <p>Come-out roll: 7/11 wint, 2/3/12 verliest. Anders zet je een punt.</p>
    <div class="table-game-panel">
      <label>Inzet (credits):</label>
      <input type="number" id="crapsBet" min="10" value="100">
      <div class="dice-row">
        <div id="crapsDieOne">‚öÄ</div>
        <div id="crapsDieTwo">‚öÄ</div>
      </div>
      <div id="crapsPoint">Punt: -</div>
      <div id="crapsStatus">Plaats je inzet en gooi de dobbelstenen.</div>
      <div style="margin-top:12px;">
        <button id="rollCrapsBtn">Gooi</button>
        <button id="resetCrapsBtn">Reset ronde</button>
        <button id="backFromCrapsBtn">Terug naar menu</button>
      </div>
    </div>
  </section>

  <!-- Baccarat -->
  <section id="baccaratSection" style="display:none;">
    <h2>üÇ° Baccarat</h2>
    <p>Kies je inzet op Player, Banker of Tie en laat de kaarten spreken.</p>
    <div class="table-game-panel">
      <label>Inzet (credits):</label>
      <input type="number" id="baccaratBet" min="10" value="200">
      <label style="margin-left:8px;">Inzet op:</label>
      <select id="baccaratBetType">
        <option value="player">Player</option>
        <option value="banker">Banker</option>
        <option value="tie">Tie</option>
      </select>
      <div class="baccarat-row" id="baccaratPlayerRow"></div>
      <div class="baccarat-row" id="baccaratBankerRow"></div>
      <div id="baccaratStatus">Plaats je inzet en start een ronde.</div>
      <div style="margin-top:12px;">
        <button id="dealBaccaratBtn">Deel kaarten</button>
        <button id="backFromBaccaratBtn">Terug naar menu</button>
      </div>
    </div>
  </section>

  <!-- Roulette -->
  <section id="rouletteSection" style="display:none;">
    <h2>üé° Roulette</h2>
    <p>Kies je inzettype en draai het wiel.</p>
    <div class="table-game-panel">
      <label>Inzet (credits):</label>
      <input type="number" id="rouletteBet" min="10" value="150">
      <label style="margin-left:8px;">Inzettype:</label>
      <select id="rouletteBetType">
        <option value="color">Kleur</option>
        <option value="number">Nummer</option>
      </select>
      <div class="roulette-row">
        <select id="rouletteColor">
          <option value="red">Rood</option>
          <option value="black">Zwart</option>
          <option value="green">Groen (0)</option>
        </select>
        <input type="number" id="rouletteNumber" min="0" max="36" value="7" style="width:90px;">
      </div>
      <div class="roulette-wheel"></div>
      <div class="roulette-result" id="rouletteResult">Resultaat: -</div>
      <div id="rouletteStatus">Plaats je inzet en draai.</div>
      <div style="margin-top:12px;">
        <button id="spinRouletteBtn">Draaien</button>
        <button id="backFromRouletteBtn">Terug naar menu</button>
      </div>
    </div>
  </section>
  
 <!-- ==================== PAARDENRACE SPEL ==================== -->
<section id="horseRaceSection" style="display:none; text-align:center; padding:20px; color:white; background:#1b1b1b; height:100vh;">
    <h2>üèá Paardenrace</h2>

    <p>Kies je paard en zet je credits in!</p>

    <label>Inzet (credits):</label>
    <input type="number" id="horseBet" min="10" value="100">

    <br><br>

    <label>Kies een paard:</label>
    <select id="horseSelect">
        <option value="1">Paard 1 ‚Äì ‚ö° Sprinter</option>
        <option value="2">Paard 2 ‚Äì üõ° Steady Boy</option>
        <option value="3">Paard 3 ‚Äì üéØ Precision</option>
        <option value="4">Paard 4 ‚Äì üé≤ Wild Power</option>
    </select>

    <br><br>

    <button id="startRaceBtn">Start race</button>
    <button id="backToMenuRace">Terug naar menu</button>

    <!-- Race Track -->
    <div id="raceTrack" style="width:90%; margin:40px auto; border:3px solid gold; padding:20px; background:#0d3f00; border-radius:14px;">
        
        <div class="raceLane" id="lane1">
            <div class="horse" id="horse1">üêé</div>
        </div>
        <div class="raceLane" id="lane2">
            <div class="horse" id="horse2">üêé</div>
        </div>
        <div class="raceLane" id="lane3">
            <div class="horse" id="horse3">üêé</div>
        </div>
        <div class="raceLane" id="lane4">
            <div class="horse" id="horse4">üêé</div>
        </div>

    </div>
</section>
  
  <!-- Leaderboard floating tab -->
  <div id="lb-tab">üèÜ Leaderboard</div>

  <!-- Leaderboard popup -->
  <div id="lb-popup">
      <div id="lb-popup-inner">
          <div id="lb-left" class="lb-arrow">‚Üê</div>
          <h2 id="lb-title">All-Time Earnings</h2>
          <div id="lb-content"></div>
          <div id="lb-right" class="lb-arrow">‚Üí</div>
          <button id="lb-close">Sluiten</button>
      </div>
  </div>

  <!-- MUSIC MENU -->
  <div id="musicMenu">
    <div id="musicMenuInner">
        <h3>Muziekinstellingen</h3>
        <label>Volume:</label><br>
        <input type="range" id="musicVolume" min="0" max="1" step="0.01">
        <br><br>
        <label>Muziek selecteren:</label>
        <select id="musicTrackSelect">
            <option value="0">Funky Upbeat</option>
            <option value="1">Electronic Chill</option>
            <option value="2">Lounge Vibes</option>
        </select>
        <br><br>
        <button id="muteBtn">üéµ Mute</button>
        <br><br>
        <button id="closeMusicMenu">Sluiten</button>
    </div>
  </div>

  <!-- Firebase v8 (online accounts & leaderboards) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyARtIFfUXzlkJppkcUSx5ril2FerJltwNs",
      authDomain: "gokken4school.firebaseapp.com",
      databaseURL: "https://gokken4school-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gokken4school",
      storageBucket: "gokken4school.firebasestorage.app",
      messagingSenderId: "210902717668",
      appId: "1:210902717668:web:16ebea58067718ffce48f1",
      measurementId: "G-G9SVYLDMWC"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <script>
    /* ---------------------------
       Data & helpers
       --------------------------- */
    let users = {};
    let currentUser = null;

    function keyForName(name){ return name.trim().toLowerCase(); }

    async function loadUser(key){
      const snap = await db.ref('users/'+key).once('value');
      return snap.val() || null;
    }
    async function saveCurrentUser(){
      if(!currentUser || !currentUser.key) return;
      await db.ref('users/'+currentUser.key).set(currentUser);
    }

    /* ---------------------------
       UI refs
       --------------------------- */
    const loginSection = document.getElementById('login');
    const dashboard = document.getElementById('dashboard');
    const blackjackSection = document.getElementById('blackjackSection');
    const pokerSection = document.getElementById('pokerSection');
    const crapsSection = document.getElementById('crapsSection');
    const baccaratSection = document.getElementById('baccaratSection');
    const rouletteSection = document.getElementById('rouletteSection');
    const lootBoxMenuSection = document.getElementById('lootBoxMenuSection');
    const lootBoxSection = document.getElementById('lootBoxSection');
    const backFromPokerBtn = document.getElementById('backFromPokerBtn');

    const usernameInput = document.getElementById('usernameInput');
    const passwordInput = document.getElementById('passwordInput');
    const loginBtn = document.getElementById('loginBtn');
    const createAccountBtn = document.getElementById('createAccountBtn');
    const displayName = document.getElementById('displayName');
    const creditsEl = document.getElementById('credits');
    const claimDailyBtn = document.getElementById('claimDailyBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const playBlackjackBtn = document.getElementById('playBlackjackBtn');
    const playPokerBtn = document.getElementById('playPokerBtn');
    const playCrapsBtn = document.getElementById('playCrapsBtn');
    const playBaccaratBtn = document.getElementById('playBaccaratBtn');
    const playRouletteBtn = document.getElementById('playRouletteBtn');
    const openLuckyBoxesTab = document.getElementById('openLuckyBoxesTab');
    const openLeaderboardsBtn = document.getElementById('openLeaderboardsBtn');
    const luckyCoinsEl = document.getElementById('luckyCoins');
    const luckyCoinProgressEl = document.getElementById('luckyCoinProgress');

    const lootBoxTitle = document.getElementById('lootBoxTitle');
    const lootBoxSubtitle = document.getElementById('lootBoxSubtitle');
    const lootBoxCard = document.getElementById('lootBoxCard');
    const lootBoxLevel = document.getElementById('lootBoxLevel');
    const lootBoxChances = document.getElementById('lootBoxChances');
    const lootBoxHint = document.getElementById('lootBoxHint');
    const lootBoxReward = document.getElementById('lootBoxReward');
    const backToMenuFromLoot = document.getElementById('backToMenuFromLoot');
    const backToMenuFromLuckyBoxes = document.getElementById('backToMenuFromLuckyBoxes');

    const bgMusic = document.getElementById('bgMusic');
    const musicControl = document.getElementById('musicControl');
    const musicMenu = document.getElementById('musicMenu');
    const musicVolume = document.getElementById('musicVolume');
    const musicTrackSelect = document.getElementById('musicTrackSelect');
    const closeMusicMenu = document.getElementById('closeMusicMenu');
    const muteBtn = document.getElementById('muteBtn');

    /* Blackjack refs */
    const startGameBtn = document.getElementById('startGame');
    const botSelect = document.getElementById('botCount');
    const betAmountInput = document.getElementById('betAmount');
    const table = document.getElementById('table');
    const hitBtn = document.getElementById('hitBtn');
    const standBtn = document.getElementById('standBtn');
    const nextRoundBtn = document.getElementById('nextRoundBtn');
    const backToMenuBtn = document.getElementById('backToMenu');

    /* Craps refs */
    const crapsBetInput = document.getElementById('crapsBet');
    const crapsDieOne = document.getElementById('crapsDieOne');
    const crapsDieTwo = document.getElementById('crapsDieTwo');
    const crapsPointEl = document.getElementById('crapsPoint');
    const crapsStatusEl = document.getElementById('crapsStatus');
    const rollCrapsBtn = document.getElementById('rollCrapsBtn');
    const resetCrapsBtn = document.getElementById('resetCrapsBtn');
    const backFromCrapsBtn = document.getElementById('backFromCrapsBtn');

    /* Baccarat refs */
    const baccaratBetInput = document.getElementById('baccaratBet');
    const baccaratBetType = document.getElementById('baccaratBetType');
    const baccaratPlayerRow = document.getElementById('baccaratPlayerRow');
    const baccaratBankerRow = document.getElementById('baccaratBankerRow');
    const baccaratStatusEl = document.getElementById('baccaratStatus');
    const dealBaccaratBtn = document.getElementById('dealBaccaratBtn');
    const backFromBaccaratBtn = document.getElementById('backFromBaccaratBtn');

    /* Roulette refs */
    const rouletteBetInput = document.getElementById('rouletteBet');
    const rouletteBetType = document.getElementById('rouletteBetType');
    const rouletteColor = document.getElementById('rouletteColor');
    const rouletteNumber = document.getElementById('rouletteNumber');
    const rouletteResult = document.getElementById('rouletteResult');
    const rouletteStatus = document.getElementById('rouletteStatus');
    const spinRouletteBtn = document.getElementById('spinRouletteBtn');
    const backFromRouletteBtn = document.getElementById('backFromRouletteBtn');

    /* Poker refs */
    const pokerTableSelect = document.getElementById('pokerTableSelect');
    const joinPokerBtn = document.getElementById('joinPokerBtn');
    const leavePokerBtn = document.getElementById('leavePokerBtn');
    const pokerPotEl = document.getElementById('pokerPot');
    const pokerSidePotEl = document.getElementById('pokerSidePot');
    const pokerCommunityEl = document.getElementById('pokerCommunity');
    const pokerPlayersEl = document.getElementById('pokerPlayers');
    const pokerCheckBtn = document.getElementById('pokerCheckBtn');
    const pokerBetBtn = document.getElementById('pokerBetBtn');
    const pokerFoldBtn = document.getElementById('pokerFoldBtn');
    const pokerBetAmountInput = document.getElementById('pokerBetAmount');
    const pokerStatusEl = document.getElementById('pokerStatus');

    /* Leaderboard refs */
    const lbTab = document.getElementById('lb-tab');
    const lbPopup = document.getElementById('lb-popup');
    const lbLeft = document.getElementById('lb-left');
    const lbRight = document.getElementById('lb-right');
    const lbClose = document.getElementById('lb-close');
    const lbTitle = document.getElementById('lb-title');
    const lbContent = document.getElementById('lb-content');

    const creditsGlobalSpan = document.getElementById('globalCredits');

    /* ---------------------------
       Login / accounts
       --------------------------- */
    loginSection.style.display = 'flex';

    loginBtn.onclick = async ()=>{
      const rawName = usernameInput.value.trim();
      const passwd = passwordInput.value.trim();
      if(!rawName || !passwd) return alert('Vul gebruikersnaam en wachtwoord in.');

      const key = keyForName(rawName);
      const existing = await loadUser(key);
      if(!existing) return alert('Account bestaat niet.');
      if(existing.password !== passwd) return alert('Wachtwoord onjuist.');

      const needsLuckyInit = typeof existing.luckyCoins !== 'number' || typeof existing.luckyCoinProgress !== 'number';
      currentUser = existing;
      currentUser.key = key;
      ensureLuckyFields(currentUser);
      loginSection.style.display='none';
      dashboard.style.display='block';
      renderDashboard();
      if(needsLuckyInit){
        saveCurrentUser();
      }
      bgMusic.play().catch(()=>{});
    };

    createAccountBtn.onclick = async ()=>{
      const rawName = usernameInput.value.trim();
      const passwd = passwordInput.value.trim();
      if(!rawName || !passwd) return alert('Vul gebruikersnaam en wachtwoord in.');

      const key = keyForName(rawName);
      const existing = await loadUser(key);
      if(existing){
        alert('Account bestaat al.');
        return;
      }

      currentUser = {
        key,
        name: rawName,
        password: passwd,
        credits: 1000,
        luckyCoins: 0,
        luckyCoinProgress: 0,
        lastDaily: null,
        wins: 0,
        losses: 0,
        gamesPlayed: 0,
        totalEarned: 0,
        bjWins: 0,
        bjLosses: 0,
        bjGames: 0,
        pkWins: 0,
        pkLosses: 0,
        pkGames: 0
      };
      await saveCurrentUser();
      loginSection.style.display='none';
      dashboard.style.display='block';
      renderDashboard();
      bgMusic.play().catch(()=>{});
    };

    function ensureLuckyFields(user){
      if(!user) return;
      if(typeof user.luckyCoins !== 'number') user.luckyCoins = 0;
      if(typeof user.luckyCoinProgress !== 'number') user.luckyCoinProgress = 0;
    }

    function updateLuckyCoinDisplay(){
      if(!currentUser) return;
      ensureLuckyFields(currentUser);
      luckyCoinsEl.textContent = currentUser.luckyCoins;
      luckyCoinProgressEl.textContent = currentUser.luckyCoinProgress;
    }

    function applyLuckyCoinProgress(amount){
      if(!currentUser || amount <= 0) return;
      ensureLuckyFields(currentUser);
      currentUser.luckyCoinProgress += amount;
      const earned = Math.floor(currentUser.luckyCoinProgress / 500);
      if(earned > 0){
        currentUser.luckyCoins += earned;
        currentUser.luckyCoinProgress = currentUser.luckyCoinProgress % 500;
      }
      updateLuckyCoinDisplay();
    }

    function renderDashboard(){
      if(!currentUser) return;
      ensureLuckyFields(currentUser);
      displayName.textContent = currentUser.name;
      creditsEl.textContent = currentUser.credits;
      updateLuckyCoinDisplay();
      const bar = document.getElementById('creditsDisplayGlobal');
      if(bar){
        bar.style.display = 'block';
        creditsGlobalSpan.textContent = currentUser.credits;
      }
    }

    logoutBtn.onclick = () => {
      currentUser = null;
      dashboard.style.display = 'none';
      blackjackSection.style.display = 'none';
      pokerSection.style.display = 'none';
      crapsSection.style.display = 'none';
      baccaratSection.style.display = 'none';
      rouletteSection.style.display = 'none';
      lootBoxMenuSection.style.display = 'none';
      lootBoxSection.style.display = 'none';
      loginSection.style.display = 'flex';
      bgMusic.pause();
      const bar = document.getElementById('creditsDisplayGlobal');
      if(bar) bar.style.display = 'none';
    };

    claimDailyBtn.onclick = async ()=>{
      if(!currentUser) return;
      const t = new Date().toDateString();
      if(currentUser.lastDaily !== t){
        currentUser.credits += 100;
        currentUser.lastDaily = t;
        await saveCurrentUser();
        renderDashboard();
        alert('Dagelijkse bonus geclaimd: +100 credits');
      } else {
        alert('Je hebt vandaag al je bonus geclaimd.');
      }
    };

    playBlackjackBtn.onclick = ()=>{
      dashboard.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      blackjackSection.style.display='block';
    };

    playPokerBtn.onclick = ()=>{
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      pokerSection.style.display='block';
    };

    playCrapsBtn.onclick = ()=>{
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      baccaratSection.style.display='none';
      rouletteSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      crapsSection.style.display='block';
    };

    playBaccaratBtn.onclick = ()=>{
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      rouletteSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      baccaratSection.style.display='block';
    };

    playRouletteBtn.onclick = ()=>{
      dashboard.style.display='none';
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      crapsSection.style.display='none';
      baccaratSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      rouletteSection.style.display='block';
    };

    openLuckyBoxesTab.onclick = ()=>{
      if(!currentUser) return alert('Je moet eerst inloggen!');
      dashboard.style.display = 'none';
      blackjackSection.style.display = 'none';
      pokerSection.style.display = 'none';
      crapsSection.style.display = 'none';
      baccaratSection.style.display = 'none';
      rouletteSection.style.display = 'none';
      lootBoxSection.style.display = 'none';
      lootBoxMenuSection.style.display = 'block';
    };

    const lootBoxConfigs = {
      lucky: { name: 'Lucky Box', cost: 1, startLevel: 1 },
      deluxe: { name: 'Deluxe Lucky Box', cost: 5, startLevel: 2 },
      ultra: { name: 'Ultra Deluxe Lucky Box', cost: 10, startLevel: 3 }
    };
    const lootBoxRewards = {
      1: 50,
      2: 150,
      3: 500,
      4: 1000,
      5: 2500
    };
    let currentLootBox = null;

    document.querySelectorAll('.lootbox-card[data-lootbox]').forEach((card)=>{
      card.addEventListener('click', ()=>{
        const type = card.getAttribute('data-lootbox');
        openLootBox(type);
      });
    });

    function updateLootBoxUI(){
      if(!currentLootBox) return;
      lootBoxTitle.textContent = currentLootBox.name;
      lootBoxSubtitle.textContent = `Klik op de box om te upgraden. ${currentLootBox.remainingChances} kansen over.`;
      lootBoxLevel.textContent = currentLootBox.level;
      lootBoxCard.className = `lootbox-card lootbox-level-${currentLootBox.level}`;
      if(currentLootBox.remainingChances === 0){
        lootBoxCard.classList.add('disabled');
      }
      const dots = lootBoxChances.querySelectorAll('.chance-dot');
      dots.forEach((dot, index)=>{
        dot.classList.toggle('used', index >= currentLootBox.remainingChances);
      });
    }

    function openLootBox(type){
      if(!currentUser) return alert('Je moet eerst inloggen!');
      const config = lootBoxConfigs[type];
      ensureLuckyFields(currentUser);
      if(currentUser.luckyCoins < config.cost){
        alert(`Je hebt ${config.cost} Lucky Coins nodig voor ${config.name}.`);
        return;
      }
      currentUser.luckyCoins -= config.cost;
      currentLootBox = {
        type,
        name: config.name,
        level: config.startLevel,
        remainingChances: 3
      };
      lootBoxReward.textContent = '';
      lootBoxHint.textContent = 'Klik om te upgraden (12,5% kans per klik).';
      dashboard.style.display = 'none';
      blackjackSection.style.display = 'none';
      pokerSection.style.display = 'none';
      lootBoxMenuSection.style.display = 'none';
      lootBoxSection.style.display = 'block';
      updateLuckyCoinDisplay();
      updateLootBoxUI();
      saveCurrentUser();
    }

    lootBoxCard.onclick = ()=>{
      if(!currentLootBox || currentLootBox.remainingChances === 0) return;
      currentLootBox.remainingChances -= 1;
      if(Math.random() < 0.125 && currentLootBox.level < 5){
        currentLootBox.level += 1;
      }
      if(currentLootBox.remainingChances === 0){
        const reward = lootBoxRewards[currentLootBox.level];
        currentUser.credits += reward;
        lootBoxHint.textContent = 'Kist geopend! Je beloning is uitgekeerd.';
        lootBoxReward.textContent = `Beloning: ${reward} credits (level ${currentLootBox.level}).`;
        saveCurrentUser().then(renderDashboard);
      }
      updateLootBoxUI();
    };
const playHorseRaceBtn = document.getElementById("playHorseRaceBtn");

playHorseRaceBtn.onclick = () => {
    dashboard.style.display = "none";
    lootBoxMenuSection.style.display = "none";
    lootBoxSection.style.display = "none";
    crapsSection.style.display = "none";
    baccaratSection.style.display = "none";
    rouletteSection.style.display = "none";
    horseRaceSection.style.display = "block";
};

    backToMenuBtn.onclick = ()=>{
      blackjackSection.style.display='none';
      pokerSection.style.display='none';
      lootBoxMenuSection.style.display='none';
      lootBoxSection.style.display='none';
      dashboard.style.display='block';
    };

    backToMenuFromLoot.onclick = ()=>{
      lootBoxSection.style.display = 'none';
      lootBoxMenuSection.style.display = 'block';
    };

    backToMenuFromLuckyBoxes.onclick = ()=>{
      lootBoxMenuSection.style.display = 'none';
      dashboard.style.display = 'block';
    };

    backFromCrapsBtn.onclick = ()=>{
      crapsSection.style.display = 'none';
      dashboard.style.display = 'block';
    };

    backFromBaccaratBtn.onclick = ()=>{
      baccaratSection.style.display = 'none';
      dashboard.style.display = 'block';
    };

    backFromRouletteBtn.onclick = ()=>{
      rouletteSection.style.display = 'none';
      dashboard.style.display = 'block';
    };

    /* ---------------------------
       Craps / Baccarat / Roulette logic
       --------------------------- */
    const diceFaces = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];
    let crapsPoint = null;
    let crapsBet = 0;

    function rollDie(){
      return Math.floor(Math.random() * 6) + 1;
    }

    function updateCrapsDice(d1, d2){
      crapsDieOne.textContent = diceFaces[d1 - 1];
      crapsDieTwo.textContent = diceFaces[d2 - 1];
    }

    function resetCrapsRound(){
      crapsPoint = null;
      crapsBet = 0;
      crapsPointEl.textContent = 'Punt: -';
      crapsStatusEl.textContent = 'Plaats je inzet en gooi de dobbelstenen.';
      updateCrapsDice(1, 1);
    }

    rollCrapsBtn.onclick = async ()=>{
      if(!currentUser) return alert('Je moet eerst inloggen!');
      if(crapsPoint === null){
        const bet = parseInt(crapsBetInput.value) || 0;
        if(bet < 10) return alert('Minimum inzet is 10 credits.');
        if(currentUser.credits < bet) return alert('Je hebt niet genoeg credits!');
        crapsBet = bet;
        currentUser.credits -= bet;
        await saveCurrentUser();
        renderDashboard();
      }

      const d1 = rollDie();
      const d2 = rollDie();
      const total = d1 + d2;
      updateCrapsDice(d1, d2);

      if(crapsPoint === null){
        if(total === 7 || total === 11){
          const winAmount = crapsBet * 2;
          currentUser.credits += winAmount;
          applyLuckyCoinProgress(winAmount);
          crapsStatusEl.textContent = `Come-out ${total}! Je wint ${winAmount} credits.`;
          crapsPointEl.textContent = 'Punt: -';
          await saveCurrentUser();
          renderDashboard();
          crapsBet = 0;
        } else if([2,3,12].includes(total)){
          crapsStatusEl.textContent = `Come-out ${total}. Je verliest je inzet.`;
          crapsPointEl.textContent = 'Punt: -';
          await saveCurrentUser();
          renderDashboard();
          crapsBet = 0;
        } else {
          crapsPoint = total;
          crapsPointEl.textContent = `Punt: ${crapsPoint}`;
          crapsStatusEl.textContent = `Punt gezet op ${crapsPoint}. Gooi door om te winnen!`;
        }
      } else {
        if(total === crapsPoint){
          const winAmount = crapsBet * 2;
          currentUser.credits += winAmount;
          applyLuckyCoinProgress(winAmount);
          crapsStatusEl.textContent = `Je rolt ${total} en maakt je punt! +${winAmount} credits.`;
          await saveCurrentUser();
          renderDashboard();
          crapsPoint = null;
          crapsBet = 0;
          crapsPointEl.textContent = 'Punt: -';
        } else if(total === 7){
          crapsStatusEl.textContent = '7-out! Je verliest je inzet.';
          await saveCurrentUser();
          renderDashboard();
          crapsPoint = null;
          crapsBet = 0;
          crapsPointEl.textContent = 'Punt: -';
        } else {
          crapsStatusEl.textContent = `Je rolt ${total}. Punt blijft ${crapsPoint}.`;
        }
      }
    };

    resetCrapsBtn.onclick = ()=>{
      resetCrapsRound();
    };

    resetCrapsRound();

    function baccaratCard(){
      const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
      const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
      const value = values[Math.floor(Math.random() * values.length)];
      const suit = suits[Math.floor(Math.random() * suits.length)];
      let points = parseInt(value, 10);
      if(Number.isNaN(points)){
        points = value === 'A' ? 1 : 0;
      }
      return { value, suit, points };
    }

    function baccaratScore(hand){
      return hand.reduce((sum, card)=>sum + card.points, 0) % 10;
    }

    function renderBaccaratHand(row, hand, label){
      row.innerHTML = `<strong style="width:100%; text-align:center;">${label} (${baccaratScore(hand)})</strong>` +
        hand.map(card=>`<div class="baccarat-card">${card.value}${card.suit}</div>`).join('');
    }

    dealBaccaratBtn.onclick = async ()=>{
      if(!currentUser) return alert('Je moet eerst inloggen!');
      const bet = parseInt(baccaratBetInput.value) || 0;
      if(bet < 10) return alert('Minimum inzet is 10 credits.');
      if(currentUser.credits < bet) return alert('Je hebt niet genoeg credits!');

      currentUser.credits -= bet;
      await saveCurrentUser();
      renderDashboard();

      const playerHand = [baccaratCard(), baccaratCard()];
      const bankerHand = [baccaratCard(), baccaratCard()];

      const playerScore = baccaratScore(playerHand);
      const bankerScore = baccaratScore(bankerHand);

      if(playerScore < 8 && bankerScore < 8){
        if(playerScore <= 5){
          playerHand.push(baccaratCard());
        }
        const newBankerScore = baccaratScore(bankerHand);
        if(newBankerScore <= 5){
          bankerHand.push(baccaratCard());
        }
      }

      const finalPlayerScore = baccaratScore(playerHand);
      const finalBankerScore = baccaratScore(bankerHand);
      let winner = 'tie';
      if(finalPlayerScore > finalBankerScore) winner = 'player';
      if(finalBankerScore > finalPlayerScore) winner = 'banker';

      renderBaccaratHand(baccaratPlayerRow, playerHand, 'Player');
      renderBaccaratHand(baccaratBankerRow, bankerHand, 'Banker');

      let winAmount = 0;
      if(baccaratBetType.value === winner){
        if(winner === 'tie'){
          winAmount = bet * 9;
        } else if(winner === 'banker'){
          winAmount = Math.floor(bet * 1.95);
        } else {
          winAmount = bet * 2;
        }
        currentUser.credits += winAmount;
        applyLuckyCoinProgress(winAmount);
        baccaratStatusEl.textContent = `Winner: ${winner.toUpperCase()}! Je wint ${winAmount} credits.`;
      } else {
        baccaratStatusEl.textContent = `Winner: ${winner.toUpperCase()}. Je verliest je inzet.`;
      }

      await saveCurrentUser();
      renderDashboard();
    };

    const rouletteRedNumbers = new Set([
      1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36
    ]);

    function rouletteColorFor(number){
      if(number === 0) return 'green';
      return rouletteRedNumbers.has(number) ? 'red' : 'black';
    }

    function updateRouletteInputs(){
      const type = rouletteBetType.value;
      rouletteColor.disabled = type !== 'color';
      rouletteNumber.disabled = type !== 'number';
    }

    rouletteBetType.onchange = updateRouletteInputs;
    updateRouletteInputs();

    spinRouletteBtn.onclick = async ()=>{
      if(!currentUser) return alert('Je moet eerst inloggen!');
      const bet = parseInt(rouletteBetInput.value) || 0;
      if(bet < 10) return alert('Minimum inzet is 10 credits.');
      if(currentUser.credits < bet) return alert('Je hebt niet genoeg credits!');

      currentUser.credits -= bet;
      await saveCurrentUser();
      renderDashboard();

      const resultNumber = Math.floor(Math.random() * 37);
      const resultColor = rouletteColorFor(resultNumber);
      rouletteResult.textContent = `Resultaat: ${resultNumber} (${resultColor})`;

      let winAmount = 0;
      if(rouletteBetType.value === 'color'){
        if(rouletteColor.value === resultColor){
          winAmount = resultColor === 'green' ? bet * 14 : bet * 2;
        }
      } else {
        const chosenNumber = parseInt(rouletteNumber.value, 10);
        if(!Number.isNaN(chosenNumber) && chosenNumber === resultNumber){
          winAmount = bet * 36;
        }
      }

      if(winAmount > 0){
        currentUser.credits += winAmount;
        applyLuckyCoinProgress(winAmount);
        rouletteStatus.textContent = `Je wint ${winAmount} credits!`;
      } else {
        rouletteStatus.textContent = 'Helaas, geen winst deze draai.';
      }

      await saveCurrentUser();
      renderDashboard();
    };

    /* ---------------------------
       Music menu
       --------------------------- */
    musicVolume.value = 0.4;
    bgMusic.volume = 0.4;

    function startMusic(){
      const sources = bgMusic.querySelectorAll('source');
      const index = parseInt(musicTrackSelect.value);
      const selectedSource = sources[index] || sources[0];
      if(selectedSource && bgMusic.src !== selectedSource.src){
        bgMusic.src = selectedSource.src;
        bgMusic.load();
      }
      bgMusic.play().catch(()=>{});
    }

    musicControl.onclick = () => {
      const isOpen = musicMenu.style.display === 'block';
      musicMenu.style.display = isOpen ? 'none' : 'block';
      if(!isOpen){
        startMusic();
      }
    };
    musicVolume.oninput = ()=>{ bgMusic.volume = parseFloat(musicVolume.value); };
    musicTrackSelect.onchange = ()=>{
      const index = parseInt(musicTrackSelect.value);
      const sources = bgMusic.querySelectorAll('source');
      if(sources[index]){
        bgMusic.pause();
        bgMusic.src = sources[index].src;
        bgMusic.load();
        startMusic();
      }
    };
    muteBtn.onclick = ()=>{ bgMusic.muted = !bgMusic.muted; muteBtn.textContent = bgMusic.muted ? 'üîá Unmute' : 'üéµ Mute'; };
    closeMusicMenu.onclick = ()=>{ musicMenu.style.display='none'; };

    /* ---------------------------
       Blackjack logic
       --------------------------- */
    const suits=['‚ô†','‚ô•','‚ô¶','‚ô£'];
    const values=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    let deck=[];

    function createDeck(){
      deck=[];
      for(let s of suits) for(let v of values) deck.push({suit:s, value:v});
      for(let i=deck.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; }
    }
    function cardValue(card){ if(['J','Q','K'].includes(card.value)) return 10; if(card.value==='A') return 11; return parseInt(card.value); }
    function handValue(hand){ let total=0, aces=0; for(let c of hand){ total+=cardValue(c); if(c.value==='A') aces++; } while(total>21 && aces>0){ total-=10; aces--; } return total; }
    function drawCard(){ return deck.pop(); }

    let players=[]; // includes human and bots
    let dealer={hand:[], name:'Dealer'};
    let currentPlayerIndex=0;
    let currentBet = 100;
    let dealerReveal = false;

    function placePlayers() {
      table.innerHTML = '';

      const centerX = table.clientWidth / 2;
      const centerY = table.clientHeight / 2;
      const cardW = 80;
      const cardH = 120;

      // binnenradius: dealer & speler, iets binnen de rand
      const innerRadius = Math.min(centerX, centerY) - 120;

      // buitenradius: bots, op de rand van de tafel
      const outerRadius = Math.min(centerX, centerY) - 70;

      // hoeken: dealer boven (12 uur), speler onder (6 uur)
      const dealerAngle = -Math.PI / 2;
      const playerAngle =  Math.PI / 2;

      const botCount = Math.max(0, players.length - 1);

      function getPos(radius, angle) {
        return {
          x: centerX + radius * Math.cos(angle) - cardW / 2,
          y: centerY + radius * Math.sin(angle) - cardH / 2
        };
      }

      function createPlayerArea(label, hand, angle, radius, isActive) {
        const pos = getPos(radius, angle);

        const div = document.createElement('div');
        div.className = 'player-area';
        if (isActive) div.classList.add('active-player');
        div.style.left = pos.x + 'px';
        div.style.top = pos.y + 'px';

        const cardsHTML = hand.map(c =>
          `<div class="card-bj">${c.value}${c.suit}</div>`
        ).join('');

        div.innerHTML = `
          <h3>${label}</h3>
          <div class="cards">${cardsHTML}</div>
          <p>Score: ${handValue(hand)}</p>
        `;

        table.appendChild(div);
      }

      // Dealer (met eventueel verborgen eerste kaart)
      (function(){
        const radius = innerRadius;
        const angle = dealerAngle;
        const pos = {
          x: centerX + radius * Math.cos(angle) - cardW / 2,
          y: centerY + radius * Math.sin(angle) - cardH / 2
        };
        const div = document.createElement('div');
        div.className = 'player-area';
        div.style.left = pos.x + 'px';
        div.style.top = pos.y + 'px';

        let cardsHTML = '';
        if (!dealerReveal && dealer.hand.length > 0) {
          cardsHTML += `<div class="card-bj card-back"></div>`;
          for (let i = 1; i < dealer.hand.length; i++) {
            const c = dealer.hand[i];
            cardsHTML += `<div class="card-bj">${c.value}${c.suit}</div>`;
          }
        } else {
          cardsHTML = dealer.hand.map(c => `<div class="card-bj">${c.value}${c.suit}</div>`).join('');
        }

        const scoreText = dealerReveal ? handValue(dealer.hand) : '?';

        div.innerHTML = `
          <h3>Dealer</h3>
          <div class="cards">${cardsHTML}</div>
          <p>Score: ${scoreText}</p>
        `;
        table.appendChild(div);
      })();

      // Speler (altijd players[0])
      if (players.length > 0) {
        const isActivePlayer = currentPlayerIndex === 0;
        createPlayerArea(players[0].name, players[0].hand, playerAngle, innerRadius, isActivePlayer);
      }

      // Bots: vaste posities rond de rand, met ruimte onder voor de knoppen
      if (botCount > 0) {
        const masterAngles = [
          -3*Math.PI/4,  // linksboven
          -Math.PI/4,    // rechtsboven
          Math.PI,       // links
          0,             // rechts
          3*Math.PI/4,   // linksonder
          Math.PI/4      // rechtsonder
        ];
        const usedAngles = masterAngles.slice(0, botCount);

        for (let i = 1; i < players.length; i++) {
          const angle = usedAngles[i - 1];
          const isActiveBot = currentPlayerIndex === i;
          createPlayerArea(players[i].name, players[i].hand, angle, outerRadius, isActiveBot);
        }
      }
    }

    function renderGame() {
      placePlayers();
    }

    function nextPlayer() {
      currentPlayerIndex++;
      if (currentPlayerIndex >= players.length) {
        dealerTurn();
      } else if (players[currentPlayerIndex].bot) {
        botTurn(players[currentPlayerIndex]);
      }
      renderGame();
    }

    function botTurn(bot){
      let hv = handValue(bot.hand);
      while(hv<16){
        bot.hand.push(drawCard());
        hv=handValue(bot.hand);
      }
      nextPlayer();
    }

    function dealerTurn(){
      dealerReveal = true;
      renderGame();
      let hv = handValue(dealer.hand);
      while(hv<17){
        dealer.hand.push(drawCard());
        hv=handValue(dealer.hand);
      }
      renderGame();
      checkWinners();
    }

    function checkWinners(){
      const dealerScore=handValue(dealer.hand);
      let resultMsg=`Dealer heeft ${dealerScore}.\n`;

      for(let i=0;i<players.length;i++){
        const p=players[i];
        const ps=handValue(p.hand);
        let outcome='lose';
        if(ps>21){
          resultMsg+=`${p.name} verliest (bust).\n`;
          outcome='lose';
        } else if(dealerScore>21 || ps>dealerScore){
          resultMsg+=`${p.name} wint!\n`;
          outcome='win';
        } else if(ps===dealerScore){
          resultMsg+=`${p.name} gelijkspel.\n`;
          outcome='push';
        } else{
          resultMsg+=`${p.name} verliest.\n`;
          outcome='lose';
        }

        if(i===0 && currentUser){
          let delta = 0;
          if(outcome==='win') delta = Math.floor(currentBet*1.5);
          else if(outcome==='push') delta = Math.floor(currentBet*1.0);
          else delta = 0;
          currentUser.credits += delta;
          if(outcome==='win'){
            applyLuckyCoinProgress(delta);
          }
          currentUser.gamesPlayed = (currentUser.gamesPlayed||0)+1;
          if(outcome==='win'){ currentUser.wins=(currentUser.wins||0)+1; currentUser.totalEarned=(currentUser.totalEarned||0)+delta; currentUser.bjWins=(currentUser.bjWins||0)+1; }
          else if(outcome==='lose'){ currentUser.losses=(currentUser.losses||0)+1; currentUser.bjLosses=(currentUser.bjLosses||0)+1; }
          currentUser.bjGames=(currentUser.bjGames||0)+1;
        }
      }

      alert(resultMsg);
      nextRoundBtn.style.display='inline';
      hitBtn.style.display='none';
      standBtn.style.display='none';

      if(currentUser){
        saveCurrentUser().then(renderDashboard);
      }
    }

    function startRound(){
      if(!currentUser) return;
      const requestedBet = parseInt(betAmountInput.value)||100;
      if(currentUser.credits < requestedBet){
        alert('Je hebt niet genoeg credits voor deze inzet.');
        return;
      }
      currentBet = requestedBet;
      currentUser.credits -= currentBet;
      saveCurrentUser().then(renderDashboard);

      dealerReveal = false;
      createDeck();
      dealer.hand=[drawCard(), drawCard()];
      players.forEach(p=>p.hand=[drawCard(), drawCard()]);
      currentPlayerIndex=0;
      renderGame();
      if(players[0].bot) botTurn(players[0]);
      hitBtn.style.display='inline';
      standBtn.style.display='inline';
      nextRoundBtn.style.display='none';
    }

    startGameBtn.onclick = ()=>{
      if(!currentUser) return alert('Je moet eerst inloggen!');
      const botCount=parseInt(botSelect.value);
      players=[{ name:currentUser.name, bot:false, hand:[] }];
      for(let i=1;i<=botCount;i++) players.push({ name:`Bot ${i}`, bot:true, hand:[] });
      dealer.hand=[];
      startRound();
    };

    hitBtn.onclick = ()=>{
      const p = players[currentPlayerIndex];
      p.hand.push(drawCard());
      if(handValue(p.hand)>21) nextPlayer();
      renderGame();
    };

    standBtn.onclick = ()=>{ nextPlayer(); };
    nextRoundBtn.onclick = ()=>{ nextRoundBtn.style.display='none'; startRound(); };

    /* ---------------------------
       Poker logic (bestaande logica)
       --------------------------- */

    const pkSuits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
    const pkValues = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    let pkDeck = [];

    function pkCreateDeck(){
      pkDeck=[];
      for(let s of pkSuits) for(let v of pkValues) pkDeck.push({suit:s,value:v});
      for(let i=pkDeck.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [pkDeck[i],pkDeck[j]]=[pkDeck[j],pkDeck[i]]; }
    }

    let pokerPlayers = [];
    let pokerPot = 0;
    let pokerSidePot = 0;
    let pokerCommunity = [];
    let pokerCurrentPlayerIndex = 0;
    let pokerTableMin = 500;

    function pkDraw(){ return pkDeck.pop(); }

    function pkRender(){
      pokerPotEl.textContent = pokerPot;
      pokerSidePotEl.textContent = pokerSidePot;
      pokerCommunityEl.innerHTML = pokerCommunity.map(c=>`<div class="card-pk">${c.value}${c.suit}</div>`).join('');
      pokerPlayersEl.innerHTML = pokerPlayers.map((p,i)=>{
        const isYou = currentUser && p.key===currentUser.key;
        return `<div class="poker-player">
          <h4>${p.name} ${isYou?'(jij)':''} ${i===pokerCurrentPlayerIndex?'‚Üê':''}</h4>
          <div class="hand">${p.hand.map(c=>`<div class="card-pk">${c.value}${c.suit}</div>`).join('')}</div>
          <div class="poker-info-row">Stack: ${p.stack}</div>
          <div class="poker-info-row">Ingezet: ${p.bet} (committed: ${p.committed})</div>
          <div class="poker-seat-row">Seat ${p.seat} ${p.folded?'[FOLDED]':''} ${p.allIn?'[ALL-IN]':''}</div>
        </div>`;
      }).join('');
    }

    function pkNewHand(){
      pkCreateDeck();
      pokerPot = 0;
      pokerSidePot = 0;
      pokerCommunity = [];
      pokerPlayers.forEach(p=>{
        p.hand = [pkDraw(), pkDraw()];
        p.bet = 0;
        p.committed = 0;
        p.folded = false;
        p.allIn = false;
      });
      pokerCurrentPlayerIndex = 0;
      pkRender();
      pokerStatusEl.textContent = 'Nieuwe hand gestart.';
    }

    function PK_addBotsIfNeeded(){
      const desiredSeats = 6;
      const occupiedSeats = new Set(pokerPlayers.map(p=>p.seat));
      let nextSeat = 1;
      while(occupiedSeats.size < desiredSeats){
        while(occupiedSeats.has(nextSeat)) nextSeat++;
        const seatIdx = nextSeat;
        occupiedSeats.add(seatIdx);
        const nextIdx = pokerPlayers.filter(p=>p.isBot).length + 1;
        const player = {
          key: 'bot'+nextIdx,
          name: 'Bot '+nextIdx,
          stack: 2000,
          entryStack: 2000,
          hand: [],
          bet: 0,
          committed: 0,
          folded: false,
          allIn: false,
          isBot: true,
          seat: seatIdx
        };
        pokerPlayers.push(player);
      }
    }

    joinPokerBtn.onclick = ()=>{
      if(!currentUser) return alert('Je moet inloggen.');
      const min = parseInt(pokerTableSelect.value)||500;
      if(currentUser.credits < min){
        alert('Je hebt niet genoeg credits voor deze tafel.');
        return;
      }
      pokerTableMin = min;

      if(pokerPlayers.some(p=>p.key===currentUser.key)){
        alert('Je zit al aan de tafel.');
        return;
      }

      currentUser.credits -= pokerTableMin;
      currentUser.entryStack = pokerTableMin;
      const seat = pokerPlayers.length ? Math.max(...pokerPlayers.map(p=>p.seat))+1 : 1;
      pokerPlayers.push({
        key: currentUser.key,
        name: currentUser.name,
        stack: pokerTableMin,
        entryStack: pokerTableMin,
        hand:[],
        bet:0,
        committed:0,
        folded:false,
        allIn:false,
        isBot:false,
        seat
      });

      PK_addBotsIfNeeded();
      saveCurrentUser().then(renderDashboard);
      pkNewHand();
      pokerSection.style.display='block';
      dashboard.style.display='none';
    };

    leavePokerBtn.onclick = ()=>{
      if(!currentUser) return;
      const idx = pokerPlayers.findIndex(p=>p.key===currentUser.key);
      if(idx===-1){
        alert('Je zit niet aan de tafel.');
        return;
      }
      const pl = pokerPlayers[idx];
      currentUser.credits += pl.stack;
      pokerPlayers.splice(idx,1);
      saveCurrentUser().then(()=>{
        renderDashboard();
        alert('Tafel verlaten. Je hebt nu weer '+currentUser.credits+' credits.');
      });
    };

    backFromPokerBtn.onclick = ()=>{
      pokerSection.style.display = 'none';
      blackjackSection.style.display = 'none';
      dashboard.style.display = 'block';
    };

    pokerCheckBtn.onclick = ()=>{
      pokerStatusEl.textContent = 'Check / Call uitgevoerd (demo).';
    };
    pokerBetBtn.onclick = ()=>{
      pokerStatusEl.textContent = 'Bet / Raise uitgevoerd (demo).';
    };
    pokerFoldBtn.onclick = ()=>{
      pokerStatusEl.textContent = 'Fold (demo).';
    };
// ==================== PAARDENRACE LOGICA (GEFIXT) ====================

const horseRaceSection = document.getElementById("horseRaceSection");
const startRaceBtn = document.getElementById("startRaceBtn");
const backToMenuRace = document.getElementById("backToMenuRace");
const horseBetInput = document.getElementById("horseBet");
const horseSelect = document.getElementById("horseSelect");

const horses = [
    document.getElementById("horse1"),
    document.getElementById("horse2"),
    document.getElementById("horse3"),
    document.getElementById("horse4")
];

function showHorseRace(){
    dashboard.style.display = "none";
    blackjackSection.style.display = "none";
    pokerSection.style.display = "none";
    crapsSection.style.display = "none";
    baccaratSection.style.display = "none";
    rouletteSection.style.display = "none";
    horseRaceSection.style.display = "block";
}

backToMenuRace.onclick = () => {
    horseRaceSection.style.display = "none";
    dashboard.style.display = "block";
};

// START RACE
startRaceBtn.onclick = async () => {
    const bet = parseInt(horseBetInput.value);
    const chosenHorse = parseInt(horseSelect.value);

    if (bet < 10) return alert("Minimum inzet is 10 credits.");
    if (currentUser.credits < bet) return alert("Je hebt niet genoeg credits!");

    // credits afschrijven
    currentUser.credits -= bet;
    await db.ref("users/" + currentUser.key).update({
        credits: currentUser.credits
    });
    renderDashboard();

    // reset horse positions
    horses.forEach(h => h.style.left = "0px");

    let finished = false;
    let winner = null;

    function raceTick(){
        horses.forEach((horse, index) => {
            if(finished) return;

            let move = Math.random() * 25 + 5; // smooth movement
            horse.style.left = (horse.offsetLeft + move) + "px";

            if(horse.offsetLeft >= 820){ // finish line
                finished = true;
                winner = index + 1;

                if(winner === chosenHorse){
                    const winAmount = bet * 3;
                    currentUser.credits += winAmount;
                    applyLuckyCoinProgress(winAmount);

                    db.ref("users/" + currentUser.key).update({
                        credits: currentUser.credits,
                        luckyCoins: currentUser.luckyCoins,
                        luckyCoinProgress: currentUser.luckyCoinProgress
                    });

                    alert("üéâ Je paard heeft gewonnen! +" + winAmount + " credits");

                } else {
                    alert("‚ùå Paard " + winner + " won. Je hebt verloren.");
                }

                renderDashboard();
            }
        });

        if(!finished){
            requestAnimationFrame(raceTick);
        }
    }

    raceTick();
};

    /* ---------------------------
       Leaderboard popup
       --------------------------- */
    let lbIndex = 0;
    const lbTypes = ['earnings','winrate','bjwinrate','pkwinrate'];

    async function loadUsersArrayFromDb(){
      const snap = await db.ref('users').once('value');
      const obj = snap.val() || {};
      return Object.entries(obj).map(([k,u])=>({
        key: k,
        name: u.name,
        totalEarned: u.totalEarned||0,
        wins: u.wins||0,
        losses: u.losses||0,
        games: u.gamesPlayed||0,
        bjWins: u.bjWins||0,
        bjLosses: u.bjLosses||0,
        bjGames: u.bjGames||0,
        pkWins: u.pkWins||0,
        pkLosses: u.pkLosses||0,
        pkGames: u.pkGames||0
      }));
    }

    async function openLeaderboard(){
      lbPopup.style.display='block';
      const type = lbTypes[lbIndex];
      let title = '';
      if(type==='earnings') title = 'All-Time Earnings';
      else if(type==='winrate') title = 'Win Percentage (overall)';
      else if(type==='bjwinrate') title = 'Blackjack Win Percentage';
      else if(type==='pkwinrate') title = 'Poker Win Percentage';
      lbTitle.textContent = title;

      const arr = await loadUsersArrayFromDb();

      if(type==='earnings'){
        arr.sort((a,b)=>b.totalEarned-a.totalEarned);
      } else if(type==='winrate'){
        arr.sort((a,b)=>{
          const ra=a.games?(a.wins/a.games):0;
          const rb=b.games?(b.wins/b.games):0;
          return rb-ra;
        });
      } else if(type==='bjwinrate'){
        arr.sort((a,b)=>{
          const ra=a.bjGames?(a.bjWins/a.bjGames):0;
          const rb=b.bjGames?(b.bjWins/b.bjGames):0;
          return rb-ra;
        });
      } else if(type==='pkwinrate'){
        arr.sort((a,b)=>{
          const ra=a.pkGames?(a.pkWins/a.pkGames):0;
          const rb=b.pkGames?(b.pkWins/b.pkGames):0;
          return rb-ra;
        });
      }

      let html='';
      const top=arr.slice(0,10);
      top.forEach((u,i)=>{
        const isYou=currentUser && (u.key===currentUser.key);
        let extra = '';
        if(type==='earnings') extra = '‚Äî '+u.totalEarned+' credits';
        else if(type==='winrate') extra = '‚Äî '+(u.games?Math.round(100*u.wins/u.games):0)+'%';
        else if(type==='bjwinrate') extra = '‚Äî '+(u.bjGames?Math.round(100*u.bjWins/u.bjGames):0)+'%';
        else if(type==='pkwinrate') extra = '‚Äî '+(u.pkGames?Math.round(100*u.pkWins/u.pkGames):0)+'%';
        html+=`<div style="padding:6px 0">${i+1}. <strong>${u.name}</strong> ${isYou?'<em>(jij)</em>':''} ${extra}</div>`;
      });

      let yourRank=-1;
      if(currentUser) yourRank=arr.findIndex(x=>x.key===currentUser.key);
      if(yourRank>9){
        const u=arr[yourRank];
        let extra = '';
        if(type==='earnings') extra = '‚Äî '+u.totalEarned+' credits';
        else if(type==='winrate') extra = '‚Äî '+(u.games?Math.round(100*u.wins/u.games):0)+'%';
        else if(type==='bjwinrate') extra = '‚Äî '+(u.bjGames?Math.round(100*u.bjWins/u.bjGames):0)+'%';
        else if(type==='pkwinrate') extra = '‚Äî '+(u.pkGames?Math.round(100*u.pkWins/u.pkGames):0)+'%';
        html+=`<hr><div style="padding:6px 0">${yourRank+1}. <strong>${u.name}</strong> ${extra}</div>`;
      } else if(yourRank===-1 && currentUser){
        html+=`<hr><div style="padding:6px 0">Jij staat nog niet in de statistieken.</div>`;
      }
      lbContent.innerHTML=html;
    }

    lbTab.onclick = ()=>{ lbIndex=0; openLeaderboard(); };
    lbClose.onclick = ()=>{ lbPopup.style.display='none'; };
    lbLeft.onclick = ()=>{ lbIndex=(lbIndex-1+lbTypes.length)%lbTypes.length; openLeaderboard(); };
    lbRight.onclick = ()=>{ lbIndex=(lbIndex+1)%lbTypes.length; openLeaderboard(); };

  </script>
</body>
</html>
